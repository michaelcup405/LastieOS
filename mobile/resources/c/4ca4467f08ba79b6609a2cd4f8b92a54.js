var exports={};var settings={"domain":"https:\/\/onlinesequencer.net","template":"default","instruments":["Elec. Piano (Classic)","Acoustic Guitar","Drum Kit","Smooth Synth (Classic)","Electric Guitar","Bass Guitar (Classic)","Synth Pluck","Scifi","Grand Piano (Classic)","French Horn","Trombone","Violin","Cello","8-Bit Sine","8-Bit Square","8-Bit Sawtooth","8-Bit Triangle","Harpsichord","Concert Harp","Xylophone","Pizzicato","Steel Drums","Sitar","Flute","Saxophone","Ragtime Piano","Music Box","Synth Bass (Classic)","Church Organ","Slap Bass","Pop Synth (Classic)","Electric Drum Kit","Jazz Guitar","Koto","Vibraphone","Muted E-Guitar","808 Drum Kit","808 Bass","Distortion Guitar","8-Bit Drum Kit","2013 Drum Kit","Grand Piano","909 Drum Kit","Electric Piano","Dist. Guitar (Sustain)","Cello (Sustain)","Violin (Sustain)","Strings (Sustain)","Bass","Clean Guitar","French Horn (Sustain)","Trombone (Sustain)","Smooth Synth","2023 Drum Kit","Bass Guitar","Synthesizer","Synth Bass (Sustain)","Pop Synth (Sustain)"],"fadeTimes":{"4":0.01,"23":0.01,"49":0.2,"44":0.2,"50":0.5,"51":0.5,"52":2.5,"53":0.1,"54":0.2,"57":0.2,"56":0.2},"min":[0,0,3,0,0,0,0,12,0,16,16,31,12,0,0,0,0,7,12,31,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,7,3,7,7,7,7,0,3,0,12,12,31,0,4,0,0,0,0,0,0,0,0,0],"max":[71,59,63,59,59,35,59,71,71,47,55,70,48,71,71,71,71,65,59,70,71,71,71,71,71,71,71,71,71,67,71,63,59,71,71,59,20,28,62,12,34,71,22,71,62,48,70,71,37,64,59,59,71,71,35,71,71,71],"originalBpm":[30,15,10,20,30,20,20,20,15,30,30,40,40,0,0,0,0,30,10,25,20,30,20,20,30,30,20,20,10,20,20,20,20,30,20,20,10,10,10,20,16.26,0,30,0,0,0,0,0,0,0,0,0,0,6,0,0,0,0],"volume":[0.25,0.5,0.4,0.8,0.8,0.8,0.65,0.8,0.3,0.2,0.2,0.55,0.1,0.1,0.1,0.1,0.1,0.3,0.3,0.3,1.3,1.3,1.5,1,1,1.5,1.5,1,1,1,1,0.8,1,1.3,1,1,1,0.5,1,1,1,0.4,2.8,0.18,0.3,1,0.55,1,0.6,0.4,0.5,0.5,0.8,0.8,0.8,0.1,0.3,0.3],"midiInstrumentMap":[1,25,1,81,30,33,88,100,1,61,58,41,43,83,81,82,88,7,46,14,46,115,105,74,65,4,11,39,20,37,51,1,27,108,12,29,1,1,31,1,1,1,1,1,43,43,41,44,33,28,61,58,81,1,33,0,39,51],"audioVersion":20,"instrumentCloneOffset":10000,"volumeWeights":[1,0.7692,{"D#7":0.6667,"D7":0.5882,"C#7":0.5,"C7":0.5,"B6":0.6667,"A#6":0.6667,"A6":0.7692,"G#6":0.5714,"G6":0.5,"F#6":0.5,"F6":0.5,"E6":0.5,"D#6":0.5882,"D6":0.625,"C#6":0.625,"C6":0.8333,"B5":0.7692,"A#5":0.5882,"A5":0.6667,"G#5":0.625,"G5":0.625,"F#5":0.6667,"F5":0.6667,"E5":0.5,"D#5":0.5,"D5":0.5,"C#5":0.5263,"C5":0.5,"B4":0.625,"A#4":0.6667,"A4":0.8333,"G#4":0.6667,"G4":0.7143,"F#4":0.6667,"F4":0.7143,"E4":1,"D#4":0.5882,"D4":0.5,"C#4":1,"C4":0.7143,"B3":0.625,"A#3":1,"A3":0.5882,"G#3":0.5,"G3":0.5,"F#3":0.5556,"F3":0.5556,"E3":0.7143,"D#3":0.8333,"D3":0.625,"C#3":0.625,"C3":0.5,"B2":0.5,"A#2":0.7692,"A2":0.5,"G#2":0.5,"G2":0.5882,"F#2":0.5882,"F2":0.6667,"E2":0.8333,"D#2":0.5},1.25,1.25,1,0.9091,1.25,1,1,1.25,1,0.5882,0.7143,1.4286,1.1111,0.7692,1.25,0.625,1,0.8333,0.9091,1.1765,0.6667,1,1,0.8696,1,0.625,1.1111,1.1111,{"D#7":0.625,"D7":0.6667,"C#7":0.7143,"C7":1.3333,"B6":1.3333,"A#6":1.25,"A6":1.25,"G#6":1,"G6":0.6667,"F#6":0.6897,"F6":0.5,"E6":0.5,"D#6":1,"D6":1.25,"C#6":0.8333,"C6":1.25,"B5":1.2,"A#5":0.7692,"A5":0.8696,"G#5":0.7692,"G5":0.7407,"F#5":0.8,"F5":0.7407,"E5":0.5882,"D#5":0.5,"D5":0.625,"C#5":0.5263,"C5":0.625,"B4":0.9524,"A#4":1.4286,"A4":1.4286,"G#4":0.9524,"G4":0.8,"F#4":0.6667,"F4":0.6667,"E4":1.0526,"D#4":0.6667,"D4":0.7692,"C#4":1,"C4":0.9524,"B3":1,"A#3":1.3333,"A3":1.1111,"G#3":0.9091,"G3":0.7143,"F#3":0.4545,"F3":0.7692,"E3":1,"D#3":1.5385,"D3":1,"C#3":0.6897,"C3":0.9091,"B2":0.9091,"A#2":0.8,"A2":0.5,"G#2":0.4,"G2":0.9091,"F#2":1,"F2":1,"E2":0.625,"D#2":0.8},0.9091,1.25,1.1765,1.3333,{"G#3":2,"G3":4,"F#3":3.5714,"F3":1.4286,"E3":1.4286,"D#3":1.6667,"D3":1.6667,"C#3":2.2222,"C3":4,"B2":2.8571,"A#2":1.6667,"A2":2,"G#2":2.5,"G2":4,"F#2":2.8571,"F2":1.5385,"E2":1,"D#2":1},1.25,1.1111,{"C3":2.5,"B2":1.8182,"A#2":1.8182,"A2":0.8333,"G#2":1,"G2":1.25},{"A#4":1.6667,"A4":3.3333,"G#4":2.5,"G4":2.5,"F#4":0.25,"F4":2.5,"E4":2.5,"D#4":2.5,"D4":2.5,"C#4":2,"C4":2.8571,"B3":1.25,"A#3":1.5385,"A3":2.5,"G#3":2.2222,"G3":1.4286,"F#3":0.9091,"F3":2.5,"E3":1.3333,"D#3":1.6667,"D3":1.1111,"C#3":1.5385,"C3":2.2222,"B2":3.6364,"A#2":4,"A2":2.5,"G#2":2.5,"G2":1.6667},0.9524,{"A#3":0.9524,"A3":1.6667,"G#3":1.5385,"G3":1.5385,"F#3":1.25,"F3":0.8696,"E3":1.6667,"D#3":1.25,"D3":1.1111,"C#3":0.8696,"C3":0.8333,"B2":0.7407,"A#2":0.9091,"A2":0.7692,"G#2":1.5385,"G2":2,"F#2":2,"F2":1.8182,"E2":1.8182,"D#2":1.8182},0.9524,0.9524,0.9524,1,1,1,1,1,1.25,1.25,1,1,1,1,1.1111],"instrumentCategories":{"Piano":[43,41,17,25,26,0,8],"Percussion (MIDI)":[2,31,19,34,21],"Percussion (Classic)":[39,40,36,42,53],"Guitar":[1,4,48,54,5,29,32,35,38,44,49,22,33],"Electronic":[55,52,6,7,13,14,15,16,30,57,27,56,37],"Orchestra":[9,50,10,51,11,46,12,45,18,20,23,47,24,28]},"instrumentCategoryIcons":{"Piano":"<i class=\"fas fa-piano-keyboard\"><\/i>","Percussion (MIDI)":"<i class=\"fas fa-drum\"><\/i>","Percussion (Classic)":"<i class=\"fas fa-drum\"><\/i>","Guitar":"<i class=\"fas fa-guitar\"><\/i>","Electronic":"<i class=\"fas fa-alien-monster\"><\/i>","Synthesizer":"<i class=\"fas fa-waveform-path\"><\/i>","Orchestra":"<i class=\"fas fa-trumpet\"><\/i>","Testing":"<i class=\"fas fa-flask\"><\/i>"},"instrumentColors":[[255,3,169,244],[255,255,152,0],[255,183,28,28],[255,233,30,99],[255,76,175,80],[255,33,33,33],[255,63,81,181],[255,205,220,57],[255,21,101,192],[255,130,119,23],[255,255,234,0],[255,141,110,99],[255,78,52,46],[255,255,99,99],[255,117,255,99],[255,99,224,255],[255,253,99,255],[255,255,87,34],[255,27,94,32],[255,244,67,54],[255,255,224,178],[255,117,117,117],[255,224,173,0],[255,233,249,189],[255,168,200,83],[255,13,71,161],[255,29,157,157],[255,30,197,122],[255,21,33,79],[255,5,16,47],[255,108,243,183],[255,255,112,112],[255,161,166,53],[255,234,121,0],[255,85,202,202],[255,0,128,64],[255,127,15,72],[255,0,0,0],[255,0,69,31],[255,159,15,34],[255,130,5,21],[255,21,101,192],[255,152,0,254],[255,3,169,244],[255,0,69,31],[255,78,52,46],[255,141,110,99],[255,142,118,255],[255,33,33,33],[255,224,211,24],[255,130,119,23],[255,255,234,0],[255,233,30,99],[255,113,0,166],[255,33,33,33],[255,255,255,255],[255,30,197,122],[255,108,243,183],[234,234,234]],"typingKeyboard":["zxcvbnm,.\/","asdfghjkl;'","qwertyuiop[]"],"punctuationCodes":{"BracketLeft":"[","BracketRight":"]","Backslash":"\\","Semicolon":";","Quote":"'","Comma":",","Period":".","Slash":"\/"},"clipboardMagicString":"Online Sequencer","piano":["C2","C#2","D2","D#2","E2","F2","F#2","G2","G#2","A2","A#2","B2","C3","C#3","D3","D#3","E3","F3","F#3","G3","G#3","A3","A#3","B3","C4","C#4","D4","D#4","E4","F4","F#4","G4","G#4","A4","A#4","B4","C5","C#5","D5","D#5","E5","F5","F#5","G5","G#5","A5","A#5","B5","C6","C#6","D6","D#6","E6","F6","F#6","G6","G#6","A6","A#6","B6","C7","C#7","D7","D#7","E7","F7","F#7","G7","G#7","A7","A#7","B7"],"pianoNotes":["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],"scaleNames":["No Key Guide","C Major","C# Major","D Major","D# Major","E Major","F Major","F# Major","G Major","G# Major","A Major","A# Major","B Major","C Minor","C# Minor","D Minor","D# Minor","E Minor","F Minor","F# Minor","G Minor","G# Minor","A Minor","A# Minor","B Minor"],"scaleOctaves":[0,6,5,5,4,4,3,3,2,1,1,0,0,6,6,5,5,4,3,3,2,2,1,0,0],"scales":[[],["C","D","E","F","G","A","B","C","D","E","F","G"],["C#","D#","F","F#","G#","A#","C","C#","D#","F","F#","G#"],["D","E","F#","G","A","B","C#","D","E","F#","G","A"],["D#","F","G","G#","A#","C","D","D#","F","G","G#","A#"],["E","F#","G#","A","B","C#","D#","E","F#","G#","A","B"],["F","G","A","A#","C","D","E","F","G","A","A#","C"],["F#","G#","A#","B","C#","D#","F","F#","G#","A#","B","C#"],["G","A","B","C","D","E","F#","G","A","B","C","D"],["G#","A#","C","C#","D#","F","G","G#","A#","C","C#","D#"],["A","B","C#","D","E","F#","G#","A","B","C#","D","E"],["A#","C","D","D#","F","G","A","A#","C","D","D#","F"],["B","C#","D#","E","F#","G#","A#","B","C#","D#","E","F#"],["C","D","D#","F","G","G#","A#","C","D","D#","F","G"],["C#","D#","E","F#","G#","A","B","C#","D#","E","F#","G#"],["D","E","F","G","A","A#","C","D","E","F","G","A"],["D#","F","F#","G#","A#","B","C#","D#","F","F#","G#","A#"],["E","F#","G","A","B","C","D","E","F#","G","A","B"],["F","G","G#","A#","C","C#","D#","F","G","G#","A#","C"],["F#","G#","A","B","C#","D","E","F#","G#","A","B","C#"],["G","A","A#","C","D","D#","F","G","A","A#","C","D"],["G#","A#","B","C#","D#","E","F#","G#","A#","B","C#","D#"],["A","B","C","D","E","F","G","A","B","C","D","E"],["A#","C","C#","D#","F","F#","G#","A#","C","C#","D#","F"],["B","C#","D","E","F#","G","A","B","C#","D","E","F#"]],"percussion":["Open Surdo","Closed Surdo","Castanets","Belltree","Jingle Bell","Shaker","Open Triangle","Mute Triangle","Open Cuica","Mute Cuica","Low Woodblock","High Woodblock","Claves","Long Guiro","Short Guiro","Long Lo Whistle","Short Hi Whistle","Maracas","Cabasa","Low Agogo","High Agogo","Low Timbale","High Timbale","Low Conga","Open Hi Conga","Mute Hi Conga","Low Bongo","High Bongo","Ride Cymbal 2","Vibra-Slap","Crash Cymbal 2","Cowbell","Splash Cymbal","Tambourine","Ride Bell","Chinese Cymbal","Ride Cymbal","High Tom 1","Crash Cymbal","High Tom 2","Mid Tom 1","Open Hi-Hat","Mid Tom 2","Pedal Hi-Hat","Low Tom 1","Closed Hi-Hat","Low Tom 2","Snare Drum 2","Hand Clap","Snare Drum 1","Side Stick","Kick Drum 1","Kick Drum 2","Metronome Bell","Metronome Click","Square Click","Sticks","Scratch Pull","Scratch Push","Slap","High Q"],"percussion_808":["Click","High Tom","808 Cowbell","Mid Tom 1","Mid Tom 2","Low Tom 1","Low Tom 2","808 Cymbal","Open Hi-Hat","Closed Hi-Hat","Snare Click","Snare Drum 1","Snare Drum 2","Hand Clap 1","Hand Clap 2","Kick Drum 1","Kick Drum 2","Kick Drum 3"],"percussion_8bit":["Snare Drum 1","Snare Drum 2","Snare Drum 3","Hi-Hat","Snare Drum 4","Kick Drum"],"percussion_2013":["Snare Drum 6","Crash Cymbal 4","Snare Drum 5","Ride Bell 2","Ride Cymbal 2","Crash Cymbal 3","Cowbell","Splash Cymbal","Tambourine"," Ride Bell 1","Crash Cymbal 2","Ride Cymbal 1","Mid Tom 2","Crash Cymbal 1","Mid Tom 1"," Low Tom 4","Loose Hi-Hat"," Low Tom 3","Open Hi-Hat"," Low Tom 2","Closed Hi-Hat","Low Tom 1","Snare Drum 4","Snare Drum 3","Snare Drum 2","Snare Drum 1","Kick Drum 2","Kick Drum"],"percussion_909":["Ride Cymbal","Crash Cymbal","Open Hi-Hat 1","Open Hi-Hat 2","Closed Hi-Hat 1","Closed Hi-Hat 2","Clap","Rim","High Tom 1","High Tom 2","Mid Tom 1","Mid Tom 2","Low Tom 1","Low Tom 2","Snare Drum 1","Snare Drum 2","Snare Drum 3","Kick Drum 1","Kick Drum 2","Kick Drum 3","a"],"percussion_2023":["Marimba C6","Marimba C5","Marimba C4","Orchestra Hit C5","Timpani C5","Timpani A4","Timpani F4","Belltree","Vibraslap","Krin 3","Krin 2","Krin 1","Djembe Slap 3","Djembe Slap 2","Djembe Slap 1","Djembe Tone 2","Djembe Tone 1","Djembe Bass","Chenda Low","Chenda High","Udu Tin","Udu Ta","Tabla Ti","Tabla Ghran","Tabla Ghe","Mridangam Nam","Mridangam Thom","Low Agogo","High Agogo","Low Timbale","High Timbale","Low Conga","High Conga","Mute Conga","Low Bongo","High Bongo","Triangle","Bell","Jingle Bells","Tambourine","Clash Cymbals","Splash Cymbal 2","Splash Cymbal 1","Ride Bell 2","Ride Bell 1","Ride Cymbal 2","Ride Cymbal 1","Crash Cymbal 3","Crash Cymbal 2","Crash Cymbal 1","Hi-hat Splash","Hi-hat Pedal","Hi-hat Open","Hi-hat Closed","High Tom 2","Mid Tom 2","Low Tom 2","High Tom","Mid Tom","Low Tom","Snare Buzz","Snare Brush","Snare Rim Shot","Snare 2","Snare 1","Snare Side Stick","Kick 4","Kick 3","Kick 2","Kick 1","Bass Drum","Sticks"],"username":null,"uid":0,"logoutkey":null,"offline":false,"sampleSize":{"church_reverb.ogg":81791,"classic_reverb.ogg":78279,"gated_reverb.ogg":38987,"large_reverb.ogg":118362,"miasma.ogg":147053,"nova.ogg":172961,"proton.ogg":292025,"reverse.ogg":26261,"ripple.ogg":228765,"schema.ogg":119161,"short_reverb.ogg":28045,"small_reverb.ogg":24496,"sylph.ogg":144917,"0.mp3":995406,"1.mp3":1280853,"10.mp3":535310,"11.mp3":408490,"12.mp3":460530,"17.mp3":995322,"18.mp3":995852,"19.mp3":420466,"2.mp3":2897667,"20.mp3":614313,"21.mp3":447742,"22.mp3":707715,"23.mp3":1087523,"24.mp3":1016730,"25.mp3":458646,"26.mp3":580144,"27.mp3":1085433,"28.mp3":1512847,"29.mp3":620250,"3.mp3":1153009,"30.mp3":1301883,"31.mp3":578076,"32.mp3":491099,"33.mp3":525740,"34.mp3":594423,"35.mp3":551893,"36.mp3":264862,"37.mp3":334896,"38.mp3":934699,"39.mp3":55280,"4.mp3":455400,"40.mp3":1365382,"42.mp3":573187,"5.mp3":334221,"53.mp3":4719118,"6.mp3":1153009,"7.mp3":613180,"8.mp3":1311017,"9.mp3":409267,"0.ogg":912533,"1.ogg":950108,"10.ogg":673595,"11.ogg":546599,"12.ogg":531392,"17.ogg":984223,"18.ogg":957194,"19.ogg":656664,"2.ogg":495102,"20.ogg":1277545,"21.ogg":870674,"22.ogg":1112728,"23.ogg":1127851,"24.ogg":963439,"25.ogg":638273,"26.ogg":974380,"27.ogg":1094656,"28.ogg":1566455,"29.ogg":1074709,"3.ogg":1008282,"30.ogg":1203396,"31.ogg":983454,"32.ogg":569566,"33.ogg":763515,"34.ogg":894336,"35.ogg":765194,"36.ogg":201035,"37.ogg":474233,"38.ogg":1340951,"39.ogg":41819,"4.ogg":732685,"40.ogg":972645,"42.ogg":320221,"5.ogg":472132,"53.ogg":4135026,"6.ogg":1098883,"7.ogg":600258,"8.ogg":1529726,"9.ogg":510484,"41.mp3":2951997,"43.mp3":2641439,"44.mp3":4327677,"45.mp3":1353856,"46.mp3":3612974,"47.mp3":5230257,"48.mp3":4435661,"49.mp3":4122610,"50.mp3":1017992,"51.mp3":1141904,"52.mp3":3663595,"54.mp3":859184,"55.mp3":0,"56.mp3":3924719,"57.mp3":5340451,"41.ogg":2699806,"43.ogg":2047852,"44.ogg":2911750,"45.ogg":3540930,"46.ogg":3438297,"47.ogg":4860437,"48.ogg":734268,"49.ogg":5735069,"50.ogg":655451,"51.ogg":880138,"52.ogg":3362986,"54.ogg":1013033,"55.ogg":0,"56.ogg":3036031,"57.ogg":3895110},"numNotes":72,"numInstruments":58,"instrumentDisplayOrder":[43,41,17,25,26,0,8,2,31,19,34,21,39,40,36,42,53,1,4,48,54,5,29,32,35,38,44,49,22,33,55,52,6,7,13,14,15,16,30,57,27,56,37,9,50,10,51,11,46,12,45,18,20,23,47,24,28]};;(function(e,t,n){function s(t,n){this.bodyOverflowX;this.callbacks={hide:[],show:[]};this.checkInterval=null;this.Content;this.$el=e(t);this.$elProxy;this.elProxyPosition;this.enabled=true;this.options=e.extend({},i,n);this.mouseIsOverProxy=false;this.namespace="tooltipster-"+Math.round(Math.random()*1e5);this.Status="hidden";this.timerHide=null;this.timerShow=null;this.$tooltip;this.options.iconTheme=this.options.iconTheme.replace(".","");this.options.theme=this.options.theme.replace(".","");this._init()}
function o(t,n){var r=true;e.each(t,function(e,i){if(typeof n[e]==="undefined"||t[e]!==n[e]){r=false;return false}});return r}
function f(){return!a&&u}
function l(){var e=n.body||n.documentElement,t=e.style,r="transition";if(typeof t[r]=="string"){return true}
v=["Moz","Webkit","Khtml","O","ms"],r=r.charAt(0).toUpperCase()+r.substr(1);for(var i=0;i<v.length;i++){if(typeof t[v[i]+r]=="string"){return true}}
return false}
var r="tooltipster",i={animation:"fade",arrow:true,arrowColor:"",autoClose:true,content:null,contentAsHTML:false,contentCloning:true,debug:true,delay:200,minWidth:0,maxWidth:null,functionInit:function(e,t){},functionBefore:function(e,t){t()},functionReady:function(e,t){},functionAfter:function(e){},hideOnClick:false,icon:"(?)",iconCloning:true,iconDesktop:false,iconTouch:false,iconTheme:"tooltipster-icon",interactive:false,interactiveTolerance:350,multiple:false,offsetX:0,offsetY:0,onlyOne:false,position:"top",positionTracker:false,positionTrackerCallback:function(e){if(this.option("trigger")=="hover"&&this.option("autoClose")){this.hide()}},restoration:"current",speed:350,timer:0,theme:"tooltipster-default",touchDevices:true,trigger:"hover",updateAnimation:true};s.prototype={_init:function(){var t=this;if(n.querySelector){var r=null;if(t.$el.data("tooltipster-initialTitle")===undefined){r=t.$el.attr("title");if(r===undefined)r=null;t.$el.data("tooltipster-initialTitle",r)}
if(t.options.content!==null){t._content_set(t.options.content)}else{t._content_set(r)}
var i=t.options.functionInit.call(t.$el,t.$el,t.Content);if(typeof i!=="undefined")t._content_set(i);t.$el.removeAttr("title").addClass("tooltipstered");if(!u&&t.options.iconDesktop||u&&t.options.iconTouch){if(typeof t.options.icon==="string"){t.$elProxy=e('<span class="'+t.options.iconTheme+'"></span>');t.$elProxy.text(t.options.icon)}else{if(t.options.iconCloning)t.$elProxy=t.options.icon.clone(true);else t.$elProxy=t.options.icon}
t.$elProxy.insertAfter(t.$el)}else{t.$elProxy=t.$el}
if(t.options.trigger=="hover"){t.$elProxy.on("mouseenter."+t.namespace,function(){if(!f()||t.options.touchDevices){t.mouseIsOverProxy=true;t._show()}}).on("mouseleave."+t.namespace,function(){if(!f()||t.options.touchDevices){t.mouseIsOverProxy=false}});if(u&&t.options.touchDevices){t.$elProxy.on("touchstart."+t.namespace,function(){t._showNow()})}}else if(t.options.trigger=="click"){t.$elProxy.on("click."+t.namespace,function(){if(!f()||t.options.touchDevices){t._show()}})}}},_show:function(){var e=this;if(e.Status!="shown"&&e.Status!="appearing"){if(e.options.delay){e.timerShow=setTimeout(function(){if(e.options.trigger=="click"||e.options.trigger=="hover"&&e.mouseIsOverProxy){e._showNow()}},e.options.delay)}else e._showNow()}},_showNow:function(n){var r=this;r.options.functionBefore.call(r.$el,r.$el,function(){if(r.enabled&&r.Content!==null){if(n)r.callbacks.show.push(n);r.callbacks.hide=[];clearTimeout(r.timerShow);r.timerShow=null;clearTimeout(r.timerHide);r.timerHide=null;if(r.options.onlyOne){e(".tooltipstered").not(r.$el).each(function(t,n){var r=e(n),i=r.data("tooltipster-ns");e.each(i,function(e,t){var n=r.data(t),i=n.status(),s=n.option("autoClose");if(i!=="hidden"&&i!=="disappearing"&&s){n.hide()}})})}
var i=function(){r.Status="shown";e.each(r.callbacks.show,function(e,t){t.call(r.$el)});r.callbacks.show=[]};if(r.Status!=="hidden"){var s=0;if(r.Status==="disappearing"){r.Status="appearing";if(l()){r.$tooltip.clearQueue().removeClass("tooltipster-dying").addClass("tooltipster-"+r.options.animation+"-show");if(r.options.speed>0)r.$tooltip.delay(r.options.speed);r.$tooltip.queue(i)}else{r.$tooltip.stop().fadeIn(i)}}else if(r.Status==="shown"){i()}}else{r.Status="appearing";var s=r.options.speed;r.bodyOverflowX=e("body").css("overflow-x");e("body").css("overflow-x","hidden");var o="tooltipster-"+r.options.animation,a="-webkit-transition-duration: "+r.options.speed+"ms; -webkit-animation-duration: "+r.options.speed+"ms; -moz-transition-duration: "+r.options.speed+"ms; -moz-animation-duration: "+r.options.speed+"ms; -o-transition-duration: "+r.options.speed+"ms; -o-animation-duration: "+r.options.speed+"ms; -ms-transition-duration: "+r.options.speed+"ms; -ms-animation-duration: "+r.options.speed+"ms; transition-duration: "+r.options.speed+"ms; animation-duration: "+r.options.speed+"ms;",f=r.options.minWidth?"min-width:"+Math.round(r.options.minWidth)+"px;":"",c=r.options.maxWidth?"max-width:"+Math.round(r.options.maxWidth)+"px;":"",h=r.options.interactive?"pointer-events: auto;":"";r.$tooltip=e('<div class="tooltipster-base '+r.options.theme+'" style="'+f+" "+c+" "+h+" "+a+'"><div class="tooltipster-content"></div></div>');if(l())r.$tooltip.addClass(o);r._content_insert();r.$tooltip.appendTo("body");r.reposition();r.options.functionReady.call(r.$el,r.$el,r.$tooltip);if(l()){r.$tooltip.addClass(o+"-show");if(r.options.speed>0)r.$tooltip.delay(r.options.speed);r.$tooltip.queue(i)}else{r.$tooltip.css("display","none").fadeIn(r.options.speed,i)}
r._interval_set();e(t).on("scroll."+r.namespace+" resize."+r.namespace,function(){r.reposition()});if(r.options.autoClose){e("body").off("."+r.namespace);if(r.options.trigger=="hover"){if(u){setTimeout(function(){e("body").on("touchstart."+r.namespace,function(){r.hide()})},0)}
if(r.options.interactive){if(u){r.$tooltip.on("touchstart."+r.namespace,function(e){e.stopPropagation()})}
var p=null;r.$elProxy.add(r.$tooltip).on("mouseleave."+r.namespace+"-autoClose",function(){clearTimeout(p);p=setTimeout(function(){r.hide()},r.options.interactiveTolerance)}).on("mouseenter."+r.namespace+"-autoClose",function(){clearTimeout(p)})}else{r.$elProxy.on("mouseleave."+r.namespace+"-autoClose",function(){r.hide()})}
if(r.options.hideOnClick){r.$elProxy.on("click."+r.namespace+"-autoClose",function(){r.hide()})}}else if(r.options.trigger=="click"){setTimeout(function(){e("body").on("click."+r.namespace+" touchstart."+r.namespace,function(){r.hide()})},0);if(r.options.interactive){r.$tooltip.on("click."+r.namespace+" touchstart."+r.namespace,function(e){e.stopPropagation()})}}}}
if(r.options.timer>0){r.timerHide=setTimeout(function(){r.timerHide=null;r.hide()},r.options.timer+s)}}})},_interval_set:function(){var t=this;t.checkInterval=setInterval(function(){if(e("body").find(t.$el).length===0||e("body").find(t.$elProxy).length===0||t.Status=="hidden"||e("body").find(t.$tooltip).length===0){if(t.Status=="shown"||t.Status=="appearing")t.hide();t._interval_cancel()}else{if(t.options.positionTracker){var n=t._repositionInfo(t.$elProxy),r=false;if(o(n.dimension,t.elProxyPosition.dimension)){if(t.$elProxy.css("position")==="fixed"){if(o(n.position,t.elProxyPosition.position))r=true}else{if(o(n.offset,t.elProxyPosition.offset))r=true}}
if(!r){t.reposition();t.options.positionTrackerCallback.call(t,t.$el)}}}},200)},_interval_cancel:function(){clearInterval(this.checkInterval);this.checkInterval=null},_content_set:function(e){if(typeof e==="object"&&e!==null&&this.options.contentCloning){e=e.clone(true)}
this.Content=e},_content_insert:function(){var e=this,t=this.$tooltip.find(".tooltipster-content");if(typeof e.Content==="string"&&!e.options.contentAsHTML){t.text(e.Content)}else{t.empty().append(e.Content)}},_update:function(e){var t=this;t._content_set(e);if(t.Content!==null){if(t.Status!=="hidden"){t._content_insert();t.reposition();if(t.options.updateAnimation){if(l()){t.$tooltip.css({width:"","-webkit-transition":"all "+t.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms","-moz-transition":"all "+t.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms","-o-transition":"all "+t.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms","-ms-transition":"all "+t.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms",transition:"all "+t.options.speed+"ms, width 0ms, height 0ms, left 0ms, top 0ms"}).addClass("tooltipster-content-changing");setTimeout(function(){if(t.Status!="hidden"){t.$tooltip.removeClass("tooltipster-content-changing");setTimeout(function(){if(t.Status!=="hidden"){t.$tooltip.css({"-webkit-transition":t.options.speed+"ms","-moz-transition":t.options.speed+"ms","-o-transition":t.options.speed+"ms","-ms-transition":t.options.speed+"ms",transition:t.options.speed+"ms"})}},t.options.speed)}},t.options.speed)}else{t.$tooltip.fadeTo(t.options.speed,.5,function(){if(t.Status!="hidden"){t.$tooltip.fadeTo(t.options.speed,1)}})}}}}else{t.hide()}},_repositionInfo:function(e){return{dimension:{height:e.outerHeight(false),width:e.outerWidth(false)},offset:e.offset(),position:{left:parseInt(e.css("left")),top:parseInt(e.css("top"))}}},hide:function(n){var r=this;if(n)r.callbacks.hide.push(n);r.callbacks.show=[];clearTimeout(r.timerShow);r.timerShow=null;clearTimeout(r.timerHide);r.timerHide=null;var i=function(){e.each(r.callbacks.hide,function(e,t){t.call(r.$el)});r.callbacks.hide=[]};if(r.Status=="shown"||r.Status=="appearing"){r.Status="disappearing";var s=function(){r.Status="hidden";if(typeof r.Content=="object"&&r.Content!==null){r.Content.detach()}
r.$tooltip.remove();r.$tooltip=null;e(t).off("."+r.namespace);e("body").off("."+r.namespace).css("overflow-x",r.bodyOverflowX);e("body").off("."+r.namespace);r.$elProxy.off("."+r.namespace+"-autoClose");r.options.functionAfter.call(r.$el,r.$el);i()};if(l()){r.$tooltip.clearQueue().removeClass("tooltipster-"+r.options.animation+"-show").addClass("tooltipster-dying");if(r.options.speed>0)r.$tooltip.delay(r.options.speed);r.$tooltip.queue(s)}else{r.$tooltip.stop().fadeOut(r.options.speed,s)}}else if(r.Status=="hidden"){i()}
return r},show:function(e){this._showNow(e);return this},update:function(e){return this.content(e)},content:function(e){if(typeof e==="undefined"){return this.Content}else{this._update(e);return this}},reposition:function(){var n=this;if(e("body").find(n.$tooltip).length!==0){n.$tooltip.css("width","");n.elProxyPosition=n._repositionInfo(n.$elProxy);var r=null,i=e(t).width(),s=n.elProxyPosition,o=n.$tooltip.outerWidth(false),u=n.$tooltip.innerWidth()+1,a=n.$tooltip.outerHeight(false);if(n.$elProxy.is("area")){var f=n.$elProxy.attr("shape"),l=n.$elProxy.parent().attr("name"),c=e('img[usemap="#'+l+'"]'),h=c.offset().left,p=c.offset().top,d=n.$elProxy.attr("coords")!==undefined?n.$elProxy.attr("coords").split(","):undefined;if(f=="circle"){var v=parseInt(d[0]),m=parseInt(d[1]),g=parseInt(d[2]);s.dimension.height=g*2;s.dimension.width=g*2;s.offset.top=p+m-g;s.offset.left=h+v-g}else if(f=="rect"){var v=parseInt(d[0]),m=parseInt(d[1]),y=parseInt(d[2]),b=parseInt(d[3]);s.dimension.height=b-m;s.dimension.width=y-v;s.offset.top=p+m;s.offset.left=h+v}else if(f=="poly"){var w=[],E=[],S=0,x=0,T=0,N=0,C="even";for(var k=0;k<d.length;k++){var L=parseInt(d[k]);if(C=="even"){if(L>T){T=L;if(k===0){S=T}}
if(L<S){S=L}
C="odd"}else{if(L>N){N=L;if(k==1){x=N}}
if(L<x){x=L}
C="even"}}
s.dimension.height=N-x;s.dimension.width=T-S;s.offset.top=p+x;s.offset.left=h+S}else{s.dimension.height=c.outerHeight(false);s.dimension.width=c.outerWidth(false);s.offset.top=p;s.offset.left=h}}
var A=0,O=0,M=0,_=parseInt(n.options.offsetY),D=parseInt(n.options.offsetX),P=n.options.position;function H(){var n=e(t).scrollLeft();if(A-n<0){r=A-n;A=n}
if(A+o-n>i){r=A-(i+n-o);A=i+n-o}}
function B(n,r){if(s.offset.top-e(t).scrollTop()-a-_-12<0&&r.indexOf("top")>-1){P=n}
if(s.offset.top+s.dimension.height+a+12+_>e(t).scrollTop()+e(t).height()&&r.indexOf("bottom")>-1){P=n;M=s.offset.top-a-_-12}}
switch(P){case"top":{var j=s.offset.left+o-(s.offset.left+s.dimension.width);A=s.offset.left+D-j/2;M=s.offset.top-a-_-12;H();B("bottom","top");break;}
case"top-left":{A=s.offset.left+D;M=s.offset.top-a-_-12;H();B("bottom-left","top-left");break;}
case"top-right":{A=s.offset.left+s.dimension.width+D-o;M=s.offset.top-a-_-12;H();B("bottom-right","top-right");break;}
case"bottom":{var j=s.offset.left+o-(s.offset.left+s.dimension.width);A=s.offset.left-j/2+D;M=s.offset.top+s.dimension.height+_+12;H();B("top","bottom");break;}
case"bottom-left":{A=s.offset.left+D;M=s.offset.top+s.dimension.height+_+12;H();B("top-left","bottom-left");break;}
case"bottom-right":{A=s.offset.left+s.dimension.width+D-o;M=s.offset.top+s.dimension.height+_+12;H();B("top-right","bottom-right");break;}
case"left":{A=s.offset.left-D-o-12;O=s.offset.left+D+s.dimension.width+12;var F=s.offset.top+a-(s.offset.top+s.dimension.height);M=s.offset.top-F/2-_;if(A<0&&O+o>i){var I=parseFloat(n.$tooltip.css("border-width"))*2,q=o+A-I;n.$tooltip.css("width",q+"px");a=n.$tooltip.outerHeight(false);A=s.offset.left-D-q-12-I;F=s.offset.top+a-(s.offset.top+s.dimension.height);M=s.offset.top-F/2-_}else if(A<0){A=s.offset.left+D+s.dimension.width+12;r="left"}}
case"right":{A=s.offset.left+D+s.dimension.width+12;O=s.offset.left-D-o-12;var F=s.offset.top+a-(s.offset.top+s.dimension.height);M=s.offset.top-F/2-_;if(A+o>i&&O<0){var I=parseFloat(n.$tooltip.css("border-width"))*2,q=i-A-I;n.$tooltip.css("width",q+"px");a=n.$tooltip.outerHeight(false);F=s.offset.top+a-(s.offset.top+s.dimension.height);M=s.offset.top-F/2-_}else if(A+o>i){A=s.offset.left-D-o-12;r="right"}}}
if(n.options.arrow){var R="tooltipster-arrow-"+P;if(n.options.arrowColor.length<1){var U=n.$tooltip.css("background-color")}else{var U=n.options.arrowColor}
if(!r){r=""}else if(r=="left"){R="tooltipster-arrow-right";r=""}else if(r=="right"){R="tooltipster-arrow-left";r=""}else{r="left:"+Math.round(r)+"px;"}
if(P=="top"||P=="top-left"||P=="top-right"){var z=parseFloat(n.$tooltip.css("border-bottom-width")),W=n.$tooltip.css("border-bottom-color")}else if(P=="bottom"||P=="bottom-left"||P=="bottom-right"){var z=parseFloat(n.$tooltip.css("border-top-width")),W=n.$tooltip.css("border-top-color")}else if(P=="left"){var z=parseFloat(n.$tooltip.css("border-right-width")),W=n.$tooltip.css("border-right-color")}else if(P=="right"){var z=parseFloat(n.$tooltip.css("border-left-width")),W=n.$tooltip.css("border-left-color")}else{var z=parseFloat(n.$tooltip.css("border-bottom-width")),W=n.$tooltip.css("border-bottom-color")}
if(z>1){z++}
var X="";if(z!==0){var V="",J="border-color: "+W+";";if(R.indexOf("bottom")!==-1){V="margin-top: -"+Math.round(z)+"px;"}else if(R.indexOf("top")!==-1){V="margin-bottom: -"+Math.round(z)+"px;"}else if(R.indexOf("left")!==-1){V="margin-right: -"+Math.round(z)+"px;"}else if(R.indexOf("right")!==-1){V="margin-left: -"+Math.round(z)+"px;"}
X='<span class="tooltipster-arrow-border" style="'+V+" "+J+';"></span>'}
n.$tooltip.find(".tooltipster-arrow").remove();var K='<div class="'+R+' tooltipster-arrow" style="'+r+'">'+X+'<span style="border-color:'+U+';"></span></div>';n.$tooltip.append(K)}
n.$tooltip.css({top:Math.round(M)+"px",left:Math.round(A)+"px"})}
return n},enable:function(){this.enabled=true;return this},disable:function(){this.hide();this.enabled=false;return this},destroy:function(){var t=this;t.hide();if(t.$el[0]!==t.$elProxy[0]){t.$elProxy.remove()}
t.$el.removeData(t.namespace).off("."+t.namespace);var n=t.$el.data("tooltipster-ns");if(n.length===1){var r=null;if(t.options.restoration==="previous"){r=t.$el.data("tooltipster-initialTitle")}else if(t.options.restoration==="current"){r=typeof t.Content==="string"?t.Content:e("<div></div>").append(t.Content).html()}
if(r){t.$el.attr("title",r)}
t.$el.removeClass("tooltipstered").removeData("tooltipster-ns").removeData("tooltipster-initialTitle")}else{n=e.grep(n,function(e,n){return e!==t.namespace});t.$el.data("tooltipster-ns",n)}
return t},elementIcon:function(){return this.$el[0]!==this.$elProxy[0]?this.$elProxy[0]:undefined},elementTooltip:function(){return this.$tooltip?this.$tooltip[0]:undefined},option:function(e,t){if(typeof t=="undefined")return this.options[e];else{this.options[e]=t;return this}},status:function(){return this.Status}};e.fn[r]=function(){var t=arguments;if(this.length===0){if(typeof t[0]==="string"){var n=true;switch(t[0]){case"setDefaults":e.extend(i,t[1]);break;default:n=false;break}
if(n)return true;else return this}else{return this}}else{if(typeof t[0]==="string"){var r="#*$~&";this.each(function(){var n=e(this).data("tooltipster-ns"),i=n?e(this).data(n[0]):null;if(i){if(typeof i[t[0]]==="function"){var s=i[t[0]](t[1],t[2])}else{throw new Error('Unknown method .tooltipster("'+t[0]+'")')}
if(s!==i){r=s;return false}}else{throw new Error("You called Tooltipster's \""+t[0]+'" method on an uninitialized element')}});return r!=="#*$~&"?r:this}else{var o=[],u=t[0]&&typeof t[0].multiple!=="undefined",a=u&&t[0].multiple||!u&&i.multiple,f=t[0]&&typeof t[0].debug!=="undefined",l=f&&t[0].debug||!f&&i.debug;this.each(function(){var n=false,r=e(this).data("tooltipster-ns"),i=null;if(!r){n=true}else if(a){n=true}else if(l){console.log('Tooltipster: one or more tooltips are already attached to this element: ignoring. Use the "multiple" option to attach more tooltips.')}
if(n){i=new s(this,t[0]);if(!r)r=[];r.push(i.namespace);e(this).data("tooltipster-ns",r);e(this).data(i.namespace,i)}
o.push(i)});if(a)return o;else return this}}};var u=!!("ontouchstart"in t);var a=false;e("body").one("mousemove",function(){a=true})})(jQuery,window,document);
/*!
 * clipboard.js v1.7.1
 * https://zenorocha.github.io/clipboard.js
 *
 * Licensed MIT Â© Zeno Rocha
 */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Clipboard=t()}}(function(){var t,e,n;return function t(e,n,o){function i(a,c){if(!n[a]){if(!e[a]){var l="function"==typeof require&&require;if(!c&&l)return l(a,!0);if(r)return r(a,!0);var s=new Error("Cannot find module '"+a+"'");throw s.code="MODULE_NOT_FOUND",s}var u=n[a]={exports:{}};e[a][0].call(u.exports,function(t){var n=e[a][1][t];return i(n||t)},u,u.exports,t,e,n,o)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<o.length;a++)i(o[a]);return i}({1:[function(t,e,n){function o(t,e){for(;t&&t.nodeType!==i;){if("function"==typeof t.matches&&t.matches(e))return t;t=t.parentNode}}var i=9;if("undefined"!=typeof Element&&!Element.prototype.matches){var r=Element.prototype;r.matches=r.matchesSelector||r.mozMatchesSelector||r.msMatchesSelector||r.oMatchesSelector||r.webkitMatchesSelector}e.exports=o},{}],2:[function(t,e,n){function o(t,e,n,o,r){var a=i.apply(this,arguments);return t.addEventListener(n,a,r),{destroy:function(){t.removeEventListener(n,a,r)}}}function i(t,e,n,o){return function(n){n.delegateTarget=r(n.target,e),n.delegateTarget&&o.call(t,n)}}var r=t("./closest");e.exports=o},{"./closest":1}],3:[function(t,e,n){n.node=function(t){return void 0!==t&&t instanceof HTMLElement&&1===t.nodeType},n.nodeList=function(t){var e=Object.prototype.toString.call(t);return void 0!==t&&("[object NodeList]"===e||"[object HTMLCollection]"===e)&&"length"in t&&(0===t.length||n.node(t[0]))},n.string=function(t){return"string"==typeof t||t instanceof String},n.fn=function(t){return"[object Function]"===Object.prototype.toString.call(t)}},{}],4:[function(t,e,n){function o(t,e,n){if(!t&&!e&&!n)throw new Error("Missing required arguments");if(!c.string(e))throw new TypeError("Second argument must be a String");if(!c.fn(n))throw new TypeError("Third argument must be a Function");if(c.node(t))return i(t,e,n);if(c.nodeList(t))return r(t,e,n);if(c.string(t))return a(t,e,n);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}function i(t,e,n){return t.addEventListener(e,n),{destroy:function(){t.removeEventListener(e,n)}}}function r(t,e,n){return Array.prototype.forEach.call(t,function(t){t.addEventListener(e,n)}),{destroy:function(){Array.prototype.forEach.call(t,function(t){t.removeEventListener(e,n)})}}}function a(t,e,n){return l(document.body,t,e,n)}var c=t("./is"),l=t("delegate");e.exports=o},{"./is":3,delegate:2}],5:[function(t,e,n){function o(t){var e;if("SELECT"===t.nodeName)t.focus(),e=t.value;else if("INPUT"===t.nodeName||"TEXTAREA"===t.nodeName){var n=t.hasAttribute("readonly");n||t.setAttribute("readonly",""),t.select(),t.setSelectionRange(0,t.value.length),n||t.removeAttribute("readonly"),e=t.value}else{t.hasAttribute("contenteditable")&&t.focus();var o=window.getSelection(),i=document.createRange();i.selectNodeContents(t),o.removeAllRanges(),o.addRange(i),e=o.toString()}return e}e.exports=o},{}],6:[function(t,e,n){function o(){}o.prototype={on:function(t,e,n){var o=this.e||(this.e={});return(o[t]||(o[t]=[])).push({fn:e,ctx:n}),this},once:function(t,e,n){function o(){i.off(t,o),e.apply(n,arguments)}var i=this;return o._=e,this.on(t,o,n)},emit:function(t){var e=[].slice.call(arguments,1),n=((this.e||(this.e={}))[t]||[]).slice(),o=0,i=n.length;for(o;o<i;o++)n[o].fn.apply(n[o].ctx,e);return this},off:function(t,e){var n=this.e||(this.e={}),o=n[t],i=[];if(o&&e)for(var r=0,a=o.length;r<a;r++)o[r].fn!==e&&o[r].fn._!==e&&i.push(o[r]);return i.length?n[t]=i:delete n[t],this}},e.exports=o},{}],7:[function(e,n,o){!function(i,r){if("function"==typeof t&&t.amd)t(["module","select"],r);else if(void 0!==o)r(n,e("select"));else{var a={exports:{}};r(a,i.select),i.clipboardAction=a.exports}}(this,function(t,e){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=n(e),r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),c=function(){function t(e){o(this,t),this.resolveOptions(e),this.initSelection()}return a(t,[{key:"resolveOptions",value:function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action=e.action,this.container=e.container,this.emitter=e.emitter,this.target=e.target,this.text=e.text,this.trigger=e.trigger,this.selectedText=""}},{key:"initSelection",value:function t(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:"selectFake",value:function t(){var e=this,n="rtl"==document.documentElement.getAttribute("dir");this.removeFake(),this.fakeHandlerCallback=function(){return e.removeFake()},this.fakeHandler=this.container.addEventListener("click",this.fakeHandlerCallback)||!0,this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="absolute",this.fakeElem.style[n?"right":"left"]="-9999px";var o=window.pageYOffset||document.documentElement.scrollTop;this.fakeElem.style.top=o+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,this.container.appendChild(this.fakeElem),this.selectedText=(0,i.default)(this.fakeElem),this.copyText()}},{key:"removeFake",value:function t(){this.fakeHandler&&(this.container.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null),this.fakeElem&&(this.container.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"selectTarget",value:function t(){this.selectedText=(0,i.default)(this.target),this.copyText()}},{key:"copyText",value:function t(){var e=void 0;try{e=document.execCommand(this.action)}catch(t){e=!1}this.handleResult(e)}},{key:"handleResult",value:function t(e){this.emitter.emit(e?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function t(){this.trigger&&this.trigger.focus(),window.getSelection().removeAllRanges()}},{key:"destroy",value:function t(){this.removeFake()}},{key:"action",set:function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"copy";if(this._action=e,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function t(){return this._action}},{key:"target",set:function t(e){if(void 0!==e){if(!e||"object"!==(void 0===e?"undefined":r(e))||1!==e.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&e.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(e.hasAttribute("readonly")||e.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=e}},get:function t(){return this._target}}]),t}();t.exports=c})},{select:5}],8:[function(e,n,o){!function(i,r){if("function"==typeof t&&t.amd)t(["module","./clipboard-action","tiny-emitter","good-listener"],r);else if(void 0!==o)r(n,e("./clipboard-action"),e("tiny-emitter"),e("good-listener"));else{var a={exports:{}};r(a,i.clipboardAction,i.tinyEmitter,i.goodListener),i.clipboard=a.exports}}(this,function(t,e,n,o){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function l(t,e){var n="data-clipboard-"+t;if(e.hasAttribute(n))return e.getAttribute(n)}var s=i(e),u=i(n),f=i(o),d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),p=function(t){function e(t,n){r(this,e);var o=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return o.resolveOptions(n),o.listenClick(t),o}return c(e,t),h(e,[{key:"resolveOptions",value:function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action="function"==typeof e.action?e.action:this.defaultAction,this.target="function"==typeof e.target?e.target:this.defaultTarget,this.text="function"==typeof e.text?e.text:this.defaultText,this.container="object"===d(e.container)?e.container:document.body}},{key:"listenClick",value:function t(e){var n=this;this.listener=(0,f.default)(e,"click",function(t){return n.onClick(t)})}},{key:"onClick",value:function t(e){var n=e.delegateTarget||e.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new s.default({action:this.action(n),target:this.target(n),text:this.text(n),container:this.container,trigger:n,emitter:this})}},{key:"defaultAction",value:function t(e){return l("action",e)}},{key:"defaultTarget",value:function t(e){var n=l("target",e);if(n)return document.querySelector(n)}},{key:"defaultText",value:function t(e){return l("text",e)}},{key:"destroy",value:function t(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}],[{key:"isSupported",value:function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["copy","cut"],n="string"==typeof e?[e]:e,o=!!document.queryCommandSupported;return n.forEach(function(t){o=o&&!!document.queryCommandSupported(t)}),o}}]),e}(u.default);t.exports=p})},{"./clipboard-action":7,"good-listener":4,"tiny-emitter":6}]},{},[8])(8)});function copyTextToClipboard(text){var textArea=document.createElement("textarea");textArea.style.position='fixed';textArea.style.top=0;textArea.style.left=0;textArea.style.width='2em';textArea.style.height='2em';textArea.style.padding=0;textArea.style.border='none';textArea.style.outline='none';textArea.style.boxShadow='none';textArea.style.background='transparent';textArea.value=text;document.body.appendChild(textArea);textArea.select();try{var successful=document.execCommand('copy');var msg=successful?'successful':'unsuccessful';}catch(err){}
document.body.removeChild(textArea);}
const _animateClass='sequencer_sidebar_animate';const _titleId='sequencer_sidebar_title';const _resizeId='sequencer_sidebar_resize';class Sidebar{constructor(sidebarId,tabListId,containerId){this.sidebar=document.getElementById(sidebarId);this.title=document.getElementById(_titleId);this.tabList=document.getElementById(tabListId);this.container=document.getElementById(containerId);this.tabs=[];this.activeTab=null;this.resizeListener=null;let resize=document.getElementById(_resizeId);let resizeMouseMoveListener=(e)=>{this.sidebar.style.width=(document.body.clientWidth-e.clientX)+'px';};let resizeMouseUpListener=()=>{document.body.removeEventListener('mousemove',resizeMouseMoveListener);document.body.removeEventListener('mouseup',resizeMouseUpListener);};resize.addEventListener('mousedown',()=>{this.setAnimationEnabled(false);document.body.addEventListener('mousemove',resizeMouseMoveListener);document.body.addEventListener('mouseup',resizeMouseUpListener);});}
open(tab,preventClose=false,immediate=false){if(!tab)return;if(tab.equals(this.activeTab)){if(!preventClose)this.remove(tab);return;}
if(!this.find(tab)){this.add(tab);}
tab.show();this.activeTab?.hide();this.activeTab=tab;this.setAnimationEnabled(!immediate);this.sidebar.style.width=tab.width;}
close(){this.activeTab.hide();this.activeTab=null;this.setAnimationEnabled(true);this.sidebar.style.width='0';setTimeout(()=>{onresize()},200);}
add(tab){if(this.find(tab))return;this.tabs.push(tab);this.tabList.appendChild(tab.element);this.container.appendChild(tab.page);this.updateTitleVisibility();}
remove(tab){const index=this.tabs.findIndex(t=>t.title===tab.title);if(index==-1)return;this.tabs.splice(index,1);this.tabList.removeChild(tab.element);this.container.removeChild(tab.page);this.updateTitleVisibility();if(!tab.equals(this.activeTab))return;let lastTab=this.tabs[this.tabs.length-1];if(lastTab){this.open(lastTab);}else{this.close();}}
find(tabOrTitle,index){if(tabOrTitle instanceof SidebarTab)
return this.tabs.find(t=>t.equals(tabOrTitle));return this.tabs.find(t=>t.title===tabOrTitle);}
tab(title,source,contentWidth='400px'){let existingTab=this.find(title);if(existingTab)return existingTab;return new SidebarTab(title,source,contentWidth);}
updateTitleVisibility(){let visible=!(this.tabs.length==1&&this.tabs[0].title=='Sequence');this.title.style.display=visible?'flex':'none';this.container.className=visible?'with-title':'';}
setAnimationEnabled(enabled){this.sidebar.className=enabled?_animateClass:'';}}
class SidebarTab{constructor(title,source,width='400px'){this.title=title;this.width=width;this.page=this.createPage(source);this.element=this.createTabElement();}
show(){this.page.style.display='flex';this.element.classList.add('selected');}
hide(){this.page.style.display='none';this.element.classList.remove('selected');}
createPage(source){const element=document.createElement('div');element.classList.add('sidebar_page');if(source instanceof HTMLTemplateElement){element.appendChild(source.content.cloneNode(true));}else{element.innerHTML=source;}
return element;}
createTabElement(){const element=document.createElement('div');element.className='sidebar_tab';element.innerHTML=`<span>${this.title}</span>`;element.addEventListener('click',(event)=>{sidebar.open(this,true);});const closeBtn=document.createElement('a');closeBtn.innerHTML='<i class="far fa-times"></i>';closeBtn.addEventListener('click',(event)=>{event.stopPropagation();sidebar.remove(this);});element.appendChild(closeBtn);return element;}
equals(tab){return this.title==tab?.title&&this.element.isSameNode(tab?.element);}}
function doLogin(){jQuery('#user_loading').css('display','block');var username=jQuery('#username').val();var password=jQuery('#password').val();console.log(document.cookie);jQuery.post('/forum/member.php','action=do_login&remember=yes&url=/ajax/login.php'+'&username='+encodeURIComponent(username)+'&password='+encodeURIComponent(password)+'&my_post_key='+encodeURIComponent(settings.post_key),function(data){if(data.indexOf('invalid username/password')>-1){alert('Incorrect username or password.');jQuery('#user_loading').css('display','none');return;}else if(data[0]!='{'){var form=$(`<form action="/forum/member.php" target="_blank" method="post">
<input type="hidden" name="username" value="${username}">
<input type="hidden" name="password" value="${password}">
<input type="hidden" name="action" value="do_login">
<input type="hidden" name="my_post_key" value="${settings.post_key}">
</form>`);$(document.body).append(form);form.submit();jQuery('#user_loading').css('display','none');return;}
var result=JSON.parse(data);settings.username=result['username'];settings.uid=parseInt(result['uid']);settings.logoutkey=result['logoutkey'];settings.post_key=result['post_key'];jQuery('#member_username').html('<a href="/members/'+result['uid']+'">'+
result['username']+'</a>');userMember.css('display','block');userGuest.css('display','none');jQuery('#user_loading').css('display','none');});}
function submitOnEnter(e){if(e.which==13){doLogin();e.preventDefault();}}
function mainInit(){userGuest=jQuery('#user_guest');userMember=jQuery('#user_member');loginbutton=jQuery('#login_button');logoutbutton=jQuery('#member_logout');loginfields=jQuery('#login_fields');if(loginbutton){loginbutton.click(function(){if(loginfields.css('display')=='none'){loginfields.css('display','inline-block');return false;}else{doLogin();}
return false;});}
if(logoutbutton){logoutbutton.click(function(){if(!confirm('Are you sure you want to log out?'))return;jQuery('#user_loading').css('display','block');jQuery.get('/forum/member.php?action=logout&logoutkey='+settings.logoutkey,function(result){settings.username='';settings.uid=0;settings.logoutkey='';userMember.css('display','none');userGuest.css('display','block');var search='my_post_key = "';var key=result.substring(result.indexOf(search)+search.length,result.indexOf(search)+search.length+32)
settings.post_key=key;jQuery('#user_loading').css('display','none');});});}
$('#username').keypress(submitOnEnter);$('#password').keypress(submitOnEnter);$('*[title]').tooltipster({arrow:false,onlyOne:true,position:'bottom',delay:100,speed:100});$('.header_links img').tooltipster({arrow:false,onlyOne:true,position:'left',delay:100,speed:100});$('.preview').tooltipster({arrow:true,onlyOne:true,position:'right',delay:100,speed:100});$('.menu_button').click(function(){$('#page_left').slideToggle();});}
window.onload=mainInit;window.confirmExit=false;window.onbeforeunload=function(e){if(typeof song!='undefined')song.stop();if(window.confirmExit){var msg='Are you sure you want to close this window? You will lose any unsaved changes.';if(!e){e=window.event;}
if(e){e.returnValue=msg;}
return msg;}};var sortType='sort_1';function sort(type){if(sortType==type){return;}else{document.getElementById(sortType).style.display='none';document.getElementById(sortType+'_link').style.fontWeight='normal';sortType=type;document.getElementById(sortType).style.display='block';document.getElementById(sortType+'_link').style.fontWeight='bold';}}
function autoResizeTextArea(element){if(element==null)return;element.style.boxSizing='border-box';var offset=element.offsetHeight-element.clientHeight;element.autoResize=function(){element.style.height='auto';element.style.height=Math.min(100,element.scrollHeight+offset)+'px';};element.addEventListener('input',element.autoResize);}
function showComments(id){commentsType=0;commentsId=id;sidebar.open(sidebar.tab('Comments',document.getElementById('template-comments')));if(id!=playlistInitialId){updateComments(0,id,1);}}
function editDescription(){document.getElementById('info-sidebar-description-text').style.display='none';document.getElementById('info-sidebar-description-edit').style.display='none';document.getElementById('info-sidebar-description-textarea').style.display='inline-block';document.getElementById('info-sidebar-description-textarea').autoResize();document.getElementById('info-sidebar-description-save').style.display='inline-block';document.getElementById('info-sidebar-description-cancel').style.display='inline-block';document.getElementById('info-sidebar-description-textarea').focus();}
async function saveDescription(id){document.getElementById('info-sidebar-description-save-icon').style.display='none';document.getElementById('info-sidebar-description-loading').style.display='inline-block';let description=document.getElementById('info-sidebar-description-textarea').value;let html=await $.post('/ajax/update_description.php',{id:id,description:description,post_key:settings.post_key});document.getElementById('info-sidebar-description-text').innerHTML=html;cancelDescription();document.getElementById('info-sidebar-description-save-icon').style.display='inline-block';document.getElementById('info-sidebar-description-cancel').style.display='none';document.getElementById('info-sidebar-description-loading').style.display='none';}
function cancelDescription(){document.getElementById('info-sidebar-description-textarea').style.display='none';document.getElementById('info-sidebar-description-save').style.display='none';document.getElementById('info-sidebar-description-cancel').style.display='none';document.getElementById('info-sidebar-description-text').style.display='block';document.getElementById('info-sidebar-description-edit').style.display='inline-block';}
function editBio(){document.getElementById('bio-text').style.display='none';document.getElementById('bio-edit').style.display='none';document.getElementById('bio-textarea').style.display='block';document.getElementById('bio-save').style.display='block';document.getElementById('bio-textarea').focus();}
async function saveBio(){document.getElementById('bio-save').style.display='none';document.getElementById('bio-loading').style.display='inline-block';let bio=document.getElementById('bio-textarea').value;let html=await $.post('/ajax/update_bio.php',{bio:bio,post_key:settings.post_key});document.getElementById('bio-text').innerHTML=html;document.getElementById('bio-text').style.display='block';document.getElementById('bio-edit').style.display='block';document.getElementById('bio-textarea').style.display='none';document.getElementById('bio-loading').style.display='none';}
function closeAd(){$('#footer_ad_wrapper').remove();onresize();}
function showHelp(id){jQuery.get('/help.html?2',function(data){sidebar.open(sidebar.tab('Help',data));});}
function sidebarChat(){hideChat();sidebar.open(sidebar.tab('Chat',`
    <div class="sidebar_chat_container">
      <div class="sidebar_chat_header">
        <div>Please follow the <a href="https://onlinesequencer.net/forum/thread-1538.html" target="_blank">rules</a> while using chat.</div>
        <div>
          <a href="/logs?page=last" target="_blank">Chat Logs</a> &middot; 
          <a href="/chat/" target="_blank">Mobile-friendly</a> &middot; 
          <a href="javascript:showChat(true)">Pop out</a>
        </div>
      </div>
      <div class="sidebar_chat_frame_container"><iframe allowTransparency="true" scrolling="no" src="/forum/chat_frame.php" frameborder="0"></iframe></div>
    </div>
  `,'500px'));}
async function addFeatured(){let url=prompt('Enter sequence URL (ex. https://onlinesequencer.net/4679)');let match=/^(\D+)?(\d+)\/?(\d+)?/.exec(url);if(match!=null){let sequenceId=match[3]!=undefined?match[3]:match[2];let playlistId=await $.post('/ajax/update_playlist.php',{type:1,post_key:settings.post_key});await $.post('/ajax/update_playlist.php',{id:playlistId,add_sequence:sequenceId,post_key:settings.post_key});window.location.reload();}}
async function createPlaylist(){let id=await $.post('/ajax/update_playlist.php',{create:true,post_key:settings.post_key});window.location='/playlist/'+id;}
async function removeFeatured(sequenceId){let playlistId=await $.post('/ajax/update_playlist.php',{type:1,post_key:settings.post_key});await $.post('/ajax/update_playlist.php',{id:playlistId,remove_sequence:sequenceId,post_key:settings.post_key});window.location.reload();}
function dragScroll(element){if(element==null)return;let wrapper=element.querySelector('.dragscroll-wrapper');let left=element.querySelector('.dragscroll-left');let right=element.querySelector('.dragscroll-right');left.style.display='none';right.style.display=wrapper.scrollWidth>wrapper.clientWidth;let isDragging=false;let mouseX;let mouseY;let scroll;let mouseUpListener=(e)=>{setTimeout(()=>isDragging=false);if(isDragging)e.preventDefault();document.body.removeEventListener('mousemove',mouseMoveListener);document.body.removeEventListener('mouseup',mouseUpListener);};let clickListener=(e)=>{if(isDragging)e.preventDefault();};let mouseMoveListener=(e)=>{isDragging=true;wrapper.scrollLeft=scroll+mouseX-e.clientX;left.style.display=wrapper.scrollLeft>50?'block':'none';right.style.display=wrapper.scrollLeft+wrapper.clientWidth<wrapper.scrollWidth-50?'block':'none';};let mouseDownListener=(e)=>{if(element.className.indexOf('info-sidebar-featured-list')>-1)
e.preventDefault();document.body.addEventListener('mousemove',mouseMoveListener);document.body.addEventListener('mouseup',mouseUpListener);mouseX=e.clientX;mouseY=e.clientY;scroll=wrapper.scrollLeft;};let scrollListener=()=>{left.style.display=wrapper.scrollLeft>50?'block':'none';right.style.display=wrapper.scrollLeft+wrapper.clientWidth<wrapper.scrollWidth-50?'block':'none';};let elements=element.querySelectorAll('*');for(let child of elements){child.addEventListener('mousedown',mouseDownListener);child.addEventListener('click',clickListener);}
element.addEventListener('mouseDownListener',mouseDownListener);wrapper.addEventListener('scroll',scrollListener);}
async function report(){if(!confirm(`Are you sure you want to report this? Only the following should be reported:
1. Plagiarism - direct copies of another sequence without credit
2. Sequences intended to annoy the listener
3. Offensive language or imagery as described in the rules`)){return;}
let reason=prompt('Enter reason for reporting:');if(!reason){return;}
await $.post('/ajax/report.php',{reason:reason,url:window.location.href,post_key:settings.post_key});alert('Report submitted.');}
/*! jQuery UI - v1.13.2 - 2022-07-14
 * http://jqueryui.com
 * Includes: widget.js, position.js, data.js, disable-selection.js, effect.js,
 * effects/effect-blind.js, effects/effect-bounce.js, effects/effect-clip.js,
 * effects/effect-drop.js, effects/effect-explode.js, effects/effect-fade.js,
 * effects/effect-fold.js, effects/effect-highlight.js, effects/effect-puff.js,
 * effects/effect-pulsate.js, effects/effect-scale.js, effects/effect-shake.js,
 * effects/effect-size.js, effects/effect-slide.js, effects/effect-transfer.js,
 * focusable.js, form-reset-mixin.js, jquery-patch.js, keycode.js, labels.js,
 * scroll-parent.js, tabbable.js, unique-id.js, widgets/accordion.js,
 * widgets/autocomplete.js, widgets/button.js, widgets/checkboxradio.js,
 * widgets/controlgroup.js, widgets/datepicker.js, widgets/dialog.js,
 * widgets/draggable.js, widgets/droppable.js, widgets/menu.js,
 * widgets/mouse.js, widgets/progressbar.js, widgets/resizable.js,
 * widgets/selectable.js, widgets/selectmenu.js, widgets/slider.js,
 * widgets/sortable.js, widgets/spinner.js, widgets/tabs.js, widgets/tooltip.js
 * Copyright jQuery Foundation and other contributors; Licensed MIT */
(function(factory){'use strict';if(typeof define==='function'&&define.amd){define(['jquery'],factory);}else{factory(jQuery);}})(function($){'use strict';$.ui=$.ui||{};var version=$.ui.version='1.13.2';
/*!
 * jQuery UI Widget 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var widgetUuid=0;var widgetHasOwnProperty=Array.prototype.hasOwnProperty;var widgetSlice=Array.prototype.slice;$.cleanData=(function(orig){return function(elems){var events,elem,i;for(i=0;(elem=elems[i])!=null;i++){events=$._data(elem,'events');if(events&&events.remove){$(elem).triggerHandler('remove');}}
orig(elems);};})($.cleanData);$.widget=function(name,base,prototype){var existingConstructor,constructor,basePrototype;var proxiedPrototype={};var namespace=name.split('.')[0];name=name.split('.')[1];var fullName=namespace+'-'+name;if(!prototype){prototype=base;base=$.Widget;}
if(Array.isArray(prototype)){prototype=$.extend.apply(null,[{}].concat(prototype));}
$.expr.pseudos[fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName);};$[namespace]=$[namespace]||{};existingConstructor=$[namespace][name];constructor=$[namespace][name]=function(options,element){if(!this||!this._createWidget){return new constructor(options,element);}
if(arguments.length){this._createWidget(options,element);}};$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]});basePrototype=new base();basePrototype.options=$.widget.extend({},basePrototype.options);$.each(prototype,function(prop,value){if(typeof value!=='function'){proxiedPrototype[prop]=value;return;}
proxiedPrototype[prop]=(function(){function _super(){return base.prototype[prop].apply(this,arguments);}
function _superApply(args){return base.prototype[prop].apply(this,args);}
return function(){var __super=this._super;var __superApply=this._superApply;var returnValue;this._super=_super;this._superApply=_superApply;returnValue=value.apply(this,arguments);this._super=__super;this._superApply=__superApply;return returnValue;};})();});constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:existingConstructor?(basePrototype.widgetEventPrefix||name):name},proxiedPrototype,{constructor:constructor,namespace:namespace,widgetName:name,widgetFullName:fullName});if(existingConstructor){$.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+'.'+childPrototype.widgetName,constructor,child._proto);});delete existingConstructor._childConstructors;}else{base._childConstructors.push(constructor);}
$.widget.bridge(name,constructor);return constructor;};$.widget.extend=function(target){var input=widgetSlice.call(arguments,1);var inputIndex=0;var inputLength=input.length;var key;var value;for(;inputIndex<inputLength;inputIndex++){for(key in input[inputIndex]){value=input[inputIndex][key];if(widgetHasOwnProperty.call(input[inputIndex],key)&&value!==undefined){if($.isPlainObject(value)){target[key]=$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value);}else{target[key]=value;}}}}
return target;};$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName||name;$.fn[name]=function(options){var isMethodCall=typeof options==='string';var args=widgetSlice.call(arguments,1);var returnValue=this;if(isMethodCall){if(!this.length&&options==='instance'){returnValue=undefined;}else{this.each(function(){var methodValue;var instance=$.data(this,fullName);if(options==='instance'){returnValue=instance;return false;}
if(!instance){return $.error('cannot call methods on '+name+' prior to initialization; '+'attempted to call method \''+options+'\'');}
if(typeof instance[options]!=='function'||options.charAt(0)==='_'){return $.error('no such method \''+options+'\' for '+name+' widget instance');}
methodValue=instance[options].apply(instance,args);if(methodValue!==instance&&methodValue!==undefined){returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue;return false;}});}}else{if(args.length){options=$.widget.extend.apply(null,[options].concat(args));}
this.each(function(){var instance=$.data(this,fullName);if(instance){instance.option(options||{});if(instance._init){instance._init();}}else{$.data(this,fullName,new object(options,this));}});}
return returnValue;};};$.Widget=function(){};$.Widget._childConstructors=[];$.Widget.prototype={widgetName:'widget',widgetEventPrefix:'',defaultElement:'<div>',options:{classes:{},disabled:false,create:null},_createWidget:function(options,element){element=$(element||this.defaultElement||this)[0];this.element=$(element);this.uuid=widgetUuid++;this.eventNamespace='.'+this.widgetName+this.uuid;this.bindings=$();this.hoverable=$();this.focusable=$();this.classesElementLookup={};if(element!==this){$.data(element,this.widgetFullName,this);this._on(true,this.element,{remove:function(event){if(event.target===element){this.destroy();}}});this.document=$(element.style?element.ownerDocument:element.document||element);this.window=$(this.document[0].defaultView||this.document[0].parentWindow);}
this.options=$.widget.extend({},this.options,this._getCreateOptions(),options);this._create();if(this.options.disabled){this._setOptionDisabled(this.options.disabled);}
this._trigger('create',null,this._getCreateEventData());this._init();},_getCreateOptions:function(){return{};},_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){var that=this;this._destroy();$.each(this.classesElementLookup,function(key,value){that._removeClass(value,key);});this.element.off(this.eventNamespace).removeData(this.widgetFullName);this.widget().off(this.eventNamespace).removeAttr('aria-disabled');this.bindings.off(this.eventNamespace);},_destroy:$.noop,widget:function(){return this.element;},option:function(key,value){var options=key;var parts;var curOption;var i;if(arguments.length===0){return $.widget.extend({},this.options);}
if(typeof key==='string'){options={};parts=key.split('.');key=parts.shift();if(parts.length){curOption=options[key]=$.widget.extend({},this.options[key]);for(i=0;i<parts.length-1;i++){curOption[parts[i]]=curOption[parts[i]]||{};curOption=curOption[parts[i]];}
key=parts.pop();if(arguments.length===1){return curOption[key]===undefined?null:curOption[key];}
curOption[key]=value;}else{if(arguments.length===1){return this.options[key]===undefined?null:this.options[key];}
options[key]=value;}}
this._setOptions(options);return this;},_setOptions:function(options){var key;for(key in options){this._setOption(key,options[key]);}
return this;},_setOption:function(key,value){if(key==='classes'){this._setOptionClasses(value);}
this.options[key]=value;if(key==='disabled'){this._setOptionDisabled(value);}
return this;},_setOptionClasses:function(value){var classKey,elements,currentElements;for(classKey in value){currentElements=this.classesElementLookup[classKey];if(value[classKey]===this.options.classes[classKey]||!currentElements||!currentElements.length){continue;}
elements=$(currentElements.get());this._removeClass(currentElements,classKey);elements.addClass(this._classes({element:elements,keys:classKey,classes:value,add:true}));}},_setOptionDisabled:function(value){this._toggleClass(this.widget(),this.widgetFullName+'-disabled',null,!!value);if(value){this._removeClass(this.hoverable,null,'ui-state-hover');this._removeClass(this.focusable,null,'ui-state-focus');}},enable:function(){return this._setOptions({disabled:false});},disable:function(){return this._setOptions({disabled:true});},_classes:function(options){var full=[];var that=this;options=$.extend({element:this.element,classes:this.options.classes||{}},options);function bindRemoveEvent(){var nodesToBind=[];options.element.each(function(_,element){var isTracked=$.map(that.classesElementLookup,function(elements){return elements;}).some(function(elements){return elements.is(element);});if(!isTracked){nodesToBind.push(element);}});that._on($(nodesToBind),{remove:'_untrackClassesElement'});}
function processClassString(classes,checkOption){var current,i;for(i=0;i<classes.length;i++){current=that.classesElementLookup[classes[i]]||$();if(options.add){bindRemoveEvent();current=$($.uniqueSort(current.get().concat(options.element.get())));}else{current=$(current.not(options.element).get());}
that.classesElementLookup[classes[i]]=current;full.push(classes[i]);if(checkOption&&options.classes[classes[i]]){full.push(options.classes[classes[i]]);}}}
if(options.keys){processClassString(options.keys.match(/\S+/g)||[],true);}
if(options.extra){processClassString(options.extra.match(/\S+/g)||[]);}
return full.join(' ');},_untrackClassesElement:function(event){var that=this;$.each(that.classesElementLookup,function(key,value){if($.inArray(event.target,value)!==-1){that.classesElementLookup[key]=$(value.not(event.target).get());}});this._off($(event.target));},_removeClass:function(element,keys,extra){return this._toggleClass(element,keys,extra,false);},_addClass:function(element,keys,extra){return this._toggleClass(element,keys,extra,true);},_toggleClass:function(element,keys,extra,add){add=(typeof add==='boolean')?add:extra;var shift=(typeof element==='string'||element===null),options={extra:shift?keys:extra,keys:shift?element:keys,element:shift?this.element:element,add:add};options.element.toggleClass(this._classes(options),add);return this;},_on:function(suppressDisabledCheck,element,handlers){var delegateElement;var instance=this;if(typeof suppressDisabledCheck!=='boolean'){handlers=element;element=suppressDisabledCheck;suppressDisabledCheck=false;}
if(!handlers){handlers=element;element=this.element;delegateElement=this.widget();}else{element=delegateElement=$(element);this.bindings=this.bindings.add(element);}
$.each(handlers,function(event,handler){function handlerProxy(){if(!suppressDisabledCheck&&(instance.options.disabled===true||$(this).hasClass('ui-state-disabled'))){return;}
return(typeof handler==='string'?instance[handler]:handler).apply(instance,arguments);}
if(typeof handler!=='string'){handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++;}
var match=event.match(/^([\w:-]*)\s*(.*)$/);var eventName=match[1]+instance.eventNamespace;var selector=match[2];if(selector){delegateElement.on(eventName,selector,handlerProxy);}else{element.on(eventName,handlerProxy);}});},_off:function(element,eventName){eventName=(eventName||'').split(' ').join(this.eventNamespace+' ')+
this.eventNamespace;element.off(eventName);this.bindings=$(this.bindings.not(element).get());this.focusable=$(this.focusable.not(element).get());this.hoverable=$(this.hoverable.not(element).get());},_delay:function(handler,delay){function handlerProxy(){return(typeof handler==='string'?instance[handler]:handler).apply(instance,arguments);}
var instance=this;return setTimeout(handlerProxy,delay||0);},_hoverable:function(element){this.hoverable=this.hoverable.add(element);this._on(element,{mouseenter:function(event){this._addClass($(event.currentTarget),null,'ui-state-hover');},mouseleave:function(event){this._removeClass($(event.currentTarget),null,'ui-state-hover');}});},_focusable:function(element){this.focusable=this.focusable.add(element);this._on(element,{focusin:function(event){this._addClass($(event.currentTarget),null,'ui-state-focus');},focusout:function(event){this._removeClass($(event.currentTarget),null,'ui-state-focus');}});},_trigger:function(type,event,data){var prop,orig;var callback=this.options[type];data=data||{};event=$.Event(event);event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase();event.target=this.element[0];orig=event.originalEvent;if(orig){for(prop in orig){if(!(prop in event)){event[prop]=orig[prop];}}}
this.element.trigger(event,data);return!(typeof callback==='function'&&callback.apply(this.element[0],[event].concat(data))===false||event.isDefaultPrevented());}};$.each({show:'fadeIn',hide:'fadeOut'},function(method,defaultEffect){$.Widget.prototype['_'+method]=function(element,options,callback){if(typeof options==='string'){options={effect:options};}
var hasOptions;var effectName=!options?method:options===true||typeof options==='number'?defaultEffect:options.effect||defaultEffect;options=options||{};if(typeof options==='number'){options={duration:options};}else if(options===true){options={};}
hasOptions=!$.isEmptyObject(options);options.complete=callback;if(options.delay){element.delay(options.delay);}
if(hasOptions&&$.effects&&$.effects.effect[effectName]){element[method](options);}else if(effectName!==method&&element[effectName]){element[effectName](options.duration,options.easing,callback);}else{element.queue(function(next){$(this)[method]();if(callback){callback.call(element[0]);}
next();});}};});var widget=$.widget;
/*!
 * jQuery UI Position 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/position/
 */
(function(){var cachedScrollbarWidth,max=Math.max,abs=Math.abs,rhorizontal=/left|center|right/,rvertical=/top|center|bottom/,roffset=/[\+\-]\d+(\.[\d]+)?%?/,rposition=/^\w+/,rpercent=/%$/,_position=$.fn.position;function getOffsets(offsets,width,height){return[parseFloat(offsets[0])*(rpercent.test(offsets[0])?width/100:1),parseFloat(offsets[1])*(rpercent.test(offsets[1])?height/100:1)];}
function parseCss(element,property){return parseInt($.css(element,property),10)||0;}
function isWindow(obj){return obj!=null&&obj===obj.window;}
function getDimensions(elem){var raw=elem[0];if(raw.nodeType===9){return{width:elem.width(),height:elem.height(),offset:{top:0,left:0}};}
if(isWindow(raw)){return{width:elem.width(),height:elem.height(),offset:{top:elem.scrollTop(),left:elem.scrollLeft()}};}
if(raw.preventDefault){return{width:0,height:0,offset:{top:raw.pageY,left:raw.pageX}};}
return{width:elem.outerWidth(),height:elem.outerHeight(),offset:elem.offset()};}
$.position={scrollbarWidth:function(){if(cachedScrollbarWidth!==undefined){return cachedScrollbarWidth;}
var w1,w2,div=$('<div style='+'\'display:block;position:absolute;width:200px;height:200px;overflow:hidden;\'>'+'<div style=\'height:300px;width:auto;\'></div></div>'),innerDiv=div.children()[0];$('body').append(div);w1=innerDiv.offsetWidth;div.css('overflow','scroll');w2=innerDiv.offsetWidth;if(w1===w2){w2=div[0].clientWidth;}
div.remove();return(cachedScrollbarWidth=w1-w2);},getScrollInfo:function(within){var overflowX=within.isWindow||within.isDocument?'':within.element.css('overflow-x'),overflowY=within.isWindow||within.isDocument?'':within.element.css('overflow-y'),hasOverflowX=overflowX==='scroll'||(overflowX==='auto'&&within.width<within.element[0].scrollWidth),hasOverflowY=overflowY==='scroll'||(overflowY==='auto'&&within.height<within.element[0].scrollHeight);return{width:hasOverflowY?$.position.scrollbarWidth():0,height:hasOverflowX?$.position.scrollbarWidth():0};},getWithinInfo:function(element){var withinElement=$(element||window),isElemWindow=isWindow(withinElement[0]),isDocument=!!withinElement[0]&&withinElement[0].nodeType===9,hasOffset=!isElemWindow&&!isDocument;return{element:withinElement,isWindow:isElemWindow,isDocument:isDocument,offset:hasOffset?$(element).offset():{left:0,top:0},scrollLeft:withinElement.scrollLeft(),scrollTop:withinElement.scrollTop(),width:withinElement.outerWidth(),height:withinElement.outerHeight()};}};$.fn.position=function(options){if(!options||!options.of){return _position.apply(this,arguments);}
options=$.extend({},options);var atOffset,targetWidth,targetHeight,targetOffset,basePosition,dimensions,target=typeof options.of==='string'?$(document).find(options.of):$(options.of),within=$.position.getWithinInfo(options.within),scrollInfo=$.position.getScrollInfo(within),collision=(options.collision||'flip').split(' '),offsets={};dimensions=getDimensions(target);if(target[0].preventDefault){options.at='left top';}
targetWidth=dimensions.width;targetHeight=dimensions.height;targetOffset=dimensions.offset;basePosition=$.extend({},targetOffset);$.each(['my','at'],function(){var pos=(options[this]||'').split(' '),horizontalOffset,verticalOffset;if(pos.length===1){pos=rhorizontal.test(pos[0])?pos.concat(['center']):rvertical.test(pos[0])?['center'].concat(pos):['center','center'];}
pos[0]=rhorizontal.test(pos[0])?pos[0]:'center';pos[1]=rvertical.test(pos[1])?pos[1]:'center';horizontalOffset=roffset.exec(pos[0]);verticalOffset=roffset.exec(pos[1]);offsets[this]=[horizontalOffset?horizontalOffset[0]:0,verticalOffset?verticalOffset[0]:0];options[this]=[rposition.exec(pos[0])[0],rposition.exec(pos[1])[0]];});if(collision.length===1){collision[1]=collision[0];}
if(options.at[0]==='right'){basePosition.left+=targetWidth;}else if(options.at[0]==='center'){basePosition.left+=targetWidth/2;}
if(options.at[1]==='bottom'){basePosition.top+=targetHeight;}else if(options.at[1]==='center'){basePosition.top+=targetHeight/2;}
atOffset=getOffsets(offsets.at,targetWidth,targetHeight);basePosition.left+=atOffset[0];basePosition.top+=atOffset[1];return this.each(function(){var collisionPosition,using,elem=$(this),elemWidth=elem.outerWidth(),elemHeight=elem.outerHeight(),marginLeft=parseCss(this,'marginLeft'),marginTop=parseCss(this,'marginTop'),collisionWidth=elemWidth+marginLeft+
parseCss(this,'marginRight')+scrollInfo.width,collisionHeight=elemHeight+marginTop+
parseCss(this,'marginBottom')+scrollInfo.height,position=$.extend({},basePosition),myOffset=getOffsets(offsets.my,elem.outerWidth(),elem.outerHeight());if(options.my[0]==='right'){position.left-=elemWidth;}else if(options.my[0]==='center'){position.left-=elemWidth/2;}
if(options.my[1]==='bottom'){position.top-=elemHeight;}else if(options.my[1]==='center'){position.top-=elemHeight/2;}
position.left+=myOffset[0];position.top+=myOffset[1];collisionPosition={marginLeft:marginLeft,marginTop:marginTop};$.each(['left','top'],function(i,dir){if($.ui.position[collision[i]]){$.ui.position[collision[i]][dir](position,{targetWidth:targetWidth,targetHeight:targetHeight,elemWidth:elemWidth,elemHeight:elemHeight,collisionPosition:collisionPosition,collisionWidth:collisionWidth,collisionHeight:collisionHeight,offset:[atOffset[0]+myOffset[0],atOffset[1]+myOffset[1]],my:options.my,at:options.at,within:within,elem:elem});}});if(options.using){using=function(props){var left=targetOffset.left-position.left,right=left+targetWidth-elemWidth,top=targetOffset.top-position.top,bottom=top+targetHeight-elemHeight,feedback={target:{element:target,left:targetOffset.left,top:targetOffset.top,width:targetWidth,height:targetHeight},element:{element:elem,left:position.left,top:position.top,width:elemWidth,height:elemHeight},horizontal:right<0?'left':left>0?'right':'center',vertical:bottom<0?'top':top>0?'bottom':'middle'};if(targetWidth<elemWidth&&abs(left+right)<targetWidth){feedback.horizontal='center';}
if(targetHeight<elemHeight&&abs(top+bottom)<targetHeight){feedback.vertical='middle';}
if(max(abs(left),abs(right))>max(abs(top),abs(bottom))){feedback.important='horizontal';}else{feedback.important='vertical';}
options.using.call(this,props,feedback);};}
elem.offset($.extend(position,{using:using}));});};$.ui.position={fit:{left:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollLeft:within.offset.left,outerWidth=within.width,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=withinOffset-collisionPosLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-
withinOffset,newOverRight;if(data.collisionWidth>outerWidth){if(overLeft>0&&overRight<=0){newOverRight=position.left+overLeft+data.collisionWidth-
outerWidth-withinOffset;position.left+=overLeft-newOverRight;}else if(overRight>0&&overLeft<=0){position.left=withinOffset;}else{if(overLeft>overRight){position.left=withinOffset+outerWidth-data.collisionWidth;}else{position.left=withinOffset;}}}else if(overLeft>0){position.left+=overLeft;}else if(overRight>0){position.left-=overRight;}else{position.left=max(position.left-collisionPosLeft,position.left);}},top:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollTop:within.offset.top,outerHeight=data.within.height,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=withinOffset-collisionPosTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-
withinOffset,newOverBottom;if(data.collisionHeight>outerHeight){if(overTop>0&&overBottom<=0){newOverBottom=position.top+overTop+data.collisionHeight-
outerHeight-withinOffset;position.top+=overTop-newOverBottom;}else if(overBottom>0&&overTop<=0){position.top=withinOffset;}else{if(overTop>overBottom){position.top=withinOffset+outerHeight-data.collisionHeight;}else{position.top=withinOffset;}}}else if(overTop>0){position.top+=overTop;}else if(overBottom>0){position.top-=overBottom;}else{position.top=max(position.top-collisionPosTop,position.top);}}},flip:{left:function(position,data){var within=data.within,withinOffset=within.offset.left+within.scrollLeft,outerWidth=within.width,offsetLeft=within.isWindow?within.scrollLeft:within.offset.left,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=collisionPosLeft-offsetLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-offsetLeft,myOffset=data.my[0]==='left'?-data.elemWidth:data.my[0]==='right'?data.elemWidth:0,atOffset=data.at[0]==='left'?data.targetWidth:data.at[0]==='right'?-data.targetWidth:0,offset=-2*data.offset[0],newOverRight,newOverLeft;if(overLeft<0){newOverRight=position.left+myOffset+atOffset+offset+
data.collisionWidth-outerWidth-withinOffset;if(newOverRight<0||newOverRight<abs(overLeft)){position.left+=myOffset+atOffset+offset;}}else if(overRight>0){newOverLeft=position.left-data.collisionPosition.marginLeft+
myOffset+atOffset+offset-offsetLeft;if(newOverLeft>0||abs(newOverLeft)<overRight){position.left+=myOffset+atOffset+offset;}}},top:function(position,data){var within=data.within,withinOffset=within.offset.top+within.scrollTop,outerHeight=within.height,offsetTop=within.isWindow?within.scrollTop:within.offset.top,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=collisionPosTop-offsetTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-offsetTop,top=data.my[1]==='top',myOffset=top?-data.elemHeight:data.my[1]==='bottom'?data.elemHeight:0,atOffset=data.at[1]==='top'?data.targetHeight:data.at[1]==='bottom'?-data.targetHeight:0,offset=-2*data.offset[1],newOverTop,newOverBottom;if(overTop<0){newOverBottom=position.top+myOffset+atOffset+offset+
data.collisionHeight-outerHeight-withinOffset;if(newOverBottom<0||newOverBottom<abs(overTop)){position.top+=myOffset+atOffset+offset;}}else if(overBottom>0){newOverTop=position.top-data.collisionPosition.marginTop+
myOffset+atOffset+offset-offsetTop;if(newOverTop>0||abs(newOverTop)<overBottom){position.top+=myOffset+atOffset+offset;}}}},flipfit:{left:function(){$.ui.position.flip.left.apply(this,arguments);$.ui.position.fit.left.apply(this,arguments);},top:function(){$.ui.position.flip.top.apply(this,arguments);$.ui.position.fit.top.apply(this,arguments);}}};})();var position=$.ui.position;
/*!
 * jQuery UI :data 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var data=$.extend($.expr.pseudos,{data:$.expr.createPseudo?$.expr.createPseudo(function(dataName){return function(elem){return!!$.data(elem,dataName);};}):function(elem,i,match){return!!$.data(elem,match[3]);}});
/*!
 * jQuery UI Disable Selection 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var disableSelection=$.fn.extend({disableSelection:(function(){var eventType='onselectstart'in document.createElement('div')?'selectstart':'mousedown';return function(){return this.on(eventType+'.ui-disableSelection',function(event){event.preventDefault();});};})(),enableSelection:function(){return this.off('.ui-disableSelection');}});var jQuery=$;
/*!
 * jQuery Color Animations v2.2.0
 * https://github.com/jquery/jquery-color
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * Date: Sun May 10 09:02:36 2020 +0200
 */
var stepHooks='backgroundColor borderBottomColor borderLeftColor borderRightColor '+'borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor',class2type={},toString=class2type.toString,rplusequals=/^([\-+])=\s*(\d+\.?\d*)/,stringParsers=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(execResult){return[execResult[1],execResult[2],execResult[3],execResult[4]];}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(execResult){return[execResult[1]*2.55,execResult[2]*2.55,execResult[3]*2.55,execResult[4]];}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})?/,parse:function(execResult){return[parseInt(execResult[1],16),parseInt(execResult[2],16),parseInt(execResult[3],16),execResult[4]?(parseInt(execResult[4],16)/255).toFixed(2):1];}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])([a-f0-9])?/,parse:function(execResult){return[parseInt(execResult[1]+execResult[1],16),parseInt(execResult[2]+execResult[2],16),parseInt(execResult[3]+execResult[3],16),execResult[4]?(parseInt(execResult[4]+execResult[4],16)/255).toFixed(2):1];}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:'hsla',parse:function(execResult){return[execResult[1],execResult[2]/100,execResult[3]/100,execResult[4]];}}],color=jQuery.Color=function(color,green,blue,alpha){return new jQuery.Color.fn.parse(color,green,blue,alpha);},spaces={rgba:{props:{red:{idx:0,type:'byte'},green:{idx:1,type:'byte'},blue:{idx:2,type:'byte'}}},hsla:{props:{hue:{idx:0,type:'degrees'},saturation:{idx:1,type:'percent'},lightness:{idx:2,type:'percent'}}}},propTypes={'byte':{floor:true,max:255},'percent':{max:1},'degrees':{mod:360,floor:true}},support=color.support={},supportElem=jQuery('<p>')[0],colors,each=jQuery.each;supportElem.style.cssText='background-color:rgba(1,1,1,.5)';support.rgba=supportElem.style.backgroundColor.indexOf('rgba')>-1;each(spaces,function(spaceName,space){space.cache='_'+spaceName;space.props.alpha={idx:3,type:'percent',def:1};});jQuery.each('Boolean Number String Function Array Date RegExp Object Error Symbol'.split(' '),function(_i,name){class2type['[object '+name+']']=name.toLowerCase();});function getType(obj){if(obj==null){return obj+'';}
return typeof obj==='object'?class2type[toString.call(obj)]||'object':typeof obj;}
function clamp(value,prop,allowEmpty){var type=propTypes[prop.type]||{};if(value==null){return(allowEmpty||!prop.def)?null:prop.def;}
value=type.floor?~~value:parseFloat(value);if(isNaN(value)){return prop.def;}
if(type.mod){return(value+type.mod)%type.mod;}
return Math.min(type.max,Math.max(0,value));}
function stringParse(string){var inst=color(),rgba=inst._rgba=[];string=string.toLowerCase();each(stringParsers,function(_i,parser){var parsed,match=parser.re.exec(string),values=match&&parser.parse(match),spaceName=parser.space||'rgba';if(values){parsed=inst[spaceName](values);inst[spaces[spaceName].cache]=parsed[spaces[spaceName].cache];rgba=inst._rgba=parsed._rgba;return false;}});if(rgba.length){if(rgba.join()==='0,0,0,0'){jQuery.extend(rgba,colors.transparent);}
return inst;}
return colors[string];}
color.fn=jQuery.extend(color.prototype,{parse:function(red,green,blue,alpha){if(red===undefined){this._rgba=[null,null,null,null];return this;}
if(red.jquery||red.nodeType){red=jQuery(red).css(green);green=undefined;}
var inst=this,type=getType(red),rgba=this._rgba=[];if(green!==undefined){red=[red,green,blue,alpha];type='array';}
if(type==='string'){return this.parse(stringParse(red)||colors._default);}
if(type==='array'){each(spaces.rgba.props,function(_key,prop){rgba[prop.idx]=clamp(red[prop.idx],prop);});return this;}
if(type==='object'){if(red instanceof color){each(spaces,function(_spaceName,space){if(red[space.cache]){inst[space.cache]=red[space.cache].slice();}});}else{each(spaces,function(_spaceName,space){var cache=space.cache;each(space.props,function(key,prop){if(!inst[cache]&&space.to){if(key==='alpha'||red[key]==null){return;}
inst[cache]=space.to(inst._rgba);}
inst[cache][prop.idx]=clamp(red[key],prop,true);});if(inst[cache]&&jQuery.inArray(null,inst[cache].slice(0,3))<0){if(inst[cache][3]==null){inst[cache][3]=1;}
if(space.from){inst._rgba=space.from(inst[cache]);}}});}
return this;}},is:function(compare){var is=color(compare),same=true,inst=this;each(spaces,function(_,space){var localCache,isCache=is[space.cache];if(isCache){localCache=inst[space.cache]||space.to&&space.to(inst._rgba)||[];each(space.props,function(_,prop){if(isCache[prop.idx]!=null){same=(isCache[prop.idx]===localCache[prop.idx]);return same;}});}
return same;});return same;},_space:function(){var used=[],inst=this;each(spaces,function(spaceName,space){if(inst[space.cache]){used.push(spaceName);}});return used.pop();},transition:function(other,distance){var end=color(other),spaceName=end._space(),space=spaces[spaceName],startColor=this.alpha()===0?color('transparent'):this,start=startColor[space.cache]||space.to(startColor._rgba),result=start.slice();end=end[space.cache];each(space.props,function(_key,prop){var index=prop.idx,startValue=start[index],endValue=end[index],type=propTypes[prop.type]||{};if(endValue===null){return;}
if(startValue===null){result[index]=endValue;}else{if(type.mod){if(endValue-startValue>type.mod/2){startValue+=type.mod;}else if(startValue-endValue>type.mod/2){startValue-=type.mod;}}
result[index]=clamp((endValue-startValue)*distance+startValue,prop);}});return this[spaceName](result);},blend:function(opaque){if(this._rgba[3]===1){return this;}
var rgb=this._rgba.slice(),a=rgb.pop(),blend=color(opaque)._rgba;return color(jQuery.map(rgb,function(v,i){return(1-a)*blend[i]+a*v;}));},toRgbaString:function(){var prefix='rgba(',rgba=jQuery.map(this._rgba,function(v,i){if(v!=null){return v;}
return i>2?1:0;});if(rgba[3]===1){rgba.pop();prefix='rgb(';}
return prefix+rgba.join()+')';},toHslaString:function(){var prefix='hsla(',hsla=jQuery.map(this.hsla(),function(v,i){if(v==null){v=i>2?1:0;}
if(i&&i<3){v=Math.round(v*100)+'%';}
return v;});if(hsla[3]===1){hsla.pop();prefix='hsl(';}
return prefix+hsla.join()+')';},toHexString:function(includeAlpha){var rgba=this._rgba.slice(),alpha=rgba.pop();if(includeAlpha){rgba.push(~~(alpha*255));}
return'#'+
jQuery.map(rgba,function(v){v=(v||0).toString(16);return v.length===1?'0'+v:v;}).join('');},toString:function(){return this._rgba[3]===0?'transparent':this.toRgbaString();}});color.fn.parse.prototype=color.fn;function hue2rgb(p,q,h){h=(h+1)%1;if(h*6<1){return p+(q-p)*h*6;}
if(h*2<1){return q;}
if(h*3<2){return p+(q-p)*((2/3)-h)*6;}
return p;}
spaces.hsla.to=function(rgba){if(rgba[0]==null||rgba[1]==null||rgba[2]==null){return[null,null,null,rgba[3]];}
var r=rgba[0]/255,g=rgba[1]/255,b=rgba[2]/255,a=rgba[3],max=Math.max(r,g,b),min=Math.min(r,g,b),diff=max-min,add=max+min,l=add*0.5,h,s;if(min===max){h=0;}else if(r===max){h=(60*(g-b)/diff)+360;}else if(g===max){h=(60*(b-r)/diff)+120;}else{h=(60*(r-g)/diff)+240;}
if(diff===0){s=0;}else if(l<=0.5){s=diff/add;}else{s=diff/(2-add);}
return[Math.round(h)%360,s,l,a==null?1:a];};spaces.hsla.from=function(hsla){if(hsla[0]==null||hsla[1]==null||hsla[2]==null){return[null,null,null,hsla[3]];}
var h=hsla[0]/360,s=hsla[1],l=hsla[2],a=hsla[3],q=l<=0.5?l*(1+s):l+s-l*s,p=2*l-q;return[Math.round(hue2rgb(p,q,h+(1/3))*255),Math.round(hue2rgb(p,q,h)*255),Math.round(hue2rgb(p,q,h-(1/3))*255),a];};each(spaces,function(spaceName,space){var props=space.props,cache=space.cache,to=space.to,from=space.from;color.fn[spaceName]=function(value){if(to&&!this[cache]){this[cache]=to(this._rgba);}
if(value===undefined){return this[cache].slice();}
var ret,type=getType(value),arr=(type==='array'||type==='object')?value:arguments,local=this[cache].slice();each(props,function(key,prop){var val=arr[type==='object'?key:prop.idx];if(val==null){val=local[prop.idx];}
local[prop.idx]=clamp(val,prop);});if(from){ret=color(from(local));ret[cache]=local;return ret;}else{return color(local);}};each(props,function(key,prop){if(color.fn[key]){return;}
color.fn[key]=function(value){var local,cur,match,fn,vtype=getType(value);if(key==='alpha'){fn=this._hsla?'hsla':'rgba';}else{fn=spaceName;}
local=this[fn]();cur=local[prop.idx];if(vtype==='undefined'){return cur;}
if(vtype==='function'){value=value.call(this,cur);vtype=getType(value);}
if(value==null&&prop.empty){return this;}
if(vtype==='string'){match=rplusequals.exec(value);if(match){value=cur+parseFloat(match[2])*(match[1]==='+'?1:-1);}}
local[prop.idx]=value;return this[fn](local);};});});color.hook=function(hook){var hooks=hook.split(' ');each(hooks,function(_i,hook){jQuery.cssHooks[hook]={set:function(elem,value){var parsed,curElem,backgroundColor='';if(value!=='transparent'&&(getType(value)!=='string'||(parsed=stringParse(value)))){value=color(parsed||value);if(!support.rgba&&value._rgba[3]!==1){curElem=hook==='backgroundColor'?elem.parentNode:elem;while((backgroundColor===''||backgroundColor==='transparent')&&curElem&&curElem.style){try{backgroundColor=jQuery.css(curElem,'backgroundColor');curElem=curElem.parentNode;}catch(e){}}
value=value.blend(backgroundColor&&backgroundColor!=='transparent'?backgroundColor:'_default');}
value=value.toRgbaString();}
try{elem.style[hook]=value;}catch(e){}}};jQuery.fx.step[hook]=function(fx){if(!fx.colorInit){fx.start=color(fx.elem,hook);fx.end=color(fx.end);fx.colorInit=true;}
jQuery.cssHooks[hook].set(fx.elem,fx.start.transition(fx.end,fx.pos));};});};color.hook(stepHooks);jQuery.cssHooks.borderColor={expand:function(value){var expanded={};each(['Top','Right','Bottom','Left'],function(_i,part){expanded['border'+part+'Color']=value;});return expanded;}};colors=jQuery.Color.names={aqua:'#00ffff',black:'#000000',blue:'#0000ff',fuchsia:'#ff00ff',gray:'#808080',green:'#008000',lime:'#00ff00',maroon:'#800000',navy:'#000080',olive:'#808000',purple:'#800080',red:'#ff0000',silver:'#c0c0c0',teal:'#008080',white:'#ffffff',yellow:'#ffff00',transparent:[null,null,null,0],_default:'#ffffff'};
/*!
 * jQuery UI Effects 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var dataSpace='ui-effects-',dataSpaceStyle='ui-effects-style',dataSpaceAnimated='ui-effects-animated';$.effects={effect:{}};(function(){var classAnimationActions=['add','remove','toggle'],shorthandStyles={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};$.each(['borderLeftStyle','borderRightStyle','borderBottomStyle','borderTopStyle'],function(_,prop){$.fx.step[prop]=function(fx){if(fx.end!=='none'&&!fx.setAttr||fx.pos===1&&!fx.setAttr){jQuery.style(fx.elem,prop,fx.end);fx.setAttr=true;}};});function camelCase(string){return string.replace(/-([\da-z])/gi,function(all,letter){return letter.toUpperCase();});}
function getElementStyles(elem){var key,len,style=elem.ownerDocument.defaultView?elem.ownerDocument.defaultView.getComputedStyle(elem,null):elem.currentStyle,styles={};if(style&&style.length&&style[0]&&style[style[0]]){len=style.length;while(len--){key=style[len];if(typeof style[key]==='string'){styles[camelCase(key)]=style[key];}}}else{for(key in style){if(typeof style[key]==='string'){styles[key]=style[key];}}}
return styles;}
function styleDifference(oldStyle,newStyle){var diff={},name,value;for(name in newStyle){value=newStyle[name];if(oldStyle[name]!==value){if(!shorthandStyles[name]){if($.fx.step[name]||!isNaN(parseFloat(value))){diff[name]=value;}}}}
return diff;}
if(!$.fn.addBack){$.fn.addBack=function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector));};}
$.effects.animateClass=function(value,duration,easing,callback){var o=$.speed(duration,easing,callback);return this.queue(function(){var animated=$(this),baseClass=animated.attr('class')||'',applyClassChange,allAnimations=o.children?animated.find('*').addBack():animated;allAnimations=allAnimations.map(function(){var el=$(this);return{el:el,start:getElementStyles(this)};});applyClassChange=function(){$.each(classAnimationActions,function(i,action){if(value[action]){animated[action+'Class'](value[action]);}});};applyClassChange();allAnimations=allAnimations.map(function(){this.end=getElementStyles(this.el[0]);this.diff=styleDifference(this.start,this.end);return this;});animated.attr('class',baseClass);allAnimations=allAnimations.map(function(){var styleInfo=this,dfd=$.Deferred(),opts=$.extend({},o,{queue:false,complete:function(){dfd.resolve(styleInfo);}});this.el.animate(this.diff,opts);return dfd.promise();});$.when.apply($,allAnimations.get()).done(function(){applyClassChange();$.each(arguments,function(){var el=this.el;$.each(this.diff,function(key){el.css(key,'');});});o.complete.call(animated[0]);});});};$.fn.extend({addClass:(function(orig){return function(classNames,speed,easing,callback){return speed?$.effects.animateClass.call(this,{add:classNames},speed,easing,callback):orig.apply(this,arguments);};})($.fn.addClass),removeClass:(function(orig){return function(classNames,speed,easing,callback){return arguments.length>1?$.effects.animateClass.call(this,{remove:classNames},speed,easing,callback):orig.apply(this,arguments);};})($.fn.removeClass),toggleClass:(function(orig){return function(classNames,force,speed,easing,callback){if(typeof force==='boolean'||force===undefined){if(!speed){return orig.apply(this,arguments);}else{return $.effects.animateClass.call(this,(force?{add:classNames}:{remove:classNames}),speed,easing,callback);}}else{return $.effects.animateClass.call(this,{toggle:classNames},force,speed,easing);}};})($.fn.toggleClass),switchClass:function(remove,add,speed,easing,callback){return $.effects.animateClass.call(this,{add:add,remove:remove},speed,easing,callback);}});})();(function(){if($.expr&&$.expr.pseudos&&$.expr.pseudos.animated){$.expr.pseudos.animated=(function(orig){return function(elem){return!!$(elem).data(dataSpaceAnimated)||orig(elem);};})($.expr.pseudos.animated);}
if($.uiBackCompat!==false){$.extend($.effects,{save:function(element,set){var i=0,length=set.length;for(;i<length;i++){if(set[i]!==null){element.data(dataSpace+set[i],element[0].style[set[i]]);}}},restore:function(element,set){var val,i=0,length=set.length;for(;i<length;i++){if(set[i]!==null){val=element.data(dataSpace+set[i]);element.css(set[i],val);}}},setMode:function(el,mode){if(mode==='toggle'){mode=el.is(':hidden')?'show':'hide';}
return mode;},createWrapper:function(element){if(element.parent().is('.ui-effects-wrapper')){return element.parent();}
var props={width:element.outerWidth(true),height:element.outerHeight(true),'float':element.css('float')},wrapper=$('<div></div>').addClass('ui-effects-wrapper').css({fontSize:'100%',background:'transparent',border:'none',margin:0,padding:0}),size={width:element.width(),height:element.height()},active=document.activeElement;try{active.id;}catch(e){active=document.body;}
element.wrap(wrapper);if(element[0]===active||$.contains(element[0],active)){$(active).trigger('focus');}
wrapper=element.parent();if(element.css('position')==='static'){wrapper.css({position:'relative'});element.css({position:'relative'});}else{$.extend(props,{position:element.css('position'),zIndex:element.css('z-index')});$.each(['top','left','bottom','right'],function(i,pos){props[pos]=element.css(pos);if(isNaN(parseInt(props[pos],10))){props[pos]='auto';}});element.css({position:'relative',top:0,left:0,right:'auto',bottom:'auto'});}
element.css(size);return wrapper.css(props).show();},removeWrapper:function(element){var active=document.activeElement;if(element.parent().is('.ui-effects-wrapper')){element.parent().replaceWith(element);if(element[0]===active||$.contains(element[0],active)){$(active).trigger('focus');}}
return element;}});}
$.extend($.effects,{version:'1.13.2',define:function(name,mode,effect){if(!effect){effect=mode;mode='effect';}
$.effects.effect[name]=effect;$.effects.effect[name].mode=mode;return effect;},scaledDimensions:function(element,percent,direction){if(percent===0){return{height:0,width:0,outerHeight:0,outerWidth:0};}
var x=direction!=='horizontal'?((percent||100)/100):1,y=direction!=='vertical'?((percent||100)/100):1;return{height:element.height()*y,width:element.width()*x,outerHeight:element.outerHeight()*y,outerWidth:element.outerWidth()*x};},clipToBox:function(animation){return{width:animation.clip.right-animation.clip.left,height:animation.clip.bottom-animation.clip.top,left:animation.clip.left,top:animation.clip.top};},unshift:function(element,queueLength,count){var queue=element.queue();if(queueLength>1){queue.splice.apply(queue,[1,0].concat(queue.splice(queueLength,count)));}
element.dequeue();},saveStyle:function(element){element.data(dataSpaceStyle,element[0].style.cssText);},restoreStyle:function(element){element[0].style.cssText=element.data(dataSpaceStyle)||'';element.removeData(dataSpaceStyle);},mode:function(element,mode){var hidden=element.is(':hidden');if(mode==='toggle'){mode=hidden?'show':'hide';}
if(hidden?mode==='hide':mode==='show'){mode='none';}
return mode;},getBaseline:function(origin,original){var y,x;switch(origin[0]){case'top':y=0;break;case'middle':y=0.5;break;case'bottom':y=1;break;default:y=origin[0]/original.height;}
switch(origin[1]){case'left':x=0;break;case'center':x=0.5;break;case'right':x=1;break;default:x=origin[1]/original.width;}
return{x:x,y:y};},createPlaceholder:function(element){var placeholder,cssPosition=element.css('position'),position=element.position();element.css({marginTop:element.css('marginTop'),marginBottom:element.css('marginBottom'),marginLeft:element.css('marginLeft'),marginRight:element.css('marginRight')}).outerWidth(element.outerWidth()).outerHeight(element.outerHeight());if(/^(static|relative)/.test(cssPosition)){cssPosition='absolute';placeholder=$('<'+element[0].nodeName+'>').insertAfter(element).css({display:/^(inline|ruby)/.test(element.css('display'))?'inline-block':'block',visibility:'hidden',marginTop:element.css('marginTop'),marginBottom:element.css('marginBottom'),marginLeft:element.css('marginLeft'),marginRight:element.css('marginRight'),'float':element.css('float')}).outerWidth(element.outerWidth()).outerHeight(element.outerHeight()).addClass('ui-effects-placeholder');element.data(dataSpace+'placeholder',placeholder);}
element.css({position:cssPosition,left:position.left,top:position.top});return placeholder;},removePlaceholder:function(element){var dataKey=dataSpace+'placeholder',placeholder=element.data(dataKey);if(placeholder){placeholder.remove();element.removeData(dataKey);}},cleanUp:function(element){$.effects.restoreStyle(element);$.effects.removePlaceholder(element);},setTransition:function(element,list,factor,value){value=value||{};$.each(list,function(i,x){var unit=element.cssUnit(x);if(unit[0]>0){value[x]=unit[0]*factor+unit[1];}});return value;}});function _normalizeArguments(effect,options,speed,callback){if($.isPlainObject(effect)){options=effect;effect=effect.effect;}
effect={effect:effect};if(options==null){options={};}
if(typeof options==='function'){callback=options;speed=null;options={};}
if(typeof options==='number'||$.fx.speeds[options]){callback=speed;speed=options;options={};}
if(typeof speed==='function'){callback=speed;speed=null;}
if(options){$.extend(effect,options);}
speed=speed||options.duration;effect.duration=$.fx.off?0:typeof speed==='number'?speed:speed in $.fx.speeds?$.fx.speeds[speed]:$.fx.speeds._default;effect.complete=callback||options.complete;return effect;}
function standardAnimationOption(option){if(!option||typeof option==='number'||$.fx.speeds[option]){return true;}
if(typeof option==='string'&&!$.effects.effect[option]){return true;}
if(typeof option==='function'){return true;}
if(typeof option==='object'&&!option.effect){return true;}
return false;}
$.fn.extend({effect:function(){var args=_normalizeArguments.apply(this,arguments),effectMethod=$.effects.effect[args.effect],defaultMode=effectMethod.mode,queue=args.queue,queueName=queue||'fx',complete=args.complete,mode=args.mode,modes=[],prefilter=function(next){var el=$(this),normalizedMode=$.effects.mode(el,mode)||defaultMode;el.data(dataSpaceAnimated,true);modes.push(normalizedMode);if(defaultMode&&(normalizedMode==='show'||(normalizedMode===defaultMode&&normalizedMode==='hide'))){el.show();}
if(!defaultMode||normalizedMode!=='none'){$.effects.saveStyle(el);}
if(typeof next==='function'){next();}};if($.fx.off||!effectMethod){if(mode){return this[mode](args.duration,complete);}else{return this.each(function(){if(complete){complete.call(this);}});}}
function run(next){var elem=$(this);function cleanup(){elem.removeData(dataSpaceAnimated);$.effects.cleanUp(elem);if(args.mode==='hide'){elem.hide();}
done();}
function done(){if(typeof complete==='function'){complete.call(elem[0]);}
if(typeof next==='function'){next();}}
args.mode=modes.shift();if($.uiBackCompat!==false&&!defaultMode){if(elem.is(':hidden')?mode==='hide':mode==='show'){elem[mode]();done();}else{effectMethod.call(elem[0],args,done);}}else{if(args.mode==='none'){elem[mode]();done();}else{effectMethod.call(elem[0],args,cleanup);}}}
return queue===false?this.each(prefilter).each(run):this.queue(queueName,prefilter).queue(queueName,run);},show:(function(orig){return function(option){if(standardAnimationOption(option)){return orig.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args.mode='show';return this.effect.call(this,args);}};})($.fn.show),hide:(function(orig){return function(option){if(standardAnimationOption(option)){return orig.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args.mode='hide';return this.effect.call(this,args);}};})($.fn.hide),toggle:(function(orig){return function(option){if(standardAnimationOption(option)||typeof option==='boolean'){return orig.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args.mode='toggle';return this.effect.call(this,args);}};})($.fn.toggle),cssUnit:function(key){var style=this.css(key),val=[];$.each(['em','px','%','pt'],function(i,unit){if(style.indexOf(unit)>0){val=[parseFloat(style),unit];}});return val;},cssClip:function(clipObj){if(clipObj){return this.css('clip','rect('+clipObj.top+'px '+clipObj.right+'px '+
clipObj.bottom+'px '+clipObj.left+'px)');}
return parseClip(this.css('clip'),this);},transfer:function(options,done){var element=$(this),target=$(options.to),targetFixed=target.css('position')==='fixed',body=$('body'),fixTop=targetFixed?body.scrollTop():0,fixLeft=targetFixed?body.scrollLeft():0,endPosition=target.offset(),animation={top:endPosition.top-fixTop,left:endPosition.left-fixLeft,height:target.innerHeight(),width:target.innerWidth()},startPosition=element.offset(),transfer=$('<div class=\'ui-effects-transfer\'></div>');transfer.appendTo('body').addClass(options.className).css({top:startPosition.top-fixTop,left:startPosition.left-fixLeft,height:element.innerHeight(),width:element.innerWidth(),position:targetFixed?'fixed':'absolute'}).animate(animation,options.duration,options.easing,function(){transfer.remove();if(typeof done==='function'){done();}});}});function parseClip(str,element){var outerWidth=element.outerWidth(),outerHeight=element.outerHeight(),clipRegex=/^rect\((-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto)\)$/,values=clipRegex.exec(str)||['',0,outerWidth,outerHeight,0];return{top:parseFloat(values[1])||0,right:values[2]==='auto'?outerWidth:parseFloat(values[2]),bottom:values[3]==='auto'?outerHeight:parseFloat(values[3]),left:parseFloat(values[4])||0};}
$.fx.step.clip=function(fx){if(!fx.clipInit){fx.start=$(fx.elem).cssClip();if(typeof fx.end==='string'){fx.end=parseClip(fx.end,fx.elem);}
fx.clipInit=true;}
$(fx.elem).cssClip({top:fx.pos*(fx.end.top-fx.start.top)+fx.start.top,right:fx.pos*(fx.end.right-fx.start.right)+fx.start.right,bottom:fx.pos*(fx.end.bottom-fx.start.bottom)+fx.start.bottom,left:fx.pos*(fx.end.left-fx.start.left)+fx.start.left});};})();(function(){var baseEasings={};$.each(['Quad','Cubic','Quart','Quint','Expo'],function(i,name){baseEasings[name]=function(p){return Math.pow(p,i+2);};});$.extend(baseEasings,{Sine:function(p){return 1-Math.cos(p*Math.PI/2);},Circ:function(p){return 1-Math.sqrt(1-p*p);},Elastic:function(p){return p===0||p===1?p:-Math.pow(2,8*(p-1))*Math.sin(((p-1)*80-7.5)*Math.PI/15);},Back:function(p){return p*p*(3*p-2);},Bounce:function(p){var pow2,bounce=4;while(p<((pow2=Math.pow(2,--bounce))-1)/11){}
return 1/Math.pow(4,3-bounce)-
7.5625*Math.pow((pow2*3-2)/22-p,2);}});$.each(baseEasings,function(name,easeIn){$.easing['easeIn'+name]=easeIn;$.easing['easeOut'+name]=function(p){return 1-easeIn(1-p);};$.easing['easeInOut'+name]=function(p){return p<0.5?easeIn(p*2)/2:1-easeIn(p*-2+2)/2;};});})();var effect=$.effects;
/*!
 * jQuery UI Effects Blind 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var effectsEffectBlind=$.effects.define('blind','hide',function(options,done){var map={up:['bottom','top'],vertical:['bottom','top'],down:['top','bottom'],left:['right','left'],horizontal:['right','left'],right:['left','right']},element=$(this),direction=options.direction||'up',start=element.cssClip(),animate={clip:$.extend({},start)},placeholder=$.effects.createPlaceholder(element);animate.clip[map[direction][0]]=animate.clip[map[direction][1]];if(options.mode==='show'){element.cssClip(animate.clip);if(placeholder){placeholder.css($.effects.clipToBox(animate));}
animate.clip=start;}
if(placeholder){placeholder.animate($.effects.clipToBox(animate),options.duration,options.easing);}
element.animate(animate,{queue:false,duration:options.duration,easing:options.easing,complete:done});});
/*!
 * jQuery UI Effects Bounce 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var effectsEffectBounce=$.effects.define('bounce',function(options,done){var upAnim,downAnim,refValue,element=$(this),mode=options.mode,hide=mode==='hide',show=mode==='show',direction=options.direction||'up',distance=options.distance,times=options.times||5,anims=times*2+(show||hide?1:0),speed=options.duration/anims,easing=options.easing,ref=(direction==='up'||direction==='down')?'top':'left',motion=(direction==='up'||direction==='left'),i=0,queuelen=element.queue().length;$.effects.createPlaceholder(element);refValue=element.css(ref);if(!distance){distance=element[ref==='top'?'outerHeight':'outerWidth']()/3;}
if(show){downAnim={opacity:1};downAnim[ref]=refValue;element.css('opacity',0).css(ref,motion?-distance*2:distance*2).animate(downAnim,speed,easing);}
if(hide){distance=distance/Math.pow(2,times-1);}
downAnim={};downAnim[ref]=refValue;for(;i<times;i++){upAnim={};upAnim[ref]=(motion?'-=':'+=')+distance;element.animate(upAnim,speed,easing).animate(downAnim,speed,easing);distance=hide?distance*2:distance/2;}
if(hide){upAnim={opacity:0};upAnim[ref]=(motion?'-=':'+=')+distance;element.animate(upAnim,speed,easing);}
element.queue(done);$.effects.unshift(element,queuelen,anims+1);});
/*!
 * jQuery UI Effects Clip 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var effectsEffectClip=$.effects.define('clip','hide',function(options,done){var start,animate={},element=$(this),direction=options.direction||'vertical',both=direction==='both',horizontal=both||direction==='horizontal',vertical=both||direction==='vertical';start=element.cssClip();animate.clip={top:vertical?(start.bottom-start.top)/2:start.top,right:horizontal?(start.right-start.left)/2:start.right,bottom:vertical?(start.bottom-start.top)/2:start.bottom,left:horizontal?(start.right-start.left)/2:start.left};$.effects.createPlaceholder(element);if(options.mode==='show'){element.cssClip(animate.clip);animate.clip=start;}
element.animate(animate,{queue:false,duration:options.duration,easing:options.easing,complete:done});});
/*!
 * jQuery UI Effects Drop 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var effectsEffectDrop=$.effects.define('drop','hide',function(options,done){var distance,element=$(this),mode=options.mode,show=mode==='show',direction=options.direction||'left',ref=(direction==='up'||direction==='down')?'top':'left',motion=(direction==='up'||direction==='left')?'-=':'+=',oppositeMotion=(motion==='+=')?'-=':'+=',animation={opacity:0};$.effects.createPlaceholder(element);distance=options.distance||element[ref==='top'?'outerHeight':'outerWidth'](true)/2;animation[ref]=motion+distance;if(show){element.css(animation);animation[ref]=oppositeMotion+distance;animation.opacity=1;}
element.animate(animation,{queue:false,duration:options.duration,easing:options.easing,complete:done});});
/*!
 * jQuery UI Effects Explode 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var effectsEffectExplode=$.effects.define('explode','hide',function(options,done){var i,j,left,top,mx,my,rows=options.pieces?Math.round(Math.sqrt(options.pieces)):3,cells=rows,element=$(this),mode=options.mode,show=mode==='show',offset=element.show().css('visibility','hidden').offset(),width=Math.ceil(element.outerWidth()/cells),height=Math.ceil(element.outerHeight()/rows),pieces=[];function childComplete(){pieces.push(this);if(pieces.length===rows*cells){animComplete();}}
for(i=0;i<rows;i++){top=offset.top+i*height;my=i-(rows-1)/2;for(j=0;j<cells;j++){left=offset.left+j*width;mx=j-(cells-1)/2;element.clone().appendTo('body').wrap('<div></div>').css({position:'absolute',visibility:'visible',left:-j*width,top:-i*height}).parent().addClass('ui-effects-explode').css({position:'absolute',overflow:'hidden',width:width,height:height,left:left+(show?mx*width:0),top:top+(show?my*height:0),opacity:show?0:1}).animate({left:left+(show?0:mx*width),top:top+(show?0:my*height),opacity:show?1:0},options.duration||500,options.easing,childComplete);}}
function animComplete(){element.css({visibility:'visible'});$(pieces).remove();done();}});
/*!
 * jQuery UI Effects Fade 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var effectsEffectFade=$.effects.define('fade','toggle',function(options,done){var show=options.mode==='show';$(this).css('opacity',show?0:1).animate({opacity:show?1:0},{queue:false,duration:options.duration,easing:options.easing,complete:done});});
/*!
 * jQuery UI Effects Fold 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var effectsEffectFold=$.effects.define('fold','hide',function(options,done){var element=$(this),mode=options.mode,show=mode==='show',hide=mode==='hide',size=options.size||15,percent=/([0-9]+)%/.exec(size),horizFirst=!!options.horizFirst,ref=horizFirst?['right','bottom']:['bottom','right'],duration=options.duration/2,placeholder=$.effects.createPlaceholder(element),start=element.cssClip(),animation1={clip:$.extend({},start)},animation2={clip:$.extend({},start)},distance=[start[ref[0]],start[ref[1]]],queuelen=element.queue().length;if(percent){size=parseInt(percent[1],10)/100*distance[hide?0:1];}
animation1.clip[ref[0]]=size;animation2.clip[ref[0]]=size;animation2.clip[ref[1]]=0;if(show){element.cssClip(animation2.clip);if(placeholder){placeholder.css($.effects.clipToBox(animation2));}
animation2.clip=start;}
element.queue(function(next){if(placeholder){placeholder.animate($.effects.clipToBox(animation1),duration,options.easing).animate($.effects.clipToBox(animation2),duration,options.easing);}
next();}).animate(animation1,duration,options.easing).animate(animation2,duration,options.easing).queue(done);$.effects.unshift(element,queuelen,4);});
/*!
 * jQuery UI Effects Highlight 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var effectsEffectHighlight=$.effects.define('highlight','show',function(options,done){var element=$(this),animation={backgroundColor:element.css('backgroundColor')};if(options.mode==='hide'){animation.opacity=0;}
$.effects.saveStyle(element);element.css({backgroundImage:'none',backgroundColor:options.color||'#ffff99'}).animate(animation,{queue:false,duration:options.duration,easing:options.easing,complete:done});});
/*!
 * jQuery UI Effects Size 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var effectsEffectSize=$.effects.define('size',function(options,done){var baseline,factor,temp,element=$(this),cProps=['fontSize'],vProps=['borderTopWidth','borderBottomWidth','paddingTop','paddingBottom'],hProps=['borderLeftWidth','borderRightWidth','paddingLeft','paddingRight'],mode=options.mode,restore=mode!=='effect',scale=options.scale||'both',origin=options.origin||['middle','center'],position=element.css('position'),pos=element.position(),original=$.effects.scaledDimensions(element),from=options.from||original,to=options.to||$.effects.scaledDimensions(element,0);$.effects.createPlaceholder(element);if(mode==='show'){temp=from;from=to;to=temp;}
factor={from:{y:from.height/original.height,x:from.width/original.width},to:{y:to.height/original.height,x:to.width/original.width}};if(scale==='box'||scale==='both'){if(factor.from.y!==factor.to.y){from=$.effects.setTransition(element,vProps,factor.from.y,from);to=$.effects.setTransition(element,vProps,factor.to.y,to);}
if(factor.from.x!==factor.to.x){from=$.effects.setTransition(element,hProps,factor.from.x,from);to=$.effects.setTransition(element,hProps,factor.to.x,to);}}
if(scale==='content'||scale==='both'){if(factor.from.y!==factor.to.y){from=$.effects.setTransition(element,cProps,factor.from.y,from);to=$.effects.setTransition(element,cProps,factor.to.y,to);}}
if(origin){baseline=$.effects.getBaseline(origin,original);from.top=(original.outerHeight-from.outerHeight)*baseline.y+pos.top;from.left=(original.outerWidth-from.outerWidth)*baseline.x+pos.left;to.top=(original.outerHeight-to.outerHeight)*baseline.y+pos.top;to.left=(original.outerWidth-to.outerWidth)*baseline.x+pos.left;}
delete from.outerHeight;delete from.outerWidth;element.css(from);if(scale==='content'||scale==='both'){vProps=vProps.concat(['marginTop','marginBottom']).concat(cProps);hProps=hProps.concat(['marginLeft','marginRight']);element.find('*[width]').each(function(){var child=$(this),childOriginal=$.effects.scaledDimensions(child),childFrom={height:childOriginal.height*factor.from.y,width:childOriginal.width*factor.from.x,outerHeight:childOriginal.outerHeight*factor.from.y,outerWidth:childOriginal.outerWidth*factor.from.x},childTo={height:childOriginal.height*factor.to.y,width:childOriginal.width*factor.to.x,outerHeight:childOriginal.height*factor.to.y,outerWidth:childOriginal.width*factor.to.x};if(factor.from.y!==factor.to.y){childFrom=$.effects.setTransition(child,vProps,factor.from.y,childFrom);childTo=$.effects.setTransition(child,vProps,factor.to.y,childTo);}
if(factor.from.x!==factor.to.x){childFrom=$.effects.setTransition(child,hProps,factor.from.x,childFrom);childTo=$.effects.setTransition(child,hProps,factor.to.x,childTo);}
if(restore){$.effects.saveStyle(child);}
child.css(childFrom);child.animate(childTo,options.duration,options.easing,function(){if(restore){$.effects.restoreStyle(child);}});});}
element.animate(to,{queue:false,duration:options.duration,easing:options.easing,complete:function(){var offset=element.offset();if(to.opacity===0){element.css('opacity',from.opacity);}
if(!restore){element.css('position',position==='static'?'relative':position).offset(offset);$.effects.saveStyle(element);}
done();}});});
/*!
 * jQuery UI Effects Scale 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var effectsEffectScale=$.effects.define('scale',function(options,done){var el=$(this),mode=options.mode,percent=parseInt(options.percent,10)||(parseInt(options.percent,10)===0?0:(mode!=='effect'?0:100)),newOptions=$.extend(true,{from:$.effects.scaledDimensions(el),to:$.effects.scaledDimensions(el,percent,options.direction||'both'),origin:options.origin||['middle','center']},options);if(options.fade){newOptions.from.opacity=1;newOptions.to.opacity=0;}
$.effects.effect.size.call(this,newOptions,done);});
/*!
 * jQuery UI Effects Puff 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var effectsEffectPuff=$.effects.define('puff','hide',function(options,done){var newOptions=$.extend(true,{},options,{fade:true,percent:parseInt(options.percent,10)||150});$.effects.effect.scale.call(this,newOptions,done);});
/*!
 * jQuery UI Effects Pulsate 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var effectsEffectPulsate=$.effects.define('pulsate','show',function(options,done){var element=$(this),mode=options.mode,show=mode==='show',hide=mode==='hide',showhide=show||hide,anims=((options.times||5)*2)+(showhide?1:0),duration=options.duration/anims,animateTo=0,i=1,queuelen=element.queue().length;if(show||!element.is(':visible')){element.css('opacity',0).show();animateTo=1;}
for(;i<anims;i++){element.animate({opacity:animateTo},duration,options.easing);animateTo=1-animateTo;}
element.animate({opacity:animateTo},duration,options.easing);element.queue(done);$.effects.unshift(element,queuelen,anims+1);});
/*!
 * jQuery UI Effects Shake 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var effectsEffectShake=$.effects.define('shake',function(options,done){var i=1,element=$(this),direction=options.direction||'left',distance=options.distance||20,times=options.times||3,anims=times*2+1,speed=Math.round(options.duration/anims),ref=(direction==='up'||direction==='down')?'top':'left',positiveMotion=(direction==='up'||direction==='left'),animation={},animation1={},animation2={},queuelen=element.queue().length;$.effects.createPlaceholder(element);animation[ref]=(positiveMotion?'-=':'+=')+distance;animation1[ref]=(positiveMotion?'+=':'-=')+distance*2;animation2[ref]=(positiveMotion?'-=':'+=')+distance*2;element.animate(animation,speed,options.easing);for(;i<times;i++){element.animate(animation1,speed,options.easing).animate(animation2,speed,options.easing);}
element.animate(animation1,speed,options.easing).animate(animation,speed/2,options.easing).queue(done);$.effects.unshift(element,queuelen,anims+1);});
/*!
 * jQuery UI Effects Slide 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var effectsEffectSlide=$.effects.define('slide','show',function(options,done){var startClip,startRef,element=$(this),map={up:['bottom','top'],down:['top','bottom'],left:['right','left'],right:['left','right']},mode=options.mode,direction=options.direction||'left',ref=(direction==='up'||direction==='down')?'top':'left',positiveMotion=(direction==='up'||direction==='left'),distance=options.distance||element[ref==='top'?'outerHeight':'outerWidth'](true),animation={};$.effects.createPlaceholder(element);startClip=element.cssClip();startRef=element.position()[ref];animation[ref]=(positiveMotion?-1:1)*distance+startRef;animation.clip=element.cssClip();animation.clip[map[direction][1]]=animation.clip[map[direction][0]];if(mode==='show'){element.cssClip(animation.clip);element.css(ref,animation[ref]);animation.clip=startClip;animation[ref]=startRef;}
element.animate(animation,{queue:false,duration:options.duration,easing:options.easing,complete:done});});
/*!
 * jQuery UI Effects Transfer 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var effect;if($.uiBackCompat!==false){effect=$.effects.define('transfer',function(options,done){$(this).transfer(options,done);});}
var effectsEffectTransfer=effect;
/*!
 * jQuery UI Focusable 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
$.ui.focusable=function(element,hasTabindex){var map,mapName,img,focusableIfVisible,fieldset,nodeName=element.nodeName.toLowerCase();if('area'===nodeName){map=element.parentNode;mapName=map.name;if(!element.href||!mapName||map.nodeName.toLowerCase()!=='map'){return false;}
img=$('img[usemap=\'#'+mapName+'\']');return img.length>0&&img.is(':visible');}
if(/^(input|select|textarea|button|object)$/.test(nodeName)){focusableIfVisible=!element.disabled;if(focusableIfVisible){fieldset=$(element).closest('fieldset')[0];if(fieldset){focusableIfVisible=!fieldset.disabled;}}}else if('a'===nodeName){focusableIfVisible=element.href||hasTabindex;}else{focusableIfVisible=hasTabindex;}
return focusableIfVisible&&$(element).is(':visible')&&visible($(element));};function visible(element){var visibility=element.css('visibility');while(visibility==='inherit'){element=element.parent();visibility=element.css('visibility');}
return visibility==='visible';}
$.extend($.expr.pseudos,{focusable:function(element){return $.ui.focusable(element,$.attr(element,'tabindex')!=null);}});var focusable=$.ui.focusable;var form=$.fn._form=function(){return typeof this[0].form==='string'?this.closest('form'):$(this[0].form);};
/*!
 * jQuery UI Form Reset Mixin 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var formResetMixin=$.ui.formResetMixin={_formResetHandler:function(){var form=$(this);setTimeout(function(){var instances=form.data('ui-form-reset-instances');$.each(instances,function(){this.refresh();});});},_bindFormResetHandler:function(){this.form=this.element._form();if(!this.form.length){return;}
var instances=this.form.data('ui-form-reset-instances')||[];if(!instances.length){this.form.on('reset.ui-form-reset',this._formResetHandler);}
instances.push(this);this.form.data('ui-form-reset-instances',instances);},_unbindFormResetHandler:function(){if(!this.form.length){return;}
var instances=this.form.data('ui-form-reset-instances');instances.splice($.inArray(this,instances),1);if(instances.length){this.form.data('ui-form-reset-instances',instances);}else{this.form.removeData('ui-form-reset-instances').off('reset.ui-form-reset');}}};
/*!
 * jQuery UI Support for jQuery core 1.8.x and newer 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 */
if(!$.expr.pseudos){$.expr.pseudos=$.expr[':'];}
if(!$.uniqueSort){$.uniqueSort=$.unique;}
if(!$.escapeSelector){var rcssescape=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;var fcssescape=function(ch,asCodePoint){if(asCodePoint){if(ch==='\0'){return'\uFFFD';}
return ch.slice(0,-1)+'\\'+
ch.charCodeAt(ch.length-1).toString(16)+' ';}
return'\\'+ch;};$.escapeSelector=function(sel){return(sel+'').replace(rcssescape,fcssescape);};}
if(!$.fn.even||!$.fn.odd){$.fn.extend({even:function(){return this.filter(function(i){return i%2===0;});},odd:function(){return this.filter(function(i){return i%2===1;});}});};
/*!
 * jQuery UI Keycode 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var keycode=$.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38};
/*!
 * jQuery UI Labels 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var labels=$.fn.labels=function(){var ancestor,selector,id,labels,ancestors;if(!this.length){return this.pushStack([]);}
if(this[0].labels&&this[0].labels.length){return this.pushStack(this[0].labels);}
labels=this.eq(0).parents('label');id=this.attr('id');if(id){ancestor=this.eq(0).parents().last();ancestors=ancestor.add(ancestor.length?ancestor.siblings():this.siblings());selector='label[for=\''+$.escapeSelector(id)+'\']';labels=labels.add(ancestors.find(selector).addBack(selector));}
return this.pushStack(labels);};
/*!
 * jQuery UI Scroll Parent 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var scrollParent=$.fn.scrollParent=function(includeHidden){var position=this.css('position'),excludeStaticParent=position==='absolute',overflowRegex=includeHidden?/(auto|scroll|hidden)/:/(auto|scroll)/,scrollParent=this.parents().filter(function(){var parent=$(this);if(excludeStaticParent&&parent.css('position')==='static'){return false;}
return overflowRegex.test(parent.css('overflow')+parent.css('overflow-y')+
parent.css('overflow-x'));}).eq(0);return position==='fixed'||!scrollParent.length?$(this[0].ownerDocument||document):scrollParent;};
/*!
 * jQuery UI Tabbable 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var tabbable=$.extend($.expr.pseudos,{tabbable:function(element){var tabIndex=$.attr(element,'tabindex'),hasTabindex=tabIndex!=null;return(!hasTabindex||tabIndex>=0)&&$.ui.focusable(element,hasTabindex);}});
/*!
 * jQuery UI Unique ID 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var uniqueId=$.fn.extend({uniqueId:(function(){var uuid=0;return function(){return this.each(function(){if(!this.id){this.id='ui-id-'+(++uuid);}});};})(),removeUniqueId:function(){return this.each(function(){if(/^ui-id-\d+$/.test(this.id)){$(this).removeAttr('id');}});}});
/*!
 * jQuery UI Accordion 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var widgetsAccordion=$.widget('ui.accordion',{version:'1.13.2',options:{active:0,animate:{},classes:{'ui-accordion-header':'ui-corner-top','ui-accordion-header-collapsed':'ui-corner-all','ui-accordion-content':'ui-corner-bottom'},collapsible:false,event:'click',header:function(elem){return elem.find('> li > :first-child').add(elem.find('> :not(li)').even());},heightStyle:'auto',icons:{activeHeader:'ui-icon-triangle-1-s',header:'ui-icon-triangle-1-e'},activate:null,beforeActivate:null},hideProps:{borderTopWidth:'hide',borderBottomWidth:'hide',paddingTop:'hide',paddingBottom:'hide',height:'hide'},showProps:{borderTopWidth:'show',borderBottomWidth:'show',paddingTop:'show',paddingBottom:'show',height:'show'},_create:function(){var options=this.options;this.prevShow=this.prevHide=$();this._addClass('ui-accordion','ui-widget ui-helper-reset');this.element.attr('role','tablist');if(!options.collapsible&&(options.active===false||options.active==null)){options.active=0;}
this._processPanels();if(options.active<0){options.active+=this.headers.length;}
this._refresh();},_getCreateEventData:function(){return{header:this.active,panel:!this.active.length?$():this.active.next()};},_createIcons:function(){var icon,children,icons=this.options.icons;if(icons){icon=$('<span>');this._addClass(icon,'ui-accordion-header-icon','ui-icon '+icons.header);icon.prependTo(this.headers);children=this.active.children('.ui-accordion-header-icon');this._removeClass(children,icons.header)._addClass(children,null,icons.activeHeader)._addClass(this.headers,'ui-accordion-icons');}},_destroyIcons:function(){this._removeClass(this.headers,'ui-accordion-icons');this.headers.children('.ui-accordion-header-icon').remove();},_destroy:function(){var contents;this.element.removeAttr('role');this.headers.removeAttr('role aria-expanded aria-selected aria-controls tabIndex').removeUniqueId();this._destroyIcons();contents=this.headers.next().css('display','').removeAttr('role aria-hidden aria-labelledby').removeUniqueId();if(this.options.heightStyle!=='content'){contents.css('height','');}},_setOption:function(key,value){if(key==='active'){this._activate(value);return;}
if(key==='event'){if(this.options.event){this._off(this.headers,this.options.event);}
this._setupEvents(value);}
this._super(key,value);if(key==='collapsible'&&!value&&this.options.active===false){this._activate(0);}
if(key==='icons'){this._destroyIcons();if(value){this._createIcons();}}},_setOptionDisabled:function(value){this._super(value);this.element.attr('aria-disabled',value);this._toggleClass(null,'ui-state-disabled',!!value);this._toggleClass(this.headers.add(this.headers.next()),null,'ui-state-disabled',!!value);},_keydown:function(event){if(event.altKey||event.ctrlKey){return;}
var keyCode=$.ui.keyCode,length=this.headers.length,currentIndex=this.headers.index(event.target),toFocus=false;switch(event.keyCode){case keyCode.RIGHT:case keyCode.DOWN:toFocus=this.headers[(currentIndex+1)%length];break;case keyCode.LEFT:case keyCode.UP:toFocus=this.headers[(currentIndex-1+length)%length];break;case keyCode.SPACE:case keyCode.ENTER:this._eventHandler(event);break;case keyCode.HOME:toFocus=this.headers[0];break;case keyCode.END:toFocus=this.headers[length-1];break;}
if(toFocus){$(event.target).attr('tabIndex',-1);$(toFocus).attr('tabIndex',0);$(toFocus).trigger('focus');event.preventDefault();}},_panelKeyDown:function(event){if(event.keyCode===$.ui.keyCode.UP&&event.ctrlKey){$(event.currentTarget).prev().trigger('focus');}},refresh:function(){var options=this.options;this._processPanels();if((options.active===false&&options.collapsible===true)||!this.headers.length){options.active=false;this.active=$();}else if(options.active===false){this._activate(0);}else if(this.active.length&&!$.contains(this.element[0],this.active[0])){if(this.headers.length===this.headers.find('.ui-state-disabled').length){options.active=false;this.active=$();}else{this._activate(Math.max(0,options.active-1));}}else{options.active=this.headers.index(this.active);}
this._destroyIcons();this._refresh();},_processPanels:function(){var prevHeaders=this.headers,prevPanels=this.panels;if(typeof this.options.header==='function'){this.headers=this.options.header(this.element);}else{this.headers=this.element.find(this.options.header);}
this._addClass(this.headers,'ui-accordion-header ui-accordion-header-collapsed','ui-state-default');this.panels=this.headers.next().filter(':not(.ui-accordion-content-active)').hide();this._addClass(this.panels,'ui-accordion-content','ui-helper-reset ui-widget-content');if(prevPanels){this._off(prevHeaders.not(this.headers));this._off(prevPanels.not(this.panels));}},_refresh:function(){var maxHeight,options=this.options,heightStyle=options.heightStyle,parent=this.element.parent();this.active=this._findActive(options.active);this._addClass(this.active,'ui-accordion-header-active','ui-state-active')._removeClass(this.active,'ui-accordion-header-collapsed');this._addClass(this.active.next(),'ui-accordion-content-active');this.active.next().show();this.headers.attr('role','tab').each(function(){var header=$(this),headerId=header.uniqueId().attr('id'),panel=header.next(),panelId=panel.uniqueId().attr('id');header.attr('aria-controls',panelId);panel.attr('aria-labelledby',headerId);}).next().attr('role','tabpanel');this.headers.not(this.active).attr({'aria-selected':'false','aria-expanded':'false',tabIndex:-1}).next().attr({'aria-hidden':'true'}).hide();if(!this.active.length){this.headers.eq(0).attr('tabIndex',0);}else{this.active.attr({'aria-selected':'true','aria-expanded':'true',tabIndex:0}).next().attr({'aria-hidden':'false'});}
this._createIcons();this._setupEvents(options.event);if(heightStyle==='fill'){maxHeight=parent.height();this.element.siblings(':visible').each(function(){var elem=$(this),position=elem.css('position');if(position==='absolute'||position==='fixed'){return;}
maxHeight-=elem.outerHeight(true);});this.headers.each(function(){maxHeight-=$(this).outerHeight(true);});this.headers.next().each(function(){$(this).height(Math.max(0,maxHeight-$(this).innerHeight()+$(this).height()));}).css('overflow','auto');}else if(heightStyle==='auto'){maxHeight=0;this.headers.next().each(function(){var isVisible=$(this).is(':visible');if(!isVisible){$(this).show();}
maxHeight=Math.max(maxHeight,$(this).css('height','').height());if(!isVisible){$(this).hide();}}).height(maxHeight);}},_activate:function(index){var active=this._findActive(index)[0];if(active===this.active[0]){return;}
active=active||this.active[0];this._eventHandler({target:active,currentTarget:active,preventDefault:$.noop});},_findActive:function(selector){return typeof selector==='number'?this.headers.eq(selector):$();},_setupEvents:function(event){var events={keydown:'_keydown'};if(event){$.each(event.split(' '),function(index,eventName){events[eventName]='_eventHandler';});}
this._off(this.headers.add(this.headers.next()));this._on(this.headers,events);this._on(this.headers.next(),{keydown:'_panelKeyDown'});this._hoverable(this.headers);this._focusable(this.headers);},_eventHandler:function(event){var activeChildren,clickedChildren,options=this.options,active=this.active,clicked=$(event.currentTarget),clickedIsActive=clicked[0]===active[0],collapsing=clickedIsActive&&options.collapsible,toShow=collapsing?$():clicked.next(),toHide=active.next(),eventData={oldHeader:active,oldPanel:toHide,newHeader:collapsing?$():clicked,newPanel:toShow};event.preventDefault();if((clickedIsActive&&!options.collapsible)||(this._trigger('beforeActivate',event,eventData)===false)){return;}
options.active=collapsing?false:this.headers.index(clicked);this.active=clickedIsActive?$():clicked;this._toggle(eventData);this._removeClass(active,'ui-accordion-header-active','ui-state-active');if(options.icons){activeChildren=active.children('.ui-accordion-header-icon');this._removeClass(activeChildren,null,options.icons.activeHeader)._addClass(activeChildren,null,options.icons.header);}
if(!clickedIsActive){this._removeClass(clicked,'ui-accordion-header-collapsed')._addClass(clicked,'ui-accordion-header-active','ui-state-active');if(options.icons){clickedChildren=clicked.children('.ui-accordion-header-icon');this._removeClass(clickedChildren,null,options.icons.header)._addClass(clickedChildren,null,options.icons.activeHeader);}
this._addClass(clicked.next(),'ui-accordion-content-active');}},_toggle:function(data){var toShow=data.newPanel,toHide=this.prevShow.length?this.prevShow:data.oldPanel;this.prevShow.add(this.prevHide).stop(true,true);this.prevShow=toShow;this.prevHide=toHide;if(this.options.animate){this._animate(toShow,toHide,data);}else{toHide.hide();toShow.show();this._toggleComplete(data);}
toHide.attr({'aria-hidden':'true'});toHide.prev().attr({'aria-selected':'false','aria-expanded':'false'});if(toShow.length&&toHide.length){toHide.prev().attr({'tabIndex':-1,'aria-expanded':'false'});}else if(toShow.length){this.headers.filter(function(){return parseInt($(this).attr('tabIndex'),10)===0;}).attr('tabIndex',-1);}
toShow.attr('aria-hidden','false').prev().attr({'aria-selected':'true','aria-expanded':'true',tabIndex:0});},_animate:function(toShow,toHide,data){var total,easing,duration,that=this,adjust=0,boxSizing=toShow.css('box-sizing'),down=toShow.length&&(!toHide.length||(toShow.index()<toHide.index())),animate=this.options.animate||{},options=down&&animate.down||animate,complete=function(){that._toggleComplete(data);};if(typeof options==='number'){duration=options;}
if(typeof options==='string'){easing=options;}
easing=easing||options.easing||animate.easing;duration=duration||options.duration||animate.duration;if(!toHide.length){return toShow.animate(this.showProps,duration,easing,complete);}
if(!toShow.length){return toHide.animate(this.hideProps,duration,easing,complete);}
total=toShow.show().outerHeight();toHide.animate(this.hideProps,{duration:duration,easing:easing,step:function(now,fx){fx.now=Math.round(now);}});toShow.hide().animate(this.showProps,{duration:duration,easing:easing,complete:complete,step:function(now,fx){fx.now=Math.round(now);if(fx.prop!=='height'){if(boxSizing==='content-box'){adjust+=fx.now;}}else if(that.options.heightStyle!=='content'){fx.now=Math.round(total-toHide.outerHeight()-adjust);adjust=0;}}});},_toggleComplete:function(data){var toHide=data.oldPanel,prev=toHide.prev();this._removeClass(toHide,'ui-accordion-content-active');this._removeClass(prev,'ui-accordion-header-active')._addClass(prev,'ui-accordion-header-collapsed');if(toHide.length){toHide.parent()[0].className=toHide.parent()[0].className;}
this._trigger('activate',null,data);}});var safeActiveElement=$.ui.safeActiveElement=function(document){var activeElement;try{activeElement=document.activeElement;}catch(error){activeElement=document.body;}
if(!activeElement){activeElement=document.body;}
if(!activeElement.nodeName){activeElement=document.body;}
return activeElement;};
/*!
 * jQuery UI Menu 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var widgetsMenu=$.widget('ui.menu',{version:'1.13.2',defaultElement:'<ul>',delay:300,options:{icons:{submenu:'ui-icon-caret-1-e'},items:'> *',menus:'ul',position:{my:'left top',at:'right top'},role:'menu',blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element;this.mouseHandled=false;this.lastMousePosition={x:null,y:null};this.element.uniqueId().attr({role:this.options.role,tabIndex:0});this._addClass('ui-menu','ui-widget ui-widget-content');this._on({'mousedown .ui-menu-item':function(event){event.preventDefault();this._activateItem(event);},'click .ui-menu-item':function(event){var target=$(event.target);var active=$($.ui.safeActiveElement(this.document[0]));if(!this.mouseHandled&&target.not('.ui-state-disabled').length){this.select(event);if(!event.isPropagationStopped()){this.mouseHandled=true;}
if(target.has('.ui-menu').length){this.expand(event);}else if(!this.element.is(':focus')&&active.closest('.ui-menu').length){this.element.trigger('focus',[true]);if(this.active&&this.active.parents('.ui-menu').length===1){clearTimeout(this.timer);}}}},'mouseenter .ui-menu-item':'_activateItem','mousemove .ui-menu-item':'_activateItem',mouseleave:'collapseAll','mouseleave .ui-menu':'collapseAll',focus:function(event,keepActiveItem){var item=this.active||this._menuItems().first();if(!keepActiveItem){this.focus(event,item);}},blur:function(event){this._delay(function(){var notContained=!$.contains(this.element[0],$.ui.safeActiveElement(this.document[0]));if(notContained){this.collapseAll(event);}});},keydown:'_keydown'});this.refresh();this._on(this.document,{click:function(event){if(this._closeOnDocumentClick(event)){this.collapseAll(event,true);}
this.mouseHandled=false;}});},_activateItem:function(event){if(this.previousFilter){return;}
if(event.clientX===this.lastMousePosition.x&&event.clientY===this.lastMousePosition.y){return;}
this.lastMousePosition={x:event.clientX,y:event.clientY};var actualTarget=$(event.target).closest('.ui-menu-item'),target=$(event.currentTarget);if(actualTarget[0]!==target[0]){return;}
if(target.is('.ui-state-active')){return;}
this._removeClass(target.siblings().children('.ui-state-active'),null,'ui-state-active');this.focus(event,target);},_destroy:function(){var items=this.element.find('.ui-menu-item').removeAttr('role aria-disabled'),submenus=items.children('.ui-menu-item-wrapper').removeUniqueId().removeAttr('tabIndex role aria-haspopup');this.element.removeAttr('aria-activedescendant').find('.ui-menu').addBack().removeAttr('role aria-labelledby aria-expanded aria-hidden aria-disabled '+'tabIndex').removeUniqueId().show();submenus.children().each(function(){var elem=$(this);if(elem.data('ui-menu-submenu-caret')){elem.remove();}});},_keydown:function(event){var match,prev,character,skip,preventDefault=true;switch(event.keyCode){case $.ui.keyCode.PAGE_UP:this.previousPage(event);break;case $.ui.keyCode.PAGE_DOWN:this.nextPage(event);break;case $.ui.keyCode.HOME:this._move('first','first',event);break;case $.ui.keyCode.END:this._move('last','last',event);break;case $.ui.keyCode.UP:this.previous(event);break;case $.ui.keyCode.DOWN:this.next(event);break;case $.ui.keyCode.LEFT:this.collapse(event);break;case $.ui.keyCode.RIGHT:if(this.active&&!this.active.is('.ui-state-disabled')){this.expand(event);}
break;case $.ui.keyCode.ENTER:case $.ui.keyCode.SPACE:this._activate(event);break;case $.ui.keyCode.ESCAPE:this.collapse(event);break;default:preventDefault=false;prev=this.previousFilter||'';skip=false;character=event.keyCode>=96&&event.keyCode<=105?(event.keyCode-96).toString():String.fromCharCode(event.keyCode);clearTimeout(this.filterTimer);if(character===prev){skip=true;}else{character=prev+character;}
match=this._filterMenuItems(character);match=skip&&match.index(this.active.next())!==-1?this.active.nextAll('.ui-menu-item'):match;if(!match.length){character=String.fromCharCode(event.keyCode);match=this._filterMenuItems(character);}
if(match.length){this.focus(event,match);this.previousFilter=character;this.filterTimer=this._delay(function(){delete this.previousFilter;},1000);}else{delete this.previousFilter;}}
if(preventDefault){event.preventDefault();}},_activate:function(event){if(this.active&&!this.active.is('.ui-state-disabled')){if(this.active.children('[aria-haspopup=\'true\']').length){this.expand(event);}else{this.select(event);}}},refresh:function(){var menus,items,newSubmenus,newItems,newWrappers,that=this,icon=this.options.icons.submenu,submenus=this.element.find(this.options.menus);this._toggleClass('ui-menu-icons',null,!!this.element.find('.ui-icon').length);newSubmenus=submenus.filter(':not(.ui-menu)').hide().attr({role:this.options.role,'aria-hidden':'true','aria-expanded':'false'}).each(function(){var menu=$(this),item=menu.prev(),submenuCaret=$('<span>').data('ui-menu-submenu-caret',true);that._addClass(submenuCaret,'ui-menu-icon','ui-icon '+icon);item.attr('aria-haspopup','true').prepend(submenuCaret);menu.attr('aria-labelledby',item.attr('id'));});this._addClass(newSubmenus,'ui-menu','ui-widget ui-widget-content ui-front');menus=submenus.add(this.element);items=menus.find(this.options.items);items.not('.ui-menu-item').each(function(){var item=$(this);if(that._isDivider(item)){that._addClass(item,'ui-menu-divider','ui-widget-content');}});newItems=items.not('.ui-menu-item, .ui-menu-divider');newWrappers=newItems.children().not('.ui-menu').uniqueId().attr({tabIndex:-1,role:this._itemRole()});this._addClass(newItems,'ui-menu-item')._addClass(newWrappers,'ui-menu-item-wrapper');items.filter('.ui-state-disabled').attr('aria-disabled','true');if(this.active&&!$.contains(this.element[0],this.active[0])){this.blur();}},_itemRole:function(){return{menu:'menuitem',listbox:'option'}[this.options.role];},_setOption:function(key,value){if(key==='icons'){var icons=this.element.find('.ui-menu-icon');this._removeClass(icons,null,this.options.icons.submenu)._addClass(icons,null,value.submenu);}
this._super(key,value);},_setOptionDisabled:function(value){this._super(value);this.element.attr('aria-disabled',String(value));this._toggleClass(null,'ui-state-disabled',!!value);},focus:function(event,item){var nested,focused,activeParent;this.blur(event,event&&event.type==='focus');this._scrollIntoView(item);this.active=item.first();focused=this.active.children('.ui-menu-item-wrapper');this._addClass(focused,null,'ui-state-active');if(this.options.role){this.element.attr('aria-activedescendant',focused.attr('id'));}
activeParent=this.active.parent().closest('.ui-menu-item').children('.ui-menu-item-wrapper');this._addClass(activeParent,null,'ui-state-active');if(event&&event.type==='keydown'){this._close();}else{this.timer=this._delay(function(){this._close();},this.delay);}
nested=item.children('.ui-menu');if(nested.length&&event&&(/^mouse/.test(event.type))){this._startOpening(nested);}
this.activeMenu=item.parent();this._trigger('focus',event,{item:item});},_scrollIntoView:function(item){var borderTop,paddingTop,offset,scroll,elementHeight,itemHeight;if(this._hasScroll()){borderTop=parseFloat($.css(this.activeMenu[0],'borderTopWidth'))||0;paddingTop=parseFloat($.css(this.activeMenu[0],'paddingTop'))||0;offset=item.offset().top-this.activeMenu.offset().top-borderTop-
paddingTop;scroll=this.activeMenu.scrollTop();elementHeight=this.activeMenu.height();itemHeight=item.outerHeight();if(offset<0){this.activeMenu.scrollTop(scroll+offset);}else if(offset+itemHeight>elementHeight){this.activeMenu.scrollTop(scroll+offset-elementHeight+itemHeight);}}},blur:function(event,fromFocus){if(!fromFocus){clearTimeout(this.timer);}
if(!this.active){return;}
this._removeClass(this.active.children('.ui-menu-item-wrapper'),null,'ui-state-active');this._trigger('blur',event,{item:this.active});this.active=null;},_startOpening:function(submenu){clearTimeout(this.timer);if(submenu.attr('aria-hidden')!=='true'){return;}
this.timer=this._delay(function(){this._close();this._open(submenu);},this.delay);},_open:function(submenu){var position=$.extend({of:this.active},this.options.position);clearTimeout(this.timer);this.element.find('.ui-menu').not(submenu.parents('.ui-menu')).hide().attr('aria-hidden','true');submenu.show().removeAttr('aria-hidden').attr('aria-expanded','true').position(position);},collapseAll:function(event,all){clearTimeout(this.timer);this.timer=this._delay(function(){var currentMenu=all?this.element:$(event&&event.target).closest(this.element.find('.ui-menu'));if(!currentMenu.length){currentMenu=this.element;}
this._close(currentMenu);this.blur(event);this._removeClass(currentMenu.find('.ui-state-active'),null,'ui-state-active');this.activeMenu=currentMenu;},all?0:this.delay);},_close:function(startMenu){if(!startMenu){startMenu=this.active?this.active.parent():this.element;}
startMenu.find('.ui-menu').hide().attr('aria-hidden','true').attr('aria-expanded','false');},_closeOnDocumentClick:function(event){return!$(event.target).closest('.ui-menu').length;},_isDivider:function(item){return!/[^\-\u2014\u2013\s]/.test(item.text());},collapse:function(event){var newItem=this.active&&this.active.parent().closest('.ui-menu-item',this.element);if(newItem&&newItem.length){this._close();this.focus(event,newItem);}},expand:function(event){var newItem=this.active&&this._menuItems(this.active.children('.ui-menu')).first();if(newItem&&newItem.length){this._open(newItem.parent());this._delay(function(){this.focus(event,newItem);});}},next:function(event){this._move('next','first',event);},previous:function(event){this._move('prev','last',event);},isFirstItem:function(){return this.active&&!this.active.prevAll('.ui-menu-item').length;},isLastItem:function(){return this.active&&!this.active.nextAll('.ui-menu-item').length;},_menuItems:function(menu){return(menu||this.element).find(this.options.items).filter('.ui-menu-item');},_move:function(direction,filter,event){var next;if(this.active){if(direction==='first'||direction==='last'){next=this.active[direction==='first'?'prevAll':'nextAll']('.ui-menu-item').last();}else{next=this.active[direction+'All']('.ui-menu-item').first();}}
if(!next||!next.length||!this.active){next=this._menuItems(this.activeMenu)[filter]();}
this.focus(event,next);},nextPage:function(event){var item,base,height;if(!this.active){this.next(event);return;}
if(this.isLastItem()){return;}
if(this._hasScroll()){base=this.active.offset().top;height=this.element.innerHeight();if($.fn.jquery.indexOf('3.2.')===0){height+=this.element[0].offsetHeight-this.element.outerHeight();}
this.active.nextAll('.ui-menu-item').each(function(){item=$(this);return item.offset().top-base-height<0;});this.focus(event,item);}else{this.focus(event,this._menuItems(this.activeMenu)[!this.active?'first':'last']());}},previousPage:function(event){var item,base,height;if(!this.active){this.next(event);return;}
if(this.isFirstItem()){return;}
if(this._hasScroll()){base=this.active.offset().top;height=this.element.innerHeight();if($.fn.jquery.indexOf('3.2.')===0){height+=this.element[0].offsetHeight-this.element.outerHeight();}
this.active.prevAll('.ui-menu-item').each(function(){item=$(this);return item.offset().top-base+height>0;});this.focus(event,item);}else{this.focus(event,this._menuItems(this.activeMenu).first());}},_hasScroll:function(){return this.element.outerHeight()<this.element.prop('scrollHeight');},select:function(event){this.active=this.active||$(event.target).closest('.ui-menu-item');var ui={item:this.active};if(!this.active.has('.ui-menu').length){this.collapseAll(event,true);}
this._trigger('select',event,ui);},_filterMenuItems:function(character){var escapedCharacter=character.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,'\\$&'),regex=new RegExp('^'+escapedCharacter,'i');return this.activeMenu.find(this.options.items).filter('.ui-menu-item').filter(function(){return regex.test(String.prototype.trim.call($(this).children('.ui-menu-item-wrapper').text()));});}});
/*!
 * jQuery UI Autocomplete 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
$.widget('ui.autocomplete',{version:'1.13.2',defaultElement:'<input>',options:{appendTo:null,autoFocus:false,delay:300,minLength:1,position:{my:'left top',at:'left bottom',collision:'none'},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,liveRegionTimer:null,_create:function(){var suppressKeyPress,suppressKeyPressRepeat,suppressInput,nodeName=this.element[0].nodeName.toLowerCase(),isTextarea=nodeName==='textarea',isInput=nodeName==='input';this.isMultiLine=isTextarea||!isInput&&this._isContentEditable(this.element);this.valueMethod=this.element[isTextarea||isInput?'val':'text'];this.isNewMenu=true;this._addClass('ui-autocomplete-input');this.element.attr('autocomplete','off');this._on(this.element,{keydown:function(event){if(this.element.prop('readOnly')){suppressKeyPress=true;suppressInput=true;suppressKeyPressRepeat=true;return;}
suppressKeyPress=false;suppressInput=false;suppressKeyPressRepeat=false;var keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.PAGE_UP:suppressKeyPress=true;this._move('previousPage',event);break;case keyCode.PAGE_DOWN:suppressKeyPress=true;this._move('nextPage',event);break;case keyCode.UP:suppressKeyPress=true;this._keyEvent('previous',event);break;case keyCode.DOWN:suppressKeyPress=true;this._keyEvent('next',event);break;case keyCode.ENTER:if(this.menu.active){suppressKeyPress=true;event.preventDefault();this.menu.select(event);}
break;case keyCode.TAB:if(this.menu.active){this.menu.select(event);}
break;case keyCode.ESCAPE:if(this.menu.element.is(':visible')){if(!this.isMultiLine){this._value(this.term);}
this.close(event);event.preventDefault();}
break;default:suppressKeyPressRepeat=true;this._searchTimeout(event);break;}},keypress:function(event){if(suppressKeyPress){suppressKeyPress=false;if(!this.isMultiLine||this.menu.element.is(':visible')){event.preventDefault();}
return;}
if(suppressKeyPressRepeat){return;}
var keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.PAGE_UP:this._move('previousPage',event);break;case keyCode.PAGE_DOWN:this._move('nextPage',event);break;case keyCode.UP:this._keyEvent('previous',event);break;case keyCode.DOWN:this._keyEvent('next',event);break;}},input:function(event){if(suppressInput){suppressInput=false;event.preventDefault();return;}
this._searchTimeout(event);},focus:function(){this.selectedItem=null;this.previous=this._value();},blur:function(event){clearTimeout(this.searching);this.close(event);this._change(event);}});this._initSource();this.menu=$('<ul>').appendTo(this._appendTo()).menu({role:null}).hide().attr({'unselectable':'on'}).menu('instance');this._addClass(this.menu.element,'ui-autocomplete','ui-front');this._on(this.menu.element,{mousedown:function(event){event.preventDefault();},menufocus:function(event,ui){var label,item;if(this.isNewMenu){this.isNewMenu=false;if(event.originalEvent&&/^mouse/.test(event.originalEvent.type)){this.menu.blur();this.document.one('mousemove',function(){$(event.target).trigger(event.originalEvent);});return;}}
item=ui.item.data('ui-autocomplete-item');if(false!==this._trigger('focus',event,{item:item})){if(event.originalEvent&&/^key/.test(event.originalEvent.type)){this._value(item.value);}}
label=ui.item.attr('aria-label')||item.value;if(label&&String.prototype.trim.call(label).length){clearTimeout(this.liveRegionTimer);this.liveRegionTimer=this._delay(function(){this.liveRegion.html($('<div>').text(label));},100);}},menuselect:function(event,ui){var item=ui.item.data('ui-autocomplete-item'),previous=this.previous;if(this.element[0]!==$.ui.safeActiveElement(this.document[0])){this.element.trigger('focus');this.previous=previous;this._delay(function(){this.previous=previous;this.selectedItem=item;});}
if(false!==this._trigger('select',event,{item:item})){this._value(item.value);}
this.term=this._value();this.close(event);this.selectedItem=item;}});this.liveRegion=$('<div>',{role:'status','aria-live':'assertive','aria-relevant':'additions'}).appendTo(this.document[0].body);this._addClass(this.liveRegion,null,'ui-helper-hidden-accessible');this._on(this.window,{beforeunload:function(){this.element.removeAttr('autocomplete');}});},_destroy:function(){clearTimeout(this.searching);this.element.removeAttr('autocomplete');this.menu.element.remove();this.liveRegion.remove();},_setOption:function(key,value){this._super(key,value);if(key==='source'){this._initSource();}
if(key==='appendTo'){this.menu.element.appendTo(this._appendTo());}
if(key==='disabled'&&value&&this.xhr){this.xhr.abort();}},_isEventTargetInWidget:function(event){var menuElement=this.menu.element[0];return event.target===this.element[0]||event.target===menuElement||$.contains(menuElement,event.target);},_closeOnClickOutside:function(event){if(!this._isEventTargetInWidget(event)){this.close();}},_appendTo:function(){var element=this.options.appendTo;if(element){element=element.jquery||element.nodeType?$(element):this.document.find(element).eq(0);}
if(!element||!element[0]){element=this.element.closest('.ui-front, dialog');}
if(!element.length){element=this.document[0].body;}
return element;},_initSource:function(){var array,url,that=this;if(Array.isArray(this.options.source)){array=this.options.source;this.source=function(request,response){response($.ui.autocomplete.filter(array,request.term));};}else if(typeof this.options.source==='string'){url=this.options.source;this.source=function(request,response){if(that.xhr){that.xhr.abort();}
that.xhr=$.ajax({url:url,data:request,dataType:'json',success:function(data){response(data);},error:function(){response([]);}});};}else{this.source=this.options.source;}},_searchTimeout:function(event){clearTimeout(this.searching);this.searching=this._delay(function(){var equalValues=this.term===this._value(),menuVisible=this.menu.element.is(':visible'),modifierKey=event.altKey||event.ctrlKey||event.metaKey||event.shiftKey;if(!equalValues||(equalValues&&!menuVisible&&!modifierKey)){this.selectedItem=null;this.search(null,event);}},this.options.delay);},search:function(value,event){value=value!=null?value:this._value();this.term=this._value();if(value.length<this.options.minLength){return this.close(event);}
if(this._trigger('search',event)===false){return;}
return this._search(value);},_search:function(value){this.pending++;this._addClass('ui-autocomplete-loading');this.cancelSearch=false;this.source({term:value},this._response());},_response:function(){var index=++this.requestIndex;return function(content){if(index===this.requestIndex){this.__response(content);}
this.pending--;if(!this.pending){this._removeClass('ui-autocomplete-loading');}}.bind(this);},__response:function(content){if(content){content=this._normalize(content);}
this._trigger('response',null,{content:content});if(!this.options.disabled&&content&&content.length&&!this.cancelSearch){this._suggest(content);this._trigger('open');}else{this._close();}},close:function(event){this.cancelSearch=true;this._close(event);},_close:function(event){this._off(this.document,'mousedown');if(this.menu.element.is(':visible')){this.menu.element.hide();this.menu.blur();this.isNewMenu=true;this._trigger('close',event);}},_change:function(event){if(this.previous!==this._value()){this._trigger('change',event,{item:this.selectedItem});}},_normalize:function(items){if(items.length&&items[0].label&&items[0].value){return items;}
return $.map(items,function(item){if(typeof item==='string'){return{label:item,value:item};}
return $.extend({},item,{label:item.label||item.value,value:item.value||item.label});});},_suggest:function(items){var ul=this.menu.element.empty();this._renderMenu(ul,items);this.isNewMenu=true;this.menu.refresh();ul.show();this._resizeMenu();ul.position($.extend({of:this.element},this.options.position));if(this.options.autoFocus){this.menu.next();}
this._on(this.document,{mousedown:'_closeOnClickOutside'});},_resizeMenu:function(){var ul=this.menu.element;ul.outerWidth(Math.max(ul.width('').outerWidth()+1,this.element.outerWidth()));},_renderMenu:function(ul,items){var that=this;$.each(items,function(index,item){that._renderItemData(ul,item);});},_renderItemData:function(ul,item){return this._renderItem(ul,item).data('ui-autocomplete-item',item);},_renderItem:function(ul,item){return $('<li>').append($('<div>').text(item.label)).appendTo(ul);},_move:function(direction,event){if(!this.menu.element.is(':visible')){this.search(null,event);return;}
if(this.menu.isFirstItem()&&/^previous/.test(direction)||this.menu.isLastItem()&&/^next/.test(direction)){if(!this.isMultiLine){this._value(this.term);}
this.menu.blur();return;}
this.menu[direction](event);},widget:function(){return this.menu.element;},_value:function(){return this.valueMethod.apply(this.element,arguments);},_keyEvent:function(keyEvent,event){if(!this.isMultiLine||this.menu.element.is(':visible')){this._move(keyEvent,event);event.preventDefault();}},_isContentEditable:function(element){if(!element.length){return false;}
var editable=element.prop('contentEditable');if(editable==='inherit'){return this._isContentEditable(element.parent());}
return editable==='true';}});$.extend($.ui.autocomplete,{escapeRegex:function(value){return value.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,'\\$&');},filter:function(array,term){var matcher=new RegExp($.ui.autocomplete.escapeRegex(term),'i');return $.grep(array,function(value){return matcher.test(value.label||value.value||value);});}});$.widget('ui.autocomplete',$.ui.autocomplete,{options:{messages:{noResults:'No search results.',results:function(amount){return amount+(amount>1?' results are':' result is')+' available, use up and down arrow keys to navigate.';}}},__response:function(content){var message;this._superApply(arguments);if(this.options.disabled||this.cancelSearch){return;}
if(content&&content.length){message=this.options.messages.results(content.length);}else{message=this.options.messages.noResults;}
clearTimeout(this.liveRegionTimer);this.liveRegionTimer=this._delay(function(){this.liveRegion.html($('<div>').text(message));},100);}});var widgetsAutocomplete=$.ui.autocomplete;
/*!
 * jQuery UI Controlgroup 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var controlgroupCornerRegex=/ui-corner-([a-z]){2,6}/g;var widgetsControlgroup=$.widget('ui.controlgroup',{version:'1.13.2',defaultElement:'<div>',options:{direction:'horizontal',disabled:null,onlyVisible:true,items:{'button':'input[type=button], input[type=submit], input[type=reset], button, a','controlgroupLabel':'.ui-controlgroup-label','checkboxradio':'input[type=\'checkbox\'], input[type=\'radio\']','selectmenu':'select','spinner':'.ui-spinner-input'}},_create:function(){this._enhance();},_enhance:function(){this.element.attr('role','toolbar');this.refresh();},_destroy:function(){this._callChildMethod('destroy');this.childWidgets.removeData('ui-controlgroup-data');this.element.removeAttr('role');if(this.options.items.controlgroupLabel){this.element.find(this.options.items.controlgroupLabel).find('.ui-controlgroup-label-contents').contents().unwrap();}},_initWidgets:function(){var that=this,childWidgets=[];$.each(this.options.items,function(widget,selector){var labels;var options={};if(!selector){return;}
if(widget==='controlgroupLabel'){labels=that.element.find(selector);labels.each(function(){var element=$(this);if(element.children('.ui-controlgroup-label-contents').length){return;}
element.contents().wrapAll('<span class=\'ui-controlgroup-label-contents\'></span>');});that._addClass(labels,null,'ui-widget ui-widget-content ui-state-default');childWidgets=childWidgets.concat(labels.get());return;}
if(!$.fn[widget]){return;}
if(that['_'+widget+'Options']){options=that['_'+widget+'Options']('middle');}else{options={classes:{}};}
that.element.find(selector).each(function(){var element=$(this);var instance=element[widget]('instance');var instanceOptions=$.widget.extend({},options);if(widget==='button'&&element.parent('.ui-spinner').length){return;}
if(!instance){instance=element[widget]()[widget]('instance');}
if(instance){instanceOptions.classes=that._resolveClassesValues(instanceOptions.classes,instance);}
element[widget](instanceOptions);var widgetElement=element[widget]('widget');$.data(widgetElement[0],'ui-controlgroup-data',instance?instance:element[widget]('instance'));childWidgets.push(widgetElement[0]);});});this.childWidgets=$($.uniqueSort(childWidgets));this._addClass(this.childWidgets,'ui-controlgroup-item');},_callChildMethod:function(method){this.childWidgets.each(function(){var element=$(this),data=element.data('ui-controlgroup-data');if(data&&data[method]){data[method]();}});},_updateCornerClass:function(element,position){var remove='ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all';var add=this._buildSimpleOptions(position,'label').classes.label;this._removeClass(element,null,remove);this._addClass(element,null,add);},_buildSimpleOptions:function(position,key){var direction=this.options.direction==='vertical';var result={classes:{}};result.classes[key]={'middle':'','first':'ui-corner-'+(direction?'top':'left'),'last':'ui-corner-'+(direction?'bottom':'right'),'only':'ui-corner-all'}[position];return result;},_spinnerOptions:function(position){var options=this._buildSimpleOptions(position,'ui-spinner');options.classes['ui-spinner-up']='';options.classes['ui-spinner-down']='';return options;},_buttonOptions:function(position){return this._buildSimpleOptions(position,'ui-button');},_checkboxradioOptions:function(position){return this._buildSimpleOptions(position,'ui-checkboxradio-label');},_selectmenuOptions:function(position){var direction=this.options.direction==='vertical';return{width:direction?'auto':false,classes:{middle:{'ui-selectmenu-button-open':'','ui-selectmenu-button-closed':''},first:{'ui-selectmenu-button-open':'ui-corner-'+(direction?'top':'tl'),'ui-selectmenu-button-closed':'ui-corner-'+(direction?'top':'left')},last:{'ui-selectmenu-button-open':direction?'':'ui-corner-tr','ui-selectmenu-button-closed':'ui-corner-'+(direction?'bottom':'right')},only:{'ui-selectmenu-button-open':'ui-corner-top','ui-selectmenu-button-closed':'ui-corner-all'}}[position]};},_resolveClassesValues:function(classes,instance){var result={};$.each(classes,function(key){var current=instance.options.classes[key]||'';current=String.prototype.trim.call(current.replace(controlgroupCornerRegex,''));result[key]=(current+' '+classes[key]).replace(/\s+/g,' ');});return result;},_setOption:function(key,value){if(key==='direction'){this._removeClass('ui-controlgroup-'+this.options.direction);}
this._super(key,value);if(key==='disabled'){this._callChildMethod(value?'disable':'enable');return;}
this.refresh();},refresh:function(){var children,that=this;this._addClass('ui-controlgroup ui-controlgroup-'+this.options.direction);if(this.options.direction==='horizontal'){this._addClass(null,'ui-helper-clearfix');}
this._initWidgets();children=this.childWidgets;if(this.options.onlyVisible){children=children.filter(':visible');}
if(children.length){$.each(['first','last'],function(index,value){var instance=children[value]().data('ui-controlgroup-data');if(instance&&that['_'+instance.widgetName+'Options']){var options=that['_'+instance.widgetName+'Options'](children.length===1?'only':value);options.classes=that._resolveClassesValues(options.classes,instance);instance.element[instance.widgetName](options);}else{that._updateCornerClass(children[value](),value);}});this._callChildMethod('refresh');}}});
/*!
 * jQuery UI Checkboxradio 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
$.widget('ui.checkboxradio',[$.ui.formResetMixin,{version:'1.13.2',options:{disabled:null,label:null,icon:true,classes:{'ui-checkboxradio-label':'ui-corner-all','ui-checkboxradio-icon':'ui-corner-all'}},_getCreateOptions:function(){var disabled,labels,labelContents;var options=this._super()||{};this._readType();labels=this.element.labels();this.label=$(labels[labels.length-1]);if(!this.label.length){$.error('No label found for checkboxradio widget');}
this.originalLabel='';labelContents=this.label.contents().not(this.element[0]);if(labelContents.length){this.originalLabel+=labelContents.clone().wrapAll('<div></div>').parent().html();}
if(this.originalLabel){options.label=this.originalLabel;}
disabled=this.element[0].disabled;if(disabled!=null){options.disabled=disabled;}
return options;},_create:function(){var checked=this.element[0].checked;this._bindFormResetHandler();if(this.options.disabled==null){this.options.disabled=this.element[0].disabled;}
this._setOption('disabled',this.options.disabled);this._addClass('ui-checkboxradio','ui-helper-hidden-accessible');this._addClass(this.label,'ui-checkboxradio-label','ui-button ui-widget');if(this.type==='radio'){this._addClass(this.label,'ui-checkboxradio-radio-label');}
if(this.options.label&&this.options.label!==this.originalLabel){this._updateLabel();}else if(this.originalLabel){this.options.label=this.originalLabel;}
this._enhance();if(checked){this._addClass(this.label,'ui-checkboxradio-checked','ui-state-active');}
this._on({change:'_toggleClasses',focus:function(){this._addClass(this.label,null,'ui-state-focus ui-visual-focus');},blur:function(){this._removeClass(this.label,null,'ui-state-focus ui-visual-focus');}});},_readType:function(){var nodeName=this.element[0].nodeName.toLowerCase();this.type=this.element[0].type;if(nodeName!=='input'||!/radio|checkbox/.test(this.type)){$.error('Can\'t create checkboxradio on element.nodeName='+nodeName+' and element.type='+this.type);}},_enhance:function(){this._updateIcon(this.element[0].checked);},widget:function(){return this.label;},_getRadioGroup:function(){var group;var name=this.element[0].name;var nameSelector='input[name=\''+$.escapeSelector(name)+'\']';if(!name){return $([]);}
if(this.form.length){group=$(this.form[0].elements).filter(nameSelector);}else{group=$(nameSelector).filter(function(){return $(this)._form().length===0;});}
return group.not(this.element);},_toggleClasses:function(){var checked=this.element[0].checked;this._toggleClass(this.label,'ui-checkboxradio-checked','ui-state-active',checked);if(this.options.icon&&this.type==='checkbox'){this._toggleClass(this.icon,null,'ui-icon-check ui-state-checked',checked)._toggleClass(this.icon,null,'ui-icon-blank',!checked);}
if(this.type==='radio'){this._getRadioGroup().each(function(){var instance=$(this).checkboxradio('instance');if(instance){instance._removeClass(instance.label,'ui-checkboxradio-checked','ui-state-active');}});}},_destroy:function(){this._unbindFormResetHandler();if(this.icon){this.icon.remove();this.iconSpace.remove();}},_setOption:function(key,value){if(key==='label'&&!value){return;}
this._super(key,value);if(key==='disabled'){this._toggleClass(this.label,null,'ui-state-disabled',value);this.element[0].disabled=value;return;}
this.refresh();},_updateIcon:function(checked){var toAdd='ui-icon ui-icon-background ';if(this.options.icon){if(!this.icon){this.icon=$('<span>');this.iconSpace=$('<span> </span>');this._addClass(this.iconSpace,'ui-checkboxradio-icon-space');}
if(this.type==='checkbox'){toAdd+=checked?'ui-icon-check ui-state-checked':'ui-icon-blank';this._removeClass(this.icon,null,checked?'ui-icon-blank':'ui-icon-check');}else{toAdd+='ui-icon-blank';}
this._addClass(this.icon,'ui-checkboxradio-icon',toAdd);if(!checked){this._removeClass(this.icon,null,'ui-icon-check ui-state-checked');}
this.icon.prependTo(this.label).after(this.iconSpace);}else if(this.icon!==undefined){this.icon.remove();this.iconSpace.remove();delete this.icon;}},_updateLabel:function(){var contents=this.label.contents().not(this.element[0]);if(this.icon){contents=contents.not(this.icon[0]);}
if(this.iconSpace){contents=contents.not(this.iconSpace[0]);}
contents.remove();this.label.append(this.options.label);},refresh:function(){var checked=this.element[0].checked,isDisabled=this.element[0].disabled;this._updateIcon(checked);this._toggleClass(this.label,'ui-checkboxradio-checked','ui-state-active',checked);if(this.options.label!==null){this._updateLabel();}
if(isDisabled!==this.options.disabled){this._setOptions({'disabled':isDisabled});}}}]);var widgetsCheckboxradio=$.ui.checkboxradio;
/*!
 * jQuery UI Button 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
$.widget('ui.button',{version:'1.13.2',defaultElement:'<button>',options:{classes:{'ui-button':'ui-corner-all'},disabled:null,icon:null,iconPosition:'beginning',label:null,showLabel:true},_getCreateOptions:function(){var disabled,options=this._super()||{};this.isInput=this.element.is('input');disabled=this.element[0].disabled;if(disabled!=null){options.disabled=disabled;}
this.originalLabel=this.isInput?this.element.val():this.element.html();if(this.originalLabel){options.label=this.originalLabel;}
return options;},_create:function(){if(!this.option.showLabel&!this.options.icon){this.options.showLabel=true;}
if(this.options.disabled==null){this.options.disabled=this.element[0].disabled||false;}
this.hasTitle=!!this.element.attr('title');if(this.options.label&&this.options.label!==this.originalLabel){if(this.isInput){this.element.val(this.options.label);}else{this.element.html(this.options.label);}}
this._addClass('ui-button','ui-widget');this._setOption('disabled',this.options.disabled);this._enhance();if(this.element.is('a')){this._on({'keyup':function(event){if(event.keyCode===$.ui.keyCode.SPACE){event.preventDefault();if(this.element[0].click){this.element[0].click();}else{this.element.trigger('click');}}}});}},_enhance:function(){if(!this.element.is('button')){this.element.attr('role','button');}
if(this.options.icon){this._updateIcon('icon',this.options.icon);this._updateTooltip();}},_updateTooltip:function(){this.title=this.element.attr('title');if(!this.options.showLabel&&!this.title){this.element.attr('title',this.options.label);}},_updateIcon:function(option,value){var icon=option!=='iconPosition',position=icon?this.options.iconPosition:value,displayBlock=position==='top'||position==='bottom';if(!this.icon){this.icon=$('<span>');this._addClass(this.icon,'ui-button-icon','ui-icon');if(!this.options.showLabel){this._addClass('ui-button-icon-only');}}else if(icon){this._removeClass(this.icon,null,this.options.icon);}
if(icon){this._addClass(this.icon,null,value);}
this._attachIcon(position);if(displayBlock){this._addClass(this.icon,null,'ui-widget-icon-block');if(this.iconSpace){this.iconSpace.remove();}}else{if(!this.iconSpace){this.iconSpace=$('<span> </span>');this._addClass(this.iconSpace,'ui-button-icon-space');}
this._removeClass(this.icon,null,'ui-wiget-icon-block');this._attachIconSpace(position);}},_destroy:function(){this.element.removeAttr('role');if(this.icon){this.icon.remove();}
if(this.iconSpace){this.iconSpace.remove();}
if(!this.hasTitle){this.element.removeAttr('title');}},_attachIconSpace:function(iconPosition){this.icon[/^(?:end|bottom)/.test(iconPosition)?'before':'after'](this.iconSpace);},_attachIcon:function(iconPosition){this.element[/^(?:end|bottom)/.test(iconPosition)?'append':'prepend'](this.icon);},_setOptions:function(options){var newShowLabel=options.showLabel===undefined?this.options.showLabel:options.showLabel,newIcon=options.icon===undefined?this.options.icon:options.icon;if(!newShowLabel&&!newIcon){options.showLabel=true;}
this._super(options);},_setOption:function(key,value){if(key==='icon'){if(value){this._updateIcon(key,value);}else if(this.icon){this.icon.remove();if(this.iconSpace){this.iconSpace.remove();}}}
if(key==='iconPosition'){this._updateIcon(key,value);}
if(key==='showLabel'){this._toggleClass('ui-button-icon-only',null,!value);this._updateTooltip();}
if(key==='label'){if(this.isInput){this.element.val(value);}else{this.element.html(value);if(this.icon){this._attachIcon(this.options.iconPosition);this._attachIconSpace(this.options.iconPosition);}}}
this._super(key,value);if(key==='disabled'){this._toggleClass(null,'ui-state-disabled',value);this.element[0].disabled=value;if(value){this.element.trigger('blur');}}},refresh:function(){var isDisabled=this.element.is('input, button')?this.element[0].disabled:this.element.hasClass('ui-button-disabled');if(isDisabled!==this.options.disabled){this._setOptions({disabled:isDisabled});}
this._updateTooltip();}});if($.uiBackCompat!==false){$.widget('ui.button',$.ui.button,{options:{text:true,icons:{primary:null,secondary:null}},_create:function(){if(this.options.showLabel&&!this.options.text){this.options.showLabel=this.options.text;}
if(!this.options.showLabel&&this.options.text){this.options.text=this.options.showLabel;}
if(!this.options.icon&&(this.options.icons.primary||this.options.icons.secondary)){if(this.options.icons.primary){this.options.icon=this.options.icons.primary;}else{this.options.icon=this.options.icons.secondary;this.options.iconPosition='end';}}else if(this.options.icon){this.options.icons.primary=this.options.icon;}
this._super();},_setOption:function(key,value){if(key==='text'){this._super('showLabel',value);return;}
if(key==='showLabel'){this.options.text=value;}
if(key==='icon'){this.options.icons.primary=value;}
if(key==='icons'){if(value.primary){this._super('icon',value.primary);this._super('iconPosition','beginning');}else if(value.secondary){this._super('icon',value.secondary);this._super('iconPosition','end');}}
this._superApply(arguments);}});$.fn.button=(function(orig){return function(options){var isMethodCall=typeof options==='string';var args=Array.prototype.slice.call(arguments,1);var returnValue=this;if(isMethodCall){if(!this.length&&options==='instance'){returnValue=undefined;}else{this.each(function(){var methodValue;var type=$(this).attr('type');var name=type!=='checkbox'&&type!=='radio'?'button':'checkboxradio';var instance=$.data(this,'ui-'+name);if(options==='instance'){returnValue=instance;return false;}
if(!instance){return $.error('cannot call methods on button'+' prior to initialization; '+'attempted to call method \''+options+'\'');}
if(typeof instance[options]!=='function'||options.charAt(0)==='_'){return $.error('no such method \''+options+'\' for button'+' widget instance');}
methodValue=instance[options].apply(instance,args);if(methodValue!==instance&&methodValue!==undefined){returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue;return false;}});}}else{if(args.length){options=$.widget.extend.apply(null,[options].concat(args));}
this.each(function(){var type=$(this).attr('type');var name=type!=='checkbox'&&type!=='radio'?'button':'checkboxradio';var instance=$.data(this,'ui-'+name);if(instance){instance.option(options||{});if(instance._init){instance._init();}}else{if(name==='button'){orig.call($(this),options);return;}
$(this).checkboxradio($.extend({icon:false},options));}});}
return returnValue;};})($.fn.button);$.fn.buttonset=function(){if(!$.ui.controlgroup){$.error('Controlgroup widget missing');}
if(arguments[0]==='option'&&arguments[1]==='items'&&arguments[2]){return this.controlgroup.apply(this,[arguments[0],'items.button',arguments[2]]);}
if(arguments[0]==='option'&&arguments[1]==='items'){return this.controlgroup.apply(this,[arguments[0],'items.button']);}
if(typeof arguments[0]==='object'&&arguments[0].items){arguments[0].items={button:arguments[0].items};}
return this.controlgroup.apply(this,arguments);};}
var widgetsButton=$.ui.button;
/*!
 * jQuery UI Datepicker 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
$.extend($.ui,{datepicker:{version:'1.13.2'}});var datepicker_instActive;function datepicker_getZindex(elem){var position,value;while(elem.length&&elem[0]!==document){position=elem.css('position');if(position==='absolute'||position==='relative'||position==='fixed'){value=parseInt(elem.css('zIndex'),10);if(!isNaN(value)&&value!==0){return value;}}
elem=elem.parent();}
return 0;}
function Datepicker(){this._curInst=null;this._keyEvent=false;this._disabledInputs=[];this._datepickerShowing=false;this._inDialog=false;this._mainDivId='ui-datepicker-div';this._inlineClass='ui-datepicker-inline';this._appendClass='ui-datepicker-append';this._triggerClass='ui-datepicker-trigger';this._dialogClass='ui-datepicker-dialog';this._disableClass='ui-datepicker-disabled';this._unselectableClass='ui-datepicker-unselectable';this._currentClass='ui-datepicker-current-day';this._dayOverClass='ui-datepicker-days-cell-over';this.regional=[];this.regional['']={closeText:'Done',prevText:'Prev',nextText:'Next',currentText:'Today',monthNames:['January','February','March','April','May','June','July','August','September','October','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],dayNames:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],dayNamesShort:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],dayNamesMin:['Su','Mo','Tu','We','Th','Fr','Sa'],weekHeader:'Wk',dateFormat:'mm/dd/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:'',selectMonthLabel:'Select month',selectYearLabel:'Select year'};this._defaults={showOn:'focus',showAnim:'fadeIn',showOptions:{},defaultDate:null,appendText:'',buttonText:'...',buttonImage:'',buttonImageOnly:false,hideIfNoPrevNext:false,navigationAsDateFormat:false,gotoCurrent:false,changeMonth:false,changeYear:false,yearRange:'c-10:c+10',showOtherMonths:false,selectOtherMonths:false,showWeek:false,calculateWeek:this.iso8601Week,shortYearCutoff:'+10',minDate:null,maxDate:null,duration:'fast',beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,onUpdateDatepicker:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:'',altFormat:'',constrainInput:true,showButtonPanel:false,autoSize:false,disabled:false};$.extend(this._defaults,this.regional['']);this.regional.en=$.extend(true,{},this.regional['']);this.regional['en-US']=$.extend(true,{},this.regional.en);this.dpDiv=datepicker_bindHover($('<div id=\''+this._mainDivId+'\' class=\'ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all\'></div>'));}
$.extend(Datepicker.prototype,{markerClassName:'hasDatepicker',maxRows:4,_widgetDatepicker:function(){return this.dpDiv;},setDefaults:function(settings){datepicker_extendRemove(this._defaults,settings||{});return this;},_attachDatepicker:function(target,settings){var nodeName,inline,inst;nodeName=target.nodeName.toLowerCase();inline=(nodeName==='div'||nodeName==='span');if(!target.id){this.uuid+=1;target.id='dp'+this.uuid;}
inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{});if(nodeName==='input'){this._connectDatepicker(target,inst);}else if(inline){this._inlineDatepicker(target,inst);}},_newInst:function(target,inline){var id=target[0].id.replace(/([^A-Za-z0-9_\-])/g,'\\\\$1');return{id:id,input:target,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:inline,dpDiv:(!inline?this.dpDiv:datepicker_bindHover($('<div class=\''+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all\'></div>')))};},_connectDatepicker:function(target,inst){var input=$(target);inst.append=$([]);inst.trigger=$([]);if(input.hasClass(this.markerClassName)){return;}
this._attachments(input,inst);input.addClass(this.markerClassName).on('keydown',this._doKeyDown).on('keypress',this._doKeyPress).on('keyup',this._doKeyUp);this._autoSize(inst);$.data(target,'datepicker',inst);if(inst.settings.disabled){this._disableDatepicker(target);}},_attachments:function(input,inst){var showOn,buttonText,buttonImage,appendText=this._get(inst,'appendText'),isRTL=this._get(inst,'isRTL');if(inst.append){inst.append.remove();}
if(appendText){inst.append=$('<span>').addClass(this._appendClass).text(appendText);input[isRTL?'before':'after'](inst.append);}
input.off('focus',this._showDatepicker);if(inst.trigger){inst.trigger.remove();}
showOn=this._get(inst,'showOn');if(showOn==='focus'||showOn==='both'){input.on('focus',this._showDatepicker);}
if(showOn==='button'||showOn==='both'){buttonText=this._get(inst,'buttonText');buttonImage=this._get(inst,'buttonImage');if(this._get(inst,'buttonImageOnly')){inst.trigger=$('<img>').addClass(this._triggerClass).attr({src:buttonImage,alt:buttonText,title:buttonText});}else{inst.trigger=$('<button type=\'button\'>').addClass(this._triggerClass);if(buttonImage){inst.trigger.html($('<img>').attr({src:buttonImage,alt:buttonText,title:buttonText}));}else{inst.trigger.text(buttonText);}}
input[isRTL?'before':'after'](inst.trigger);inst.trigger.on('click',function(){if($.datepicker._datepickerShowing&&$.datepicker._lastInput===input[0]){$.datepicker._hideDatepicker();}else if($.datepicker._datepickerShowing&&$.datepicker._lastInput!==input[0]){$.datepicker._hideDatepicker();$.datepicker._showDatepicker(input[0]);}else{$.datepicker._showDatepicker(input[0]);}
return false;});}},_autoSize:function(inst){if(this._get(inst,'autoSize')&&!inst.inline){var findMax,max,maxI,i,date=new Date(2009,12-1,20),dateFormat=this._get(inst,'dateFormat');if(dateFormat.match(/[DM]/)){findMax=function(names){max=0;maxI=0;for(i=0;i<names.length;i++){if(names[i].length>max){max=names[i].length;maxI=i;}}
return maxI;};date.setMonth(findMax(this._get(inst,(dateFormat.match(/MM/)?'monthNames':'monthNamesShort'))));date.setDate(findMax(this._get(inst,(dateFormat.match(/DD/)?'dayNames':'dayNamesShort')))+
20-date.getDay());}
inst.input.attr('size',this._formatDate(inst,date).length);}},_inlineDatepicker:function(target,inst){var divSpan=$(target);if(divSpan.hasClass(this.markerClassName)){return;}
divSpan.addClass(this.markerClassName).append(inst.dpDiv);$.data(target,'datepicker',inst);this._setDate(inst,this._getDefaultDate(inst),true);this._updateDatepicker(inst);this._updateAlternate(inst);if(inst.settings.disabled){this._disableDatepicker(target);}
inst.dpDiv.css('display','block');},_dialogDatepicker:function(input,date,onSelect,settings,pos){var id,browserWidth,browserHeight,scrollX,scrollY,inst=this._dialogInst;if(!inst){this.uuid+=1;id='dp'+this.uuid;this._dialogInput=$('<input type=\'text\' id=\''+id+'\' style=\'position: absolute; top: -100px; width: 0px;\'/>');this._dialogInput.on('keydown',this._doKeyDown);$('body').append(this._dialogInput);inst=this._dialogInst=this._newInst(this._dialogInput,false);inst.settings={};$.data(this._dialogInput[0],'datepicker',inst);}
datepicker_extendRemove(inst.settings,settings||{});date=(date&&date.constructor===Date?this._formatDate(inst,date):date);this._dialogInput.val(date);this._pos=(pos?(pos.length?pos:[pos.pageX,pos.pageY]):null);if(!this._pos){browserWidth=document.documentElement.clientWidth;browserHeight=document.documentElement.clientHeight;scrollX=document.documentElement.scrollLeft||document.body.scrollLeft;scrollY=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[(browserWidth/2)-100+scrollX,(browserHeight/2)-150+scrollY];}
this._dialogInput.css('left',(this._pos[0]+20)+'px').css('top',this._pos[1]+'px');inst.settings.onSelect=onSelect;this._inDialog=true;this.dpDiv.addClass(this._dialogClass);this._showDatepicker(this._dialogInput[0]);if($.blockUI){$.blockUI(this.dpDiv);}
$.data(this._dialogInput[0],'datepicker',inst);return this;},_destroyDatepicker:function(target){var nodeName,$target=$(target),inst=$.data(target,'datepicker');if(!$target.hasClass(this.markerClassName)){return;}
nodeName=target.nodeName.toLowerCase();$.removeData(target,'datepicker');if(nodeName==='input'){inst.append.remove();inst.trigger.remove();$target.removeClass(this.markerClassName).off('focus',this._showDatepicker).off('keydown',this._doKeyDown).off('keypress',this._doKeyPress).off('keyup',this._doKeyUp);}else if(nodeName==='div'||nodeName==='span'){$target.removeClass(this.markerClassName).empty();}
if(datepicker_instActive===inst){datepicker_instActive=null;this._curInst=null;}},_enableDatepicker:function(target){var nodeName,inline,$target=$(target),inst=$.data(target,'datepicker');if(!$target.hasClass(this.markerClassName)){return;}
nodeName=target.nodeName.toLowerCase();if(nodeName==='input'){target.disabled=false;inst.trigger.filter('button').each(function(){this.disabled=false;}).end().filter('img').css({opacity:'1.0',cursor:''});}else if(nodeName==='div'||nodeName==='span'){inline=$target.children('.'+this._inlineClass);inline.children().removeClass('ui-state-disabled');inline.find('select.ui-datepicker-month, select.ui-datepicker-year').prop('disabled',false);}
this._disabledInputs=$.map(this._disabledInputs,function(value){return(value===target?null:value);});},_disableDatepicker:function(target){var nodeName,inline,$target=$(target),inst=$.data(target,'datepicker');if(!$target.hasClass(this.markerClassName)){return;}
nodeName=target.nodeName.toLowerCase();if(nodeName==='input'){target.disabled=true;inst.trigger.filter('button').each(function(){this.disabled=true;}).end().filter('img').css({opacity:'0.5',cursor:'default'});}else if(nodeName==='div'||nodeName==='span'){inline=$target.children('.'+this._inlineClass);inline.children().addClass('ui-state-disabled');inline.find('select.ui-datepicker-month, select.ui-datepicker-year').prop('disabled',true);}
this._disabledInputs=$.map(this._disabledInputs,function(value){return(value===target?null:value);});this._disabledInputs[this._disabledInputs.length]=target;},_isDisabledDatepicker:function(target){if(!target){return false;}
for(var i=0;i<this._disabledInputs.length;i++){if(this._disabledInputs[i]===target){return true;}}
return false;},_getInst:function(target){try{return $.data(target,'datepicker');}catch(err){throw'Missing instance data for this datepicker';}},_optionDatepicker:function(target,name,value){var settings,date,minDate,maxDate,inst=this._getInst(target);if(arguments.length===2&&typeof name==='string'){return(name==='defaults'?$.extend({},$.datepicker._defaults):(inst?(name==='all'?$.extend({},inst.settings):this._get(inst,name)):null));}
settings=name||{};if(typeof name==='string'){settings={};settings[name]=value;}
if(inst){if(this._curInst===inst){this._hideDatepicker();}
date=this._getDateDatepicker(target,true);minDate=this._getMinMaxDate(inst,'min');maxDate=this._getMinMaxDate(inst,'max');datepicker_extendRemove(inst.settings,settings);if(minDate!==null&&settings.dateFormat!==undefined&&settings.minDate===undefined){inst.settings.minDate=this._formatDate(inst,minDate);}
if(maxDate!==null&&settings.dateFormat!==undefined&&settings.maxDate===undefined){inst.settings.maxDate=this._formatDate(inst,maxDate);}
if('disabled'in settings){if(settings.disabled){this._disableDatepicker(target);}else{this._enableDatepicker(target);}}
this._attachments($(target),inst);this._autoSize(inst);this._setDate(inst,date);this._updateAlternate(inst);this._updateDatepicker(inst);}},_changeDatepicker:function(target,name,value){this._optionDatepicker(target,name,value);},_refreshDatepicker:function(target){var inst=this._getInst(target);if(inst){this._updateDatepicker(inst);}},_setDateDatepicker:function(target,date){var inst=this._getInst(target);if(inst){this._setDate(inst,date);this._updateDatepicker(inst);this._updateAlternate(inst);}},_getDateDatepicker:function(target,noDefault){var inst=this._getInst(target);if(inst&&!inst.inline){this._setDateFromField(inst,noDefault);}
return(inst?this._getDate(inst):null);},_doKeyDown:function(event){var onSelect,dateStr,sel,inst=$.datepicker._getInst(event.target),handled=true,isRTL=inst.dpDiv.is('.ui-datepicker-rtl');inst._keyEvent=true;if($.datepicker._datepickerShowing){switch(event.keyCode){case 9:$.datepicker._hideDatepicker();handled=false;break;case 13:sel=$('td.'+$.datepicker._dayOverClass+':not(.'+
$.datepicker._currentClass+')',inst.dpDiv);if(sel[0]){$.datepicker._selectDay(event.target,inst.selectedMonth,inst.selectedYear,sel[0]);}
onSelect=$.datepicker._get(inst,'onSelect');if(onSelect){dateStr=$.datepicker._formatDate(inst);onSelect.apply((inst.input?inst.input[0]:null),[dateStr,inst]);}else{$.datepicker._hideDatepicker();}
return false;case 27:$.datepicker._hideDatepicker();break;case 33:$.datepicker._adjustDate(event.target,(event.ctrlKey?-$.datepicker._get(inst,'stepBigMonths'):-$.datepicker._get(inst,'stepMonths')),'M');break;case 34:$.datepicker._adjustDate(event.target,(event.ctrlKey?+$.datepicker._get(inst,'stepBigMonths'):+$.datepicker._get(inst,'stepMonths')),'M');break;case 35:if(event.ctrlKey||event.metaKey){$.datepicker._clearDate(event.target);}
handled=event.ctrlKey||event.metaKey;break;case 36:if(event.ctrlKey||event.metaKey){$.datepicker._gotoToday(event.target);}
handled=event.ctrlKey||event.metaKey;break;case 37:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,(isRTL?+1:-1),'D');}
handled=event.ctrlKey||event.metaKey;if(event.originalEvent.altKey){$.datepicker._adjustDate(event.target,(event.ctrlKey?-$.datepicker._get(inst,'stepBigMonths'):-$.datepicker._get(inst,'stepMonths')),'M');}
break;case 38:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,-7,'D');}
handled=event.ctrlKey||event.metaKey;break;case 39:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,(isRTL?-1:+1),'D');}
handled=event.ctrlKey||event.metaKey;if(event.originalEvent.altKey){$.datepicker._adjustDate(event.target,(event.ctrlKey?+$.datepicker._get(inst,'stepBigMonths'):+$.datepicker._get(inst,'stepMonths')),'M');}
break;case 40:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,+7,'D');}
handled=event.ctrlKey||event.metaKey;break;default:handled=false;}}else if(event.keyCode===36&&event.ctrlKey){$.datepicker._showDatepicker(this);}else{handled=false;}
if(handled){event.preventDefault();event.stopPropagation();}},_doKeyPress:function(event){var chars,chr,inst=$.datepicker._getInst(event.target);if($.datepicker._get(inst,'constrainInput')){chars=$.datepicker._possibleChars($.datepicker._get(inst,'dateFormat'));chr=String.fromCharCode(event.charCode==null?event.keyCode:event.charCode);return event.ctrlKey||event.metaKey||(chr<' '||!chars||chars.indexOf(chr)>-1);}},_doKeyUp:function(event){var date,inst=$.datepicker._getInst(event.target);if(inst.input.val()!==inst.lastVal){try{date=$.datepicker.parseDate($.datepicker._get(inst,'dateFormat'),(inst.input?inst.input.val():null),$.datepicker._getFormatConfig(inst));if(date){$.datepicker._setDateFromField(inst);$.datepicker._updateAlternate(inst);$.datepicker._updateDatepicker(inst);}}catch(err){}}
return true;},_showDatepicker:function(input){input=input.target||input;if(input.nodeName.toLowerCase()!=='input'){input=$('input',input.parentNode)[0];}
if($.datepicker._isDisabledDatepicker(input)||$.datepicker._lastInput===input){return;}
var inst,beforeShow,beforeShowSettings,isFixed,offset,showAnim,duration;inst=$.datepicker._getInst(input);if($.datepicker._curInst&&$.datepicker._curInst!==inst){$.datepicker._curInst.dpDiv.stop(true,true);if(inst&&$.datepicker._datepickerShowing){$.datepicker._hideDatepicker($.datepicker._curInst.input[0]);}}
beforeShow=$.datepicker._get(inst,'beforeShow');beforeShowSettings=beforeShow?beforeShow.apply(input,[input,inst]):{};if(beforeShowSettings===false){return;}
datepicker_extendRemove(inst.settings,beforeShowSettings);inst.lastVal=null;$.datepicker._lastInput=input;$.datepicker._setDateFromField(inst);if($.datepicker._inDialog){input.value='';}
if(!$.datepicker._pos){$.datepicker._pos=$.datepicker._findPos(input);$.datepicker._pos[1]+=input.offsetHeight;}
isFixed=false;$(input).parents().each(function(){isFixed|=$(this).css('position')==='fixed';return!isFixed;});offset={left:$.datepicker._pos[0],top:$.datepicker._pos[1]};$.datepicker._pos=null;inst.dpDiv.empty();inst.dpDiv.css({position:'absolute',display:'block',top:'-1000px'});$.datepicker._updateDatepicker(inst);offset=$.datepicker._checkOffset(inst,offset,isFixed);inst.dpDiv.css({position:($.datepicker._inDialog&&$.blockUI?'static':(isFixed?'fixed':'absolute')),display:'none',left:offset.left+'px',top:offset.top+'px'});if(!inst.inline){showAnim=$.datepicker._get(inst,'showAnim');duration=$.datepicker._get(inst,'duration');inst.dpDiv.css('z-index',datepicker_getZindex($(input))+1);$.datepicker._datepickerShowing=true;if($.effects&&$.effects.effect[showAnim]){inst.dpDiv.show(showAnim,$.datepicker._get(inst,'showOptions'),duration);}else{inst.dpDiv[showAnim||'show'](showAnim?duration:null);}
if($.datepicker._shouldFocusInput(inst)){inst.input.trigger('focus');}
$.datepicker._curInst=inst;}},_updateDatepicker:function(inst){this.maxRows=4;datepicker_instActive=inst;inst.dpDiv.empty().append(this._generateHTML(inst));this._attachHandlers(inst);var origyearshtml,numMonths=this._getNumberOfMonths(inst),cols=numMonths[1],width=17,activeCell=inst.dpDiv.find('.'+this._dayOverClass+' a'),onUpdateDatepicker=$.datepicker._get(inst,'onUpdateDatepicker');if(activeCell.length>0){datepicker_handleMouseover.apply(activeCell.get(0));}
inst.dpDiv.removeClass('ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4').width('');if(cols>1){inst.dpDiv.addClass('ui-datepicker-multi-'+cols).css('width',(width*cols)+'em');}
inst.dpDiv[(numMonths[0]!==1||numMonths[1]!==1?'add':'remove')+'Class']('ui-datepicker-multi');inst.dpDiv[(this._get(inst,'isRTL')?'add':'remove')+'Class']('ui-datepicker-rtl');if(inst===$.datepicker._curInst&&$.datepicker._datepickerShowing&&$.datepicker._shouldFocusInput(inst)){inst.input.trigger('focus');}
if(inst.yearshtml){origyearshtml=inst.yearshtml;setTimeout(function(){if(origyearshtml===inst.yearshtml&&inst.yearshtml){inst.dpDiv.find('select.ui-datepicker-year').first().replaceWith(inst.yearshtml);}
origyearshtml=inst.yearshtml=null;},0);}
if(onUpdateDatepicker){onUpdateDatepicker.apply((inst.input?inst.input[0]:null),[inst]);}},_shouldFocusInput:function(inst){return inst.input&&inst.input.is(':visible')&&!inst.input.is(':disabled')&&!inst.input.is(':focus');},_checkOffset:function(inst,offset,isFixed){var dpWidth=inst.dpDiv.outerWidth(),dpHeight=inst.dpDiv.outerHeight(),inputWidth=inst.input?inst.input.outerWidth():0,inputHeight=inst.input?inst.input.outerHeight():0,viewWidth=document.documentElement.clientWidth+
(isFixed?0:$(document).scrollLeft()),viewHeight=document.documentElement.clientHeight+
(isFixed?0:$(document).scrollTop());offset.left-=(this._get(inst,'isRTL')?(dpWidth-inputWidth):0);offset.left-=(isFixed&&offset.left===inst.input.offset().left)?$(document).scrollLeft():0;offset.top-=(isFixed&&offset.top===(inst.input.offset().top+inputHeight))?$(document).scrollTop():0;offset.left-=Math.min(offset.left,(offset.left+dpWidth>viewWidth&&viewWidth>dpWidth)?Math.abs(offset.left+dpWidth-viewWidth):0);offset.top-=Math.min(offset.top,(offset.top+dpHeight>viewHeight&&viewHeight>dpHeight)?Math.abs(dpHeight+inputHeight):0);return offset;},_findPos:function(obj){var position,inst=this._getInst(obj),isRTL=this._get(inst,'isRTL');while(obj&&(obj.type==='hidden'||obj.nodeType!==1||$.expr.pseudos.hidden(obj))){obj=obj[isRTL?'previousSibling':'nextSibling'];}
position=$(obj).offset();return[position.left,position.top];},_hideDatepicker:function(input){var showAnim,duration,postProcess,onClose,inst=this._curInst;if(!inst||(input&&inst!==$.data(input,'datepicker'))){return;}
if(this._datepickerShowing){showAnim=this._get(inst,'showAnim');duration=this._get(inst,'duration');postProcess=function(){$.datepicker._tidyDialog(inst);};if($.effects&&($.effects.effect[showAnim]||$.effects[showAnim])){inst.dpDiv.hide(showAnim,$.datepicker._get(inst,'showOptions'),duration,postProcess);}else{inst.dpDiv[(showAnim==='slideDown'?'slideUp':(showAnim==='fadeIn'?'fadeOut':'hide'))]((showAnim?duration:null),postProcess);}
if(!showAnim){postProcess();}
this._datepickerShowing=false;onClose=this._get(inst,'onClose');if(onClose){onClose.apply((inst.input?inst.input[0]:null),[(inst.input?inst.input.val():''),inst]);}
this._lastInput=null;if(this._inDialog){this._dialogInput.css({position:'absolute',left:'0',top:'-100px'});if($.blockUI){$.unblockUI();$('body').append(this.dpDiv);}}
this._inDialog=false;}},_tidyDialog:function(inst){inst.dpDiv.removeClass(this._dialogClass).off('.ui-datepicker-calendar');},_checkExternalClick:function(event){if(!$.datepicker._curInst){return;}
var $target=$(event.target),inst=$.datepicker._getInst($target[0]);if((($target[0].id!==$.datepicker._mainDivId&&$target.parents('#'+$.datepicker._mainDivId).length===0&&!$target.hasClass($.datepicker.markerClassName)&&!$target.closest('.'+$.datepicker._triggerClass).length&&$.datepicker._datepickerShowing&&!($.datepicker._inDialog&&$.blockUI)))||($target.hasClass($.datepicker.markerClassName)&&$.datepicker._curInst!==inst)){$.datepicker._hideDatepicker();}},_adjustDate:function(id,offset,period){var target=$(id),inst=this._getInst(target[0]);if(this._isDisabledDatepicker(target[0])){return;}
this._adjustInstDate(inst,offset,period);this._updateDatepicker(inst);},_gotoToday:function(id){var date,target=$(id),inst=this._getInst(target[0]);if(this._get(inst,'gotoCurrent')&&inst.currentDay){inst.selectedDay=inst.currentDay;inst.drawMonth=inst.selectedMonth=inst.currentMonth;inst.drawYear=inst.selectedYear=inst.currentYear;}else{date=new Date();inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();}
this._notifyChange(inst);this._adjustDate(target);},_selectMonthYear:function(id,select,period){var target=$(id),inst=this._getInst(target[0]);inst['selected'+(period==='M'?'Month':'Year')]=inst['draw'+(period==='M'?'Month':'Year')]=parseInt(select.options[select.selectedIndex].value,10);this._notifyChange(inst);this._adjustDate(target);},_selectDay:function(id,month,year,td){var inst,target=$(id);if($(td).hasClass(this._unselectableClass)||this._isDisabledDatepicker(target[0])){return;}
inst=this._getInst(target[0]);inst.selectedDay=inst.currentDay=parseInt($('a',td).attr('data-date'));inst.selectedMonth=inst.currentMonth=month;inst.selectedYear=inst.currentYear=year;this._selectDate(id,this._formatDate(inst,inst.currentDay,inst.currentMonth,inst.currentYear));},_clearDate:function(id){var target=$(id);this._selectDate(target,'');},_selectDate:function(id,dateStr){var onSelect,target=$(id),inst=this._getInst(target[0]);dateStr=(dateStr!=null?dateStr:this._formatDate(inst));if(inst.input){inst.input.val(dateStr);}
this._updateAlternate(inst);onSelect=this._get(inst,'onSelect');if(onSelect){onSelect.apply((inst.input?inst.input[0]:null),[dateStr,inst]);}else if(inst.input){inst.input.trigger('change');}
if(inst.inline){this._updateDatepicker(inst);}else{this._hideDatepicker();this._lastInput=inst.input[0];if(typeof(inst.input[0])!=='object'){inst.input.trigger('focus');}
this._lastInput=null;}},_updateAlternate:function(inst){var altFormat,date,dateStr,altField=this._get(inst,'altField');if(altField){altFormat=this._get(inst,'altFormat')||this._get(inst,'dateFormat');date=this._getDate(inst);dateStr=this.formatDate(altFormat,date,this._getFormatConfig(inst));$(document).find(altField).val(dateStr);}},noWeekends:function(date){var day=date.getDay();return[(day>0&&day<6),''];},iso8601Week:function(date){var time,checkDate=new Date(date.getTime());checkDate.setDate(checkDate.getDate()+4-(checkDate.getDay()||7));time=checkDate.getTime();checkDate.setMonth(0);checkDate.setDate(1);return Math.floor(Math.round((time-checkDate)/86400000)/7)+1;},parseDate:function(format,value,settings){if(format==null||value==null){throw'Invalid arguments';}
value=(typeof value==='object'?value.toString():value+'');if(value===''){return null;}
var iFormat,dim,extra,iValue=0,shortYearCutoffTemp=(settings?settings.shortYearCutoff:null)||this._defaults.shortYearCutoff,shortYearCutoff=(typeof shortYearCutoffTemp!=='string'?shortYearCutoffTemp:new Date().getFullYear()%100+
parseInt(shortYearCutoffTemp,10)),dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort,dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames,monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort,monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames,year=-1,month=-1,day=-1,doy=-1,literal=false,date,lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)===match);if(matches){iFormat++;}
return matches;},getNumber=function(match){var isDoubled=lookAhead(match),size=(match==='@'?14:(match==='!'?20:(match==='y'&&isDoubled?4:(match==='o'?3:2)))),minSize=(match==='y'?size:1),digits=new RegExp('^\\d{'+minSize+','+size+'}'),num=value.substring(iValue).match(digits);if(!num){throw'Missing number at position '+iValue;}
iValue+=num[0].length;return parseInt(num[0],10);},getName=function(match,shortNames,longNames){var index=-1,names=$.map(lookAhead(match)?longNames:shortNames,function(v,k){return[[k,v]];}).sort(function(a,b){return-(a[1].length-b[1].length);});$.each(names,function(i,pair){var name=pair[1];if(value.substr(iValue,name.length).toLowerCase()===name.toLowerCase()){index=pair[0];iValue+=name.length;return false;}});if(index!==-1){return index+1;}else{throw'Unknown name at position '+iValue;}},checkLiteral=function(){if(value.charAt(iValue)!==format.charAt(iFormat)){throw'Unexpected literal at position '+iValue;}
iValue++;};for(iFormat=0;iFormat<format.length;iFormat++){if(literal){if(format.charAt(iFormat)==='\''&&!lookAhead('\'')){literal=false;}else{checkLiteral();}}else{switch(format.charAt(iFormat)){case'd':day=getNumber('d');break;case'D':getName('D',dayNamesShort,dayNames);break;case'o':doy=getNumber('o');break;case'm':month=getNumber('m');break;case'M':month=getName('M',monthNamesShort,monthNames);break;case'y':year=getNumber('y');break;case'@':date=new Date(getNumber('@'));year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case'!':date=new Date((getNumber('!')-this._ticksTo1970)/10000);year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case'\'':if(lookAhead('\'')){checkLiteral();}else{literal=true;}
break;default:checkLiteral();}}}
if(iValue<value.length){extra=value.substr(iValue);if(!/^\s+/.test(extra)){throw'Extra/unparsed characters found in date: '+extra;}}
if(year===-1){year=new Date().getFullYear();}else if(year<100){year+=new Date().getFullYear()-new Date().getFullYear()%100+
(year<=shortYearCutoff?0:-100);}
if(doy>-1){month=1;day=doy;do{dim=this._getDaysInMonth(year,month-1);if(day<=dim){break;}
month++;day-=dim;}while(true);}
date=this._daylightSavingAdjust(new Date(year,month-1,day));if(date.getFullYear()!==year||date.getMonth()+1!==month||date.getDate()!==day){throw'Invalid date';}
return date;},ATOM:'yy-mm-dd',COOKIE:'D, dd M yy',ISO_8601:'yy-mm-dd',RFC_822:'D, d M y',RFC_850:'DD, dd-M-y',RFC_1036:'D, d M y',RFC_1123:'D, d M yy',RFC_2822:'D, d M yy',RSS:'D, d M y',TICKS:'!',TIMESTAMP:'@',W3C:'yy-mm-dd',_ticksTo1970:(((1970-1)*365+Math.floor(1970/4)-Math.floor(1970/100)+
Math.floor(1970/400))*24*60*60*10000000),formatDate:function(format,date,settings){if(!date){return'';}
var iFormat,dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort,dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames,monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort,monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames,lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)===match);if(matches){iFormat++;}
return matches;},formatNumber=function(match,value,len){var num=''+value;if(lookAhead(match)){while(num.length<len){num='0'+num;}}
return num;},formatName=function(match,value,shortNames,longNames){return(lookAhead(match)?longNames[value]:shortNames[value]);},output='',literal=false;if(date){for(iFormat=0;iFormat<format.length;iFormat++){if(literal){if(format.charAt(iFormat)==='\''&&!lookAhead('\'')){literal=false;}else{output+=format.charAt(iFormat);}}else{switch(format.charAt(iFormat)){case'd':output+=formatNumber('d',date.getDate(),2);break;case'D':output+=formatName('D',date.getDay(),dayNamesShort,dayNames);break;case'o':output+=formatNumber('o',Math.round((new Date(date.getFullYear(),date.getMonth(),date.getDate()).getTime()-
new Date(date.getFullYear(),0,0).getTime())/86400000),3);break;case'm':output+=formatNumber('m',date.getMonth()+1,2);break;case'M':output+=formatName('M',date.getMonth(),monthNamesShort,monthNames);break;case'y':output+=(lookAhead('y')?date.getFullYear():(date.getFullYear()%100<10?'0':'')+
date.getFullYear()%100);break;case'@':output+=date.getTime();break;case'!':output+=date.getTime()*10000+this._ticksTo1970;break;case'\'':if(lookAhead('\'')){output+='\'';}else{literal=true;}
break;default:output+=format.charAt(iFormat);}}}}
return output;},_possibleChars:function(format){var iFormat,chars='',literal=false,lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)===match);if(matches){iFormat++;}
return matches;};for(iFormat=0;iFormat<format.length;iFormat++){if(literal){if(format.charAt(iFormat)==='\''&&!lookAhead('\'')){literal=false;}else{chars+=format.charAt(iFormat);}}else{switch(format.charAt(iFormat)){case'd':case'm':case'y':case'@':chars+='0123456789';break;case'D':case'M':return null;case'\'':if(lookAhead('\'')){chars+='\'';}else{literal=true;}
break;default:chars+=format.charAt(iFormat);}}}
return chars;},_get:function(inst,name){return inst.settings[name]!==undefined?inst.settings[name]:this._defaults[name];},_setDateFromField:function(inst,noDefault){if(inst.input.val()===inst.lastVal){return;}
var dateFormat=this._get(inst,'dateFormat'),dates=inst.lastVal=inst.input?inst.input.val():null,defaultDate=this._getDefaultDate(inst),date=defaultDate,settings=this._getFormatConfig(inst);try{date=this.parseDate(dateFormat,dates,settings)||defaultDate;}catch(event){dates=(noDefault?'':dates);}
inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();inst.currentDay=(dates?date.getDate():0);inst.currentMonth=(dates?date.getMonth():0);inst.currentYear=(dates?date.getFullYear():0);this._adjustInstDate(inst);},_getDefaultDate:function(inst){return this._restrictMinMax(inst,this._determineDate(inst,this._get(inst,'defaultDate'),new Date()));},_determineDate:function(inst,date,defaultDate){var offsetNumeric=function(offset){var date=new Date();date.setDate(date.getDate()+offset);return date;},offsetString=function(offset){try{return $.datepicker.parseDate($.datepicker._get(inst,'dateFormat'),offset,$.datepicker._getFormatConfig(inst));}catch(e){}
var date=(offset.toLowerCase().match(/^c/)?$.datepicker._getDate(inst):null)||new Date(),year=date.getFullYear(),month=date.getMonth(),day=date.getDate(),pattern=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,matches=pattern.exec(offset);while(matches){switch(matches[2]||'d'){case'd':case'D':day+=parseInt(matches[1],10);break;case'w':case'W':day+=parseInt(matches[1],10)*7;break;case'm':case'M':month+=parseInt(matches[1],10);day=Math.min(day,$.datepicker._getDaysInMonth(year,month));break;case'y':case'Y':year+=parseInt(matches[1],10);day=Math.min(day,$.datepicker._getDaysInMonth(year,month));break;}
matches=pattern.exec(offset);}
return new Date(year,month,day);},newDate=(date==null||date===''?defaultDate:(typeof date==='string'?offsetString(date):(typeof date==='number'?(isNaN(date)?defaultDate:offsetNumeric(date)):new Date(date.getTime()))));newDate=(newDate&&newDate.toString()==='Invalid Date'?defaultDate:newDate);if(newDate){newDate.setHours(0);newDate.setMinutes(0);newDate.setSeconds(0);newDate.setMilliseconds(0);}
return this._daylightSavingAdjust(newDate);},_daylightSavingAdjust:function(date){if(!date){return null;}
date.setHours(date.getHours()>12?date.getHours()+2:0);return date;},_setDate:function(inst,date,noChange){var clear=!date,origMonth=inst.selectedMonth,origYear=inst.selectedYear,newDate=this._restrictMinMax(inst,this._determineDate(inst,date,new Date()));inst.selectedDay=inst.currentDay=newDate.getDate();inst.drawMonth=inst.selectedMonth=inst.currentMonth=newDate.getMonth();inst.drawYear=inst.selectedYear=inst.currentYear=newDate.getFullYear();if((origMonth!==inst.selectedMonth||origYear!==inst.selectedYear)&&!noChange){this._notifyChange(inst);}
this._adjustInstDate(inst);if(inst.input){inst.input.val(clear?'':this._formatDate(inst));}},_getDate:function(inst){var startDate=(!inst.currentYear||(inst.input&&inst.input.val()==='')?null:this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));return startDate;},_attachHandlers:function(inst){var stepMonths=this._get(inst,'stepMonths'),id='#'+inst.id.replace(/\\\\/g,'\\');inst.dpDiv.find('[data-handler]').map(function(){var handler={prev:function(){$.datepicker._adjustDate(id,-stepMonths,'M');},next:function(){$.datepicker._adjustDate(id,+stepMonths,'M');},hide:function(){$.datepicker._hideDatepicker();},today:function(){$.datepicker._gotoToday(id);},selectDay:function(){$.datepicker._selectDay(id,+this.getAttribute('data-month'),+this.getAttribute('data-year'),this);return false;},selectMonth:function(){$.datepicker._selectMonthYear(id,this,'M');return false;},selectYear:function(){$.datepicker._selectMonthYear(id,this,'Y');return false;}};$(this).on(this.getAttribute('data-event'),handler[this.getAttribute('data-handler')]);});},_generateHTML:function(inst){var maxDraw,prevText,prev,nextText,next,currentText,gotoDate,controls,buttonPanel,firstDay,showWeek,dayNames,dayNamesMin,monthNames,monthNamesShort,beforeShowDay,showOtherMonths,selectOtherMonths,defaultDate,html,dow,row,group,col,selectedDate,cornerClass,calender,thead,day,daysInMonth,leadDays,curRows,numRows,printDate,dRow,tbody,daySettings,otherMonth,unselectable,tempDate=new Date(),today=this._daylightSavingAdjust(new Date(tempDate.getFullYear(),tempDate.getMonth(),tempDate.getDate())),isRTL=this._get(inst,'isRTL'),showButtonPanel=this._get(inst,'showButtonPanel'),hideIfNoPrevNext=this._get(inst,'hideIfNoPrevNext'),navigationAsDateFormat=this._get(inst,'navigationAsDateFormat'),numMonths=this._getNumberOfMonths(inst),showCurrentAtPos=this._get(inst,'showCurrentAtPos'),stepMonths=this._get(inst,'stepMonths'),isMultiMonth=(numMonths[0]!==1||numMonths[1]!==1),currentDate=this._daylightSavingAdjust((!inst.currentDay?new Date(9999,9,9):new Date(inst.currentYear,inst.currentMonth,inst.currentDay))),minDate=this._getMinMaxDate(inst,'min'),maxDate=this._getMinMaxDate(inst,'max'),drawMonth=inst.drawMonth-showCurrentAtPos,drawYear=inst.drawYear;if(drawMonth<0){drawMonth+=12;drawYear--;}
if(maxDate){maxDraw=this._daylightSavingAdjust(new Date(maxDate.getFullYear(),maxDate.getMonth()-(numMonths[0]*numMonths[1])+1,maxDate.getDate()));maxDraw=(minDate&&maxDraw<minDate?minDate:maxDraw);while(this._daylightSavingAdjust(new Date(drawYear,drawMonth,1))>maxDraw){drawMonth--;if(drawMonth<0){drawMonth=11;drawYear--;}}}
inst.drawMonth=drawMonth;inst.drawYear=drawYear;prevText=this._get(inst,'prevText');prevText=(!navigationAsDateFormat?prevText:this.formatDate(prevText,this._daylightSavingAdjust(new Date(drawYear,drawMonth-stepMonths,1)),this._getFormatConfig(inst)));if(this._canAdjustMonth(inst,-1,drawYear,drawMonth)){prev=$('<a>').attr({'class':'ui-datepicker-prev ui-corner-all','data-handler':'prev','data-event':'click',title:prevText}).append($('<span>').addClass('ui-icon ui-icon-circle-triangle-'+
(isRTL?'e':'w')).text(prevText))[0].outerHTML;}else if(hideIfNoPrevNext){prev='';}else{prev=$('<a>').attr({'class':'ui-datepicker-prev ui-corner-all ui-state-disabled',title:prevText}).append($('<span>').addClass('ui-icon ui-icon-circle-triangle-'+
(isRTL?'e':'w')).text(prevText))[0].outerHTML;}
nextText=this._get(inst,'nextText');nextText=(!navigationAsDateFormat?nextText:this.formatDate(nextText,this._daylightSavingAdjust(new Date(drawYear,drawMonth+stepMonths,1)),this._getFormatConfig(inst)));if(this._canAdjustMonth(inst,+1,drawYear,drawMonth)){next=$('<a>').attr({'class':'ui-datepicker-next ui-corner-all','data-handler':'next','data-event':'click',title:nextText}).append($('<span>').addClass('ui-icon ui-icon-circle-triangle-'+
(isRTL?'w':'e')).text(nextText))[0].outerHTML;}else if(hideIfNoPrevNext){next='';}else{next=$('<a>').attr({'class':'ui-datepicker-next ui-corner-all ui-state-disabled',title:nextText}).append($('<span>').attr('class','ui-icon ui-icon-circle-triangle-'+
(isRTL?'w':'e')).text(nextText))[0].outerHTML;}
currentText=this._get(inst,'currentText');gotoDate=(this._get(inst,'gotoCurrent')&&inst.currentDay?currentDate:today);currentText=(!navigationAsDateFormat?currentText:this.formatDate(currentText,gotoDate,this._getFormatConfig(inst)));controls='';if(!inst.inline){controls=$('<button>').attr({type:'button','class':'ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all','data-handler':'hide','data-event':'click'}).text(this._get(inst,'closeText'))[0].outerHTML;}
buttonPanel='';if(showButtonPanel){buttonPanel=$('<div class=\'ui-datepicker-buttonpane ui-widget-content\'>').append(isRTL?controls:'').append(this._isInRange(inst,gotoDate)?$('<button>').attr({type:'button','class':'ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all','data-handler':'today','data-event':'click'}).text(currentText):'').append(isRTL?'':controls)[0].outerHTML;}
firstDay=parseInt(this._get(inst,'firstDay'),10);firstDay=(isNaN(firstDay)?0:firstDay);showWeek=this._get(inst,'showWeek');dayNames=this._get(inst,'dayNames');dayNamesMin=this._get(inst,'dayNamesMin');monthNames=this._get(inst,'monthNames');monthNamesShort=this._get(inst,'monthNamesShort');beforeShowDay=this._get(inst,'beforeShowDay');showOtherMonths=this._get(inst,'showOtherMonths');selectOtherMonths=this._get(inst,'selectOtherMonths');defaultDate=this._getDefaultDate(inst);html='';for(row=0;row<numMonths[0];row++){group='';this.maxRows=4;for(col=0;col<numMonths[1];col++){selectedDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,inst.selectedDay));cornerClass=' ui-corner-all';calender='';if(isMultiMonth){calender+='<div class=\'ui-datepicker-group';if(numMonths[1]>1){switch(col){case 0:calender+=' ui-datepicker-group-first';cornerClass=' ui-corner-'+(isRTL?'right':'left');break;case numMonths[1]-1:calender+=' ui-datepicker-group-last';cornerClass=' ui-corner-'+(isRTL?'left':'right');break;default:calender+=' ui-datepicker-group-middle';cornerClass='';break;}}
calender+='\'>';}
calender+='<div class=\'ui-datepicker-header ui-widget-header ui-helper-clearfix'+
cornerClass+'\'>'+
(/all|left/.test(cornerClass)&&row===0?(isRTL?next:prev):'')+
(/all|right/.test(cornerClass)&&row===0?(isRTL?prev:next):'')+
this._generateMonthYearHeader(inst,drawMonth,drawYear,minDate,maxDate,row>0||col>0,monthNames,monthNamesShort)+'</div><table class=\'ui-datepicker-calendar\'><thead>'+'<tr>';thead=(showWeek?'<th class=\'ui-datepicker-week-col\'>'+
this._get(inst,'weekHeader')+'</th>':'');for(dow=0;dow<7;dow++){day=(dow+firstDay)%7;thead+='<th scope=\'col\''+
((dow+firstDay+6)%7>=5?' class=\'ui-datepicker-week-end\'':'')+'>'+'<span title=\''+dayNames[day]+'\'>'+dayNamesMin[day]+'</span></th>';}
calender+=thead+'</tr></thead><tbody>';daysInMonth=this._getDaysInMonth(drawYear,drawMonth);if(drawYear===inst.selectedYear&&drawMonth===inst.selectedMonth){inst.selectedDay=Math.min(inst.selectedDay,daysInMonth);}
leadDays=(this._getFirstDayOfMonth(drawYear,drawMonth)-firstDay+7)%7;curRows=Math.ceil((leadDays+daysInMonth)/7);numRows=(isMultiMonth?this.maxRows>curRows?this.maxRows:curRows:curRows);this.maxRows=numRows;printDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,1-leadDays));for(dRow=0;dRow<numRows;dRow++){calender+='<tr>';tbody=(!showWeek?'':'<td class=\'ui-datepicker-week-col\'>'+
this._get(inst,'calculateWeek')(printDate)+'</td>');for(dow=0;dow<7;dow++){daySettings=(beforeShowDay?beforeShowDay.apply((inst.input?inst.input[0]:null),[printDate]):[true,'']);otherMonth=(printDate.getMonth()!==drawMonth);unselectable=(otherMonth&&!selectOtherMonths)||!daySettings[0]||(minDate&&printDate<minDate)||(maxDate&&printDate>maxDate);tbody+='<td class=\''+
((dow+firstDay+6)%7>=5?' ui-datepicker-week-end':'')+
(otherMonth?' ui-datepicker-other-month':'')+
((printDate.getTime()===selectedDate.getTime()&&drawMonth===inst.selectedMonth&&inst._keyEvent)||(defaultDate.getTime()===printDate.getTime()&&defaultDate.getTime()===selectedDate.getTime())?' '+this._dayOverClass:'')+
(unselectable?' '+this._unselectableClass+' ui-state-disabled':'')+
(otherMonth&&!showOtherMonths?'':' '+daySettings[1]+
(printDate.getTime()===currentDate.getTime()?' '+this._currentClass:'')+
(printDate.getTime()===today.getTime()?' ui-datepicker-today':''))+'\''+
((!otherMonth||showOtherMonths)&&daySettings[2]?' title=\''+daySettings[2].replace(/'/g,'&#39;')+'\'':'')+
(unselectable?'':' data-handler=\'selectDay\' data-event=\'click\' data-month=\''+
printDate.getMonth()+'\' data-year=\''+
printDate.getFullYear()+'\'')+'>'+
(otherMonth&&!showOtherMonths?'&#xa0;':(unselectable?'<span class=\'ui-state-default\'>'+
printDate.getDate()+'</span>':'<a class=\'ui-state-default'+
(printDate.getTime()===today.getTime()?' ui-state-highlight':'')+
(printDate.getTime()===currentDate.getTime()?' ui-state-active':'')+
(otherMonth?' ui-priority-secondary':'')+'\' href=\'#\' aria-current=\''+
(printDate.getTime()===currentDate.getTime()?'true':'false')+'\' data-date=\''+
printDate.getDate()+'\'>'+printDate.getDate()+'</a>'))+'</td>';printDate.setDate(printDate.getDate()+1);printDate=this._daylightSavingAdjust(printDate);}
calender+=tbody+'</tr>';}
drawMonth++;if(drawMonth>11){drawMonth=0;drawYear++;}
calender+='</tbody></table>'+
(isMultiMonth?'</div>'+
((numMonths[0]>0&&col===numMonths[1]-1)?'<div class=\'ui-datepicker-row-break\'></div>':''):'');group+=calender;}
html+=group;}
html+=buttonPanel;inst._keyEvent=false;return html;},_generateMonthYearHeader:function(inst,drawMonth,drawYear,minDate,maxDate,secondary,monthNames,monthNamesShort){var inMinYear,inMaxYear,month,years,thisYear,determineYear,year,endYear,changeMonth=this._get(inst,'changeMonth'),changeYear=this._get(inst,'changeYear'),showMonthAfterYear=this._get(inst,'showMonthAfterYear'),selectMonthLabel=this._get(inst,'selectMonthLabel'),selectYearLabel=this._get(inst,'selectYearLabel'),html='<div class=\'ui-datepicker-title\'>',monthHtml='';if(secondary||!changeMonth){monthHtml+='<span class=\'ui-datepicker-month\'>'+
monthNames[drawMonth]+'</span>';}else{inMinYear=(minDate&&minDate.getFullYear()===drawYear);inMaxYear=(maxDate&&maxDate.getFullYear()===drawYear);monthHtml+='<select class=\'ui-datepicker-month\' aria-label=\''+
selectMonthLabel+'\' data-handler=\'selectMonth\' data-event=\'change\'>';for(month=0;month<12;month++){if((!inMinYear||month>=minDate.getMonth())&&(!inMaxYear||month<=maxDate.getMonth())){monthHtml+='<option value=\''+month+'\''+
(month===drawMonth?' selected=\'selected\'':'')+'>'+
monthNamesShort[month]+'</option>';}}
monthHtml+='</select>';}
if(!showMonthAfterYear){html+=monthHtml+
(secondary||!(changeMonth&&changeYear)?'&#xa0;':'');}
if(!inst.yearshtml){inst.yearshtml='';if(secondary||!changeYear){html+='<span class=\'ui-datepicker-year\'>'+drawYear+'</span>';}else{years=this._get(inst,'yearRange').split(':');thisYear=new Date().getFullYear();determineYear=function(value){var year=(value.match(/c[+\-].*/)?drawYear+parseInt(value.substring(1),10):(value.match(/[+\-].*/)?thisYear+parseInt(value,10):parseInt(value,10)));return(isNaN(year)?thisYear:year);};year=determineYear(years[0]);endYear=Math.max(year,determineYear(years[1]||''));year=(minDate?Math.max(year,minDate.getFullYear()):year);endYear=(maxDate?Math.min(endYear,maxDate.getFullYear()):endYear);inst.yearshtml+='<select class=\'ui-datepicker-year\' aria-label=\''+
selectYearLabel+'\' data-handler=\'selectYear\' data-event=\'change\'>';for(;year<=endYear;year++){inst.yearshtml+='<option value=\''+year+'\''+
(year===drawYear?' selected=\'selected\'':'')+'>'+year+'</option>';}
inst.yearshtml+='</select>';html+=inst.yearshtml;inst.yearshtml=null;}}
html+=this._get(inst,'yearSuffix');if(showMonthAfterYear){html+=(secondary||!(changeMonth&&changeYear)?'&#xa0;':'')+
monthHtml;}
html+='</div>';return html;},_adjustInstDate:function(inst,offset,period){var year=inst.selectedYear+(period==='Y'?offset:0),month=inst.selectedMonth+(period==='M'?offset:0),day=Math.min(inst.selectedDay,this._getDaysInMonth(year,month))+
(period==='D'?offset:0),date=this._restrictMinMax(inst,this._daylightSavingAdjust(new Date(year,month,day)));inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();if(period==='M'||period==='Y'){this._notifyChange(inst);}},_restrictMinMax:function(inst,date){var minDate=this._getMinMaxDate(inst,'min'),maxDate=this._getMinMaxDate(inst,'max'),newDate=(minDate&&date<minDate?minDate:date);return(maxDate&&newDate>maxDate?maxDate:newDate);},_notifyChange:function(inst){var onChange=this._get(inst,'onChangeMonthYear');if(onChange){onChange.apply((inst.input?inst.input[0]:null),[inst.selectedYear,inst.selectedMonth+1,inst]);}},_getNumberOfMonths:function(inst){var numMonths=this._get(inst,'numberOfMonths');return(numMonths==null?[1,1]:(typeof numMonths==='number'?[1,numMonths]:numMonths));},_getMinMaxDate:function(inst,minMax){return this._determineDate(inst,this._get(inst,minMax+'Date'),null);},_getDaysInMonth:function(year,month){return 32-this._daylightSavingAdjust(new Date(year,month,32)).getDate();},_getFirstDayOfMonth:function(year,month){return new Date(year,month,1).getDay();},_canAdjustMonth:function(inst,offset,curYear,curMonth){var numMonths=this._getNumberOfMonths(inst),date=this._daylightSavingAdjust(new Date(curYear,curMonth+(offset<0?offset:numMonths[0]*numMonths[1]),1));if(offset<0){date.setDate(this._getDaysInMonth(date.getFullYear(),date.getMonth()));}
return this._isInRange(inst,date);},_isInRange:function(inst,date){var yearSplit,currentYear,minDate=this._getMinMaxDate(inst,'min'),maxDate=this._getMinMaxDate(inst,'max'),minYear=null,maxYear=null,years=this._get(inst,'yearRange');if(years){yearSplit=years.split(':');currentYear=new Date().getFullYear();minYear=parseInt(yearSplit[0],10);maxYear=parseInt(yearSplit[1],10);if(yearSplit[0].match(/[+\-].*/)){minYear+=currentYear;}
if(yearSplit[1].match(/[+\-].*/)){maxYear+=currentYear;}}
return((!minDate||date.getTime()>=minDate.getTime())&&(!maxDate||date.getTime()<=maxDate.getTime())&&(!minYear||date.getFullYear()>=minYear)&&(!maxYear||date.getFullYear()<=maxYear));},_getFormatConfig:function(inst){var shortYearCutoff=this._get(inst,'shortYearCutoff');shortYearCutoff=(typeof shortYearCutoff!=='string'?shortYearCutoff:new Date().getFullYear()%100+parseInt(shortYearCutoff,10));return{shortYearCutoff:shortYearCutoff,dayNamesShort:this._get(inst,'dayNamesShort'),dayNames:this._get(inst,'dayNames'),monthNamesShort:this._get(inst,'monthNamesShort'),monthNames:this._get(inst,'monthNames')};},_formatDate:function(inst,day,month,year){if(!day){inst.currentDay=inst.selectedDay;inst.currentMonth=inst.selectedMonth;inst.currentYear=inst.selectedYear;}
var date=(day?(typeof day==='object'?day:this._daylightSavingAdjust(new Date(year,month,day))):this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));return this.formatDate(this._get(inst,'dateFormat'),date,this._getFormatConfig(inst));}});function datepicker_bindHover(dpDiv){var selector='button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a';return dpDiv.on('mouseout',selector,function(){$(this).removeClass('ui-state-hover');if(this.className.indexOf('ui-datepicker-prev')!==-1){$(this).removeClass('ui-datepicker-prev-hover');}
if(this.className.indexOf('ui-datepicker-next')!==-1){$(this).removeClass('ui-datepicker-next-hover');}}).on('mouseover',selector,datepicker_handleMouseover);}
function datepicker_handleMouseover(){if(!$.datepicker._isDisabledDatepicker(datepicker_instActive.inline?datepicker_instActive.dpDiv.parent()[0]:datepicker_instActive.input[0])){$(this).parents('.ui-datepicker-calendar').find('a').removeClass('ui-state-hover');$(this).addClass('ui-state-hover');if(this.className.indexOf('ui-datepicker-prev')!==-1){$(this).addClass('ui-datepicker-prev-hover');}
if(this.className.indexOf('ui-datepicker-next')!==-1){$(this).addClass('ui-datepicker-next-hover');}}}
function datepicker_extendRemove(target,props){$.extend(target,props);for(var name in props){if(props[name]==null){target[name]=props[name];}}
return target;}
$.fn.datepicker=function(options){if(!this.length){return this;}
if(!$.datepicker.initialized){$(document).on('mousedown',$.datepicker._checkExternalClick);$.datepicker.initialized=true;}
if($('#'+$.datepicker._mainDivId).length===0){$('body').append($.datepicker.dpDiv);}
var otherArgs=Array.prototype.slice.call(arguments,1);if(typeof options==='string'&&(options==='isDisabled'||options==='getDate'||options==='widget')){return $.datepicker['_'+options+'Datepicker'].apply($.datepicker,[this[0]].concat(otherArgs));}
if(options==='option'&&arguments.length===2&&typeof arguments[1]==='string'){return $.datepicker['_'+options+'Datepicker'].apply($.datepicker,[this[0]].concat(otherArgs));}
return this.each(function(){if(typeof options==='string'){$.datepicker['_'+options+'Datepicker'].apply($.datepicker,[this].concat(otherArgs));}else{$.datepicker._attachDatepicker(this,options);}});};$.datepicker=new Datepicker();$.datepicker.initialized=false;$.datepicker.uuid=new Date().getTime();$.datepicker.version='1.13.2';var widgetsDatepicker=$.datepicker;var ie=$.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());
/*!
 * jQuery UI Mouse 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var mouseHandled=false;$(document).on('mouseup',function(){mouseHandled=false;});var widgetsMouse=$.widget('ui.mouse',{version:'1.13.2',options:{cancel:'input, textarea, button, select, option',distance:1,delay:0},_mouseInit:function(){var that=this;this.element.on('mousedown.'+this.widgetName,function(event){return that._mouseDown(event);}).on('click.'+this.widgetName,function(event){if(true===$.data(event.target,that.widgetName+'.preventClickEvent')){$.removeData(event.target,that.widgetName+'.preventClickEvent');event.stopImmediatePropagation();return false;}});this.started=false;},_mouseDestroy:function(){this.element.off('.'+this.widgetName);if(this._mouseMoveDelegate){this.document.off('mousemove.'+this.widgetName,this._mouseMoveDelegate).off('mouseup.'+this.widgetName,this._mouseUpDelegate);}},_mouseDown:function(event){if(mouseHandled){return;}
this._mouseMoved=false;if(this._mouseStarted){this._mouseUp(event);}
this._mouseDownEvent=event;var that=this,btnIsLeft=(event.which===1),elIsCancel=(typeof this.options.cancel==='string'&&event.target.nodeName?$(event.target).closest(this.options.cancel).length:false);if(!btnIsLeft||elIsCancel||!this._mouseCapture(event)){return true;}
this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){that.mouseDelayMet=true;},this.options.delay);}
if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(event)!==false);if(!this._mouseStarted){event.preventDefault();return true;}}
if(true===$.data(event.target,this.widgetName+'.preventClickEvent')){$.removeData(event.target,this.widgetName+'.preventClickEvent');}
this._mouseMoveDelegate=function(event){return that._mouseMove(event);};this._mouseUpDelegate=function(event){return that._mouseUp(event);};this.document.on('mousemove.'+this.widgetName,this._mouseMoveDelegate).on('mouseup.'+this.widgetName,this._mouseUpDelegate);event.preventDefault();mouseHandled=true;return true;},_mouseMove:function(event){if(this._mouseMoved){if($.ui.ie&&(!document.documentMode||document.documentMode<9)&&!event.button){return this._mouseUp(event);}else if(!event.which){if(event.originalEvent.altKey||event.originalEvent.ctrlKey||event.originalEvent.metaKey||event.originalEvent.shiftKey){this.ignoreMissingWhich=true;}else if(!this.ignoreMissingWhich){return this._mouseUp(event);}}}
if(event.which||event.button){this._mouseMoved=true;}
if(this._mouseStarted){this._mouseDrag(event);return event.preventDefault();}
if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(this._mouseDownEvent,event)!==false);if(this._mouseStarted){this._mouseDrag(event);}else{this._mouseUp(event);}}
return!this._mouseStarted;},_mouseUp:function(event){this.document.off('mousemove.'+this.widgetName,this._mouseMoveDelegate).off('mouseup.'+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;if(event.target===this._mouseDownEvent.target){$.data(event.target,this.widgetName+'.preventClickEvent',true);}
this._mouseStop(event);}
if(this._mouseDelayTimer){clearTimeout(this._mouseDelayTimer);delete this._mouseDelayTimer;}
this.ignoreMissingWhich=false;mouseHandled=false;event.preventDefault();},_mouseDistanceMet:function(event){return(Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance);},_mouseDelayMet:function(){return this.mouseDelayMet;},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return true;}});var plugin=$.ui.plugin={add:function(module,option,set){var i,proto=$.ui[module].prototype;for(i in set){proto.plugins[i]=proto.plugins[i]||[];proto.plugins[i].push([option,set[i]]);}},call:function(instance,name,args,allowDisconnected){var i,set=instance.plugins[name];if(!set){return;}
if(!allowDisconnected&&(!instance.element[0].parentNode||instance.element[0].parentNode.nodeType===11)){return;}
for(i=0;i<set.length;i++){if(instance.options[set[i][0]]){set[i][1].apply(instance.element,args);}}}};var safeBlur=$.ui.safeBlur=function(element){if(element&&element.nodeName.toLowerCase()!=='body'){$(element).trigger('blur');}};
/*!
 * jQuery UI Draggable 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
$.widget('ui.draggable',$.ui.mouse,{version:'1.13.2',widgetEventPrefix:'drag',options:{addClasses:true,appendTo:'parent',axis:false,connectToSortable:false,containment:false,cursor:'auto',cursorAt:false,grid:false,handle:false,helper:'original',iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:'default',scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:'both',snapTolerance:20,stack:false,zIndex:false,drag:null,start:null,stop:null},_create:function(){if(this.options.helper==='original'){this._setPositionRelative();}
if(this.options.addClasses){this._addClass('ui-draggable');}
this._setHandleClassName();this._mouseInit();},_setOption:function(key,value){this._super(key,value);if(key==='handle'){this._removeHandleClassName();this._setHandleClassName();}},_destroy:function(){if((this.helper||this.element).is('.ui-draggable-dragging')){this.destroyOnClear=true;return;}
this._removeHandleClassName();this._mouseDestroy();},_mouseCapture:function(event){var o=this.options;if(this.helper||o.disabled||$(event.target).closest('.ui-resizable-handle').length>0){return false;}
this.handle=this._getHandle(event);if(!this.handle){return false;}
this._blurActiveElement(event);this._blockFrames(o.iframeFix===true?'iframe':o.iframeFix);return true;},_blockFrames:function(selector){this.iframeBlocks=this.document.find(selector).map(function(){var iframe=$(this);return $('<div>').css('position','absolute').appendTo(iframe.parent()).outerWidth(iframe.outerWidth()).outerHeight(iframe.outerHeight()).offset(iframe.offset())[0];});},_unblockFrames:function(){if(this.iframeBlocks){this.iframeBlocks.remove();delete this.iframeBlocks;}},_blurActiveElement:function(event){var activeElement=$.ui.safeActiveElement(this.document[0]),target=$(event.target);if(target.closest(activeElement).length){return;}
$.ui.safeBlur(activeElement);},_mouseStart:function(event){var o=this.options;this.helper=this._createHelper(event);this._addClass(this.helper,'ui-draggable-dragging');this._cacheHelperProportions();if($.ui.ddmanager){$.ui.ddmanager.current=this;}
this._cacheMargins();this.cssPosition=this.helper.css('position');this.scrollParent=this.helper.scrollParent(true);this.offsetParent=this.helper.offsetParent();this.hasFixedAncestor=this.helper.parents().filter(function(){return $(this).css('position')==='fixed';}).length>0;this.positionAbs=this.element.offset();this._refreshOffsets(event);this.originalPosition=this.position=this._generatePosition(event,false);this.originalPageX=event.pageX;this.originalPageY=event.pageY;if(o.cursorAt){this._adjustOffsetFromHelper(o.cursorAt);}
this._setContainment();if(this._trigger('start',event)===false){this._clear();return false;}
this._cacheHelperProportions();if($.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(this,event);}
this._mouseDrag(event,true);if($.ui.ddmanager){$.ui.ddmanager.dragStart(this,event);}
return true;},_refreshOffsets:function(event){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:false,parent:this._getParentOffset(),relative:this._getRelativeOffset()};this.offset.click={left:event.pageX-this.offset.left,top:event.pageY-this.offset.top};},_mouseDrag:function(event,noPropagation){if(this.hasFixedAncestor){this.offset.parent=this._getParentOffset();}
this.position=this._generatePosition(event,true);this.positionAbs=this._convertPositionTo('absolute');if(!noPropagation){var ui=this._uiHash();if(this._trigger('drag',event,ui)===false){this._mouseUp(new $.Event('mouseup',event));return false;}
this.position=ui.position;}
this.helper[0].style.left=this.position.left+'px';this.helper[0].style.top=this.position.top+'px';if($.ui.ddmanager){$.ui.ddmanager.drag(this,event);}
return false;},_mouseStop:function(event){var that=this,dropped=false;if($.ui.ddmanager&&!this.options.dropBehaviour){dropped=$.ui.ddmanager.drop(this,event);}
if(this.dropped){dropped=this.dropped;this.dropped=false;}
if((this.options.revert==='invalid'&&!dropped)||(this.options.revert==='valid'&&dropped)||this.options.revert===true||(typeof this.options.revert==='function'&&this.options.revert.call(this.element,dropped))){$(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){if(that._trigger('stop',event)!==false){that._clear();}});}else{if(this._trigger('stop',event)!==false){this._clear();}}
return false;},_mouseUp:function(event){this._unblockFrames();if($.ui.ddmanager){$.ui.ddmanager.dragStop(this,event);}
if(this.handleElement.is(event.target)){this.element.trigger('focus');}
return $.ui.mouse.prototype._mouseUp.call(this,event);},cancel:function(){if(this.helper.is('.ui-draggable-dragging')){this._mouseUp(new $.Event('mouseup',{target:this.element[0]}));}else{this._clear();}
return this;},_getHandle:function(event){return this.options.handle?!!$(event.target).closest(this.element.find(this.options.handle)).length:true;},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element;this._addClass(this.handleElement,'ui-draggable-handle');},_removeHandleClassName:function(){this._removeClass(this.handleElement,'ui-draggable-handle');},_createHelper:function(event){var o=this.options,helperIsFunction=typeof o.helper==='function',helper=helperIsFunction?$(o.helper.apply(this.element[0],[event])):(o.helper==='clone'?this.element.clone().removeAttr('id'):this.element);if(!helper.parents('body').length){helper.appendTo((o.appendTo==='parent'?this.element[0].parentNode:o.appendTo));}
if(helperIsFunction&&helper[0]===this.element[0]){this._setPositionRelative();}
if(helper[0]!==this.element[0]&&!(/(fixed|absolute)/).test(helper.css('position'))){helper.css('position','absolute');}
return helper;},_setPositionRelative:function(){if(!(/^(?:r|a|f)/).test(this.element.css('position'))){this.element[0].style.position='relative';}},_adjustOffsetFromHelper:function(obj){if(typeof obj==='string'){obj=obj.split(' ');}
if(Array.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0};}
if('left'in obj){this.offset.click.left=obj.left+this.margins.left;}
if('right'in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left;}
if('top'in obj){this.offset.click.top=obj.top+this.margins.top;}
if('bottom'in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top;}},_isRootNode:function(element){return(/(html|body)/i).test(element.tagName)||element===this.document[0];},_getParentOffset:function(){var po=this.offsetParent.offset(),document=this.document[0];if(this.cssPosition==='absolute'&&this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop();}
if(this._isRootNode(this.offsetParent[0])){po={top:0,left:0};}
return{top:po.top+(parseInt(this.offsetParent.css('borderTopWidth'),10)||0),left:po.left+
(parseInt(this.offsetParent.css('borderLeftWidth'),10)||0)};},_getRelativeOffset:function(){if(this.cssPosition!=='relative'){return{top:0,left:0};}
var p=this.element.position(),scrollIsRootNode=this._isRootNode(this.scrollParent[0]);return{top:p.top-(parseInt(this.helper.css('top'),10)||0)+
(!scrollIsRootNode?this.scrollParent.scrollTop():0),left:p.left-(parseInt(this.helper.css('left'),10)||0)+
(!scrollIsRootNode?this.scrollParent.scrollLeft():0)};},_cacheMargins:function(){this.margins={left:(parseInt(this.element.css('marginLeft'),10)||0),top:(parseInt(this.element.css('marginTop'),10)||0),right:(parseInt(this.element.css('marginRight'),10)||0),bottom:(parseInt(this.element.css('marginBottom'),10)||0)};},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};},_setContainment:function(){var isUserScrollable,c,ce,o=this.options,document=this.document[0];this.relativeContainer=null;if(!o.containment){this.containment=null;return;}
if(o.containment==='window'){this.containment=[$(window).scrollLeft()-this.offset.relative.left-
this.offset.parent.left,$(window).scrollTop()-this.offset.relative.top-
this.offset.parent.top,$(window).scrollLeft()+$(window).width()-
this.helperProportions.width-this.margins.left,$(window).scrollTop()+
($(window).height()||document.body.parentNode.scrollHeight)-
this.helperProportions.height-this.margins.top];return;}
if(o.containment==='document'){this.containment=[0,0,$(document).width()-this.helperProportions.width-this.margins.left,($(document).height()||document.body.parentNode.scrollHeight)-
this.helperProportions.height-this.margins.top];return;}
if(o.containment.constructor===Array){this.containment=o.containment;return;}
if(o.containment==='parent'){o.containment=this.helper[0].parentNode;}
c=$(o.containment);ce=c[0];if(!ce){return;}
isUserScrollable=/(scroll|auto)/.test(c.css('overflow'));this.containment=[(parseInt(c.css('borderLeftWidth'),10)||0)+
(parseInt(c.css('paddingLeft'),10)||0),(parseInt(c.css('borderTopWidth'),10)||0)+
(parseInt(c.css('paddingTop'),10)||0),(isUserScrollable?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-
(parseInt(c.css('borderRightWidth'),10)||0)-
(parseInt(c.css('paddingRight'),10)||0)-
this.helperProportions.width-this.margins.left-this.margins.right,(isUserScrollable?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-
(parseInt(c.css('borderBottomWidth'),10)||0)-
(parseInt(c.css('paddingBottom'),10)||0)-
this.helperProportions.height-this.margins.top-this.margins.bottom];this.relativeContainer=c;},_convertPositionTo:function(d,pos){if(!pos){pos=this.position;}
var mod=d==='absolute'?1:-1,scrollIsRootNode=this._isRootNode(this.scrollParent[0]);return{top:(pos.top+
this.offset.relative.top*mod+
this.offset.parent.top*mod-
((this.cssPosition==='fixed'?-this.offset.scroll.top:(scrollIsRootNode?0:this.offset.scroll.top))*mod)),left:(pos.left+
this.offset.relative.left*mod+
this.offset.parent.left*mod-
((this.cssPosition==='fixed'?-this.offset.scroll.left:(scrollIsRootNode?0:this.offset.scroll.left))*mod))};},_generatePosition:function(event,constrainPosition){var containment,co,top,left,o=this.options,scrollIsRootNode=this._isRootNode(this.scrollParent[0]),pageX=event.pageX,pageY=event.pageY;if(!scrollIsRootNode||!this.offset.scroll){this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()};}
if(constrainPosition){if(this.containment){if(this.relativeContainer){co=this.relativeContainer.offset();containment=[this.containment[0]+co.left,this.containment[1]+co.top,this.containment[2]+co.left,this.containment[3]+co.top];}else{containment=this.containment;}
if(event.pageX-this.offset.click.left<containment[0]){pageX=containment[0]+this.offset.click.left;}
if(event.pageY-this.offset.click.top<containment[1]){pageY=containment[1]+this.offset.click.top;}
if(event.pageX-this.offset.click.left>containment[2]){pageX=containment[2]+this.offset.click.left;}
if(event.pageY-this.offset.click.top>containment[3]){pageY=containment[3]+this.offset.click.top;}}
if(o.grid){top=o.grid[1]?this.originalPageY+
Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY;pageY=containment?((top-this.offset.click.top>=containment[1]||top-this.offset.click.top>containment[3])?top:((top-this.offset.click.top>=containment[1])?top-o.grid[1]:top+o.grid[1])):top;left=o.grid[0]?this.originalPageX+
Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX;pageX=containment?((left-this.offset.click.left>=containment[0]||left-this.offset.click.left>containment[2])?left:((left-this.offset.click.left>=containment[0])?left-o.grid[0]:left+o.grid[0])):left;}
if(o.axis==='y'){pageX=this.originalPageX;}
if(o.axis==='x'){pageY=this.originalPageY;}}
return{top:(pageY-
this.offset.click.top-
this.offset.relative.top-
this.offset.parent.top+
(this.cssPosition==='fixed'?-this.offset.scroll.top:(scrollIsRootNode?0:this.offset.scroll.top))),left:(pageX-
this.offset.click.left-
this.offset.relative.left-
this.offset.parent.left+
(this.cssPosition==='fixed'?-this.offset.scroll.left:(scrollIsRootNode?0:this.offset.scroll.left)))};},_clear:function(){this._removeClass(this.helper,'ui-draggable-dragging');if(this.helper[0]!==this.element[0]&&!this.cancelHelperRemoval){this.helper.remove();}
this.helper=null;this.cancelHelperRemoval=false;if(this.destroyOnClear){this.destroy();}},_trigger:function(type,event,ui){ui=ui||this._uiHash();$.ui.plugin.call(this,type,[event,ui,this],true);if(/^(drag|start|stop)/.test(type)){this.positionAbs=this._convertPositionTo('absolute');ui.offset=this.positionAbs;}
return $.Widget.prototype._trigger.call(this,type,event,ui);},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs};}});$.ui.plugin.add('draggable','connectToSortable',{start:function(event,ui,draggable){var uiSortable=$.extend({},ui,{item:draggable.element});draggable.sortables=[];$(draggable.options.connectToSortable).each(function(){var sortable=$(this).sortable('instance');if(sortable&&!sortable.options.disabled){draggable.sortables.push(sortable);sortable.refreshPositions();sortable._trigger('activate',event,uiSortable);}});},stop:function(event,ui,draggable){var uiSortable=$.extend({},ui,{item:draggable.element});draggable.cancelHelperRemoval=false;$.each(draggable.sortables,function(){var sortable=this;if(sortable.isOver){sortable.isOver=0;draggable.cancelHelperRemoval=true;sortable.cancelHelperRemoval=false;sortable._storedCSS={position:sortable.placeholder.css('position'),top:sortable.placeholder.css('top'),left:sortable.placeholder.css('left')};sortable._mouseStop(event);sortable.options.helper=sortable.options._helper;}else{sortable.cancelHelperRemoval=true;sortable._trigger('deactivate',event,uiSortable);}});},drag:function(event,ui,draggable){$.each(draggable.sortables,function(){var innermostIntersecting=false,sortable=this;sortable.positionAbs=draggable.positionAbs;sortable.helperProportions=draggable.helperProportions;sortable.offset.click=draggable.offset.click;if(sortable._intersectsWith(sortable.containerCache)){innermostIntersecting=true;$.each(draggable.sortables,function(){this.positionAbs=draggable.positionAbs;this.helperProportions=draggable.helperProportions;this.offset.click=draggable.offset.click;if(this!==sortable&&this._intersectsWith(this.containerCache)&&$.contains(sortable.element[0],this.element[0])){innermostIntersecting=false;}
return innermostIntersecting;});}
if(innermostIntersecting){if(!sortable.isOver){sortable.isOver=1;draggable._parent=ui.helper.parent();sortable.currentItem=ui.helper.appendTo(sortable.element).data('ui-sortable-item',true);sortable.options._helper=sortable.options.helper;sortable.options.helper=function(){return ui.helper[0];};event.target=sortable.currentItem[0];sortable._mouseCapture(event,true);sortable._mouseStart(event,true,true);sortable.offset.click.top=draggable.offset.click.top;sortable.offset.click.left=draggable.offset.click.left;sortable.offset.parent.left-=draggable.offset.parent.left-sortable.offset.parent.left;sortable.offset.parent.top-=draggable.offset.parent.top-sortable.offset.parent.top;draggable._trigger('toSortable',event);draggable.dropped=sortable.element;$.each(draggable.sortables,function(){this.refreshPositions();});draggable.currentItem=draggable.element;sortable.fromOutside=draggable;}
if(sortable.currentItem){sortable._mouseDrag(event);ui.position=sortable.position;}}else{if(sortable.isOver){sortable.isOver=0;sortable.cancelHelperRemoval=true;sortable.options._revert=sortable.options.revert;sortable.options.revert=false;sortable._trigger('out',event,sortable._uiHash(sortable));sortable._mouseStop(event,true);sortable.options.revert=sortable.options._revert;sortable.options.helper=sortable.options._helper;if(sortable.placeholder){sortable.placeholder.remove();}
ui.helper.appendTo(draggable._parent);draggable._refreshOffsets(event);ui.position=draggable._generatePosition(event,true);draggable._trigger('fromSortable',event);draggable.dropped=false;$.each(draggable.sortables,function(){this.refreshPositions();});}}});}});$.ui.plugin.add('draggable','cursor',{start:function(event,ui,instance){var t=$('body'),o=instance.options;if(t.css('cursor')){o._cursor=t.css('cursor');}
t.css('cursor',o.cursor);},stop:function(event,ui,instance){var o=instance.options;if(o._cursor){$('body').css('cursor',o._cursor);}}});$.ui.plugin.add('draggable','opacity',{start:function(event,ui,instance){var t=$(ui.helper),o=instance.options;if(t.css('opacity')){o._opacity=t.css('opacity');}
t.css('opacity',o.opacity);},stop:function(event,ui,instance){var o=instance.options;if(o._opacity){$(ui.helper).css('opacity',o._opacity);}}});$.ui.plugin.add('draggable','scroll',{start:function(event,ui,i){if(!i.scrollParentNotHidden){i.scrollParentNotHidden=i.helper.scrollParent(false);}
if(i.scrollParentNotHidden[0]!==i.document[0]&&i.scrollParentNotHidden[0].tagName!=='HTML'){i.overflowOffset=i.scrollParentNotHidden.offset();}},drag:function(event,ui,i){var o=i.options,scrolled=false,scrollParent=i.scrollParentNotHidden[0],document=i.document[0];if(scrollParent!==document&&scrollParent.tagName!=='HTML'){if(!o.axis||o.axis!=='x'){if((i.overflowOffset.top+scrollParent.offsetHeight)-event.pageY<o.scrollSensitivity){scrollParent.scrollTop=scrolled=scrollParent.scrollTop+o.scrollSpeed;}else if(event.pageY-i.overflowOffset.top<o.scrollSensitivity){scrollParent.scrollTop=scrolled=scrollParent.scrollTop-o.scrollSpeed;}}
if(!o.axis||o.axis!=='y'){if((i.overflowOffset.left+scrollParent.offsetWidth)-event.pageX<o.scrollSensitivity){scrollParent.scrollLeft=scrolled=scrollParent.scrollLeft+o.scrollSpeed;}else if(event.pageX-i.overflowOffset.left<o.scrollSensitivity){scrollParent.scrollLeft=scrolled=scrollParent.scrollLeft-o.scrollSpeed;}}}else{if(!o.axis||o.axis!=='x'){if(event.pageY-$(document).scrollTop()<o.scrollSensitivity){scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed);}else if($(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity){scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed);}}
if(!o.axis||o.axis!=='y'){if(event.pageX-$(document).scrollLeft()<o.scrollSensitivity){scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed);}else if($(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity){scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed);}}}
if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(i,event);}}});$.ui.plugin.add('draggable','snap',{start:function(event,ui,i){var o=i.options;i.snapElements=[];$(o.snap.constructor!==String?(o.snap.items||':data(ui-draggable)'):o.snap).each(function(){var $t=$(this),$o=$t.offset();if(this!==i.element[0]){i.snapElements.push({item:this,width:$t.outerWidth(),height:$t.outerHeight(),top:$o.top,left:$o.left});}});},drag:function(event,ui,inst){var ts,bs,ls,rs,l,r,t,b,i,first,o=inst.options,d=o.snapTolerance,x1=ui.offset.left,x2=x1+inst.helperProportions.width,y1=ui.offset.top,y2=y1+inst.helperProportions.height;for(i=inst.snapElements.length-1;i>=0;i--){l=inst.snapElements[i].left-inst.margins.left;r=l+inst.snapElements[i].width;t=inst.snapElements[i].top-inst.margins.top;b=t+inst.snapElements[i].height;if(x2<l-d||x1>r+d||y2<t-d||y1>b+d||!$.contains(inst.snapElements[i].item.ownerDocument,inst.snapElements[i].item)){if(inst.snapElements[i].snapping){if(inst.options.snap.release){inst.options.snap.release.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item}));}}
inst.snapElements[i].snapping=false;continue;}
if(o.snapMode!=='inner'){ts=Math.abs(t-y2)<=d;bs=Math.abs(b-y1)<=d;ls=Math.abs(l-x2)<=d;rs=Math.abs(r-x1)<=d;if(ts){ui.position.top=inst._convertPositionTo('relative',{top:t-inst.helperProportions.height,left:0}).top;}
if(bs){ui.position.top=inst._convertPositionTo('relative',{top:b,left:0}).top;}
if(ls){ui.position.left=inst._convertPositionTo('relative',{top:0,left:l-inst.helperProportions.width}).left;}
if(rs){ui.position.left=inst._convertPositionTo('relative',{top:0,left:r}).left;}}
first=(ts||bs||ls||rs);if(o.snapMode!=='outer'){ts=Math.abs(t-y1)<=d;bs=Math.abs(b-y2)<=d;ls=Math.abs(l-x1)<=d;rs=Math.abs(r-x2)<=d;if(ts){ui.position.top=inst._convertPositionTo('relative',{top:t,left:0}).top;}
if(bs){ui.position.top=inst._convertPositionTo('relative',{top:b-inst.helperProportions.height,left:0}).top;}
if(ls){ui.position.left=inst._convertPositionTo('relative',{top:0,left:l}).left;}
if(rs){ui.position.left=inst._convertPositionTo('relative',{top:0,left:r-inst.helperProportions.width}).left;}}
if(!inst.snapElements[i].snapping&&(ts||bs||ls||rs||first)){if(inst.options.snap.snap){inst.options.snap.snap.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item}));}}
inst.snapElements[i].snapping=(ts||bs||ls||rs||first);}}});$.ui.plugin.add('draggable','stack',{start:function(event,ui,instance){var min,o=instance.options,group=$.makeArray($(o.stack)).sort(function(a,b){return(parseInt($(a).css('zIndex'),10)||0)-
(parseInt($(b).css('zIndex'),10)||0);});if(!group.length){return;}
min=parseInt($(group[0]).css('zIndex'),10)||0;$(group).each(function(i){$(this).css('zIndex',min+i);});this.css('zIndex',(min+group.length));}});$.ui.plugin.add('draggable','zIndex',{start:function(event,ui,instance){var t=$(ui.helper),o=instance.options;if(t.css('zIndex')){o._zIndex=t.css('zIndex');}
t.css('zIndex',o.zIndex);},stop:function(event,ui,instance){var o=instance.options;if(o._zIndex){$(ui.helper).css('zIndex',o._zIndex);}}});var widgetsDraggable=$.ui.draggable;
/*!
 * jQuery UI Resizable 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
$.widget('ui.resizable',$.ui.mouse,{version:'1.13.2',widgetEventPrefix:'resize',options:{alsoResize:false,animate:false,animateDuration:'slow',animateEasing:'swing',aspectRatio:false,autoHide:false,classes:{'ui-resizable-se':'ui-icon ui-icon-gripsmall-diagonal-se'},containment:false,ghost:false,grid:false,handles:'e,s,se',helper:false,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(value){return parseFloat(value)||0;},_isNumber:function(value){return!isNaN(parseFloat(value));},_hasScroll:function(el,a){if($(el).css('overflow')==='hidden'){return false;}
var scroll=(a&&a==='left')?'scrollLeft':'scrollTop',has=false;if(el[scroll]>0){return true;}
try{el[scroll]=1;has=(el[scroll]>0);el[scroll]=0;}catch(e){}
return has;},_create:function(){var margins,o=this.options,that=this;this._addClass('ui-resizable');$.extend(this,{_aspectRatio:!!(o.aspectRatio),aspectRatio:o.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:o.helper||o.ghost||o.animate?o.helper||'ui-resizable-helper':null});if(this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)){this.element.wrap($('<div class=\'ui-wrapper\'></div>').css({overflow:'hidden',position:this.element.css('position'),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css('top'),left:this.element.css('left')}));this.element=this.element.parent().data('ui-resizable',this.element.resizable('instance'));this.elementIsWrapper=true;margins={marginTop:this.originalElement.css('marginTop'),marginRight:this.originalElement.css('marginRight'),marginBottom:this.originalElement.css('marginBottom'),marginLeft:this.originalElement.css('marginLeft')};this.element.css(margins);this.originalElement.css('margin',0);this.originalResizeStyle=this.originalElement.css('resize');this.originalElement.css('resize','none');this._proportionallyResizeElements.push(this.originalElement.css({position:'static',zoom:1,display:'block'}));this.originalElement.css(margins);this._proportionallyResize();}
this._setupHandles();if(o.autoHide){$(this.element).on('mouseenter',function(){if(o.disabled){return;}
that._removeClass('ui-resizable-autohide');that._handles.show();}).on('mouseleave',function(){if(o.disabled){return;}
if(!that.resizing){that._addClass('ui-resizable-autohide');that._handles.hide();}});}
this._mouseInit();},_destroy:function(){this._mouseDestroy();this._addedHandles.remove();var wrapper,_destroy=function(exp){$(exp).removeData('resizable').removeData('ui-resizable').off('.resizable');};if(this.elementIsWrapper){_destroy(this.element);wrapper=this.element;this.originalElement.css({position:wrapper.css('position'),width:wrapper.outerWidth(),height:wrapper.outerHeight(),top:wrapper.css('top'),left:wrapper.css('left')}).insertAfter(wrapper);wrapper.remove();}
this.originalElement.css('resize',this.originalResizeStyle);_destroy(this.originalElement);return this;},_setOption:function(key,value){this._super(key,value);switch(key){case'handles':this._removeHandles();this._setupHandles();break;case'aspectRatio':this._aspectRatio=!!value;break;default:break;}},_setupHandles:function(){var o=this.options,handle,i,n,hname,axis,that=this;this.handles=o.handles||(!$('.ui-resizable-handle',this.element).length?'e,s,se':{n:'.ui-resizable-n',e:'.ui-resizable-e',s:'.ui-resizable-s',w:'.ui-resizable-w',se:'.ui-resizable-se',sw:'.ui-resizable-sw',ne:'.ui-resizable-ne',nw:'.ui-resizable-nw'});this._handles=$();this._addedHandles=$();if(this.handles.constructor===String){if(this.handles==='all'){this.handles='n,e,s,w,se,sw,ne,nw';}
n=this.handles.split(',');this.handles={};for(i=0;i<n.length;i++){handle=String.prototype.trim.call(n[i]);hname='ui-resizable-'+handle;axis=$('<div>');this._addClass(axis,'ui-resizable-handle '+hname);axis.css({zIndex:o.zIndex});this.handles[handle]='.ui-resizable-'+handle;if(!this.element.children(this.handles[handle]).length){this.element.append(axis);this._addedHandles=this._addedHandles.add(axis);}}}
this._renderAxis=function(target){var i,axis,padPos,padWrapper;target=target||this.element;for(i in this.handles){if(this.handles[i].constructor===String){this.handles[i]=this.element.children(this.handles[i]).first().show();}else if(this.handles[i].jquery||this.handles[i].nodeType){this.handles[i]=$(this.handles[i]);this._on(this.handles[i],{'mousedown':that._mouseDown});}
if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)){axis=$(this.handles[i],this.element);padWrapper=/sw|ne|nw|se|n|s/.test(i)?axis.outerHeight():axis.outerWidth();padPos=['padding',/ne|nw|n/.test(i)?'Top':/se|sw|s/.test(i)?'Bottom':/^e$/.test(i)?'Right':'Left'].join('');target.css(padPos,padWrapper);this._proportionallyResize();}
this._handles=this._handles.add(this.handles[i]);}};this._renderAxis(this.element);this._handles=this._handles.add(this.element.find('.ui-resizable-handle'));this._handles.disableSelection();this._handles.on('mouseover',function(){if(!that.resizing){if(this.className){axis=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);}
that.axis=axis&&axis[1]?axis[1]:'se';}});if(o.autoHide){this._handles.hide();this._addClass('ui-resizable-autohide');}},_removeHandles:function(){this._addedHandles.remove();},_mouseCapture:function(event){var i,handle,capture=false;for(i in this.handles){handle=$(this.handles[i])[0];if(handle===event.target||$.contains(handle,event.target)){capture=true;}}
return!this.options.disabled&&capture;},_mouseStart:function(event){var curleft,curtop,cursor,o=this.options,el=this.element;this.resizing=true;this._renderProxy();curleft=this._num(this.helper.css('left'));curtop=this._num(this.helper.css('top'));if(o.containment){curleft+=$(o.containment).scrollLeft()||0;curtop+=$(o.containment).scrollTop()||0;}
this.offset=this.helper.offset();this.position={left:curleft,top:curtop};this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:el.width(),height:el.height()};this.originalSize=this._helper?{width:el.outerWidth(),height:el.outerHeight()}:{width:el.width(),height:el.height()};this.sizeDiff={width:el.outerWidth()-el.width(),height:el.outerHeight()-el.height()};this.originalPosition={left:curleft,top:curtop};this.originalMousePosition={left:event.pageX,top:event.pageY};this.aspectRatio=(typeof o.aspectRatio==='number')?o.aspectRatio:((this.originalSize.width/this.originalSize.height)||1);cursor=$('.ui-resizable-'+this.axis).css('cursor');$('body').css('cursor',cursor==='auto'?this.axis+'-resize':cursor);this._addClass('ui-resizable-resizing');this._propagate('start',event);return true;},_mouseDrag:function(event){var data,props,smp=this.originalMousePosition,a=this.axis,dx=(event.pageX-smp.left)||0,dy=(event.pageY-smp.top)||0,trigger=this._change[a];this._updatePrevProperties();if(!trigger){return false;}
data=trigger.apply(this,[event,dx,dy]);this._updateVirtualBoundaries(event.shiftKey);if(this._aspectRatio||event.shiftKey){data=this._updateRatio(data,event);}
data=this._respectSize(data,event);this._updateCache(data);this._propagate('resize',event);props=this._applyChanges();if(!this._helper&&this._proportionallyResizeElements.length){this._proportionallyResize();}
if(!$.isEmptyObject(props)){this._updatePrevProperties();this._trigger('resize',event,this.ui());this._applyChanges();}
return false;},_mouseStop:function(event){this.resizing=false;var pr,ista,soffseth,soffsetw,s,left,top,o=this.options,that=this;if(this._helper){pr=this._proportionallyResizeElements;ista=pr.length&&(/textarea/i).test(pr[0].nodeName);soffseth=ista&&this._hasScroll(pr[0],'left')?0:that.sizeDiff.height;soffsetw=ista?0:that.sizeDiff.width;s={width:(that.helper.width()-soffsetw),height:(that.helper.height()-soffseth)};left=(parseFloat(that.element.css('left'))+
(that.position.left-that.originalPosition.left))||null;top=(parseFloat(that.element.css('top'))+
(that.position.top-that.originalPosition.top))||null;if(!o.animate){this.element.css($.extend(s,{top:top,left:left}));}
that.helper.height(that.size.height);that.helper.width(that.size.width);if(this._helper&&!o.animate){this._proportionallyResize();}}
$('body').css('cursor','auto');this._removeClass('ui-resizable-resizing');this._propagate('stop',event);if(this._helper){this.helper.remove();}
return false;},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left};this.prevSize={width:this.size.width,height:this.size.height};},_applyChanges:function(){var props={};if(this.position.top!==this.prevPosition.top){props.top=this.position.top+'px';}
if(this.position.left!==this.prevPosition.left){props.left=this.position.left+'px';}
if(this.size.width!==this.prevSize.width){props.width=this.size.width+'px';}
if(this.size.height!==this.prevSize.height){props.height=this.size.height+'px';}
this.helper.css(props);return props;},_updateVirtualBoundaries:function(forceAspectRatio){var pMinWidth,pMaxWidth,pMinHeight,pMaxHeight,b,o=this.options;b={minWidth:this._isNumber(o.minWidth)?o.minWidth:0,maxWidth:this._isNumber(o.maxWidth)?o.maxWidth:Infinity,minHeight:this._isNumber(o.minHeight)?o.minHeight:0,maxHeight:this._isNumber(o.maxHeight)?o.maxHeight:Infinity};if(this._aspectRatio||forceAspectRatio){pMinWidth=b.minHeight*this.aspectRatio;pMinHeight=b.minWidth/this.aspectRatio;pMaxWidth=b.maxHeight*this.aspectRatio;pMaxHeight=b.maxWidth/this.aspectRatio;if(pMinWidth>b.minWidth){b.minWidth=pMinWidth;}
if(pMinHeight>b.minHeight){b.minHeight=pMinHeight;}
if(pMaxWidth<b.maxWidth){b.maxWidth=pMaxWidth;}
if(pMaxHeight<b.maxHeight){b.maxHeight=pMaxHeight;}}
this._vBoundaries=b;},_updateCache:function(data){this.offset=this.helper.offset();if(this._isNumber(data.left)){this.position.left=data.left;}
if(this._isNumber(data.top)){this.position.top=data.top;}
if(this._isNumber(data.height)){this.size.height=data.height;}
if(this._isNumber(data.width)){this.size.width=data.width;}},_updateRatio:function(data){var cpos=this.position,csize=this.size,a=this.axis;if(this._isNumber(data.height)){data.width=(data.height*this.aspectRatio);}else if(this._isNumber(data.width)){data.height=(data.width/this.aspectRatio);}
if(a==='sw'){data.left=cpos.left+(csize.width-data.width);data.top=null;}
if(a==='nw'){data.top=cpos.top+(csize.height-data.height);data.left=cpos.left+(csize.width-data.width);}
return data;},_respectSize:function(data){var o=this._vBoundaries,a=this.axis,ismaxw=this._isNumber(data.width)&&o.maxWidth&&(o.maxWidth<data.width),ismaxh=this._isNumber(data.height)&&o.maxHeight&&(o.maxHeight<data.height),isminw=this._isNumber(data.width)&&o.minWidth&&(o.minWidth>data.width),isminh=this._isNumber(data.height)&&o.minHeight&&(o.minHeight>data.height),dw=this.originalPosition.left+this.originalSize.width,dh=this.originalPosition.top+this.originalSize.height,cw=/sw|nw|w/.test(a),ch=/nw|ne|n/.test(a);if(isminw){data.width=o.minWidth;}
if(isminh){data.height=o.minHeight;}
if(ismaxw){data.width=o.maxWidth;}
if(ismaxh){data.height=o.maxHeight;}
if(isminw&&cw){data.left=dw-o.minWidth;}
if(ismaxw&&cw){data.left=dw-o.maxWidth;}
if(isminh&&ch){data.top=dh-o.minHeight;}
if(ismaxh&&ch){data.top=dh-o.maxHeight;}
if(!data.width&&!data.height&&!data.left&&data.top){data.top=null;}else if(!data.width&&!data.height&&!data.top&&data.left){data.left=null;}
return data;},_getPaddingPlusBorderDimensions:function(element){var i=0,widths=[],borders=[element.css('borderTopWidth'),element.css('borderRightWidth'),element.css('borderBottomWidth'),element.css('borderLeftWidth')],paddings=[element.css('paddingTop'),element.css('paddingRight'),element.css('paddingBottom'),element.css('paddingLeft')];for(;i<4;i++){widths[i]=(parseFloat(borders[i])||0);widths[i]+=(parseFloat(paddings[i])||0);}
return{height:widths[0]+widths[2],width:widths[1]+widths[3]};},_proportionallyResize:function(){if(!this._proportionallyResizeElements.length){return;}
var prel,i=0,element=this.helper||this.element;for(;i<this._proportionallyResizeElements.length;i++){prel=this._proportionallyResizeElements[i];if(!this.outerDimensions){this.outerDimensions=this._getPaddingPlusBorderDimensions(prel);}
prel.css({height:(element.height()-this.outerDimensions.height)||0,width:(element.width()-this.outerDimensions.width)||0});}},_renderProxy:function(){var el=this.element,o=this.options;this.elementOffset=el.offset();if(this._helper){this.helper=this.helper||$('<div></div>').css({overflow:'hidden'});this._addClass(this.helper,this._helper);this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:'absolute',left:this.elementOffset.left+'px',top:this.elementOffset.top+'px',zIndex:++o.zIndex});this.helper.appendTo('body').disableSelection();}else{this.helper=this.element;}},_change:{e:function(event,dx){return{width:this.originalSize.width+dx};},w:function(event,dx){var cs=this.originalSize,sp=this.originalPosition;return{left:sp.left+dx,width:cs.width-dx};},n:function(event,dx,dy){var cs=this.originalSize,sp=this.originalPosition;return{top:sp.top+dy,height:cs.height-dy};},s:function(event,dx,dy){return{height:this.originalSize.height+dy};},se:function(event,dx,dy){return $.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[event,dx,dy]));},sw:function(event,dx,dy){return $.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[event,dx,dy]));},ne:function(event,dx,dy){return $.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[event,dx,dy]));},nw:function(event,dx,dy){return $.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[event,dx,dy]));}},_propagate:function(n,event){$.ui.plugin.call(this,n,[event,this.ui()]);if(n!=='resize'){this._trigger(n,event,this.ui());}},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition};}});$.ui.plugin.add('resizable','animate',{stop:function(event){var that=$(this).resizable('instance'),o=that.options,pr=that._proportionallyResizeElements,ista=pr.length&&(/textarea/i).test(pr[0].nodeName),soffseth=ista&&that._hasScroll(pr[0],'left')?0:that.sizeDiff.height,soffsetw=ista?0:that.sizeDiff.width,style={width:(that.size.width-soffsetw),height:(that.size.height-soffseth)},left=(parseFloat(that.element.css('left'))+
(that.position.left-that.originalPosition.left))||null,top=(parseFloat(that.element.css('top'))+
(that.position.top-that.originalPosition.top))||null;that.element.animate($.extend(style,top&&left?{top:top,left:left}:{}),{duration:o.animateDuration,easing:o.animateEasing,step:function(){var data={width:parseFloat(that.element.css('width')),height:parseFloat(that.element.css('height')),top:parseFloat(that.element.css('top')),left:parseFloat(that.element.css('left'))};if(pr&&pr.length){$(pr[0]).css({width:data.width,height:data.height});}
that._updateCache(data);that._propagate('resize',event);}});}});$.ui.plugin.add('resizable','containment',{start:function(){var element,p,co,ch,cw,width,height,that=$(this).resizable('instance'),o=that.options,el=that.element,oc=o.containment,ce=(oc instanceof $)?oc.get(0):(/parent/.test(oc))?el.parent().get(0):oc;if(!ce){return;}
that.containerElement=$(ce);if(/document/.test(oc)||oc===document){that.containerOffset={left:0,top:0};that.containerPosition={left:0,top:0};that.parentData={element:$(document),left:0,top:0,width:$(document).width(),height:$(document).height()||document.body.parentNode.scrollHeight};}else{element=$(ce);p=[];$(['Top','Right','Left','Bottom']).each(function(i,name){p[i]=that._num(element.css('padding'+name));});that.containerOffset=element.offset();that.containerPosition=element.position();that.containerSize={height:(element.innerHeight()-p[3]),width:(element.innerWidth()-p[1])};co=that.containerOffset;ch=that.containerSize.height;cw=that.containerSize.width;width=(that._hasScroll(ce,'left')?ce.scrollWidth:cw);height=(that._hasScroll(ce)?ce.scrollHeight:ch);that.parentData={element:ce,left:co.left,top:co.top,width:width,height:height};}},resize:function(event){var woset,hoset,isParent,isOffsetRelative,that=$(this).resizable('instance'),o=that.options,co=that.containerOffset,cp=that.position,pRatio=that._aspectRatio||event.shiftKey,cop={top:0,left:0},ce=that.containerElement,continueResize=true;if(ce[0]!==document&&(/static/).test(ce.css('position'))){cop=co;}
if(cp.left<(that._helper?co.left:0)){that.size.width=that.size.width+
(that._helper?(that.position.left-co.left):(that.position.left-cop.left));if(pRatio){that.size.height=that.size.width/that.aspectRatio;continueResize=false;}
that.position.left=o.helper?co.left:0;}
if(cp.top<(that._helper?co.top:0)){that.size.height=that.size.height+
(that._helper?(that.position.top-co.top):that.position.top);if(pRatio){that.size.width=that.size.height*that.aspectRatio;continueResize=false;}
that.position.top=that._helper?co.top:0;}
isParent=that.containerElement.get(0)===that.element.parent().get(0);isOffsetRelative=/relative|absolute/.test(that.containerElement.css('position'));if(isParent&&isOffsetRelative){that.offset.left=that.parentData.left+that.position.left;that.offset.top=that.parentData.top+that.position.top;}else{that.offset.left=that.element.offset().left;that.offset.top=that.element.offset().top;}
woset=Math.abs(that.sizeDiff.width+
(that._helper?that.offset.left-cop.left:(that.offset.left-co.left)));hoset=Math.abs(that.sizeDiff.height+
(that._helper?that.offset.top-cop.top:(that.offset.top-co.top)));if(woset+that.size.width>=that.parentData.width){that.size.width=that.parentData.width-woset;if(pRatio){that.size.height=that.size.width/that.aspectRatio;continueResize=false;}}
if(hoset+that.size.height>=that.parentData.height){that.size.height=that.parentData.height-hoset;if(pRatio){that.size.width=that.size.height*that.aspectRatio;continueResize=false;}}
if(!continueResize){that.position.left=that.prevPosition.left;that.position.top=that.prevPosition.top;that.size.width=that.prevSize.width;that.size.height=that.prevSize.height;}},stop:function(){var that=$(this).resizable('instance'),o=that.options,co=that.containerOffset,cop=that.containerPosition,ce=that.containerElement,helper=$(that.helper),ho=helper.offset(),w=helper.outerWidth()-that.sizeDiff.width,h=helper.outerHeight()-that.sizeDiff.height;if(that._helper&&!o.animate&&(/relative/).test(ce.css('position'))){$(this).css({left:ho.left-cop.left-co.left,width:w,height:h});}
if(that._helper&&!o.animate&&(/static/).test(ce.css('position'))){$(this).css({left:ho.left-cop.left-co.left,width:w,height:h});}}});$.ui.plugin.add('resizable','alsoResize',{start:function(){var that=$(this).resizable('instance'),o=that.options;$(o.alsoResize).each(function(){var el=$(this);el.data('ui-resizable-alsoresize',{width:parseFloat(el.width()),height:parseFloat(el.height()),left:parseFloat(el.css('left')),top:parseFloat(el.css('top'))});});},resize:function(event,ui){var that=$(this).resizable('instance'),o=that.options,os=that.originalSize,op=that.originalPosition,delta={height:(that.size.height-os.height)||0,width:(that.size.width-os.width)||0,top:(that.position.top-op.top)||0,left:(that.position.left-op.left)||0};$(o.alsoResize).each(function(){var el=$(this),start=$(this).data('ui-resizable-alsoresize'),style={},css=el.parents(ui.originalElement[0]).length?['width','height']:['width','height','top','left'];$.each(css,function(i,prop){var sum=(start[prop]||0)+(delta[prop]||0);if(sum&&sum>=0){style[prop]=sum||null;}});el.css(style);});},stop:function(){$(this).removeData('ui-resizable-alsoresize');}});$.ui.plugin.add('resizable','ghost',{start:function(){var that=$(this).resizable('instance'),cs=that.size;that.ghost=that.originalElement.clone();that.ghost.css({opacity:0.25,display:'block',position:'relative',height:cs.height,width:cs.width,margin:0,left:0,top:0});that._addClass(that.ghost,'ui-resizable-ghost');if($.uiBackCompat!==false&&typeof that.options.ghost==='string'){that.ghost.addClass(this.options.ghost);}
that.ghost.appendTo(that.helper);},resize:function(){var that=$(this).resizable('instance');if(that.ghost){that.ghost.css({position:'relative',height:that.size.height,width:that.size.width});}},stop:function(){var that=$(this).resizable('instance');if(that.ghost&&that.helper){that.helper.get(0).removeChild(that.ghost.get(0));}}});$.ui.plugin.add('resizable','grid',{resize:function(){var outerDimensions,that=$(this).resizable('instance'),o=that.options,cs=that.size,os=that.originalSize,op=that.originalPosition,a=that.axis,grid=typeof o.grid==='number'?[o.grid,o.grid]:o.grid,gridX=(grid[0]||1),gridY=(grid[1]||1),ox=Math.round((cs.width-os.width)/gridX)*gridX,oy=Math.round((cs.height-os.height)/gridY)*gridY,newWidth=os.width+ox,newHeight=os.height+oy,isMaxWidth=o.maxWidth&&(o.maxWidth<newWidth),isMaxHeight=o.maxHeight&&(o.maxHeight<newHeight),isMinWidth=o.minWidth&&(o.minWidth>newWidth),isMinHeight=o.minHeight&&(o.minHeight>newHeight);o.grid=grid;if(isMinWidth){newWidth+=gridX;}
if(isMinHeight){newHeight+=gridY;}
if(isMaxWidth){newWidth-=gridX;}
if(isMaxHeight){newHeight-=gridY;}
if(/^(se|s|e)$/.test(a)){that.size.width=newWidth;that.size.height=newHeight;}else if(/^(ne)$/.test(a)){that.size.width=newWidth;that.size.height=newHeight;that.position.top=op.top-oy;}else if(/^(sw)$/.test(a)){that.size.width=newWidth;that.size.height=newHeight;that.position.left=op.left-ox;}else{if(newHeight-gridY<=0||newWidth-gridX<=0){outerDimensions=that._getPaddingPlusBorderDimensions(this);}
if(newHeight-gridY>0){that.size.height=newHeight;that.position.top=op.top-oy;}else{newHeight=gridY-outerDimensions.height;that.size.height=newHeight;that.position.top=op.top+os.height-newHeight;}
if(newWidth-gridX>0){that.size.width=newWidth;that.position.left=op.left-ox;}else{newWidth=gridX-outerDimensions.width;that.size.width=newWidth;that.position.left=op.left+os.width-newWidth;}}}});var widgetsResizable=$.ui.resizable;
/*!
 * jQuery UI Dialog 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
$.widget('ui.dialog',{version:'1.13.2',options:{appendTo:'body',autoOpen:true,buttons:[],classes:{'ui-dialog':'ui-corner-all','ui-dialog-titlebar':'ui-corner-all'},closeOnEscape:true,closeText:'Close',draggable:true,hide:null,height:'auto',maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:false,position:{my:'center',at:'center',of:window,collision:'fit',using:function(pos){var topOffset=$(this).css(pos).offset().top;if(topOffset<0){$(this).css('top',pos.top-topOffset);}}},resizable:true,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:true,height:true,maxHeight:true,maxWidth:true,minHeight:true,minWidth:true,width:true},resizableRelatedOptions:{maxHeight:true,maxWidth:true,minHeight:true,minWidth:true},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height};this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)};this.originalTitle=this.element.attr('title');if(this.options.title==null&&this.originalTitle!=null){this.options.title=this.originalTitle;}
if(this.options.disabled){this.options.disabled=false;}
this._createWrapper();this.element.show().removeAttr('title').appendTo(this.uiDialog);this._addClass('ui-dialog-content','ui-widget-content');this._createTitlebar();this._createButtonPane();if(this.options.draggable&&$.fn.draggable){this._makeDraggable();}
if(this.options.resizable&&$.fn.resizable){this._makeResizable();}
this._isOpen=false;this._trackFocus();},_init:function(){if(this.options.autoOpen){this.open();}},_appendTo:function(){var element=this.options.appendTo;if(element&&(element.jquery||element.nodeType)){return $(element);}
return this.document.find(element||'body').eq(0);},_destroy:function(){var next,originalPosition=this.originalPosition;this._untrackInstance();this._destroyOverlay();this.element.removeUniqueId().css(this.originalCss).detach();this.uiDialog.remove();if(this.originalTitle){this.element.attr('title',this.originalTitle);}
next=originalPosition.parent.children().eq(originalPosition.index);if(next.length&&next[0]!==this.element[0]){next.before(this.element);}else{originalPosition.parent.append(this.element);}},widget:function(){return this.uiDialog;},disable:$.noop,enable:$.noop,close:function(event){var that=this;if(!this._isOpen||this._trigger('beforeClose',event)===false){return;}
this._isOpen=false;this._focusedElement=null;this._destroyOverlay();this._untrackInstance();if(!this.opener.filter(':focusable').trigger('focus').length){$.ui.safeBlur($.ui.safeActiveElement(this.document[0]));}
this._hide(this.uiDialog,this.options.hide,function(){that._trigger('close',event);});},isOpen:function(){return this._isOpen;},moveToTop:function(){this._moveToTop();},_moveToTop:function(event,silent){var moved=false,zIndices=this.uiDialog.siblings('.ui-front:visible').map(function(){return+$(this).css('z-index');}).get(),zIndexMax=Math.max.apply(null,zIndices);if(zIndexMax>=+this.uiDialog.css('z-index')){this.uiDialog.css('z-index',zIndexMax+1);moved=true;}
if(moved&&!silent){this._trigger('focus',event);}
return moved;},open:function(){var that=this;if(this._isOpen){if(this._moveToTop()){this._focusTabbable();}
return;}
this._isOpen=true;this.opener=$($.ui.safeActiveElement(this.document[0]));this._size();this._position();this._createOverlay();this._moveToTop(null,true);if(this.overlay){this.overlay.css('z-index',this.uiDialog.css('z-index')-1);}
this._show(this.uiDialog,this.options.show,function(){that._focusTabbable();that._trigger('focus');});this._makeFocusTarget();this._trigger('open');},_focusTabbable:function(){var hasFocus=this._focusedElement;if(!hasFocus){hasFocus=this.element.find('[autofocus]');}
if(!hasFocus.length){hasFocus=this.element.find(':tabbable');}
if(!hasFocus.length){hasFocus=this.uiDialogButtonPane.find(':tabbable');}
if(!hasFocus.length){hasFocus=this.uiDialogTitlebarClose.filter(':tabbable');}
if(!hasFocus.length){hasFocus=this.uiDialog;}
hasFocus.eq(0).trigger('focus');},_restoreTabbableFocus:function(){var activeElement=$.ui.safeActiveElement(this.document[0]),isActive=this.uiDialog[0]===activeElement||$.contains(this.uiDialog[0],activeElement);if(!isActive){this._focusTabbable();}},_keepFocus:function(event){event.preventDefault();this._restoreTabbableFocus();this._delay(this._restoreTabbableFocus);},_createWrapper:function(){this.uiDialog=$('<div>').hide().attr({tabIndex:-1,role:'dialog'}).appendTo(this._appendTo());this._addClass(this.uiDialog,'ui-dialog','ui-widget ui-widget-content ui-front');this._on(this.uiDialog,{keydown:function(event){if(this.options.closeOnEscape&&!event.isDefaultPrevented()&&event.keyCode&&event.keyCode===$.ui.keyCode.ESCAPE){event.preventDefault();this.close(event);return;}
if(event.keyCode!==$.ui.keyCode.TAB||event.isDefaultPrevented()){return;}
var tabbables=this.uiDialog.find(':tabbable'),first=tabbables.first(),last=tabbables.last();if((event.target===last[0]||event.target===this.uiDialog[0])&&!event.shiftKey){this._delay(function(){first.trigger('focus');});event.preventDefault();}else if((event.target===first[0]||event.target===this.uiDialog[0])&&event.shiftKey){this._delay(function(){last.trigger('focus');});event.preventDefault();}},mousedown:function(event){if(this._moveToTop(event)){this._focusTabbable();}}});if(!this.element.find('[aria-describedby]').length){this.uiDialog.attr({'aria-describedby':this.element.uniqueId().attr('id')});}},_createTitlebar:function(){var uiDialogTitle;this.uiDialogTitlebar=$('<div>');this._addClass(this.uiDialogTitlebar,'ui-dialog-titlebar','ui-widget-header ui-helper-clearfix');this._on(this.uiDialogTitlebar,{mousedown:function(event){if(!$(event.target).closest('.ui-dialog-titlebar-close')){this.uiDialog.trigger('focus');}}});this.uiDialogTitlebarClose=$('<button type=\'button\'></button>').button({label:$('<a>').text(this.options.closeText).html(),icon:'ui-icon-closethick',showLabel:false}).appendTo(this.uiDialogTitlebar);this._addClass(this.uiDialogTitlebarClose,'ui-dialog-titlebar-close');this._on(this.uiDialogTitlebarClose,{click:function(event){event.preventDefault();this.close(event);}});uiDialogTitle=$('<span>').uniqueId().prependTo(this.uiDialogTitlebar);this._addClass(uiDialogTitle,'ui-dialog-title');this._title(uiDialogTitle);this.uiDialogTitlebar.prependTo(this.uiDialog);this.uiDialog.attr({'aria-labelledby':uiDialogTitle.attr('id')});},_title:function(title){if(this.options.title){title.text(this.options.title);}else{title.html('&#160;');}},_createButtonPane:function(){this.uiDialogButtonPane=$('<div>');this._addClass(this.uiDialogButtonPane,'ui-dialog-buttonpane','ui-widget-content ui-helper-clearfix');this.uiButtonSet=$('<div>').appendTo(this.uiDialogButtonPane);this._addClass(this.uiButtonSet,'ui-dialog-buttonset');this._createButtons();},_createButtons:function(){var that=this,buttons=this.options.buttons;this.uiDialogButtonPane.remove();this.uiButtonSet.empty();if($.isEmptyObject(buttons)||(Array.isArray(buttons)&&!buttons.length)){this._removeClass(this.uiDialog,'ui-dialog-buttons');return;}
$.each(buttons,function(name,props){var click,buttonOptions;props=typeof props==='function'?{click:props,text:name}:props;props=$.extend({type:'button'},props);click=props.click;buttonOptions={icon:props.icon,iconPosition:props.iconPosition,showLabel:props.showLabel,icons:props.icons,text:props.text};delete props.click;delete props.icon;delete props.iconPosition;delete props.showLabel;delete props.icons;if(typeof props.text==='boolean'){delete props.text;}
$('<button></button>',props).button(buttonOptions).appendTo(that.uiButtonSet).on('click',function(){click.apply(that.element[0],arguments);});});this._addClass(this.uiDialog,'ui-dialog-buttons');this.uiDialogButtonPane.appendTo(this.uiDialog);},_makeDraggable:function(){var that=this,options=this.options;function filteredUi(ui){return{position:ui.position,offset:ui.offset};}
this.uiDialog.draggable({cancel:'.ui-dialog-content, .ui-dialog-titlebar-close',handle:'.ui-dialog-titlebar',containment:'document',start:function(event,ui){that._addClass($(this),'ui-dialog-dragging');that._blockFrames();that._trigger('dragStart',event,filteredUi(ui));},drag:function(event,ui){that._trigger('drag',event,filteredUi(ui));},stop:function(event,ui){var left=ui.offset.left-that.document.scrollLeft(),top=ui.offset.top-that.document.scrollTop();options.position={my:'left top',at:'left'+(left>=0?'+':'')+left+' '+'top'+(top>=0?'+':'')+top,of:that.window};that._removeClass($(this),'ui-dialog-dragging');that._unblockFrames();that._trigger('dragStop',event,filteredUi(ui));}});},_makeResizable:function(){var that=this,options=this.options,handles=options.resizable,position=this.uiDialog.css('position'),resizeHandles=typeof handles==='string'?handles:'n,e,s,w,se,sw,ne,nw';function filteredUi(ui){return{originalPosition:ui.originalPosition,originalSize:ui.originalSize,position:ui.position,size:ui.size};}
this.uiDialog.resizable({cancel:'.ui-dialog-content',containment:'document',alsoResize:this.element,maxWidth:options.maxWidth,maxHeight:options.maxHeight,minWidth:options.minWidth,minHeight:this._minHeight(),handles:resizeHandles,start:function(event,ui){that._addClass($(this),'ui-dialog-resizing');that._blockFrames();that._trigger('resizeStart',event,filteredUi(ui));},resize:function(event,ui){that._trigger('resize',event,filteredUi(ui));},stop:function(event,ui){var offset=that.uiDialog.offset(),left=offset.left-that.document.scrollLeft(),top=offset.top-that.document.scrollTop();options.height=that.uiDialog.height();options.width=that.uiDialog.width();options.position={my:'left top',at:'left'+(left>=0?'+':'')+left+' '+'top'+(top>=0?'+':'')+top,of:that.window};that._removeClass($(this),'ui-dialog-resizing');that._unblockFrames();that._trigger('resizeStop',event,filteredUi(ui));}}).css('position',position);},_trackFocus:function(){this._on(this.widget(),{focusin:function(event){this._makeFocusTarget();this._focusedElement=$(event.target);}});},_makeFocusTarget:function(){this._untrackInstance();this._trackingInstances().unshift(this);},_untrackInstance:function(){var instances=this._trackingInstances(),exists=$.inArray(this,instances);if(exists!==-1){instances.splice(exists,1);}},_trackingInstances:function(){var instances=this.document.data('ui-dialog-instances');if(!instances){instances=[];this.document.data('ui-dialog-instances',instances);}
return instances;},_minHeight:function(){var options=this.options;return options.height==='auto'?options.minHeight:Math.min(options.minHeight,options.height);},_position:function(){var isVisible=this.uiDialog.is(':visible');if(!isVisible){this.uiDialog.show();}
this.uiDialog.position(this.options.position);if(!isVisible){this.uiDialog.hide();}},_setOptions:function(options){var that=this,resize=false,resizableOptions={};$.each(options,function(key,value){that._setOption(key,value);if(key in that.sizeRelatedOptions){resize=true;}
if(key in that.resizableRelatedOptions){resizableOptions[key]=value;}});if(resize){this._size();this._position();}
if(this.uiDialog.is(':data(ui-resizable)')){this.uiDialog.resizable('option',resizableOptions);}},_setOption:function(key,value){var isDraggable,isResizable,uiDialog=this.uiDialog;if(key==='disabled'){return;}
this._super(key,value);if(key==='appendTo'){this.uiDialog.appendTo(this._appendTo());}
if(key==='buttons'){this._createButtons();}
if(key==='closeText'){this.uiDialogTitlebarClose.button({label:$('<a>').text(''+this.options.closeText).html()});}
if(key==='draggable'){isDraggable=uiDialog.is(':data(ui-draggable)');if(isDraggable&&!value){uiDialog.draggable('destroy');}
if(!isDraggable&&value){this._makeDraggable();}}
if(key==='position'){this._position();}
if(key==='resizable'){isResizable=uiDialog.is(':data(ui-resizable)');if(isResizable&&!value){uiDialog.resizable('destroy');}
if(isResizable&&typeof value==='string'){uiDialog.resizable('option','handles',value);}
if(!isResizable&&value!==false){this._makeResizable();}}
if(key==='title'){this._title(this.uiDialogTitlebar.find('.ui-dialog-title'));}},_size:function(){var nonContentHeight,minContentHeight,maxContentHeight,options=this.options;this.element.show().css({width:'auto',minHeight:0,maxHeight:'none',height:0});if(options.minWidth>options.width){options.width=options.minWidth;}
nonContentHeight=this.uiDialog.css({height:'auto',width:options.width}).outerHeight();minContentHeight=Math.max(0,options.minHeight-nonContentHeight);maxContentHeight=typeof options.maxHeight==='number'?Math.max(0,options.maxHeight-nonContentHeight):'none';if(options.height==='auto'){this.element.css({minHeight:minContentHeight,maxHeight:maxContentHeight,height:'auto'});}else{this.element.height(Math.max(0,options.height-nonContentHeight));}
if(this.uiDialog.is(':data(ui-resizable)')){this.uiDialog.resizable('option','minHeight',this._minHeight());}},_blockFrames:function(){this.iframeBlocks=this.document.find('iframe').map(function(){var iframe=$(this);return $('<div>').css({position:'absolute',width:iframe.outerWidth(),height:iframe.outerHeight()}).appendTo(iframe.parent()).offset(iframe.offset())[0];});},_unblockFrames:function(){if(this.iframeBlocks){this.iframeBlocks.remove();delete this.iframeBlocks;}},_allowInteraction:function(event){if($(event.target).closest('.ui-dialog').length){return true;}
return!!$(event.target).closest('.ui-datepicker').length;},_createOverlay:function(){if(!this.options.modal){return;}
var jqMinor=$.fn.jquery.substring(0,4);var isOpening=true;this._delay(function(){isOpening=false;});if(!this.document.data('ui-dialog-overlays')){this.document.on('focusin.ui-dialog',function(event){if(isOpening){return;}
var instance=this._trackingInstances()[0];if(!instance._allowInteraction(event)){event.preventDefault();instance._focusTabbable();if(jqMinor==='3.4.'||jqMinor==='3.5.'){instance._delay(instance._restoreTabbableFocus);}}}.bind(this));}
this.overlay=$('<div>').appendTo(this._appendTo());this._addClass(this.overlay,null,'ui-widget-overlay ui-front');this._on(this.overlay,{mousedown:'_keepFocus'});this.document.data('ui-dialog-overlays',(this.document.data('ui-dialog-overlays')||0)+1);},_destroyOverlay:function(){if(!this.options.modal){return;}
if(this.overlay){var overlays=this.document.data('ui-dialog-overlays')-1;if(!overlays){this.document.off('focusin.ui-dialog');this.document.removeData('ui-dialog-overlays');}else{this.document.data('ui-dialog-overlays',overlays);}
this.overlay.remove();this.overlay=null;}}});if($.uiBackCompat!==false){$.widget('ui.dialog',$.ui.dialog,{options:{dialogClass:''},_createWrapper:function(){this._super();this.uiDialog.addClass(this.options.dialogClass);},_setOption:function(key,value){if(key==='dialogClass'){this.uiDialog.removeClass(this.options.dialogClass).addClass(value);}
this._superApply(arguments);}});}
var widgetsDialog=$.ui.dialog;
/*!
 * jQuery UI Droppable 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
$.widget('ui.droppable',{version:'1.13.2',widgetEventPrefix:'drop',options:{accept:'*',addClasses:true,greedy:false,scope:'default',tolerance:'intersect',activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var proportions,o=this.options,accept=o.accept;this.isover=false;this.isout=true;this.accept=typeof accept==='function'?accept:function(d){return d.is(accept);};this.proportions=function(){if(arguments.length){proportions=arguments[0];}else{return proportions?proportions:proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight};}};this._addToManager(o.scope);if(o.addClasses){this._addClass('ui-droppable');}},_addToManager:function(scope){$.ui.ddmanager.droppables[scope]=$.ui.ddmanager.droppables[scope]||[];$.ui.ddmanager.droppables[scope].push(this);},_splice:function(drop){var i=0;for(;i<drop.length;i++){if(drop[i]===this){drop.splice(i,1);}}},_destroy:function(){var drop=$.ui.ddmanager.droppables[this.options.scope];this._splice(drop);},_setOption:function(key,value){if(key==='accept'){this.accept=typeof value==='function'?value:function(d){return d.is(value);};}else if(key==='scope'){var drop=$.ui.ddmanager.droppables[this.options.scope];this._splice(drop);this._addToManager(value);}
this._super(key,value);},_activate:function(event){var draggable=$.ui.ddmanager.current;this._addActiveClass();if(draggable){this._trigger('activate',event,this.ui(draggable));}},_deactivate:function(event){var draggable=$.ui.ddmanager.current;this._removeActiveClass();if(draggable){this._trigger('deactivate',event,this.ui(draggable));}},_over:function(event){var draggable=$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]===this.element[0]){return;}
if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){this._addHoverClass();this._trigger('over',event,this.ui(draggable));}},_out:function(event){var draggable=$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]===this.element[0]){return;}
if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){this._removeHoverClass();this._trigger('out',event,this.ui(draggable));}},_drop:function(event,custom){var draggable=custom||$.ui.ddmanager.current,childrenIntersection=false;if(!draggable||(draggable.currentItem||draggable.element)[0]===this.element[0]){return false;}
this.element.find(':data(ui-droppable)').not('.ui-draggable-dragging').each(function(){var inst=$(this).droppable('instance');if(inst.options.greedy&&!inst.options.disabled&&inst.options.scope===draggable.options.scope&&inst.accept.call(inst.element[0],(draggable.currentItem||draggable.element))&&$.ui.intersect(draggable,$.extend(inst,{offset:inst.element.offset()}),inst.options.tolerance,event)){childrenIntersection=true;return false;}});if(childrenIntersection){return false;}
if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){this._removeActiveClass();this._removeHoverClass();this._trigger('drop',event,this.ui(draggable));return this.element;}
return false;},ui:function(c){return{draggable:(c.currentItem||c.element),helper:c.helper,position:c.position,offset:c.positionAbs};},_addHoverClass:function(){this._addClass('ui-droppable-hover');},_removeHoverClass:function(){this._removeClass('ui-droppable-hover');},_addActiveClass:function(){this._addClass('ui-droppable-active');},_removeActiveClass:function(){this._removeClass('ui-droppable-active');}});$.ui.intersect=(function(){function isOverAxis(x,reference,size){return(x>=reference)&&(x<(reference+size));}
return function(draggable,droppable,toleranceMode,event){if(!droppable.offset){return false;}
var x1=(draggable.positionAbs||draggable.position.absolute).left+
draggable.margins.left,y1=(draggable.positionAbs||draggable.position.absolute).top+
draggable.margins.top,x2=x1+draggable.helperProportions.width,y2=y1+draggable.helperProportions.height,l=droppable.offset.left,t=droppable.offset.top,r=l+droppable.proportions().width,b=t+droppable.proportions().height;switch(toleranceMode){case'fit':return(l<=x1&&x2<=r&&t<=y1&&y2<=b);case'intersect':return(l<x1+(draggable.helperProportions.width/2)&&x2-(draggable.helperProportions.width/2)<r&&t<y1+(draggable.helperProportions.height/2)&&y2-(draggable.helperProportions.height/2)<b);case'pointer':return isOverAxis(event.pageY,t,droppable.proportions().height)&&isOverAxis(event.pageX,l,droppable.proportions().width);case'touch':return((y1>=t&&y1<=b)||(y2>=t&&y2<=b)||(y1<t&&y2>b))&&((x1>=l&&x1<=r)||(x2>=l&&x2<=r)||(x1<l&&x2>r));default:return false;}};})();$.ui.ddmanager={current:null,droppables:{'default':[]},prepareOffsets:function(t,event){var i,j,m=$.ui.ddmanager.droppables[t.options.scope]||[],type=event?event.type:null,list=(t.currentItem||t.element).find(':data(ui-droppable)').addBack();droppablesLoop:for(i=0;i<m.length;i++){if(m[i].options.disabled||(t&&!m[i].accept.call(m[i].element[0],(t.currentItem||t.element)))){continue;}
for(j=0;j<list.length;j++){if(list[j]===m[i].element[0]){m[i].proportions().height=0;continue droppablesLoop;}}
m[i].visible=m[i].element.css('display')!=='none';if(!m[i].visible){continue;}
if(type==='mousedown'){m[i]._activate.call(m[i],event);}
m[i].offset=m[i].element.offset();m[i].proportions({width:m[i].element[0].offsetWidth,height:m[i].element[0].offsetHeight});}},drop:function(draggable,event){var dropped=false;$.each(($.ui.ddmanager.droppables[draggable.options.scope]||[]).slice(),function(){if(!this.options){return;}
if(!this.options.disabled&&this.visible&&$.ui.intersect(draggable,this,this.options.tolerance,event)){dropped=this._drop.call(this,event)||dropped;}
if(!this.options.disabled&&this.visible&&this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){this.isout=true;this.isover=false;this._deactivate.call(this,event);}});return dropped;},dragStart:function(draggable,event){draggable.element.parentsUntil('body').on('scroll.droppable',function(){if(!draggable.options.refreshPositions){$.ui.ddmanager.prepareOffsets(draggable,event);}});},drag:function(draggable,event){if(draggable.options.refreshPositions){$.ui.ddmanager.prepareOffsets(draggable,event);}
$.each($.ui.ddmanager.droppables[draggable.options.scope]||[],function(){if(this.options.disabled||this.greedyChild||!this.visible){return;}
var parentInstance,scope,parent,intersects=$.ui.intersect(draggable,this,this.options.tolerance,event),c=!intersects&&this.isover?'isout':(intersects&&!this.isover?'isover':null);if(!c){return;}
if(this.options.greedy){scope=this.options.scope;parent=this.element.parents(':data(ui-droppable)').filter(function(){return $(this).droppable('instance').options.scope===scope;});if(parent.length){parentInstance=$(parent[0]).droppable('instance');parentInstance.greedyChild=(c==='isover');}}
if(parentInstance&&c==='isover'){parentInstance.isover=false;parentInstance.isout=true;parentInstance._out.call(parentInstance,event);}
this[c]=true;this[c==='isout'?'isover':'isout']=false;this[c==='isover'?'_over':'_out'].call(this,event);if(parentInstance&&c==='isout'){parentInstance.isout=false;parentInstance.isover=true;parentInstance._over.call(parentInstance,event);}});},dragStop:function(draggable,event){draggable.element.parentsUntil('body').off('scroll.droppable');if(!draggable.options.refreshPositions){$.ui.ddmanager.prepareOffsets(draggable,event);}}};if($.uiBackCompat!==false){$.widget('ui.droppable',$.ui.droppable,{options:{hoverClass:false,activeClass:false},_addActiveClass:function(){this._super();if(this.options.activeClass){this.element.addClass(this.options.activeClass);}},_removeActiveClass:function(){this._super();if(this.options.activeClass){this.element.removeClass(this.options.activeClass);}},_addHoverClass:function(){this._super();if(this.options.hoverClass){this.element.addClass(this.options.hoverClass);}},_removeHoverClass:function(){this._super();if(this.options.hoverClass){this.element.removeClass(this.options.hoverClass);}}});}
var widgetsDroppable=$.ui.droppable;
/*!
 * jQuery UI Progressbar 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var widgetsProgressbar=$.widget('ui.progressbar',{version:'1.13.2',options:{classes:{'ui-progressbar':'ui-corner-all','ui-progressbar-value':'ui-corner-left','ui-progressbar-complete':'ui-corner-right'},max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue();this.element.attr({role:'progressbar','aria-valuemin':this.min});this._addClass('ui-progressbar','ui-widget ui-widget-content');this.valueDiv=$('<div>').appendTo(this.element);this._addClass(this.valueDiv,'ui-progressbar-value','ui-widget-header');this._refreshValue();},_destroy:function(){this.element.removeAttr('role aria-valuemin aria-valuemax aria-valuenow');this.valueDiv.remove();},value:function(newValue){if(newValue===undefined){return this.options.value;}
this.options.value=this._constrainedValue(newValue);this._refreshValue();},_constrainedValue:function(newValue){if(newValue===undefined){newValue=this.options.value;}
this.indeterminate=newValue===false;if(typeof newValue!=='number'){newValue=0;}
return this.indeterminate?false:Math.min(this.options.max,Math.max(this.min,newValue));},_setOptions:function(options){var value=options.value;delete options.value;this._super(options);this.options.value=this._constrainedValue(value);this._refreshValue();},_setOption:function(key,value){if(key==='max'){value=Math.max(this.min,value);}
this._super(key,value);},_setOptionDisabled:function(value){this._super(value);this.element.attr('aria-disabled',value);this._toggleClass(null,'ui-state-disabled',!!value);},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min);},_refreshValue:function(){var value=this.options.value,percentage=this._percentage();this.valueDiv.toggle(this.indeterminate||value>this.min).width(percentage.toFixed(0)+'%');this._toggleClass(this.valueDiv,'ui-progressbar-complete',null,value===this.options.max)._toggleClass('ui-progressbar-indeterminate',null,this.indeterminate);if(this.indeterminate){this.element.removeAttr('aria-valuenow');if(!this.overlayDiv){this.overlayDiv=$('<div>').appendTo(this.valueDiv);this._addClass(this.overlayDiv,'ui-progressbar-overlay');}}else{this.element.attr({'aria-valuemax':this.options.max,'aria-valuenow':value});if(this.overlayDiv){this.overlayDiv.remove();this.overlayDiv=null;}}
if(this.oldValue!==value){this.oldValue=value;this._trigger('change');}
if(value===this.options.max){this._trigger('complete');}}});
/*!
 * jQuery UI Selectable 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var widgetsSelectable=$.widget('ui.selectable',$.ui.mouse,{version:'1.13.2',options:{appendTo:'body',autoRefresh:true,distance:0,filter:'*',tolerance:'touch',selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var that=this;this._addClass('ui-selectable');this.dragged=false;this.refresh=function(){that.elementPos=$(that.element[0]).offset();that.selectees=$(that.options.filter,that.element[0]);that._addClass(that.selectees,'ui-selectee');that.selectees.each(function(){var $this=$(this),selecteeOffset=$this.offset(),pos={left:selecteeOffset.left-that.elementPos.left,top:selecteeOffset.top-that.elementPos.top};$.data(this,'selectable-item',{element:this,$element:$this,left:pos.left,top:pos.top,right:pos.left+$this.outerWidth(),bottom:pos.top+$this.outerHeight(),startselected:false,selected:$this.hasClass('ui-selected'),selecting:$this.hasClass('ui-selecting'),unselecting:$this.hasClass('ui-unselecting')});});};this.refresh();this._mouseInit();this.helper=$('<div>');this._addClass(this.helper,'ui-selectable-helper');},_destroy:function(){this.selectees.removeData('selectable-item');this._mouseDestroy();},_mouseStart:function(event){var that=this,options=this.options;this.opos=[event.pageX,event.pageY];this.elementPos=$(this.element[0]).offset();if(this.options.disabled){return;}
this.selectees=$(options.filter,this.element[0]);this._trigger('start',event);$(options.appendTo).append(this.helper);this.helper.css({'left':event.pageX,'top':event.pageY,'width':0,'height':0});if(options.autoRefresh){this.refresh();}
this.selectees.filter('.ui-selected').each(function(){var selectee=$.data(this,'selectable-item');selectee.startselected=true;if(!event.metaKey&&!event.ctrlKey){that._removeClass(selectee.$element,'ui-selected');selectee.selected=false;that._addClass(selectee.$element,'ui-unselecting');selectee.unselecting=true;that._trigger('unselecting',event,{unselecting:selectee.element});}});$(event.target).parents().addBack().each(function(){var doSelect,selectee=$.data(this,'selectable-item');if(selectee){doSelect=(!event.metaKey&&!event.ctrlKey)||!selectee.$element.hasClass('ui-selected');that._removeClass(selectee.$element,doSelect?'ui-unselecting':'ui-selected')._addClass(selectee.$element,doSelect?'ui-selecting':'ui-unselecting');selectee.unselecting=!doSelect;selectee.selecting=doSelect;selectee.selected=doSelect;if(doSelect){that._trigger('selecting',event,{selecting:selectee.element});}else{that._trigger('unselecting',event,{unselecting:selectee.element});}
return false;}});},_mouseDrag:function(event){this.dragged=true;if(this.options.disabled){return;}
var tmp,that=this,options=this.options,x1=this.opos[0],y1=this.opos[1],x2=event.pageX,y2=event.pageY;if(x1>x2){tmp=x2;x2=x1;x1=tmp;}
if(y1>y2){tmp=y2;y2=y1;y1=tmp;}
this.helper.css({left:x1,top:y1,width:x2-x1,height:y2-y1});this.selectees.each(function(){var selectee=$.data(this,'selectable-item'),hit=false,offset={};if(!selectee||selectee.element===that.element[0]){return;}
offset.left=selectee.left+that.elementPos.left;offset.right=selectee.right+that.elementPos.left;offset.top=selectee.top+that.elementPos.top;offset.bottom=selectee.bottom+that.elementPos.top;if(options.tolerance==='touch'){hit=(!(offset.left>x2||offset.right<x1||offset.top>y2||offset.bottom<y1));}else if(options.tolerance==='fit'){hit=(offset.left>x1&&offset.right<x2&&offset.top>y1&&offset.bottom<y2);}
if(hit){if(selectee.selected){that._removeClass(selectee.$element,'ui-selected');selectee.selected=false;}
if(selectee.unselecting){that._removeClass(selectee.$element,'ui-unselecting');selectee.unselecting=false;}
if(!selectee.selecting){that._addClass(selectee.$element,'ui-selecting');selectee.selecting=true;that._trigger('selecting',event,{selecting:selectee.element});}}else{if(selectee.selecting){if((event.metaKey||event.ctrlKey)&&selectee.startselected){that._removeClass(selectee.$element,'ui-selecting');selectee.selecting=false;that._addClass(selectee.$element,'ui-selected');selectee.selected=true;}else{that._removeClass(selectee.$element,'ui-selecting');selectee.selecting=false;if(selectee.startselected){that._addClass(selectee.$element,'ui-unselecting');selectee.unselecting=true;}
that._trigger('unselecting',event,{unselecting:selectee.element});}}
if(selectee.selected){if(!event.metaKey&&!event.ctrlKey&&!selectee.startselected){that._removeClass(selectee.$element,'ui-selected');selectee.selected=false;that._addClass(selectee.$element,'ui-unselecting');selectee.unselecting=true;that._trigger('unselecting',event,{unselecting:selectee.element});}}}});return false;},_mouseStop:function(event){var that=this;this.dragged=false;$('.ui-unselecting',this.element[0]).each(function(){var selectee=$.data(this,'selectable-item');that._removeClass(selectee.$element,'ui-unselecting');selectee.unselecting=false;selectee.startselected=false;that._trigger('unselected',event,{unselected:selectee.element});});$('.ui-selecting',this.element[0]).each(function(){var selectee=$.data(this,'selectable-item');that._removeClass(selectee.$element,'ui-selecting')._addClass(selectee.$element,'ui-selected');selectee.selecting=false;selectee.selected=true;selectee.startselected=true;that._trigger('selected',event,{selected:selectee.element});});this._trigger('stop',event);this.helper.remove();return false;}});
/*!
 * jQuery UI Selectmenu 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var widgetsSelectmenu=$.widget('ui.selectmenu',[$.ui.formResetMixin,{version:'1.13.2',defaultElement:'<select>',options:{appendTo:null,classes:{'ui-selectmenu-button-open':'ui-corner-top','ui-selectmenu-button-closed':'ui-corner-all'},disabled:null,icons:{button:'ui-icon-triangle-1-s'},position:{my:'left top',at:'left bottom',collision:'none'},width:false,change:null,close:null,focus:null,open:null,select:null},_create:function(){var selectmenuId=this.element.uniqueId().attr('id');this.ids={element:selectmenuId,button:selectmenuId+'-button',menu:selectmenuId+'-menu'};this._drawButton();this._drawMenu();this._bindFormResetHandler();this._rendered=false;this.menuItems=$();},_drawButton:function(){var icon,that=this,item=this._parseOption(this.element.find('option:selected'),this.element[0].selectedIndex);this.labels=this.element.labels().attr('for',this.ids.button);this._on(this.labels,{click:function(event){this.button.trigger('focus');event.preventDefault();}});this.element.hide();this.button=$('<span>',{tabindex:this.options.disabled?-1:0,id:this.ids.button,role:'combobox','aria-expanded':'false','aria-autocomplete':'list','aria-owns':this.ids.menu,'aria-haspopup':'true',title:this.element.attr('title')}).insertAfter(this.element);this._addClass(this.button,'ui-selectmenu-button ui-selectmenu-button-closed','ui-button ui-widget');icon=$('<span>').appendTo(this.button);this._addClass(icon,'ui-selectmenu-icon','ui-icon '+this.options.icons.button);this.buttonItem=this._renderButtonItem(item).appendTo(this.button);if(this.options.width!==false){this._resizeButton();}
this._on(this.button,this._buttonEvents);this.button.one('focusin',function(){if(!that._rendered){that._refreshMenu();}});},_drawMenu:function(){var that=this;this.menu=$('<ul>',{'aria-hidden':'true','aria-labelledby':this.ids.button,id:this.ids.menu});this.menuWrap=$('<div>').append(this.menu);this._addClass(this.menuWrap,'ui-selectmenu-menu','ui-front');this.menuWrap.appendTo(this._appendTo());this.menuInstance=this.menu.menu({classes:{'ui-menu':'ui-corner-bottom'},role:'listbox',select:function(event,ui){event.preventDefault();that._setSelection();that._select(ui.item.data('ui-selectmenu-item'),event);},focus:function(event,ui){var item=ui.item.data('ui-selectmenu-item');if(that.focusIndex!=null&&item.index!==that.focusIndex){that._trigger('focus',event,{item:item});if(!that.isOpen){that._select(item,event);}}
that.focusIndex=item.index;that.button.attr('aria-activedescendant',that.menuItems.eq(item.index).attr('id'));}}).menu('instance');this.menuInstance._off(this.menu,'mouseleave');this.menuInstance._closeOnDocumentClick=function(){return false;};this.menuInstance._isDivider=function(){return false;};},refresh:function(){this._refreshMenu();this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(this._getSelectedItem().data('ui-selectmenu-item')||{}));if(this.options.width===null){this._resizeButton();}},_refreshMenu:function(){var item,options=this.element.find('option');this.menu.empty();this._parseOptions(options);this._renderMenu(this.menu,this.items);this.menuInstance.refresh();this.menuItems=this.menu.find('li').not('.ui-selectmenu-optgroup').find('.ui-menu-item-wrapper');this._rendered=true;if(!options.length){return;}
item=this._getSelectedItem();this.menuInstance.focus(null,item);this._setAria(item.data('ui-selectmenu-item'));this._setOption('disabled',this.element.prop('disabled'));},open:function(event){if(this.options.disabled){return;}
if(!this._rendered){this._refreshMenu();}else{this._removeClass(this.menu.find('.ui-state-active'),null,'ui-state-active');this.menuInstance.focus(null,this._getSelectedItem());}
if(!this.menuItems.length){return;}
this.isOpen=true;this._toggleAttr();this._resizeMenu();this._position();this._on(this.document,this._documentClick);this._trigger('open',event);},_position:function(){this.menuWrap.position($.extend({of:this.button},this.options.position));},close:function(event){if(!this.isOpen){return;}
this.isOpen=false;this._toggleAttr();this.range=null;this._off(this.document);this._trigger('close',event);},widget:function(){return this.button;},menuWidget:function(){return this.menu;},_renderButtonItem:function(item){var buttonItem=$('<span>');this._setText(buttonItem,item.label);this._addClass(buttonItem,'ui-selectmenu-text');return buttonItem;},_renderMenu:function(ul,items){var that=this,currentOptgroup='';$.each(items,function(index,item){var li;if(item.optgroup!==currentOptgroup){li=$('<li>',{html:item.optgroup});that._addClass(li,'ui-selectmenu-optgroup','ui-menu-divider'+
(item.element.parent('optgroup').prop('disabled')?' ui-state-disabled':''));li.appendTo(ul);currentOptgroup=item.optgroup;}
that._renderItemData(ul,item);});},_renderItemData:function(ul,item){return this._renderItem(ul,item).data('ui-selectmenu-item',item);},_renderItem:function(ul,item){var li=$('<li>'),wrapper=$('<div>',{title:item.element.attr('title')});if(item.disabled){this._addClass(li,null,'ui-state-disabled');}
this._setText(wrapper,item.label);return li.append(wrapper).appendTo(ul);},_setText:function(element,value){if(value){element.text(value);}else{element.html('&#160;');}},_move:function(direction,event){var item,next,filter='.ui-menu-item';if(this.isOpen){item=this.menuItems.eq(this.focusIndex).parent('li');}else{item=this.menuItems.eq(this.element[0].selectedIndex).parent('li');filter+=':not(.ui-state-disabled)';}
if(direction==='first'||direction==='last'){next=item[direction==='first'?'prevAll':'nextAll'](filter).eq(-1);}else{next=item[direction+'All'](filter).eq(0);}
if(next.length){this.menuInstance.focus(event,next);}},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex).parent('li');},_toggle:function(event){this[this.isOpen?'close':'open'](event);},_setSelection:function(){var selection;if(!this.range){return;}
if(window.getSelection){selection=window.getSelection();selection.removeAllRanges();selection.addRange(this.range);}else{this.range.select();}
this.button.trigger('focus');},_documentClick:{mousedown:function(event){if(!this.isOpen){return;}
if(!$(event.target).closest('.ui-selectmenu-menu, #'+
$.escapeSelector(this.ids.button)).length){this.close(event);}}},_buttonEvents:{mousedown:function(){var selection;if(window.getSelection){selection=window.getSelection();if(selection.rangeCount){this.range=selection.getRangeAt(0);}}else{this.range=document.selection.createRange();}},click:function(event){this._setSelection();this._toggle(event);},keydown:function(event){var preventDefault=true;switch(event.keyCode){case $.ui.keyCode.TAB:case $.ui.keyCode.ESCAPE:this.close(event);preventDefault=false;break;case $.ui.keyCode.ENTER:if(this.isOpen){this._selectFocusedItem(event);}
break;case $.ui.keyCode.UP:if(event.altKey){this._toggle(event);}else{this._move('prev',event);}
break;case $.ui.keyCode.DOWN:if(event.altKey){this._toggle(event);}else{this._move('next',event);}
break;case $.ui.keyCode.SPACE:if(this.isOpen){this._selectFocusedItem(event);}else{this._toggle(event);}
break;case $.ui.keyCode.LEFT:this._move('prev',event);break;case $.ui.keyCode.RIGHT:this._move('next',event);break;case $.ui.keyCode.HOME:case $.ui.keyCode.PAGE_UP:this._move('first',event);break;case $.ui.keyCode.END:case $.ui.keyCode.PAGE_DOWN:this._move('last',event);break;default:this.menu.trigger(event);preventDefault=false;}
if(preventDefault){event.preventDefault();}}},_selectFocusedItem:function(event){var item=this.menuItems.eq(this.focusIndex).parent('li');if(!item.hasClass('ui-state-disabled')){this._select(item.data('ui-selectmenu-item'),event);}},_select:function(item,event){var oldIndex=this.element[0].selectedIndex;this.element[0].selectedIndex=item.index;this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(item));this._setAria(item);this._trigger('select',event,{item:item});if(item.index!==oldIndex){this._trigger('change',event,{item:item});}
this.close(event);},_setAria:function(item){var id=this.menuItems.eq(item.index).attr('id');this.button.attr({'aria-labelledby':id,'aria-activedescendant':id});this.menu.attr('aria-activedescendant',id);},_setOption:function(key,value){if(key==='icons'){var icon=this.button.find('span.ui-icon');this._removeClass(icon,null,this.options.icons.button)._addClass(icon,null,value.button);}
this._super(key,value);if(key==='appendTo'){this.menuWrap.appendTo(this._appendTo());}
if(key==='width'){this._resizeButton();}},_setOptionDisabled:function(value){this._super(value);this.menuInstance.option('disabled',value);this.button.attr('aria-disabled',value);this._toggleClass(this.button,null,'ui-state-disabled',value);this.element.prop('disabled',value);if(value){this.button.attr('tabindex',-1);this.close();}else{this.button.attr('tabindex',0);}},_appendTo:function(){var element=this.options.appendTo;if(element){element=element.jquery||element.nodeType?$(element):this.document.find(element).eq(0);}
if(!element||!element[0]){element=this.element.closest('.ui-front, dialog');}
if(!element.length){element=this.document[0].body;}
return element;},_toggleAttr:function(){this.button.attr('aria-expanded',this.isOpen);this._removeClass(this.button,'ui-selectmenu-button-'+(this.isOpen?'closed':'open'))._addClass(this.button,'ui-selectmenu-button-'+(this.isOpen?'open':'closed'))._toggleClass(this.menuWrap,'ui-selectmenu-open',null,this.isOpen);this.menu.attr('aria-hidden',!this.isOpen);},_resizeButton:function(){var width=this.options.width;if(width===false){this.button.css('width','');return;}
if(width===null){width=this.element.show().outerWidth();this.element.hide();}
this.button.outerWidth(width);},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width('').outerWidth()+1));},_getCreateOptions:function(){var options=this._super();options.disabled=this.element.prop('disabled');return options;},_parseOptions:function(options){var that=this,data=[];options.each(function(index,item){if(item.hidden){return;}
data.push(that._parseOption($(item),index));});this.items=data;},_parseOption:function(option,index){var optgroup=option.parent('optgroup');return{element:option,index:index,value:option.val(),label:option.text(),optgroup:optgroup.attr('label')||'',disabled:optgroup.prop('disabled')||option.prop('disabled')};},_destroy:function(){this._unbindFormResetHandler();this.menuWrap.remove();this.button.remove();this.element.show();this.element.removeUniqueId();this.labels.attr('for',this.ids.element);}}]);
/*!
 * jQuery UI Slider 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var widgetsSlider=$.widget('ui.slider',$.ui.mouse,{version:'1.13.2',widgetEventPrefix:'slide',options:{animate:false,classes:{'ui-slider':'ui-corner-all','ui-slider-handle':'ui-corner-all','ui-slider-range':'ui-corner-all ui-widget-header'},distance:0,max:100,min:0,orientation:'horizontal',range:false,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=false;this._mouseSliding=false;this._animateOff=true;this._handleIndex=null;this._detectOrientation();this._mouseInit();this._calculateNewMax();this._addClass('ui-slider ui-slider-'+this.orientation,'ui-widget ui-widget-content');this._refresh();this._animateOff=false;},_refresh:function(){this._createRange();this._createHandles();this._setupEvents();this._refreshValue();},_createHandles:function(){var i,handleCount,options=this.options,existingHandles=this.element.find('.ui-slider-handle'),handle='<span tabindex=\'0\'></span>',handles=[];handleCount=(options.values&&options.values.length)||1;if(existingHandles.length>handleCount){existingHandles.slice(handleCount).remove();existingHandles=existingHandles.slice(0,handleCount);}
for(i=existingHandles.length;i<handleCount;i++){handles.push(handle);}
this.handles=existingHandles.add($(handles.join('')).appendTo(this.element));this._addClass(this.handles,'ui-slider-handle','ui-state-default');this.handle=this.handles.eq(0);this.handles.each(function(i){$(this).data('ui-slider-handle-index',i).attr('tabIndex',0);});},_createRange:function(){var options=this.options;if(options.range){if(options.range===true){if(!options.values){options.values=[this._valueMin(),this._valueMin()];}else if(options.values.length&&options.values.length!==2){options.values=[options.values[0],options.values[0]];}else if(Array.isArray(options.values)){options.values=options.values.slice(0);}}
if(!this.range||!this.range.length){this.range=$('<div>').appendTo(this.element);this._addClass(this.range,'ui-slider-range');}else{this._removeClass(this.range,'ui-slider-range-min ui-slider-range-max');this.range.css({'left':'','bottom':''});}
if(options.range==='min'||options.range==='max'){this._addClass(this.range,'ui-slider-range-'+options.range);}}else{if(this.range){this.range.remove();}
this.range=null;}},_setupEvents:function(){this._off(this.handles);this._on(this.handles,this._handleEvents);this._hoverable(this.handles);this._focusable(this.handles);},_destroy:function(){this.handles.remove();if(this.range){this.range.remove();}
this._mouseDestroy();},_mouseCapture:function(event){var position,normValue,distance,closestHandle,index,allowed,offset,mouseOverHandle,that=this,o=this.options;if(o.disabled){return false;}
this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();position={x:event.pageX,y:event.pageY};normValue=this._normValueFromMouse(position);distance=this._valueMax()-this._valueMin()+1;this.handles.each(function(i){var thisDistance=Math.abs(normValue-that.values(i));if((distance>thisDistance)||(distance===thisDistance&&(i===that._lastChangedValue||that.values(i)===o.min))){distance=thisDistance;closestHandle=$(this);index=i;}});allowed=this._start(event,index);if(allowed===false){return false;}
this._mouseSliding=true;this._handleIndex=index;this._addClass(closestHandle,null,'ui-state-active');closestHandle.trigger('focus');offset=closestHandle.offset();mouseOverHandle=!$(event.target).parents().addBack().is('.ui-slider-handle');this._clickOffset=mouseOverHandle?{left:0,top:0}:{left:event.pageX-offset.left-(closestHandle.width()/2),top:event.pageY-offset.top-(closestHandle.height()/2)-
(parseInt(closestHandle.css('borderTopWidth'),10)||0)-
(parseInt(closestHandle.css('borderBottomWidth'),10)||0)+
(parseInt(closestHandle.css('marginTop'),10)||0)};if(!this.handles.hasClass('ui-state-hover')){this._slide(event,index,normValue);}
this._animateOff=true;return true;},_mouseStart:function(){return true;},_mouseDrag:function(event){var position={x:event.pageX,y:event.pageY},normValue=this._normValueFromMouse(position);this._slide(event,this._handleIndex,normValue);return false;},_mouseStop:function(event){this._removeClass(this.handles,null,'ui-state-active');this._mouseSliding=false;this._stop(event,this._handleIndex);this._change(event,this._handleIndex);this._handleIndex=null;this._clickOffset=null;this._animateOff=false;return false;},_detectOrientation:function(){this.orientation=(this.options.orientation==='vertical')?'vertical':'horizontal';},_normValueFromMouse:function(position){var pixelTotal,pixelMouse,percentMouse,valueTotal,valueMouse;if(this.orientation==='horizontal'){pixelTotal=this.elementSize.width;pixelMouse=position.x-this.elementOffset.left-
(this._clickOffset?this._clickOffset.left:0);}else{pixelTotal=this.elementSize.height;pixelMouse=position.y-this.elementOffset.top-
(this._clickOffset?this._clickOffset.top:0);}
percentMouse=(pixelMouse/pixelTotal);if(percentMouse>1){percentMouse=1;}
if(percentMouse<0){percentMouse=0;}
if(this.orientation==='vertical'){percentMouse=1-percentMouse;}
valueTotal=this._valueMax()-this._valueMin();valueMouse=this._valueMin()+percentMouse*valueTotal;return this._trimAlignValue(valueMouse);},_uiHash:function(index,value,values){var uiHash={handle:this.handles[index],handleIndex:index,value:value!==undefined?value:this.value()};if(this._hasMultipleValues()){uiHash.value=value!==undefined?value:this.values(index);uiHash.values=values||this.values();}
return uiHash;},_hasMultipleValues:function(){return this.options.values&&this.options.values.length;},_start:function(event,index){return this._trigger('start',event,this._uiHash(index));},_slide:function(event,index,newVal){var allowed,otherVal,currentValue=this.value(),newValues=this.values();if(this._hasMultipleValues()){otherVal=this.values(index?0:1);currentValue=this.values(index);if(this.options.values.length===2&&this.options.range===true){newVal=index===0?Math.min(otherVal,newVal):Math.max(otherVal,newVal);}
newValues[index]=newVal;}
if(newVal===currentValue){return;}
allowed=this._trigger('slide',event,this._uiHash(index,newVal,newValues));if(allowed===false){return;}
if(this._hasMultipleValues()){this.values(index,newVal);}else{this.value(newVal);}},_stop:function(event,index){this._trigger('stop',event,this._uiHash(index));},_change:function(event,index){if(!this._keySliding&&!this._mouseSliding){this._lastChangedValue=index;this._trigger('change',event,this._uiHash(index));}},value:function(newValue){if(arguments.length){this.options.value=this._trimAlignValue(newValue);this._refreshValue();this._change(null,0);return;}
return this._value();},values:function(index,newValue){var vals,newValues,i;if(arguments.length>1){this.options.values[index]=this._trimAlignValue(newValue);this._refreshValue();this._change(null,index);return;}
if(arguments.length){if(Array.isArray(arguments[0])){vals=this.options.values;newValues=arguments[0];for(i=0;i<vals.length;i+=1){vals[i]=this._trimAlignValue(newValues[i]);this._change(null,i);}
this._refreshValue();}else{if(this._hasMultipleValues()){return this._values(index);}else{return this.value();}}}else{return this._values();}},_setOption:function(key,value){var i,valsLength=0;if(key==='range'&&this.options.range===true){if(value==='min'){this.options.value=this._values(0);this.options.values=null;}else if(value==='max'){this.options.value=this._values(this.options.values.length-1);this.options.values=null;}}
if(Array.isArray(this.options.values)){valsLength=this.options.values.length;}
this._super(key,value);switch(key){case'orientation':this._detectOrientation();this._removeClass('ui-slider-horizontal ui-slider-vertical')._addClass('ui-slider-'+this.orientation);this._refreshValue();if(this.options.range){this._refreshRange(value);}
this.handles.css(value==='horizontal'?'bottom':'left','');break;case'value':this._animateOff=true;this._refreshValue();this._change(null,0);this._animateOff=false;break;case'values':this._animateOff=true;this._refreshValue();for(i=valsLength-1;i>=0;i--){this._change(null,i);}
this._animateOff=false;break;case'step':case'min':case'max':this._animateOff=true;this._calculateNewMax();this._refreshValue();this._animateOff=false;break;case'range':this._animateOff=true;this._refresh();this._animateOff=false;break;}},_setOptionDisabled:function(value){this._super(value);this._toggleClass(null,'ui-state-disabled',!!value);},_value:function(){var val=this.options.value;val=this._trimAlignValue(val);return val;},_values:function(index){var val,vals,i;if(arguments.length){val=this.options.values[index];val=this._trimAlignValue(val);return val;}else if(this._hasMultipleValues()){vals=this.options.values.slice();for(i=0;i<vals.length;i+=1){vals[i]=this._trimAlignValue(vals[i]);}
return vals;}else{return[];}},_trimAlignValue:function(val){if(val<=this._valueMin()){return this._valueMin();}
if(val>=this._valueMax()){return this._valueMax();}
var step=(this.options.step>0)?this.options.step:1,valModStep=(val-this._valueMin())%step,alignValue=val-valModStep;if(Math.abs(valModStep)*2>=step){alignValue+=(valModStep>0)?step:(-step);}
return parseFloat(alignValue.toFixed(5));},_calculateNewMax:function(){var max=this.options.max,min=this._valueMin(),step=this.options.step,aboveMin=Math.round((max-min)/step)*step;max=aboveMin+min;if(max>this.options.max){max-=step;}
this.max=parseFloat(max.toFixed(this._precision()));},_precision:function(){var precision=this._precisionOf(this.options.step);if(this.options.min!==null){precision=Math.max(precision,this._precisionOf(this.options.min));}
return precision;},_precisionOf:function(num){var str=num.toString(),decimal=str.indexOf('.');return decimal===-1?0:str.length-decimal-1;},_valueMin:function(){return this.options.min;},_valueMax:function(){return this.max;},_refreshRange:function(orientation){if(orientation==='vertical'){this.range.css({'width':'','left':''});}
if(orientation==='horizontal'){this.range.css({'height':'','bottom':''});}},_refreshValue:function(){var lastValPercent,valPercent,value,valueMin,valueMax,oRange=this.options.range,o=this.options,that=this,animate=(!this._animateOff)?o.animate:false,_set={};if(this._hasMultipleValues()){this.handles.each(function(i){valPercent=(that.values(i)-that._valueMin())/(that._valueMax()-that._valueMin())*100;_set[that.orientation==='horizontal'?'left':'bottom']=valPercent+'%';$(this).stop(1,1)[animate?'animate':'css'](_set,o.animate);if(that.options.range===true){if(that.orientation==='horizontal'){if(i===0){that.range.stop(1,1)[animate?'animate':'css']({left:valPercent+'%'},o.animate);}
if(i===1){that.range[animate?'animate':'css']({width:(valPercent-lastValPercent)+'%'},{queue:false,duration:o.animate});}}else{if(i===0){that.range.stop(1,1)[animate?'animate':'css']({bottom:(valPercent)+'%'},o.animate);}
if(i===1){that.range[animate?'animate':'css']({height:(valPercent-lastValPercent)+'%'},{queue:false,duration:o.animate});}}}
lastValPercent=valPercent;});}else{value=this.value();valueMin=this._valueMin();valueMax=this._valueMax();valPercent=(valueMax!==valueMin)?(value-valueMin)/(valueMax-valueMin)*100:0;_set[this.orientation==='horizontal'?'left':'bottom']=valPercent+'%';this.handle.stop(1,1)[animate?'animate':'css'](_set,o.animate);if(oRange==='min'&&this.orientation==='horizontal'){this.range.stop(1,1)[animate?'animate':'css']({width:valPercent+'%'},o.animate);}
if(oRange==='max'&&this.orientation==='horizontal'){this.range.stop(1,1)[animate?'animate':'css']({width:(100-valPercent)+'%'},o.animate);}
if(oRange==='min'&&this.orientation==='vertical'){this.range.stop(1,1)[animate?'animate':'css']({height:valPercent+'%'},o.animate);}
if(oRange==='max'&&this.orientation==='vertical'){this.range.stop(1,1)[animate?'animate':'css']({height:(100-valPercent)+'%'},o.animate);}}},_handleEvents:{keydown:function(event){var allowed,curVal,newVal,step,index=$(event.target).data('ui-slider-handle-index');switch(event.keyCode){case $.ui.keyCode.HOME:case $.ui.keyCode.END:case $.ui.keyCode.PAGE_UP:case $.ui.keyCode.PAGE_DOWN:case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:event.preventDefault();if(!this._keySliding){this._keySliding=true;this._addClass($(event.target),null,'ui-state-active');allowed=this._start(event,index);if(allowed===false){return;}}
break;}
step=this.options.step;if(this._hasMultipleValues()){curVal=newVal=this.values(index);}else{curVal=newVal=this.value();}
switch(event.keyCode){case $.ui.keyCode.HOME:newVal=this._valueMin();break;case $.ui.keyCode.END:newVal=this._valueMax();break;case $.ui.keyCode.PAGE_UP:newVal=this._trimAlignValue(curVal+((this._valueMax()-this._valueMin())/this.numPages));break;case $.ui.keyCode.PAGE_DOWN:newVal=this._trimAlignValue(curVal-((this._valueMax()-this._valueMin())/this.numPages));break;case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:if(curVal===this._valueMax()){return;}
newVal=this._trimAlignValue(curVal+step);break;case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:if(curVal===this._valueMin()){return;}
newVal=this._trimAlignValue(curVal-step);break;}
this._slide(event,index,newVal);},keyup:function(event){var index=$(event.target).data('ui-slider-handle-index');if(this._keySliding){this._keySliding=false;this._stop(event,index);this._change(event,index);this._removeClass($(event.target),null,'ui-state-active');}}}});
/*!
 * jQuery UI Sortable 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
var widgetsSortable=$.widget('ui.sortable',$.ui.mouse,{version:'1.13.2',widgetEventPrefix:'sort',ready:false,options:{appendTo:'parent',axis:false,connectWith:false,containment:false,cursor:'auto',cursorAt:false,dropOnEmpty:true,forcePlaceholderSize:false,forceHelperSize:false,grid:false,handle:false,helper:'original',items:'> *',opacity:false,placeholder:false,revert:false,scroll:true,scrollSensitivity:20,scrollSpeed:20,scope:'default',tolerance:'intersect',zIndex:1000,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(x,reference,size){return(x>=reference)&&(x<(reference+size));},_isFloating:function(item){return(/left|right/).test(item.css('float'))||(/inline|table-cell/).test(item.css('display'));},_create:function(){this.containerCache={};this._addClass('ui-sortable');this.refresh();this.offset=this.element.offset();this._mouseInit();this._setHandleClassName();this.ready=true;},_setOption:function(key,value){this._super(key,value);if(key==='handle'){this._setHandleClassName();}},_setHandleClassName:function(){var that=this;this._removeClass(this.element.find('.ui-sortable-handle'),'ui-sortable-handle');$.each(this.items,function(){that._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,'ui-sortable-handle');});},_destroy:function(){this._mouseDestroy();for(var i=this.items.length-1;i>=0;i--){this.items[i].item.removeData(this.widgetName+'-item');}
return this;},_mouseCapture:function(event,overrideHandle){var currentItem=null,validHandle=false,that=this;if(this.reverting){return false;}
if(this.options.disabled||this.options.type==='static'){return false;}
this._refreshItems(event);$(event.target).parents().each(function(){if($.data(this,that.widgetName+'-item')===that){currentItem=$(this);return false;}});if($.data(event.target,that.widgetName+'-item')===that){currentItem=$(event.target);}
if(!currentItem){return false;}
if(this.options.handle&&!overrideHandle){$(this.options.handle,currentItem).find('*').addBack().each(function(){if(this===event.target){validHandle=true;}});if(!validHandle){return false;}}
this.currentItem=currentItem;this._removeCurrentsFromItems();return true;},_mouseStart:function(event,overrideHandle,noActivation){var i,body,o=this.options;this.currentContainer=this;this.refreshPositions();this.appendTo=$(o.appendTo!=='parent'?o.appendTo:this.currentItem.parent());this.helper=this._createHelper(event);this._cacheHelperProportions();this._cacheMargins();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},relative:this._getRelativeOffset()});this.helper.css('position','absolute');this.cssPosition=this.helper.css('position');if(o.cursorAt){this._adjustOffsetFromHelper(o.cursorAt);}
this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};if(this.helper[0]!==this.currentItem[0]){this.currentItem.hide();}
this._createPlaceholder();this.scrollParent=this.placeholder.scrollParent();$.extend(this.offset,{parent:this._getParentOffset()});if(o.containment){this._setContainment();}
if(o.cursor&&o.cursor!=='auto'){body=this.document.find('body');this.storedCursor=body.css('cursor');body.css('cursor',o.cursor);this.storedStylesheet=$('<style>*{ cursor: '+o.cursor+' !important; }</style>').appendTo(body);}
if(o.zIndex){if(this.helper.css('zIndex')){this._storedZIndex=this.helper.css('zIndex');}
this.helper.css('zIndex',o.zIndex);}
if(o.opacity){if(this.helper.css('opacity')){this._storedOpacity=this.helper.css('opacity');}
this.helper.css('opacity',o.opacity);}
if(this.scrollParent[0]!==this.document[0]&&this.scrollParent[0].tagName!=='HTML'){this.overflowOffset=this.scrollParent.offset();}
this._trigger('start',event,this._uiHash());if(!this._preserveHelperProportions){this._cacheHelperProportions();}
if(!noActivation){for(i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger('activate',event,this._uiHash(this));}}
if($.ui.ddmanager){$.ui.ddmanager.current=this;}
if($.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(this,event);}
this.dragging=true;this._addClass(this.helper,'ui-sortable-helper');if(!this.helper.parent().is(this.appendTo)){this.helper.detach().appendTo(this.appendTo);this.offset.parent=this._getParentOffset();}
this.position=this.originalPosition=this._generatePosition(event);this.originalPageX=event.pageX;this.originalPageY=event.pageY;this.lastPositionAbs=this.positionAbs=this._convertPositionTo('absolute');this._mouseDrag(event);return true;},_scroll:function(event){var o=this.options,scrolled=false;if(this.scrollParent[0]!==this.document[0]&&this.scrollParent[0].tagName!=='HTML'){if((this.overflowOffset.top+this.scrollParent[0].offsetHeight)-
event.pageY<o.scrollSensitivity){this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop+o.scrollSpeed;}else if(event.pageY-this.overflowOffset.top<o.scrollSensitivity){this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop-o.scrollSpeed;}
if((this.overflowOffset.left+this.scrollParent[0].offsetWidth)-
event.pageX<o.scrollSensitivity){this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft+o.scrollSpeed;}else if(event.pageX-this.overflowOffset.left<o.scrollSensitivity){this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft-o.scrollSpeed;}}else{if(event.pageY-this.document.scrollTop()<o.scrollSensitivity){scrolled=this.document.scrollTop(this.document.scrollTop()-o.scrollSpeed);}else if(this.window.height()-(event.pageY-this.document.scrollTop())<o.scrollSensitivity){scrolled=this.document.scrollTop(this.document.scrollTop()+o.scrollSpeed);}
if(event.pageX-this.document.scrollLeft()<o.scrollSensitivity){scrolled=this.document.scrollLeft(this.document.scrollLeft()-o.scrollSpeed);}else if(this.window.width()-(event.pageX-this.document.scrollLeft())<o.scrollSensitivity){scrolled=this.document.scrollLeft(this.document.scrollLeft()+o.scrollSpeed);}}
return scrolled;},_mouseDrag:function(event){var i,item,itemElement,intersection,o=this.options;this.position=this._generatePosition(event);this.positionAbs=this._convertPositionTo('absolute');if(!this.options.axis||this.options.axis!=='y'){this.helper[0].style.left=this.position.left+'px';}
if(!this.options.axis||this.options.axis!=='x'){this.helper[0].style.top=this.position.top+'px';}
if(o.scroll){if(this._scroll(event)!==false){this._refreshItemPositions(true);if($.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(this,event);}}}
this.dragDirection={vertical:this._getDragVerticalDirection(),horizontal:this._getDragHorizontalDirection()};for(i=this.items.length-1;i>=0;i--){item=this.items[i];itemElement=item.item[0];intersection=this._intersectsWithPointer(item);if(!intersection){continue;}
if(item.instance!==this.currentContainer){continue;}
if(itemElement!==this.currentItem[0]&&this.placeholder[intersection===1?'next':'prev']()[0]!==itemElement&&!$.contains(this.placeholder[0],itemElement)&&(this.options.type==='semi-dynamic'?!$.contains(this.element[0],itemElement):true)){this.direction=intersection===1?'down':'up';if(this.options.tolerance==='pointer'||this._intersectsWithSides(item)){this._rearrange(event,item);}else{break;}
this._trigger('change',event,this._uiHash());break;}}
this._contactContainers(event);if($.ui.ddmanager){$.ui.ddmanager.drag(this,event);}
this._trigger('sort',event,this._uiHash());this.lastPositionAbs=this.positionAbs;return false;},_mouseStop:function(event,noPropagation){if(!event){return;}
if($.ui.ddmanager&&!this.options.dropBehaviour){$.ui.ddmanager.drop(this,event);}
if(this.options.revert){var that=this,cur=this.placeholder.offset(),axis=this.options.axis,animation={};if(!axis||axis==='x'){animation.left=cur.left-this.offset.parent.left-
this.margins.left+
(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft);}
if(!axis||axis==='y'){animation.top=cur.top-this.offset.parent.top-this.margins.top+
(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop);}
this.reverting=true;$(this.helper).animate(animation,parseInt(this.options.revert,10)||500,function(){that._clear(event);});}else{this._clear(event,noPropagation);}
return false;},cancel:function(){if(this.dragging){this._mouseUp(new $.Event('mouseup',{target:null}));if(this.options.helper==='original'){this.currentItem.css(this._storedCSS);this._removeClass(this.currentItem,'ui-sortable-helper');}else{this.currentItem.show();}
for(var i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger('deactivate',null,this._uiHash(this));if(this.containers[i].containerCache.over){this.containers[i]._trigger('out',null,this._uiHash(this));this.containers[i].containerCache.over=0;}}}
if(this.placeholder){if(this.placeholder[0].parentNode){this.placeholder[0].parentNode.removeChild(this.placeholder[0]);}
if(this.options.helper!=='original'&&this.helper&&this.helper[0].parentNode){this.helper.remove();}
$.extend(this,{helper:null,dragging:false,reverting:false,_noFinalSort:null});if(this.domPosition.prev){$(this.domPosition.prev).after(this.currentItem);}else{$(this.domPosition.parent).prepend(this.currentItem);}}
return this;},serialize:function(o){var items=this._getItemsAsjQuery(o&&o.connected),str=[];o=o||{};$(items).each(function(){var res=($(o.item||this).attr(o.attribute||'id')||'').match(o.expression||(/(.+)[\-=_](.+)/));if(res){str.push((o.key||res[1]+'[]')+'='+
(o.key&&o.expression?res[1]:res[2]));}});if(!str.length&&o.key){str.push(o.key+'=');}
return str.join('&');},toArray:function(o){var items=this._getItemsAsjQuery(o&&o.connected),ret=[];o=o||{};items.each(function(){ret.push($(o.item||this).attr(o.attribute||'id')||'');});return ret;},_intersectsWith:function(item){var x1=this.positionAbs.left,x2=x1+this.helperProportions.width,y1=this.positionAbs.top,y2=y1+this.helperProportions.height,l=item.left,r=l+item.width,t=item.top,b=t+item.height,dyClick=this.offset.click.top,dxClick=this.offset.click.left,isOverElementHeight=(this.options.axis==='x')||((y1+dyClick)>t&&(y1+dyClick)<b),isOverElementWidth=(this.options.axis==='y')||((x1+dxClick)>l&&(x1+dxClick)<r),isOverElement=isOverElementHeight&&isOverElementWidth;if(this.options.tolerance==='pointer'||this.options.forcePointerForContainers||(this.options.tolerance!=='pointer'&&this.helperProportions[this.floating?'width':'height']>item[this.floating?'width':'height'])){return isOverElement;}else{return(l<x1+(this.helperProportions.width/2)&&x2-(this.helperProportions.width/2)<r&&t<y1+(this.helperProportions.height/2)&&y2-(this.helperProportions.height/2)<b);}},_intersectsWithPointer:function(item){var verticalDirection,horizontalDirection,isOverElementHeight=(this.options.axis==='x')||this._isOverAxis(this.positionAbs.top+this.offset.click.top,item.top,item.height),isOverElementWidth=(this.options.axis==='y')||this._isOverAxis(this.positionAbs.left+this.offset.click.left,item.left,item.width),isOverElement=isOverElementHeight&&isOverElementWidth;if(!isOverElement){return false;}
verticalDirection=this.dragDirection.vertical;horizontalDirection=this.dragDirection.horizontal;return this.floating?((horizontalDirection==='right'||verticalDirection==='down')?2:1):(verticalDirection&&(verticalDirection==='down'?2:1));},_intersectsWithSides:function(item){var isOverBottomHalf=this._isOverAxis(this.positionAbs.top+this.offset.click.top,item.top+(item.height/2),item.height),isOverRightHalf=this._isOverAxis(this.positionAbs.left+this.offset.click.left,item.left+(item.width/2),item.width),verticalDirection=this.dragDirection.vertical,horizontalDirection=this.dragDirection.horizontal;if(this.floating&&horizontalDirection){return((horizontalDirection==='right'&&isOverRightHalf)||(horizontalDirection==='left'&&!isOverRightHalf));}else{return verticalDirection&&((verticalDirection==='down'&&isOverBottomHalf)||(verticalDirection==='up'&&!isOverBottomHalf));}},_getDragVerticalDirection:function(){var delta=this.positionAbs.top-this.lastPositionAbs.top;return delta!==0&&(delta>0?'down':'up');},_getDragHorizontalDirection:function(){var delta=this.positionAbs.left-this.lastPositionAbs.left;return delta!==0&&(delta>0?'right':'left');},refresh:function(event){this._refreshItems(event);this._setHandleClassName();this.refreshPositions();return this;},_connectWith:function(){var options=this.options;return options.connectWith.constructor===String?[options.connectWith]:options.connectWith;},_getItemsAsjQuery:function(connected){var i,j,cur,inst,items=[],queries=[],connectWith=this._connectWith();if(connectWith&&connected){for(i=connectWith.length-1;i>=0;i--){cur=$(connectWith[i],this.document[0]);for(j=cur.length-1;j>=0;j--){inst=$.data(cur[j],this.widgetFullName);if(inst&&inst!==this&&!inst.options.disabled){queries.push([typeof inst.options.items==='function'?inst.options.items.call(inst.element):$(inst.options.items,inst.element).not('.ui-sortable-helper').not('.ui-sortable-placeholder'),inst]);}}}}
queries.push([typeof this.options.items==='function'?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):$(this.options.items,this.element).not('.ui-sortable-helper').not('.ui-sortable-placeholder'),this]);function addItems(){items.push(this);}
for(i=queries.length-1;i>=0;i--){queries[i][0].each(addItems);}
return $(items);},_removeCurrentsFromItems:function(){var list=this.currentItem.find(':data('+this.widgetName+'-item)');this.items=$.grep(this.items,function(item){for(var j=0;j<list.length;j++){if(list[j]===item.item[0]){return false;}}
return true;});},_refreshItems:function(event){this.items=[];this.containers=[this];var i,j,cur,inst,targetData,_queries,item,queriesLength,items=this.items,queries=[[typeof this.options.items==='function'?this.options.items.call(this.element[0],event,{item:this.currentItem}):$(this.options.items,this.element),this]],connectWith=this._connectWith();if(connectWith&&this.ready){for(i=connectWith.length-1;i>=0;i--){cur=$(connectWith[i],this.document[0]);for(j=cur.length-1;j>=0;j--){inst=$.data(cur[j],this.widgetFullName);if(inst&&inst!==this&&!inst.options.disabled){queries.push([typeof inst.options.items==='function'?inst.options.items.call(inst.element[0],event,{item:this.currentItem}):$(inst.options.items,inst.element),inst]);this.containers.push(inst);}}}}
for(i=queries.length-1;i>=0;i--){targetData=queries[i][1];_queries=queries[i][0];for(j=0,queriesLength=_queries.length;j<queriesLength;j++){item=$(_queries[j]);item.data(this.widgetName+'-item',targetData);items.push({item:item,instance:targetData,width:0,height:0,left:0,top:0});}}},_refreshItemPositions:function(fast){var i,item,t,p;for(i=this.items.length-1;i>=0;i--){item=this.items[i];if(this.currentContainer&&item.instance!==this.currentContainer&&item.item[0]!==this.currentItem[0]){continue;}
t=this.options.toleranceElement?$(this.options.toleranceElement,item.item):item.item;if(!fast){item.width=t.outerWidth();item.height=t.outerHeight();}
p=t.offset();item.left=p.left;item.top=p.top;}},refreshPositions:function(fast){this.floating=this.items.length?this.options.axis==='x'||this._isFloating(this.items[0].item):false;if(this.offsetParent&&this.helper){this.offset.parent=this._getParentOffset();}
this._refreshItemPositions(fast);var i,p;if(this.options.custom&&this.options.custom.refreshContainers){this.options.custom.refreshContainers.call(this);}else{for(i=this.containers.length-1;i>=0;i--){p=this.containers[i].element.offset();this.containers[i].containerCache.left=p.left;this.containers[i].containerCache.top=p.top;this.containers[i].containerCache.width=this.containers[i].element.outerWidth();this.containers[i].containerCache.height=this.containers[i].element.outerHeight();}}
return this;},_createPlaceholder:function(that){that=that||this;var className,nodeName,o=that.options;if(!o.placeholder||o.placeholder.constructor===String){className=o.placeholder;nodeName=that.currentItem[0].nodeName.toLowerCase();o.placeholder={element:function(){var element=$('<'+nodeName+'>',that.document[0]);that._addClass(element,'ui-sortable-placeholder',className||that.currentItem[0].className)._removeClass(element,'ui-sortable-helper');if(nodeName==='tbody'){that._createTrPlaceholder(that.currentItem.find('tr').eq(0),$('<tr>',that.document[0]).appendTo(element));}else if(nodeName==='tr'){that._createTrPlaceholder(that.currentItem,element);}else if(nodeName==='img'){element.attr('src',that.currentItem.attr('src'));}
if(!className){element.css('visibility','hidden');}
return element;},update:function(container,p){if(className&&!o.forcePlaceholderSize){return;}
if(!p.height()||(o.forcePlaceholderSize&&(nodeName==='tbody'||nodeName==='tr'))){p.height(that.currentItem.innerHeight()-
parseInt(that.currentItem.css('paddingTop')||0,10)-
parseInt(that.currentItem.css('paddingBottom')||0,10));}
if(!p.width()){p.width(that.currentItem.innerWidth()-
parseInt(that.currentItem.css('paddingLeft')||0,10)-
parseInt(that.currentItem.css('paddingRight')||0,10));}}};}
that.placeholder=$(o.placeholder.element.call(that.element,that.currentItem));that.currentItem.after(that.placeholder);o.placeholder.update(that,that.placeholder);},_createTrPlaceholder:function(sourceTr,targetTr){var that=this;sourceTr.children().each(function(){$('<td>&#160;</td>',that.document[0]).attr('colspan',$(this).attr('colspan')||1).appendTo(targetTr);});},_contactContainers:function(event){var i,j,dist,itemWithLeastDistance,posProperty,sizeProperty,cur,nearBottom,floating,axis,innermostContainer=null,innermostIndex=null;for(i=this.containers.length-1;i>=0;i--){if($.contains(this.currentItem[0],this.containers[i].element[0])){continue;}
if(this._intersectsWith(this.containers[i].containerCache)){if(innermostContainer&&$.contains(this.containers[i].element[0],innermostContainer.element[0])){continue;}
innermostContainer=this.containers[i];innermostIndex=i;}else{if(this.containers[i].containerCache.over){this.containers[i]._trigger('out',event,this._uiHash(this));this.containers[i].containerCache.over=0;}}}
if(!innermostContainer){return;}
if(this.containers.length===1){if(!this.containers[innermostIndex].containerCache.over){this.containers[innermostIndex]._trigger('over',event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1;}}else{dist=10000;itemWithLeastDistance=null;floating=innermostContainer.floating||this._isFloating(this.currentItem);posProperty=floating?'left':'top';sizeProperty=floating?'width':'height';axis=floating?'pageX':'pageY';for(j=this.items.length-1;j>=0;j--){if(!$.contains(this.containers[innermostIndex].element[0],this.items[j].item[0])){continue;}
if(this.items[j].item[0]===this.currentItem[0]){continue;}
cur=this.items[j].item.offset()[posProperty];nearBottom=false;if(event[axis]-cur>this.items[j][sizeProperty]/2){nearBottom=true;}
if(Math.abs(event[axis]-cur)<dist){dist=Math.abs(event[axis]-cur);itemWithLeastDistance=this.items[j];this.direction=nearBottom?'up':'down';}}
if(!itemWithLeastDistance&&!this.options.dropOnEmpty){return;}
if(this.currentContainer===this.containers[innermostIndex]){if(!this.currentContainer.containerCache.over){this.containers[innermostIndex]._trigger('over',event,this._uiHash());this.currentContainer.containerCache.over=1;}
return;}
if(itemWithLeastDistance){this._rearrange(event,itemWithLeastDistance,null,true);}else{this._rearrange(event,null,this.containers[innermostIndex].element,true);}
this._trigger('change',event,this._uiHash());this.containers[innermostIndex]._trigger('change',event,this._uiHash(this));this.currentContainer=this.containers[innermostIndex];this.options.placeholder.update(this.currentContainer,this.placeholder);this.scrollParent=this.placeholder.scrollParent();if(this.scrollParent[0]!==this.document[0]&&this.scrollParent[0].tagName!=='HTML'){this.overflowOffset=this.scrollParent.offset();}
this.containers[innermostIndex]._trigger('over',event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1;}},_createHelper:function(event){var o=this.options,helper=typeof o.helper==='function'?$(o.helper.apply(this.element[0],[event,this.currentItem])):(o.helper==='clone'?this.currentItem.clone():this.currentItem);if(!helper.parents('body').length){this.appendTo[0].appendChild(helper[0]);}
if(helper[0]===this.currentItem[0]){this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css('position'),top:this.currentItem.css('top'),left:this.currentItem.css('left')};}
if(!helper[0].style.width||o.forceHelperSize){helper.width(this.currentItem.width());}
if(!helper[0].style.height||o.forceHelperSize){helper.height(this.currentItem.height());}
return helper;},_adjustOffsetFromHelper:function(obj){if(typeof obj==='string'){obj=obj.split(' ');}
if(Array.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0};}
if('left'in obj){this.offset.click.left=obj.left+this.margins.left;}
if('right'in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left;}
if('top'in obj){this.offset.click.top=obj.top+this.margins.top;}
if('bottom'in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top;}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();if(this.cssPosition==='absolute'&&this.scrollParent[0]!==this.document[0]&&$.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop();}
if(this.offsetParent[0]===this.document[0].body||(this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()==='html'&&$.ui.ie)){po={top:0,left:0};}
return{top:po.top+(parseInt(this.offsetParent.css('borderTopWidth'),10)||0),left:po.left+
(parseInt(this.offsetParent.css('borderLeftWidth'),10)||0)};},_getRelativeOffset:function(){if(this.cssPosition==='relative'){var p=this.currentItem.position();return{top:p.top-(parseInt(this.helper.css('top'),10)||0)+
this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css('left'),10)||0)+
this.scrollParent.scrollLeft()};}else{return{top:0,left:0};}},_cacheMargins:function(){this.margins={left:(parseInt(this.currentItem.css('marginLeft'),10)||0),top:(parseInt(this.currentItem.css('marginTop'),10)||0)};},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};},_setContainment:function(){var ce,co,over,o=this.options;if(o.containment==='parent'){o.containment=this.helper[0].parentNode;}
if(o.containment==='document'||o.containment==='window'){this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,o.containment==='document'?this.document.width():this.window.width()-
this.helperProportions.width-this.margins.left,(o.containment==='document'?(this.document.height()||document.body.parentNode.scrollHeight):this.window.height()||this.document[0].body.parentNode.scrollHeight)-
this.helperProportions.height-this.margins.top];}
if(!(/^(document|window|parent)$/).test(o.containment)){ce=$(o.containment)[0];co=$(o.containment).offset();over=($(ce).css('overflow')!=='hidden');this.containment=[co.left+(parseInt($(ce).css('borderLeftWidth'),10)||0)+
(parseInt($(ce).css('paddingLeft'),10)||0)-this.margins.left,co.top+(parseInt($(ce).css('borderTopWidth'),10)||0)+
(parseInt($(ce).css('paddingTop'),10)||0)-this.margins.top,co.left+
(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-
(parseInt($(ce).css('borderLeftWidth'),10)||0)-
(parseInt($(ce).css('paddingRight'),10)||0)-
this.helperProportions.width-this.margins.left,co.top+
(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-
(parseInt($(ce).css('borderTopWidth'),10)||0)-
(parseInt($(ce).css('paddingBottom'),10)||0)-
this.helperProportions.height-this.margins.top];}},_convertPositionTo:function(d,pos){if(!pos){pos=this.position;}
var mod=d==='absolute'?1:-1,scroll=this.cssPosition==='absolute'&&!(this.scrollParent[0]!==this.document[0]&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);return{top:(pos.top+
this.offset.relative.top*mod+
this.offset.parent.top*mod-
((this.cssPosition==='fixed'?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop()))*mod)),left:(pos.left+
this.offset.relative.left*mod+
this.offset.parent.left*mod-
((this.cssPosition==='fixed'?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod))};},_generatePosition:function(event){var top,left,o=this.options,pageX=event.pageX,pageY=event.pageY,scroll=this.cssPosition==='absolute'&&!(this.scrollParent[0]!==this.document[0]&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);if(this.cssPosition==='relative'&&!(this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0])){this.offset.relative=this._getRelativeOffset();}
if(this.originalPosition){if(this.containment){if(event.pageX-this.offset.click.left<this.containment[0]){pageX=this.containment[0]+this.offset.click.left;}
if(event.pageY-this.offset.click.top<this.containment[1]){pageY=this.containment[1]+this.offset.click.top;}
if(event.pageX-this.offset.click.left>this.containment[2]){pageX=this.containment[2]+this.offset.click.left;}
if(event.pageY-this.offset.click.top>this.containment[3]){pageY=this.containment[3]+this.offset.click.top;}}
if(o.grid){top=this.originalPageY+
Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1];pageY=this.containment?((top-this.offset.click.top>=this.containment[1]&&top-this.offset.click.top<=this.containment[3])?top:((top-this.offset.click.top>=this.containment[1])?top-o.grid[1]:top+o.grid[1])):top;left=this.originalPageX+
Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0];pageX=this.containment?((left-this.offset.click.left>=this.containment[0]&&left-this.offset.click.left<=this.containment[2])?left:((left-this.offset.click.left>=this.containment[0])?left-o.grid[0]:left+o.grid[0])):left;}}
return{top:(pageY-
this.offset.click.top-
this.offset.relative.top-
this.offset.parent.top+
((this.cssPosition==='fixed'?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop())))),left:(pageX-
this.offset.click.left-
this.offset.relative.left-
this.offset.parent.left+
((this.cssPosition==='fixed'?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())))};},_rearrange:function(event,i,a,hardRefresh){if(a){a[0].appendChild(this.placeholder[0]);}else{i.item[0].parentNode.insertBefore(this.placeholder[0],(this.direction==='down'?i.item[0]:i.item[0].nextSibling));}
this.counter=this.counter?++this.counter:1;var counter=this.counter;this._delay(function(){if(counter===this.counter){this.refreshPositions(!hardRefresh);}});},_clear:function(event,noPropagation){this.reverting=false;var i,delayedTriggers=[];if(!this._noFinalSort&&this.currentItem.parent().length){this.placeholder.before(this.currentItem);}
this._noFinalSort=null;if(this.helper[0]===this.currentItem[0]){for(i in this._storedCSS){if(this._storedCSS[i]==='auto'||this._storedCSS[i]==='static'){this._storedCSS[i]='';}}
this.currentItem.css(this._storedCSS);this._removeClass(this.currentItem,'ui-sortable-helper');}else{this.currentItem.show();}
if(this.fromOutside&&!noPropagation){delayedTriggers.push(function(event){this._trigger('receive',event,this._uiHash(this.fromOutside));});}
if((this.fromOutside||this.domPosition.prev!==this.currentItem.prev().not('.ui-sortable-helper')[0]||this.domPosition.parent!==this.currentItem.parent()[0])&&!noPropagation){delayedTriggers.push(function(event){this._trigger('update',event,this._uiHash());});}
if(this!==this.currentContainer){if(!noPropagation){delayedTriggers.push(function(event){this._trigger('remove',event,this._uiHash());});delayedTriggers.push((function(c){return function(event){c._trigger('receive',event,this._uiHash(this));};}).call(this,this.currentContainer));delayedTriggers.push((function(c){return function(event){c._trigger('update',event,this._uiHash(this));};}).call(this,this.currentContainer));}}
function delayEvent(type,instance,container){return function(event){container._trigger(type,event,instance._uiHash(instance));};}
for(i=this.containers.length-1;i>=0;i--){if(!noPropagation){delayedTriggers.push(delayEvent('deactivate',this,this.containers[i]));}
if(this.containers[i].containerCache.over){delayedTriggers.push(delayEvent('out',this,this.containers[i]));this.containers[i].containerCache.over=0;}}
if(this.storedCursor){this.document.find('body').css('cursor',this.storedCursor);this.storedStylesheet.remove();}
if(this._storedOpacity){this.helper.css('opacity',this._storedOpacity);}
if(this._storedZIndex){this.helper.css('zIndex',this._storedZIndex==='auto'?'':this._storedZIndex);}
this.dragging=false;if(!noPropagation){this._trigger('beforeStop',event,this._uiHash());}
this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(!this.cancelHelperRemoval){if(this.helper[0]!==this.currentItem[0]){this.helper.remove();}
this.helper=null;}
if(!noPropagation){for(i=0;i<delayedTriggers.length;i++){delayedTriggers[i].call(this,event);}
this._trigger('stop',event,this._uiHash());}
this.fromOutside=false;return!this.cancelHelperRemoval;},_trigger:function(){if($.Widget.prototype._trigger.apply(this,arguments)===false){this.cancel();}},_uiHash:function(_inst){var inst=_inst||this;return{helper:inst.helper,placeholder:inst.placeholder||$([]),position:inst.position,originalPosition:inst.originalPosition,offset:inst.positionAbs,item:inst.currentItem,sender:_inst?_inst.element:null};}});
/*!
 * jQuery UI Spinner 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
function spinnerModifier(fn){return function(){var previous=this.element.val();fn.apply(this,arguments);this._refresh();if(previous!==this.element.val()){this._trigger('change');}};}
$.widget('ui.spinner',{version:'1.13.2',defaultElement:'<input>',widgetEventPrefix:'spin',options:{classes:{'ui-spinner':'ui-corner-all','ui-spinner-down':'ui-corner-br','ui-spinner-up':'ui-corner-tr'},culture:null,icons:{down:'ui-icon-triangle-1-s',up:'ui-icon-triangle-1-n'},incremental:true,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption('max',this.options.max);this._setOption('min',this.options.min);this._setOption('step',this.options.step);if(this.value()!==''){this._value(this.element.val(),true);}
this._draw();this._on(this._events);this._refresh();this._on(this.window,{beforeunload:function(){this.element.removeAttr('autocomplete');}});},_getCreateOptions:function(){var options=this._super();var element=this.element;$.each(['min','max','step'],function(i,option){var value=element.attr(option);if(value!=null&&value.length){options[option]=value;}});return options;},_events:{keydown:function(event){if(this._start(event)&&this._keydown(event)){event.preventDefault();}},keyup:'_stop',focus:function(){this.previous=this.element.val();},blur:function(event){if(this.cancelBlur){delete this.cancelBlur;return;}
this._stop();this._refresh();if(this.previous!==this.element.val()){this._trigger('change',event);}},mousewheel:function(event,delta){var activeElement=$.ui.safeActiveElement(this.document[0]);var isActive=this.element[0]===activeElement;if(!isActive||!delta){return;}
if(!this.spinning&&!this._start(event)){return false;}
this._spin((delta>0?1:-1)*this.options.step,event);clearTimeout(this.mousewheelTimer);this.mousewheelTimer=this._delay(function(){if(this.spinning){this._stop(event);}},100);event.preventDefault();},'mousedown .ui-spinner-button':function(event){var previous;previous=this.element[0]===$.ui.safeActiveElement(this.document[0])?this.previous:this.element.val();function checkFocus(){var isActive=this.element[0]===$.ui.safeActiveElement(this.document[0]);if(!isActive){this.element.trigger('focus');this.previous=previous;this._delay(function(){this.previous=previous;});}}
event.preventDefault();checkFocus.call(this);this.cancelBlur=true;this._delay(function(){delete this.cancelBlur;checkFocus.call(this);});if(this._start(event)===false){return;}
this._repeat(null,$(event.currentTarget).hasClass('ui-spinner-up')?1:-1,event);},'mouseup .ui-spinner-button':'_stop','mouseenter .ui-spinner-button':function(event){if(!$(event.currentTarget).hasClass('ui-state-active')){return;}
if(this._start(event)===false){return false;}
this._repeat(null,$(event.currentTarget).hasClass('ui-spinner-up')?1:-1,event);},'mouseleave .ui-spinner-button':'_stop'},_enhance:function(){this.uiSpinner=this.element.attr('autocomplete','off').wrap('<span>').parent().append('<a></a><a></a>');},_draw:function(){this._enhance();this._addClass(this.uiSpinner,'ui-spinner','ui-widget ui-widget-content');this._addClass('ui-spinner-input');this.element.attr('role','spinbutton');this.buttons=this.uiSpinner.children('a').attr('tabIndex',-1).attr('aria-hidden',true).button({classes:{'ui-button':''}});this._removeClass(this.buttons,'ui-corner-all');this._addClass(this.buttons.first(),'ui-spinner-button ui-spinner-up');this._addClass(this.buttons.last(),'ui-spinner-button ui-spinner-down');this.buttons.first().button({'icon':this.options.icons.up,'showLabel':false});this.buttons.last().button({'icon':this.options.icons.down,'showLabel':false});if(this.buttons.height()>Math.ceil(this.uiSpinner.height()*0.5)&&this.uiSpinner.height()>0){this.uiSpinner.height(this.uiSpinner.height());}},_keydown:function(event){var options=this.options,keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.UP:this._repeat(null,1,event);return true;case keyCode.DOWN:this._repeat(null,-1,event);return true;case keyCode.PAGE_UP:this._repeat(null,options.page,event);return true;case keyCode.PAGE_DOWN:this._repeat(null,-options.page,event);return true;}
return false;},_start:function(event){if(!this.spinning&&this._trigger('start',event)===false){return false;}
if(!this.counter){this.counter=1;}
this.spinning=true;return true;},_repeat:function(i,steps,event){i=i||500;clearTimeout(this.timer);this.timer=this._delay(function(){this._repeat(40,steps,event);},i);this._spin(steps*this.options.step,event);},_spin:function(step,event){var value=this.value()||0;if(!this.counter){this.counter=1;}
value=this._adjustValue(value+step*this._increment(this.counter));if(!this.spinning||this._trigger('spin',event,{value:value})!==false){this._value(value);this.counter++;}},_increment:function(i){var incremental=this.options.incremental;if(incremental){return typeof incremental==='function'?incremental(i):Math.floor(i*i*i/50000-i*i/500+17*i/200+1);}
return 1;},_precision:function(){var precision=this._precisionOf(this.options.step);if(this.options.min!==null){precision=Math.max(precision,this._precisionOf(this.options.min));}
return precision;},_precisionOf:function(num){var str=num.toString(),decimal=str.indexOf('.');return decimal===-1?0:str.length-decimal-1;},_adjustValue:function(value){var base,aboveMin,options=this.options;base=options.min!==null?options.min:0;aboveMin=value-base;aboveMin=Math.round(aboveMin/options.step)*options.step;value=base+aboveMin;value=parseFloat(value.toFixed(this._precision()));if(options.max!==null&&value>options.max){return options.max;}
if(options.min!==null&&value<options.min){return options.min;}
return value;},_stop:function(event){if(!this.spinning){return;}
clearTimeout(this.timer);clearTimeout(this.mousewheelTimer);this.counter=0;this.spinning=false;this._trigger('stop',event);},_setOption:function(key,value){var prevValue,first,last;if(key==='culture'||key==='numberFormat'){prevValue=this._parse(this.element.val());this.options[key]=value;this.element.val(this._format(prevValue));return;}
if(key==='max'||key==='min'||key==='step'){if(typeof value==='string'){value=this._parse(value);}}
if(key==='icons'){first=this.buttons.first().find('.ui-icon');this._removeClass(first,null,this.options.icons.up);this._addClass(first,null,value.up);last=this.buttons.last().find('.ui-icon');this._removeClass(last,null,this.options.icons.down);this._addClass(last,null,value.down);}
this._super(key,value);},_setOptionDisabled:function(value){this._super(value);this._toggleClass(this.uiSpinner,null,'ui-state-disabled',!!value);this.element.prop('disabled',!!value);this.buttons.button(value?'disable':'enable');},_setOptions:spinnerModifier(function(options){this._super(options);}),_parse:function(val){if(typeof val==='string'&&val!==''){val=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(val,10,this.options.culture):+val;}
return val===''||isNaN(val)?null:val;},_format:function(value){if(value===''){return'';}
return window.Globalize&&this.options.numberFormat?Globalize.format(value,this.options.numberFormat,this.options.culture):value;},_refresh:function(){this.element.attr({'aria-valuemin':this.options.min,'aria-valuemax':this.options.max,'aria-valuenow':this._parse(this.element.val())});},isValid:function(){var value=this.value();if(value===null){return false;}
return value===this._adjustValue(value);},_value:function(value,allowAny){var parsed;if(value!==''){parsed=this._parse(value);if(parsed!==null){if(!allowAny){parsed=this._adjustValue(parsed);}
value=this._format(parsed);}}
this.element.val(value);this._refresh();},_destroy:function(){this.element.prop('disabled',false).removeAttr('autocomplete role aria-valuemin aria-valuemax aria-valuenow');this.uiSpinner.replaceWith(this.element);},stepUp:spinnerModifier(function(steps){this._stepUp(steps);}),_stepUp:function(steps){if(this._start()){this._spin((steps||1)*this.options.step);this._stop();}},stepDown:spinnerModifier(function(steps){this._stepDown(steps);}),_stepDown:function(steps){if(this._start()){this._spin((steps||1)*-this.options.step);this._stop();}},pageUp:spinnerModifier(function(pages){this._stepUp((pages||1)*this.options.page);}),pageDown:spinnerModifier(function(pages){this._stepDown((pages||1)*this.options.page);}),value:function(newVal){if(!arguments.length){return this._parse(this.element.val());}
spinnerModifier(this._value).call(this,newVal);},widget:function(){return this.uiSpinner;}});if($.uiBackCompat!==false){$.widget('ui.spinner',$.ui.spinner,{_enhance:function(){this.uiSpinner=this.element.attr('autocomplete','off').wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());},_uiSpinnerHtml:function(){return'<span>';},_buttonHtml:function(){return'<a></a><a></a>';}});}
var widgetsSpinner=$.ui.spinner;
/*!
 * jQuery UI Tabs 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
$.widget('ui.tabs',{version:'1.13.2',delay:300,options:{active:null,classes:{'ui-tabs':'ui-corner-all','ui-tabs-nav':'ui-corner-all','ui-tabs-panel':'ui-corner-bottom','ui-tabs-tab':'ui-corner-top'},collapsible:false,event:'click',heightStyle:'content',hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:(function(){var rhash=/#.*$/;return function(anchor){var anchorUrl,locationUrl;anchorUrl=anchor.href.replace(rhash,'');locationUrl=location.href.replace(rhash,'');try{anchorUrl=decodeURIComponent(anchorUrl);}catch(error){}
try{locationUrl=decodeURIComponent(locationUrl);}catch(error){}
return anchor.hash.length>1&&anchorUrl===locationUrl;};})(),_create:function(){var that=this,options=this.options;this.running=false;this._addClass('ui-tabs','ui-widget ui-widget-content');this._toggleClass('ui-tabs-collapsible',null,options.collapsible);this._processTabs();options.active=this._initialActive();if(Array.isArray(options.disabled)){options.disabled=$.uniqueSort(options.disabled.concat($.map(this.tabs.filter('.ui-state-disabled'),function(li){return that.tabs.index(li);}))).sort();}
if(this.options.active!==false&&this.anchors.length){this.active=this._findActive(options.active);}else{this.active=$();}
this._refresh();if(this.active.length){this.load(options.active);}},_initialActive:function(){var active=this.options.active,collapsible=this.options.collapsible,locationHash=location.hash.substring(1);if(active===null){if(locationHash){this.tabs.each(function(i,tab){if($(tab).attr('aria-controls')===locationHash){active=i;return false;}});}
if(active===null){active=this.tabs.index(this.tabs.filter('.ui-tabs-active'));}
if(active===null||active===-1){active=this.tabs.length?0:false;}}
if(active!==false){active=this.tabs.index(this.tabs.eq(active));if(active===-1){active=collapsible?false:0;}}
if(!collapsible&&active===false&&this.anchors.length){active=0;}
return active;},_getCreateEventData:function(){return{tab:this.active,panel:!this.active.length?$():this._getPanelForTab(this.active)};},_tabKeydown:function(event){var focusedTab=$($.ui.safeActiveElement(this.document[0])).closest('li'),selectedIndex=this.tabs.index(focusedTab),goingForward=true;if(this._handlePageNav(event)){return;}
switch(event.keyCode){case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:selectedIndex++;break;case $.ui.keyCode.UP:case $.ui.keyCode.LEFT:goingForward=false;selectedIndex--;break;case $.ui.keyCode.END:selectedIndex=this.anchors.length-1;break;case $.ui.keyCode.HOME:selectedIndex=0;break;case $.ui.keyCode.SPACE:event.preventDefault();clearTimeout(this.activating);this._activate(selectedIndex);return;case $.ui.keyCode.ENTER:event.preventDefault();clearTimeout(this.activating);this._activate(selectedIndex===this.options.active?false:selectedIndex);return;default:return;}
event.preventDefault();clearTimeout(this.activating);selectedIndex=this._focusNextTab(selectedIndex,goingForward);if(!event.ctrlKey&&!event.metaKey){focusedTab.attr('aria-selected','false');this.tabs.eq(selectedIndex).attr('aria-selected','true');this.activating=this._delay(function(){this.option('active',selectedIndex);},this.delay);}},_panelKeydown:function(event){if(this._handlePageNav(event)){return;}
if(event.ctrlKey&&event.keyCode===$.ui.keyCode.UP){event.preventDefault();this.active.trigger('focus');}},_handlePageNav:function(event){if(event.altKey&&event.keyCode===$.ui.keyCode.PAGE_UP){this._activate(this._focusNextTab(this.options.active-1,false));return true;}
if(event.altKey&&event.keyCode===$.ui.keyCode.PAGE_DOWN){this._activate(this._focusNextTab(this.options.active+1,true));return true;}},_findNextTab:function(index,goingForward){var lastTabIndex=this.tabs.length-1;function constrain(){if(index>lastTabIndex){index=0;}
if(index<0){index=lastTabIndex;}
return index;}
while($.inArray(constrain(),this.options.disabled)!==-1){index=goingForward?index+1:index-1;}
return index;},_focusNextTab:function(index,goingForward){index=this._findNextTab(index,goingForward);this.tabs.eq(index).trigger('focus');return index;},_setOption:function(key,value){if(key==='active'){this._activate(value);return;}
this._super(key,value);if(key==='collapsible'){this._toggleClass('ui-tabs-collapsible',null,value);if(!value&&this.options.active===false){this._activate(0);}}
if(key==='event'){this._setupEvents(value);}
if(key==='heightStyle'){this._setupHeightStyle(value);}},_sanitizeSelector:function(hash){return hash?hash.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,'\\$&'):'';},refresh:function(){var options=this.options,lis=this.tablist.children(':has(a[href])');options.disabled=$.map(lis.filter('.ui-state-disabled'),function(tab){return lis.index(tab);});this._processTabs();if(options.active===false||!this.anchors.length){options.active=false;this.active=$();}else if(this.active.length&&!$.contains(this.tablist[0],this.active[0])){if(this.tabs.length===options.disabled.length){options.active=false;this.active=$();}else{this._activate(this._findNextTab(Math.max(0,options.active-1),false));}}else{options.active=this.tabs.index(this.active);}
this._refresh();},_refresh:function(){this._setOptionDisabled(this.options.disabled);this._setupEvents(this.options.event);this._setupHeightStyle(this.options.heightStyle);this.tabs.not(this.active).attr({'aria-selected':'false','aria-expanded':'false',tabIndex:-1});this.panels.not(this._getPanelForTab(this.active)).hide().attr({'aria-hidden':'true'});if(!this.active.length){this.tabs.eq(0).attr('tabIndex',0);}else{this.active.attr({'aria-selected':'true','aria-expanded':'true',tabIndex:0});this._addClass(this.active,'ui-tabs-active','ui-state-active');this._getPanelForTab(this.active).show().attr({'aria-hidden':'false'});}},_processTabs:function(){var that=this,prevTabs=this.tabs,prevAnchors=this.anchors,prevPanels=this.panels;this.tablist=this._getList().attr('role','tablist');this._addClass(this.tablist,'ui-tabs-nav','ui-helper-reset ui-helper-clearfix ui-widget-header');this.tablist.on('mousedown'+this.eventNamespace,'> li',function(event){if($(this).is('.ui-state-disabled')){event.preventDefault();}}).on('focus'+this.eventNamespace,'.ui-tabs-anchor',function(){if($(this).closest('li').is('.ui-state-disabled')){this.blur();}});this.tabs=this.tablist.find('> li:has(a[href])').attr({role:'tab',tabIndex:-1});this._addClass(this.tabs,'ui-tabs-tab','ui-state-default');this.anchors=this.tabs.map(function(){return $('a',this)[0];}).attr({tabIndex:-1});this._addClass(this.anchors,'ui-tabs-anchor');this.panels=$();this.anchors.each(function(i,anchor){var selector,panel,panelId,anchorId=$(anchor).uniqueId().attr('id'),tab=$(anchor).closest('li'),originalAriaControls=tab.attr('aria-controls');if(that._isLocal(anchor)){selector=anchor.hash;panelId=selector.substring(1);panel=that.element.find(that._sanitizeSelector(selector));}else{panelId=tab.attr('aria-controls')||$({}).uniqueId()[0].id;selector='#'+panelId;panel=that.element.find(selector);if(!panel.length){panel=that._createPanel(panelId);panel.insertAfter(that.panels[i-1]||that.tablist);}
panel.attr('aria-live','polite');}
if(panel.length){that.panels=that.panels.add(panel);}
if(originalAriaControls){tab.data('ui-tabs-aria-controls',originalAriaControls);}
tab.attr({'aria-controls':panelId,'aria-labelledby':anchorId});panel.attr('aria-labelledby',anchorId);});this.panels.attr('role','tabpanel');this._addClass(this.panels,'ui-tabs-panel','ui-widget-content');if(prevTabs){this._off(prevTabs.not(this.tabs));this._off(prevAnchors.not(this.anchors));this._off(prevPanels.not(this.panels));}},_getList:function(){return this.tablist||this.element.find('ol, ul').eq(0);},_createPanel:function(id){return $('<div>').attr('id',id).data('ui-tabs-destroy',true);},_setOptionDisabled:function(disabled){var currentItem,li,i;if(Array.isArray(disabled)){if(!disabled.length){disabled=false;}else if(disabled.length===this.anchors.length){disabled=true;}}
for(i=0;(li=this.tabs[i]);i++){currentItem=$(li);if(disabled===true||$.inArray(i,disabled)!==-1){currentItem.attr('aria-disabled','true');this._addClass(currentItem,null,'ui-state-disabled');}else{currentItem.removeAttr('aria-disabled');this._removeClass(currentItem,null,'ui-state-disabled');}}
this.options.disabled=disabled;this._toggleClass(this.widget(),this.widgetFullName+'-disabled',null,disabled===true);},_setupEvents:function(event){var events={};if(event){$.each(event.split(' '),function(index,eventName){events[eventName]='_eventHandler';});}
this._off(this.anchors.add(this.tabs).add(this.panels));this._on(true,this.anchors,{click:function(event){event.preventDefault();}});this._on(this.anchors,events);this._on(this.tabs,{keydown:'_tabKeydown'});this._on(this.panels,{keydown:'_panelKeydown'});this._focusable(this.tabs);this._hoverable(this.tabs);},_setupHeightStyle:function(heightStyle){var maxHeight,parent=this.element.parent();if(heightStyle==='fill'){maxHeight=parent.height();maxHeight-=this.element.outerHeight()-this.element.height();this.element.siblings(':visible').each(function(){var elem=$(this),position=elem.css('position');if(position==='absolute'||position==='fixed'){return;}
maxHeight-=elem.outerHeight(true);});this.element.children().not(this.panels).each(function(){maxHeight-=$(this).outerHeight(true);});this.panels.each(function(){$(this).height(Math.max(0,maxHeight-$(this).innerHeight()+$(this).height()));}).css('overflow','auto');}else if(heightStyle==='auto'){maxHeight=0;this.panels.each(function(){maxHeight=Math.max(maxHeight,$(this).height('').height());}).height(maxHeight);}},_eventHandler:function(event){var options=this.options,active=this.active,anchor=$(event.currentTarget),tab=anchor.closest('li'),clickedIsActive=tab[0]===active[0],collapsing=clickedIsActive&&options.collapsible,toShow=collapsing?$():this._getPanelForTab(tab),toHide=!active.length?$():this._getPanelForTab(active),eventData={oldTab:active,oldPanel:toHide,newTab:collapsing?$():tab,newPanel:toShow};event.preventDefault();if(tab.hasClass('ui-state-disabled')||tab.hasClass('ui-tabs-loading')||this.running||(clickedIsActive&&!options.collapsible)||(this._trigger('beforeActivate',event,eventData)===false)){return;}
options.active=collapsing?false:this.tabs.index(tab);this.active=clickedIsActive?$():tab;if(this.xhr){this.xhr.abort();}
if(!toHide.length&&!toShow.length){$.error('jQuery UI Tabs: Mismatching fragment identifier.');}
if(toShow.length){this.load(this.tabs.index(tab),event);}
this._toggle(event,eventData);},_toggle:function(event,eventData){var that=this,toShow=eventData.newPanel,toHide=eventData.oldPanel;this.running=true;function complete(){that.running=false;that._trigger('activate',event,eventData);}
function show(){that._addClass(eventData.newTab.closest('li'),'ui-tabs-active','ui-state-active');if(toShow.length&&that.options.show){that._show(toShow,that.options.show,complete);}else{toShow.show();complete();}}
if(toHide.length&&this.options.hide){this._hide(toHide,this.options.hide,function(){that._removeClass(eventData.oldTab.closest('li'),'ui-tabs-active','ui-state-active');show();});}else{this._removeClass(eventData.oldTab.closest('li'),'ui-tabs-active','ui-state-active');toHide.hide();show();}
toHide.attr('aria-hidden','true');eventData.oldTab.attr({'aria-selected':'false','aria-expanded':'false'});if(toShow.length&&toHide.length){eventData.oldTab.attr('tabIndex',-1);}else if(toShow.length){this.tabs.filter(function(){return $(this).attr('tabIndex')===0;}).attr('tabIndex',-1);}
toShow.attr('aria-hidden','false');eventData.newTab.attr({'aria-selected':'true','aria-expanded':'true',tabIndex:0});},_activate:function(index){var anchor,active=this._findActive(index);if(active[0]===this.active[0]){return;}
if(!active.length){active=this.active;}
anchor=active.find('.ui-tabs-anchor')[0];this._eventHandler({target:anchor,currentTarget:anchor,preventDefault:$.noop});},_findActive:function(index){return index===false?$():this.tabs.eq(index);},_getIndex:function(index){if(typeof index==='string'){index=this.anchors.index(this.anchors.filter('[href$=\''+$.escapeSelector(index)+'\']'));}
return index;},_destroy:function(){if(this.xhr){this.xhr.abort();}
this.tablist.removeAttr('role').off(this.eventNamespace);this.anchors.removeAttr('role tabIndex').removeUniqueId();this.tabs.add(this.panels).each(function(){if($.data(this,'ui-tabs-destroy')){$(this).remove();}else{$(this).removeAttr('role tabIndex '+'aria-live aria-busy aria-selected aria-labelledby aria-hidden aria-expanded');}});this.tabs.each(function(){var li=$(this),prev=li.data('ui-tabs-aria-controls');if(prev){li.attr('aria-controls',prev).removeData('ui-tabs-aria-controls');}else{li.removeAttr('aria-controls');}});this.panels.show();if(this.options.heightStyle!=='content'){this.panels.css('height','');}},enable:function(index){var disabled=this.options.disabled;if(disabled===false){return;}
if(index===undefined){disabled=false;}else{index=this._getIndex(index);if(Array.isArray(disabled)){disabled=$.map(disabled,function(num){return num!==index?num:null;});}else{disabled=$.map(this.tabs,function(li,num){return num!==index?num:null;});}}
this._setOptionDisabled(disabled);},disable:function(index){var disabled=this.options.disabled;if(disabled===true){return;}
if(index===undefined){disabled=true;}else{index=this._getIndex(index);if($.inArray(index,disabled)!==-1){return;}
if(Array.isArray(disabled)){disabled=$.merge([index],disabled).sort();}else{disabled=[index];}}
this._setOptionDisabled(disabled);},load:function(index,event){index=this._getIndex(index);var that=this,tab=this.tabs.eq(index),anchor=tab.find('.ui-tabs-anchor'),panel=this._getPanelForTab(tab),eventData={tab:tab,panel:panel},complete=function(jqXHR,status){if(status==='abort'){that.panels.stop(false,true);}
that._removeClass(tab,'ui-tabs-loading');panel.removeAttr('aria-busy');if(jqXHR===that.xhr){delete that.xhr;}};if(this._isLocal(anchor[0])){return;}
this.xhr=$.ajax(this._ajaxSettings(anchor,event,eventData));if(this.xhr&&this.xhr.statusText!=='canceled'){this._addClass(tab,'ui-tabs-loading');panel.attr('aria-busy','true');this.xhr.done(function(response,status,jqXHR){setTimeout(function(){panel.html(response);that._trigger('load',event,eventData);complete(jqXHR,status);},1);}).fail(function(jqXHR,status){setTimeout(function(){complete(jqXHR,status);},1);});}},_ajaxSettings:function(anchor,event,eventData){var that=this;return{url:anchor.attr('href').replace(/#.*$/,''),beforeSend:function(jqXHR,settings){return that._trigger('beforeLoad',event,$.extend({jqXHR:jqXHR,ajaxSettings:settings},eventData));}};},_getPanelForTab:function(tab){var id=$(tab).attr('aria-controls');return this.element.find(this._sanitizeSelector('#'+id));}});if($.uiBackCompat!==false){$.widget('ui.tabs',$.ui.tabs,{_processTabs:function(){this._superApply(arguments);this._addClass(this.tabs,'ui-tab');}});}
var widgetsTabs=$.ui.tabs;
/*!
 * jQuery UI Tooltip 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
$.widget('ui.tooltip',{version:'1.13.2',options:{classes:{'ui-tooltip':'ui-corner-all ui-widget-shadow'},content:function(){var title=$(this).attr('title');return $('<a>').text(title).html();},hide:true,items:'[title]:not([disabled])',position:{my:'left top+15',at:'left bottom',collision:'flipfit flip'},show:true,track:false,close:null,open:null},_addDescribedBy:function(elem,id){var describedby=(elem.attr('aria-describedby')||'').split(/\s+/);describedby.push(id);elem.data('ui-tooltip-id',id).attr('aria-describedby',String.prototype.trim.call(describedby.join(' ')));},_removeDescribedBy:function(elem){var id=elem.data('ui-tooltip-id'),describedby=(elem.attr('aria-describedby')||'').split(/\s+/),index=$.inArray(id,describedby);if(index!==-1){describedby.splice(index,1);}
elem.removeData('ui-tooltip-id');describedby=String.prototype.trim.call(describedby.join(' '));if(describedby){elem.attr('aria-describedby',describedby);}else{elem.removeAttr('aria-describedby');}},_create:function(){this._on({mouseover:'open',focusin:'open'});this.tooltips={};this.parents={};this.liveRegion=$('<div>').attr({role:'log','aria-live':'assertive','aria-relevant':'additions'}).appendTo(this.document[0].body);this._addClass(this.liveRegion,null,'ui-helper-hidden-accessible');this.disabledTitles=$([]);},_setOption:function(key,value){var that=this;this._super(key,value);if(key==='content'){$.each(this.tooltips,function(id,tooltipData){that._updateContent(tooltipData.element);});}},_setOptionDisabled:function(value){this[value?'_disable':'_enable']();},_disable:function(){var that=this;$.each(this.tooltips,function(id,tooltipData){var event=$.Event('blur');event.target=event.currentTarget=tooltipData.element[0];that.close(event,true);});this.disabledTitles=this.disabledTitles.add(this.element.find(this.options.items).addBack().filter(function(){var element=$(this);if(element.is('[title]')){return element.data('ui-tooltip-title',element.attr('title')).removeAttr('title');}}));},_enable:function(){this.disabledTitles.each(function(){var element=$(this);if(element.data('ui-tooltip-title')){element.attr('title',element.data('ui-tooltip-title'));}});this.disabledTitles=$([]);},open:function(event){var that=this,target=$(event?event.target:this.element).closest(this.options.items);if(!target.length||target.data('ui-tooltip-id')){return;}
if(target.attr('title')){target.data('ui-tooltip-title',target.attr('title'));}
target.data('ui-tooltip-open',true);if(event&&event.type==='mouseover'){target.parents().each(function(){var parent=$(this),blurEvent;if(parent.data('ui-tooltip-open')){blurEvent=$.Event('blur');blurEvent.target=blurEvent.currentTarget=this;that.close(blurEvent,true);}
if(parent.attr('title')){parent.uniqueId();that.parents[this.id]={element:this,title:parent.attr('title')};parent.attr('title','');}});}
this._registerCloseHandlers(event,target);this._updateContent(target,event);},_updateContent:function(target,event){var content,contentOption=this.options.content,that=this,eventType=event?event.type:null;if(typeof contentOption==='string'||contentOption.nodeType||contentOption.jquery){return this._open(event,target,contentOption);}
content=contentOption.call(target[0],function(response){that._delay(function(){if(!target.data('ui-tooltip-open')){return;}
if(event){event.type=eventType;}
this._open(event,target,response);});});if(content){this._open(event,target,content);}},_open:function(event,target,content){var tooltipData,tooltip,delayedShow,a11yContent,positionOption=$.extend({},this.options.position);if(!content){return;}
tooltipData=this._find(target);if(tooltipData){tooltipData.tooltip.find('.ui-tooltip-content').html(content);return;}
if(target.is('[title]')){if(event&&event.type==='mouseover'){target.attr('title','');}else{target.removeAttr('title');}}
tooltipData=this._tooltip(target);tooltip=tooltipData.tooltip;this._addDescribedBy(target,tooltip.attr('id'));tooltip.find('.ui-tooltip-content').html(content);this.liveRegion.children().hide();a11yContent=$('<div>').html(tooltip.find('.ui-tooltip-content').html());a11yContent.removeAttr('name').find('[name]').removeAttr('name');a11yContent.removeAttr('id').find('[id]').removeAttr('id');a11yContent.appendTo(this.liveRegion);function position(event){positionOption.of=event;if(tooltip.is(':hidden')){return;}
tooltip.position(positionOption);}
if(this.options.track&&event&&/^mouse/.test(event.type)){this._on(this.document,{mousemove:position});position(event);}else{tooltip.position($.extend({of:target},this.options.position));}
tooltip.hide();this._show(tooltip,this.options.show);if(this.options.track&&this.options.show&&this.options.show.delay){delayedShow=this.delayedShow=setInterval(function(){if(tooltip.is(':visible')){position(positionOption.of);clearInterval(delayedShow);}},13);}
this._trigger('open',event,{tooltip:tooltip});},_registerCloseHandlers:function(event,target){var events={keyup:function(event){if(event.keyCode===$.ui.keyCode.ESCAPE){var fakeEvent=$.Event(event);fakeEvent.currentTarget=target[0];this.close(fakeEvent,true);}}};if(target[0]!==this.element[0]){events.remove=function(){var targetElement=this._find(target);if(targetElement){this._removeTooltip(targetElement.tooltip);}};}
if(!event||event.type==='mouseover'){events.mouseleave='close';}
if(!event||event.type==='focusin'){events.focusout='close';}
this._on(true,target,events);},close:function(event){var tooltip,that=this,target=$(event?event.currentTarget:this.element),tooltipData=this._find(target);if(!tooltipData){target.removeData('ui-tooltip-open');return;}
tooltip=tooltipData.tooltip;if(tooltipData.closing){return;}
clearInterval(this.delayedShow);if(target.data('ui-tooltip-title')&&!target.attr('title')){target.attr('title',target.data('ui-tooltip-title'));}
this._removeDescribedBy(target);tooltipData.hiding=true;tooltip.stop(true);this._hide(tooltip,this.options.hide,function(){that._removeTooltip($(this));});target.removeData('ui-tooltip-open');this._off(target,'mouseleave focusout keyup');if(target[0]!==this.element[0]){this._off(target,'remove');}
this._off(this.document,'mousemove');if(event&&event.type==='mouseleave'){$.each(this.parents,function(id,parent){$(parent.element).attr('title',parent.title);delete that.parents[id];});}
tooltipData.closing=true;this._trigger('close',event,{tooltip:tooltip});if(!tooltipData.hiding){tooltipData.closing=false;}},_tooltip:function(element){var tooltip=$('<div>').attr('role','tooltip'),content=$('<div>').appendTo(tooltip),id=tooltip.uniqueId().attr('id');this._addClass(content,'ui-tooltip-content');this._addClass(tooltip,'ui-tooltip','ui-widget ui-widget-content');tooltip.appendTo(this._appendTo(element));return this.tooltips[id]={element:element,tooltip:tooltip};},_find:function(target){var id=target.data('ui-tooltip-id');return id?this.tooltips[id]:null;},_removeTooltip:function(tooltip){clearInterval(this.delayedShow);tooltip.remove();delete this.tooltips[tooltip.attr('id')];},_appendTo:function(target){var element=target.closest('.ui-front, dialog');if(!element.length){element=this.document[0].body;}
return element;},_destroy:function(){var that=this;$.each(this.tooltips,function(id,tooltipData){var event=$.Event('blur'),element=tooltipData.element;event.target=event.currentTarget=element[0];that.close(event,true);$('#'+id).remove();if(element.data('ui-tooltip-title')){if(!element.attr('title')){element.attr('title',element.data('ui-tooltip-title'));}
element.removeData('ui-tooltip-title');}});this.liveRegion.remove();}});if($.uiBackCompat!==false){$.widget('ui.tooltip',$.ui.tooltip,{options:{tooltipClass:null},_tooltip:function(){var tooltipData=this._superApply(arguments);if(this.options.tooltipClass){tooltipData.tooltip.addClass(this.options.tooltipClass);}
return tooltipData;}});}
var widgetsTooltip=$.ui.tooltip;});
/*! jQuery Mobile v1.4.5 | Copyright 2010, 2014 jQuery Foundation, Inc. | jquery.org/license */
(function(e,t,n){typeof define=="function"&&define.amd?define(["jquery"],function(r){return n(r,e,t),r.mobile}):n(e.jQuery,e,t)})(this,document,function(e,t,n,r){(function(e,t,n,r){function T(e){while(e&&typeof e.originalEvent!="undefined")e=e.originalEvent;return e}
function N(t,n){var i=t.type,s,o,a,l,c,h,p,d,v;t=e.Event(t),t.type=n,s=t.originalEvent,o=e.event.props,i.search(/^(mouse|click)/)>-1&&(o=f);if(s)
for(p=o.length,l;p;)l=o[--p],t[l]=s[l];i.search(/mouse(down|up)|click/)>-1&&!t.which&&(t.which=1);if(i.search(/^touch/)!==-1){a=T(s),i=a.touches,c=a.changedTouches,h=i&&i.length?i[0]:c&&c.length?c[0]:r;if(h)
for(d=0,v=u.length;d<v;d++)l=u[d],t[l]=h[l]}
return t}
function C(t){var n={},r,s;while(t){r=e.data(t,i);for(s in r)r[s]&&(n[s]=n.hasVirtualBinding=!0);t=t.parentNode}
return n}
function k(t,n){var r;while(t){r=e.data(t,i);if(r&&(!n||r[n]))return t;t=t.parentNode}
return null}
function L(){g=!1}
function A(){g=!0}
function O(){E=0,v.length=0,m=!1,A()}
function M(){L()}
function _(){D(),c=setTimeout(function(){c=0,O()},e.vmouse.resetTimerDuration)}
function D(){c&&(clearTimeout(c),c=0)}
function P(t,n,r){var i;if(r&&r[t]||!r&&k(n.target,t))i=N(n,t),e(n.target).trigger(i);return i}
function H(t){var n=e.data(t.target,s),r;!m&&(!E||E!==n)&&(r=P("v"+t.type,t),r&&(r.isDefaultPrevented()&&t.preventDefault(),r.isPropagationStopped()&&t.stopPropagation(),r.isImmediatePropagationStopped()&&t.stopImmediatePropagation()))}
function B(t){var n=T(t).touches,r,i,o;n&&n.length===1&&(r=t.target,i=C(r),i.hasVirtualBinding&&(E=w++,e.data(r,s,E),D(),M(),d=!1,o=T(t).touches[0],h=o.pageX,p=o.pageY,P("vmouseover",t,i),P("vmousedown",t,i)))}
function j(e){if(g)return;d||P("vmousecancel",e,C(e.target)),d=!0,_()}
function F(t){if(g)return;var n=T(t).touches[0],r=d,i=e.vmouse.moveDistanceThreshold,s=C(t.target);d=d||Math.abs(n.pageX-h)>i||Math.abs(n.pageY-p)>i,d&&!r&&P("vmousecancel",t,s),P("vmousemove",t,s),_()}
function I(e){if(g)return;A();var t=C(e.target),n,r;P("vmouseup",e,t),d||(n=P("vclick",e,t),n&&n.isDefaultPrevented()&&(r=T(e).changedTouches[0],v.push({touchID:E,x:r.clientX,y:r.clientY}),m=!0)),P("vmouseout",e,t),d=!1,_()}
function q(t){var n=e.data(t,i),r;if(n)
for(r in n)
if(n[r])return!0;return!1}
function R(){}
function U(t){var n=t.substr(1);return{setup:function(){q(this)||e.data(this,i,{});var r=e.data(this,i);r[t]=!0,l[t]=(l[t]||0)+1,l[t]===1&&b.bind(n,H),e(this).bind(n,R),y&&(l.touchstart=(l.touchstart||0)+1,l.touchstart===1&&b.bind("touchstart",B).bind("touchend",I).bind("touchmove",F).bind("scroll",j))},teardown:function(){--l[t],l[t]||b.unbind(n,H),y&&(--l.touchstart,l.touchstart||b.unbind("touchstart",B).unbind("touchmove",F).unbind("touchend",I).unbind("scroll",j));var r=e(this),s=e.data(this,i);s&&(s[t]=!1),r.unbind(n,R),q(this)||r.removeData(i)}}}
var i="virtualMouseBindings",s="virtualTouchID",o="vmouseover vmousedown vmousemove vmouseup vclick vmouseout vmousecancel".split(" "),u="clientX clientY pageX pageY screenX screenY".split(" "),a=e.event.mouseHooks?e.event.mouseHooks.props:[],f=e.event.props.concat(a),l={},c=0,h=0,p=0,d=!1,v=[],m=!1,g=!1,y="addEventListener"in n,b=e(n),w=1,E=0,S,x;e.vmouse={moveDistanceThreshold:10,clickDistanceThreshold:10,resetTimerDuration:1500};for(x=0;x<o.length;x++)e.event.special[o[x]]=U(o[x]);y&&n.addEventListener("click",function(t){var n=v.length,r=t.target,i,o,u,a,f,l;if(n){i=t.clientX,o=t.clientY,S=e.vmouse.clickDistanceThreshold,u=r;while(u){for(a=0;a<n;a++){f=v[a],l=0;if(u===r&&Math.abs(f.x-i)<S&&Math.abs(f.y-o)<S||e.data(u,s)===f.touchID){t.preventDefault(),t.stopPropagation();return}}
u=u.parentNode}}},!0)})(e,t,n)});function getCommentForm(){return document.getElementById('comments');}
var commentsType,commentsId;function showCommentForm(){getCommentForm().querySelector('.comment-form').style.display='block';autoResizeTextArea(getCommentForm().querySelector('textarea'));}
function updateComments(type,id,page){let form=getCommentForm();if(form==null)return;form.querySelector('.comments-reload').classList.add('disabled');form.querySelector('.comments-reload-icon').style.display='none';form.querySelector('.comments-loading').style.display='inline-block';jQuery.get(`/ajax/get_comments.php?id=${type}&id=${id}&page=${page}`,function(result){form.querySelector('.comments-content').innerHTML=result;form.querySelector('.comments-reload').classList.remove('disabled');form.querySelector('.comments-reload-icon').style.display='inline-block';form.querySelector('.comments-loading').style.display='none';});}
async function deleteComment(commentId,page){await $.post('/ajax/delete_comment.php',{id:commentId,post_key:settings.post_key});updateComments(commentsType,commentsId,page);}
async function saveComment(){let form=getCommentForm();form.querySelector('.comment-save').classList.add('disabled');form.querySelector('.comment-save-icon').style.display='none';form.querySelector('.comment-save-loading').style.display='inline-block';let text=form.querySelector('textarea').value;await $.post('/ajax/add_comment.php',{type:commentsType,id:commentsId,text:text,post_key:settings.post_key})
form.querySelector('.comment-save').classList.remove('disabled');form.querySelector('.comment-save-icon').style.display='inline-block';form.querySelector('.comment-save-loading').style.display='none';form.querySelector('.comment-form').style.display='none';form.querySelector('textarea').value='';updateComments(commentsType,commentsId,1);}
function cancelComment(){getCommentForm().querySelector('.comment-form').style.display='none';}
function openModCp(userId){window.open('/modcp?user='+userId);}
function showChat(force=false){let hasSidebar=typeof sidebar!='undefined'&&sidebar instanceof Sidebar;if(hasSidebar&&!force){sidebarChat();}else{if(hasSidebar)
sidebar?.remove(sidebar?.find('Chat'));document.getElementById('chatplaceholder').innerHTML='<div id="chatbox"><div id="chatbox_inner"><div id="chatbox_left">Please follow the <a href="https://onlinesequencer.net/forum/thread-1538.html" target="_blank">rules</a> while using chat.</div><div id="chatbox_right"><a href="/logs?page=last" target="_blank">Chat Logs</a> &middot; <a href="/chat/" target="_blank">Mobile-friendly</a> &middot; <span class="sidebar_chat_link"><a href="javascript:sidebarChat()">Move to sidebar</a> &middot; </span><a href="javascript:hideChat()" class="close_chat"><i class="far fa-times"></i></a></div><iframe allowTransparency="true" scrolling="no" src="/forum/chat_frame.php" frameborder="0"></iframe></div></div>';$('#chatbox').draggable();}}
function hideChat(){document.getElementById('chatplaceholder').innerHTML='';}
function lamejs(){function X(c){return new Int32Array(c)}function K(c){return new Float32Array(c)}function ca(c){if(1==c.length)return K(c[0]);var k=c[0];c=c.slice(1);for(var n=[],u=0;u<k;u++)n.push(ca(c));return n}function Ia(c){if(1==c.length)return X(c[0]);var k=c[0];c=c.slice(1);for(var n=[],u=0;u<k;u++)n.push(Ia(c));return n}function dc(c){if(1==c.length)return new Int16Array(c[0]);var k=c[0];c=c.slice(1);for(var n=[],u=0;u<k;u++)n.push(dc(c));return n}function Ob(c){if(1==c.length)return Array(c[0]);var k=c[0];c=c.slice(1);for(var n=[],u=0;u<k;u++)n.push(Ob(c));return n}function ra(c){this.ordinal=c}function G(c){this.ordinal=c}function la(c){this.ordinal=function(){return c}}function mc(){this.getLameVersion=function(){return"3.98.4"};this.getLameShortVersion=function(){return"3.98.4"};this.getLameVeryShortVersion=function(){return"LAME3.98r"};this.getPsyVersion=function(){return"0.93"};this.getLameUrl=function(){return"http://www.mp3dev.org/"};this.getLameOsBitness=function(){return"32bits"}}
function Y(){function c(f,b,c,a,m,k){for(;0!=m--;)c[a]=1E-10+f[b+0]*k[0]-c[a-1]*k[1]+f[b-1]*k[2]-c[a-2]*k[3]+f[b-2]*k[4]-c[a-3]*k[5]+f[b-3]*k[6]-c[a-4]*k[7]+f[b-4]*k[8]-c[a-5]*k[9]+f[b-5]*k[10]-c[a-6]*k[11]+f[b-6]*k[12]-c[a-7]*k[13]+f[b-7]*k[14]-c[a-8]*k[15]+f[b-8]*k[16]-c[a-9]*k[17]+f[b-9]*k[18]-c[a-10]*k[19]+f[b-10]*k[20],++a,++b}function k(f,b,c,a,m,k){for(;0!=m--;)c[a]=f[b+0]*k[0]-c[a-1]*k[1]+f[b-1]*k[2]-c[a-2]*k[3]+f[b-2]*k[4],++a,++b}function n(f){return f*f}var V=Y.RMS_WINDOW_TIME_NUMERATOR,E=Y.RMS_WINDOW_TIME_DENOMINATOR,B=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9.291677959E-5,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,1.2025322027E-4,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-8.28086748E-6,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],w=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];this.InitGainAnalysis=function(f,b){a:{for(var c=0;c<MAX_ORDER;c++)f.linprebuf[c]=f.lstepbuf[c]=f.loutbuf[c]=f.rinprebuf[c]=f.rstepbuf[c]=f.routbuf[c]=0;switch(0|b){case 48E3:f.reqindex=0;break;case 44100:f.reqindex=1;break;case 32E3:f.reqindex=2;break;case 24E3:f.reqindex=3;break;case 22050:f.reqindex=4;break;case 16E3:f.reqindex=5;break;case 12E3:f.reqindex=6;break;case 11025:f.reqindex=7;break;case 8E3:f.reqindex=8;break;default:b=INIT_GAIN_ANALYSIS_ERROR;break a}f.sampleWindow=0|(b*V+E-1)/E;f.lsum=0;f.rsum=0;f.totsamp=0;na.ill(f.A,0);b=INIT_GAIN_ANALYSIS_OK}if(b!=INIT_GAIN_ANALYSIS_OK)return INIT_GAIN_ANALYSIS_ERROR;f.linpre=MAX_ORDER;f.rinpre=MAX_ORDER;f.lstep=MAX_ORDER;f.rstep=MAX_ORDER;f.lout=MAX_ORDER;f.rout=MAX_ORDER;na.fill(f.B,0);return INIT_GAIN_ANALYSIS_OK};this.AnalyzeSamples=function(f,b,v,a,m,u,e){if(0==u)return GAIN_ANALYSIS_OK;var l=0;var d=u;switch(e){case 1:a=b;m=v;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}u<MAX_ORDER?(T.arraycopy(b,v,f.linprebuf,MAX_ORDER,u),T.arraycopy(a,m,f.rinprebuf,MAX_ORDER,u)):(T.arraycopy(b,v,f.linprebuf,MAX_ORDER,MAX_ORDER),T.arraycopy(a,m,f.rinprebuf,MAX_ORDER,MAX_ORDER));for(;0<d;){var g=d>f.sampleWindow-f.totsamp?f.sampleWindow-f.totsamp:d;if(l<MAX_ORDER){e=f.linpre+l;var q=f.linprebuf;var D=f.rinpre+l;var p=f.rinprebuf;g>MAX_ORDER-l&&(g=MAX_ORDER-l)}else e=v+l,q=b,D=m+l,p=a;c(q,e,f.lstepbuf,f.lstep+f.totsamp,g,B[f.reqindex]);c(p,D,f.rstepbuf,f.rstep+f.totsamp,g,B[f.reqindex]);k(f.lstepbuf,f.lstep+f.totsamp,f.loutbuf,f.lout+f.totsamp,g,w[f.reqindex]);k(f.rstepbuf,f.rstep+f.totsamp,f.routbuf,f.rout+f.totsamp,g,w[f.reqindex]);e=f.lout+f.totsamp;q=f.loutbuf;D=f.rout+f.totsamp;p=f.routbuf;for(var r=g%8;0!=r--;)f.lsum+=n(q[e++]),f.rsum+=n(p[D++]);for(r=g/8;0!=r--;)f.lsum+=n(q[e+0])+n(q[e+1])+n(q[e+2])+n(q[e+3])+n(q[e+4])+n(q[e+5])+n(q[e+6])+n(q[e+7]),e+=8,f.rsum+=n(p[D+0])+n(p[D+1])+n(p[D+2])+n(p[D+3])+n(p[D+4])+n(p[D+5])+n(p[D+6])+n(p[D+7]),D+=8;d-=g;l+=g;f.totsamp+=g;f.totsamp==f.sampleWindow&&(e=10*Y.STEPS_per_dB*Math.log10((f.lsum+f.rsum)/f.totsamp*.5+1E-37),e=0>=e?0:0|e,e>=f.A.length&&(e=f.A.length-1),f.A[e]++,f.lsum=f.rsum=0,T.arraycopy(f.loutbuf,f.totsamp,f.loutbuf,0,MAX_ORDER),T.arraycopy(f.routbuf,f.totsamp,f.routbuf,0,MAX_ORDER),T.arraycopy(f.lstepbuf,f.totsamp,f.lstepbuf,0,MAX_ORDER),T.arraycopy(f.rstepbuf,f.totsamp,f.rstepbuf,0,MAX_ORDER),f.totsamp=0);if(f.totsamp>f.sampleWindow)return GAIN_ANALYSIS_ERROR}u<MAX_ORDER?(T.arraycopy(f.linprebuf,u,f.linprebuf,0,MAX_ORDER-u),T.arraycopy(f.rinprebuf,u,f.rinprebuf,0,MAX_ORDER-u),T.arraycopy(b,v,f.linprebuf,MAX_ORDER-u,u),T.arraycopy(a,m,f.rinprebuf,MAX_ORDER-u,u)):(T.arraycopy(b,v+u-MAX_ORDER,f.linprebuf,0,MAX_ORDER),T.arraycopy(a,m+u-MAX_ORDER,f.rinprebuf,0,MAX_ORDER));return GAIN_ANALYSIS_OK};this.GetTitleGain=function(f){var b=f.A;var c=f.A.length,a,m=0;for(a=0;a<c;a++)m+=b[a];if(0==m)b=GAIN_NOT_ENOUGH_SAMPLES;else{m=0|Math.ceil(m*(1-.95));for(a=c;0<a--&&!(0>=(m-=b[a])););b=64.82-a/Y.STEPS_per_dB}for(c=0;c<f.A.length;c++)f.B[c]+=f.A[c],f.A[c]=0;for(c=0;c<MAX_ORDER;c++)f.linprebuf[c]=f.lstepbuf[c]=f.loutbuf[c]=f.rinprebuf[c]=f.rstepbuf[c]=f.routbuf[c]=0;f.totsamp=0;f.lsum=f.rsum=0;return b}}
function wc(){function c(b,c,a,f,k,e,l,d,g,q,D,p,r,t,J){this.vbr_q=b;this.quant_comp=c;this.quant_comp_s=a;this.expY=f;this.st_lrm=k;this.st_s=e;this.masking_adj=l;this.masking_adj_short=d;this.ath_lower=g;this.ath_curve=q;this.ath_sensitivity=D;this.interch=p;this.safejoint=r;this.sfb21mod=t;this.msfix=J}function k(b,c,a,f,k,e,l,d,g,q,D,p,r,t){this.quant_comp=c;this.quant_comp_s=a;this.safejoint=f;this.nsmsfix=k;this.st_lrm=e;this.st_s=l;this.nsbass=d;this.scale=g;this.masking_adj=q;this.ath_lower=D;this.ath_curve=p;this.interch=r;this.sfscale=t}function n(b,c,a){var f=b.VBR==G.vbr_rh?B:w,k=b.VBR_q_frac,e=f[c];f=f[c+1];e.st_lrm+=k*(f.st_lrm-e.st_lrm);e.st_s+=k*(f.st_s-e.st_s);e.masking_adj+=k*(f.masking_adj-e.masking_adj);e.masking_adj_short+=k*(f.masking_adj_short-e.masking_adj_short);e.ath_lower+=k*(f.ath_lower-e.ath_lower);e.ath_curve+=k*(f.ath_curve-e.ath_curve);e.ath_sensitivity+=k*(f.ath_sensitivity-e.ath_sensitivity);e.interch+=k*(f.interch-e.interch);e.msfix+=k*(f.msfix-e.msfix);f=e.vbr_q;0>f&&(f=0);9<f&&(f=9);b.VBR_q=f;b.VBR_q_frac=0;0!=a?b.quant_comp=e.quant_comp:0<Math.abs(b.quant_comp- -1)||(b.quant_comp=e.quant_comp);0!=a?b.quant_comp_short=e.quant_comp_s:0<Math.abs(b.quant_comp_short- -1)||(b.quant_comp_short=e.quant_comp_s);0!=e.expY&&(b.experimentalY=0!=e.expY);0!=a?b.internal_flags.nsPsy.attackthre=e.st_lrm:0<Math.abs(b.internal_flags.nsPsy.attackthre- -1)||(b.internal_flags.nsPsy.attackthre=e.st_lrm);0!=a?b.internal_flags.nsPsy.attackthre_s=e.st_s:0<Math.abs(b.internal_flags.nsPsy.attackthre_s-
-1)||(b.internal_flags.nsPsy.attackthre_s=e.st_s);0!=a?b.maskingadjust=e.masking_adj:0<Math.abs(b.maskingadjust-0)||(b.maskingadjust=e.masking_adj);0!=a?b.maskingadjust_short=e.masking_adj_short:0<Math.abs(b.maskingadjust_short-0)||(b.maskingadjust_short=e.masking_adj_short);0!=a?b.ATHlower=-e.ath_lower/10:0<Math.abs(10*-b.ATHlower)||(b.ATHlower=-e.ath_lower/10);0!=a?b.ATHcurve=e.ath_curve:0<Math.abs(b.ATHcurve- -1)||(b.ATHcurve=e.ath_curve);0!=a?b.athaa_sensitivity=e.ath_sensitivity:0<Math.abs(b.athaa_sensitivity-
-1)||(b.athaa_sensitivity=e.ath_sensitivity);0<e.interch&&(0!=a?b.interChRatio=e.interch:0<Math.abs(b.interChRatio- -1)||(b.interChRatio=e.interch));0<e.safejoint&&(b.exp_nspsytune|=e.safejoint);0<e.sfb21mod&&(b.exp_nspsytune|=e.sfb21mod<<20);0!=a?b.msfix=e.msfix:0<Math.abs(b.msfix- -1)||(b.msfix=e.msfix);0==a&&(b.VBR_q=c,b.VBR_q_frac=k)}function V(b,c,a){var m=E.nearestBitrateFullIndex(c);b.VBR=G.vbr_abr;b.VBR_mean_bitrate_kbps=c;b.VBR_mean_bitrate_kbps=Math.min(b.VBR_mean_bitrate_kbps,320);b.VBR_mean_bitrate_kbps=Math.max(b.VBR_mean_bitrate_kbps,8);b.brate=b.VBR_mean_bitrate_kbps;320<b.VBR_mean_bitrate_kbps&&(b.disable_reservoir=!0);0<f[m].safejoint&&(b.exp_nspsytune|=2);0<f[m].sfscale&&(b.internal_flags.noise_shaping=2);if(0<Math.abs(f[m].nsbass)){var k=int(4*f[m].nsbass);0>k&&(k+=64);b.exp_nspsytune|=k<<2}0!=a?b.quant_comp=f[m].quant_comp:0<Math.abs(b.quant_comp- -1)||(b.quant_comp=f[m].quant_comp);0!=a?b.quant_comp_short=f[m].quant_comp_s:0<Math.abs(b.quant_comp_short- -1)||(b.quant_comp_short=f[m].quant_comp_s);0!=a?b.msfix=f[m].nsmsfix:0<Math.abs(b.msfix- -1)||(b.msfix=f[m].nsmsfix);0!=a?b.internal_flags.nsPsy.attackthre=f[m].st_lrm:0<Math.abs(b.internal_flags.nsPsy.attackthre- -1)||(b.internal_flags.nsPsy.attackthre=f[m].st_lrm);0!=a?b.internal_flags.nsPsy.attackthre_s=f[m].st_s:0<Math.abs(b.internal_flags.nsPsy.attackthre_s- -1)||(b.internal_flags.nsPsy.attackthre_s=f[m].st_s);0!=a?b.scale=f[m].scale:0<Math.abs(b.scale- -1)||(b.scale=f[m].scale);0!=a?b.maskingadjust=f[m].masking_adj:0<Math.abs(b.maskingadjust-
0)||(b.maskingadjust=f[m].masking_adj);0<f[m].masking_adj?0!=a?b.maskingadjust_short=.9*f[m].masking_adj:0<Math.abs(b.maskingadjust_short-0)||(b.maskingadjust_short=.9*f[m].masking_adj):0!=a?b.maskingadjust_short=1.1*f[m].masking_adj:0<Math.abs(b.maskingadjust_short-0)||(b.maskingadjust_short=1.1*f[m].masking_adj);0!=a?b.ATHlower=-f[m].ath_lower/10:0<Math.abs(10*-b.ATHlower)||(b.ATHlower=-f[m].ath_lower/10);0!=a?b.ATHcurve=f[m].ath_curve:0<Math.abs(b.ATHcurve- -1)||(b.ATHcurve=f[m].ath_curve);0!=a?b.interChRatio=f[m].interch:0<Math.abs(b.interChRatio- -1)||(b.interChRatio=f[m].interch);return c}var E;this.setModules=function(b){E=b};var B=[new c(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new c(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new c(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new c(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new c(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new c(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2E-4,0,0,1.95),new c(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4E-4,0,0,2.3),new c(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6E-4,0,0,2.7),new c(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7E-4,0,0,0),new c(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8E-4,0,0,0),new c(10,9,9,1,6.6,145,2,2,-36,12,-25,8E-4,0,0,0)],w=[new c(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new c(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new c(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new c(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new c(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new c(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2E-4,0,0,1.95),new c(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4E-4,0,0,2),new c(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6E-4,0,0,2),new c(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7E-4,0,0,2),new c(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8E-4,0,0,2),new c(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8E-4,0,0,2)],f=[new k(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new k(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new k(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new k(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new k(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9E-4,1),new k(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9E-4,1),new k(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8E-4,1),new k(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8E-4,1),new k(80,9,9,0,0,6.6,145,0,.95,0,0,8,7E-4,1),new k(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6E-4,1),new k(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5E-4,1),new k(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2E-4,1),new k(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new k(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new k(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new k(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new k(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];this.apply_preset=function(b,c,a){switch(c){case W.R3MIX:c=W.V3;b.VBR=G.vbr_mtrh;break;case W.MEDIUM:c=W.V4;b.VBR=G.vbr_rh;break;case W.MEDIUM_FAST:c=W.V4;b.VBR=G.vbr_mtrh;break;case W.STANDARD:c=W.V2;b.VBR=G.vbr_rh;break;case W.STANDARD_FAST:c=W.V2;b.VBR=G.vbr_mtrh;break;case W.EXTREME:c=W.V0;b.VBR=G.vbr_rh;break;case W.EXTREME_FAST:c=W.V0;b.VBR=G.vbr_mtrh;break;case W.INSANE:return c=320,b.preset=c,V(b,c,a),b.VBR=G.vbr_off,c}b.preset=c;switch(c){case W.V9:return n(b,9,a),c;case W.V8:return n(b,8,a),c;case W.V7:return n(b,7,a),c;case W.V6:return n(b,6,a),c;case W.V5:return n(b,5,a),c;case W.V4:return n(b,4,a),c;case W.V3:return n(b,3,a),c;case W.V2:return n(b,2,a),c;case W.V1:return n(b,1,a),c;case W.V0:return n(b,0,a),c}if(8<=c&&320>=c)return V(b,c,a);b.preset=0;return c}}function qb(){function u(a){this.bits=0|a}function k(a,d,p,b,e,c){d=.5946/d;for(a>>=1;0!=a--;)e[c++]=d>p[b++]?0:1,e[c++]=d>p[b++]?0:1}function n(a,d,b,e,c,l){a>>=1;var h=a%2;for(a>>=1;0!=a--;){var p=b[e++]*d;var r=b[e++]*d;var t=0|p;var f=b[e++]*d;var g=0|r;var J=b[e++]*d;var D=0|f;p+=B.adj43[t];t=0|J;r+=B.adj43[g];c[l++]=0|p;f+=B.adj43[D];c[l++]=0|r;J+=B.adj43[t];c[l++]=0|f;c[l++]=0|J}0!=h&&(p=b[e++]*d,r=b[e++]*d,p+=B.adj43[0|p],r+=B.adj43[0|r],c[l++]=0|p,c[l++]=0|r)}function V(a,d,b,e){var p,c=d,h=p=0;do{var r=a[c++],l=a[c++];p<r&&(p=r);h<l&&(h=l)}while(c<b);p<h&&(p=h);switch(p){case 0:return p;case 1:c=d;d=0;p=w.ht[1].hlen;do h=2*a[c+0]+a[c+1],c+=2,d+=p[h];while(c<b);e.bits+=d;return 1;case 2:case 3:c=d;d=f[p-1];p=0;h=w.ht[d].xlen;r=2==d?w.table23:w.table56;do l=a[c+0]*h+a[c+1],c+=2,p+=r[l];while(c<b);a=p&65535;p>>=16;p>a&&(p=a,d++);e.bits+=p;return d;case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:c=d;d=f[p-1];r=h=p=0;l=w.ht[d].xlen;var g=w.ht[d].hlen,D=w.ht[d+1].hlen,q=w.ht[d+2].hlen;do{var m=a[c+0]*l+a[c+1];c+=2;p+=g[m];h+=D[m];r+=q[m]}while(c<b);a=d;p>h&&(p=h,a++);p>r&&(p=r,a=d+2);e.bits+=p;return a;default:if(p>ia.IXMAX_VAL)return e.bits=ia.LARGE_BITS,-1;p-=15;for(c=24;32>c&&!(w.ht[c].linmax>=p);c++);for(h=c-8;24>h&&!(w.ht[h].linmax>=p);h++);p=h;r=65536*w.ht[p].xlen+w.ht[c].xlen;h=0;do l=a[d++],g=a[d++],0!=l&&(14<l&&(l=15,h+=r),l*=16),0!=g&&(14<g&&(g=15,h+=r),l+=g),h+=w.largetbl[l];while(d<b);a=h&65535;h>>=16;h>a&&(h=a,p=c);e.bits+=h;return p}}function E(a,d,p,b,e,l,h,g){for(var r=d.big_values,f=2;f<c.SBMAX_l+1;f++){var x=a.scalefac_band.l[f];if(x>=r)break;var t=e[f-2]+d.count1bits;if(p.part2_3_length<=t)break;t=new u(t);x=V(b,x,r,t);t=t.bits;p.part2_3_length<=t||(p.assign(d),p.part2_3_length=t,p.region0_count=l[f-2],p.region1_count=f-2-l[f-2],p.table_select[0]=h[f-2],p.table_select[1]=g[f-2],p.table_select[2]=x)}}var B=null;this.qupvt=null;this.setModules=function(a){B=this.qupvt=a};var ha=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]],f=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];this.noquant_count_bits=function(a,d,p){var b=d.l3_enc,e=Math.min(576,d.max_nonzero_coeff+2>>1<<1);null!=p&&(p.sfb_count1=0);for(;1<e&&0==(b[e-1]|b[e-2]);e-=2);d.count1=e;for(var l=0,h=0;3<e&&!(1<((b[e-1]|b[e-2]|b[e-3]|b[e-4])&2147483647));e-=4){var f=2*(2*(2*b[e-4]+b[e-3])+b[e-2])+b[e-1];l+=w.t32l[f];h+=w.t33l[f]}f=l;d.count1table_select=0;l>h&&(f=h,d.count1table_select=1);d.count1bits=f;d.big_values=e;if(0==e)return f;d.block_type==c.SHORT_TYPE?(l=3*a.scalefac_band.s[3],l>d.big_values&&(l=d.big_values),h=d.big_values):d.block_type==c.NORM_TYPE?(l=d.region0_count=a.bv_scf[e-2],h=d.region1_count=a.bv_scf[e-1],h=a.scalefac_band.l[l+h+2],l=a.scalefac_band.l[l+1],h<e&&(f=new u(f),d.table_select[2]=V(b,h,e,f),f=f.bits)):(d.region0_count=7,d.region1_count=c.SBMAX_l-1-7-1,l=a.scalefac_band.l[8],h=e,l>h&&(l=h));l=Math.min(l,e);h=Math.min(h,e);0<l&&(f=new u(f),d.table_select[0]=V(b,0,l,f),f=f.bits);l<h&&(f=new u(f),d.table_select[1]=V(b,l,h,f),f=f.bits);2==a.use_best_huffman&&(d.part2_3_length=f,best_huffman_divide(a,d),f=d.part2_3_length);if(null!=p&&d.block_type==c.NORM_TYPE){for(b=0;a.scalefac_band.l[b]<d.big_values;)b++;p.sfb_count1=b}return f};this.count_bits=function(a,d,e,b){var p=e.l3_enc,l=ia.IXMAX_VAL/B.IPOW20(e.global_gain);if(e.xrpow_max>l)return ia.LARGE_BITS;l=B.IPOW20(e.global_gain);var h,f=0,g=0,r=0,D=0,m=0,q=p,v=0,C=d,I=0;var Q=null!=b&&e.global_gain==b.global_gain;var S=e.block_type==c.SHORT_TYPE?38:21;for(h=0;h<=S;h++){var u=-1;if(Q||e.block_type==c.NORM_TYPE)u=e.global_gain-(e.scalefac[h]+(0!=e.preflag?B.pretab[h]:0)<<e.scalefac_scale+1)-8*e.subblock_gain[e.window[h]];if(Q&&b.step[h]==u)0!=g&&(n(g,l,C,I,q,v),g=0),0!=r&&(k(r,l,C,I,q,v),r=0);else{var Z=e.width[h];f+e.width[h]>e.max_nonzero_coeff&&(h=e.max_nonzero_coeff-f+1,na.fill(p,e.max_nonzero_coeff,576,0),Z=h,0>Z&&(Z=0),h=S+1);0==g&&0==r&&(q=p,v=m,C=d,I=D);null!=b&&0<b.sfb_count1&&h>=b.sfb_count1&&0<b.step[h]&&u>=b.step[h]?(0!=g&&(n(g,l,C,I,q,v),g=0,q=p,v=m,C=d,I=D),r+=Z):(0!=r&&(k(r,l,C,I,q,v),r=0,q=p,v=m,C=d,I=D),g+=Z);if(0>=Z){0!=r&&(k(r,l,C,I,q,v),r=0);0!=g&&(n(g,l,C,I,q,v),g=0);break}}h<=S&&(m+=e.width[h],D+=e.width[h],f+=e.width[h])}0!=g&&n(g,l,C,I,q,v);0!=r&&k(r,l,C,I,q,v);if(0!=(a.substep_shaping&2))for(l=0,S=.634521682242439/B.IPOW20(e.global_gain+e.scalefac_scale),f=0;f<e.sfbmax;f++)if(Q=e.width[f],0==a.pseudohalf[f])l+=Q;else for(g=l,l+=Q;g<l;++g)p[g]=d[g]>=S?p[g]:0;return this.noquant_count_bits(a,e,b)};this.best_huffman_divide=function(a,d){var e=new rb,b=d.l3_enc,l=X(23),f=X(23),h=X(23),g=X(23);if(d.block_type!=c.SHORT_TYPE||1!=a.mode_gr){e.assign(d);if(d.block_type==c.NORM_TYPE){for(var y=d.big_values,m=0;22>=m;m++)l[m]=ia.LARGE_BITS;for(m=0;16>m;m++){var D=a.scalefac_band.l[m+1];if(D>=y)break;var q=0,k=new u(q),v=V(b,0,D,k);q=k.bits;for(var C=0;8>C;C++){var I=a.scalefac_band.l[m+C+2];if(I>=y)break;k=q;k=new u(k);I=V(b,D,I,k);k=k.bits;l[m+C]>k&&(l[m+C]=k,f[m+C]=m,h[m+C]=v,g[m+C]=I)}}E(a,e,d,b,l,f,h,g)}y=e.big_values;if(!(0==y||1<(b[y-2]|b[y-1])||(y=d.count1+2,576<y))){e.assign(d);e.count1=y;for(D=m=0;y>e.big_values;y-=4)q=2*(2*(2*b[y-4]+b[y-3])+b[y-2])+b[y-1],m+=w.t32l[q],D+=w.t33l[q];e.big_values=y;e.count1table_select=0;m>D&&(m=D,e.count1table_select=1);e.count1bits=m;e.block_type==c.NORM_TYPE?E(a,e,d,b,l,f,h,g):(e.part2_3_length=m,m=a.scalefac_band.l[8],m>y&&(m=y),0<m&&(a=new u(e.part2_3_length),e.table_select[0]=V(b,0,m,a),e.part2_3_length=a.bits),y>m&&(a=new u(e.part2_3_length),e.table_select[1]=V(b,m,y,a),e.part2_3_length=a.bits),d.part2_3_length>e.part2_3_length&&d.assign(e))}}};var b=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],v=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],a=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],m=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];qb.slen1_tab=a;qb.slen2_tab=m;this.best_scalefac_store=function(d,e,p,l){var f=l.tt[e][p],g,h,r=0;for(g=h=0;g<f.sfbmax;g++){var y=f.width[g];h+=y;for(y=-y;0>y&&0==f.l3_enc[y+h];y++);0==y&&(f.scalefac[g]=r=-2)}if(0==f.scalefac_scale&&0==f.preflag){for(g=h=0;g<f.sfbmax;g++)0<f.scalefac[g]&&(h|=f.scalefac[g]);if(0==(h&1)&&0!=h){for(g=0;g<f.sfbmax;g++)0<f.scalefac[g]&&(f.scalefac[g]>>=1);f.scalefac_scale=r=1}}if(0==f.preflag&&f.block_type!=c.SHORT_TYPE&&2==d.mode_gr){for(g=11;g<c.SBPSY_l&&!(f.scalefac[g]<B.pretab[g]&&-2!=f.scalefac[g]);g++);if(g==c.SBPSY_l){for(g=11;g<c.SBPSY_l;g++)0<f.scalefac[g]&&(f.scalefac[g]-=B.pretab[g]);f.preflag=r=1}}for(g=0;4>g;g++)l.scfsi[p][g]=0;if(2==d.mode_gr&&1==e&&l.tt[0][p].block_type!=c.SHORT_TYPE&&l.tt[1][p].block_type!=c.SHORT_TYPE){e=l.tt[1][p];h=l.tt[0][p];for(r=0;r<w.scfsi_band.length-1;r++){for(g=w.scfsi_band[r];g<w.scfsi_band[r+1]&&!(h.scalefac[g]!=e.scalefac[g]&&0<=e.scalefac[g]);g++);if(g==w.scfsi_band[r+1]){for(g=w.scfsi_band[r];g<w.scfsi_band[r+1];g++)e.scalefac[g]=-1;l.scfsi[p][r]=1}}for(g=l=p=0;11>g;g++)-1!=e.scalefac[g]&&(l++,p<e.scalefac[g]&&(p=e.scalefac[g]));for(y=h=0;g<c.SBPSY_l;g++)-1!=e.scalefac[g]&&(y++,h<e.scalefac[g]&&(h=e.scalefac[g]));for(r=0;16>r;r++)p<b[r]&&h<v[r]&&(g=a[r]*l+m[r]*y,e.part2_length>g&&(e.part2_length=g,e.scalefac_compress=r));r=0}for(g=0;g<f.sfbmax;g++)-2==f.scalefac[g]&&(f.scalefac[g]=0);0!=r&&(2==d.mode_gr?this.scale_bitcount(f):this.scale_bitcount_lsf(d,f))};var z=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],e=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],l=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(a){var d,g=0,f=0,t=a.scalefac;if(a.block_type==c.SHORT_TYPE){var m=z;0!=a.mixed_block_flag&&(m=e)}else if(m=l,0==a.preflag){for(d=11;d<c.SBPSY_l&&!(t[d]<B.pretab[d]);d++);if(d==c.SBPSY_l)for(a.preflag=1,d=11;d<c.SBPSY_l;d++)t[d]-=B.pretab[d]}for(d=0;d<a.sfbdivide;d++)g<t[d]&&(g=t[d]);for(;d<a.sfbmax;d++)f<t[d]&&(f=t[d]);a.part2_length=ia.LARGE_BITS;for(d=0;16>d;d++)g<b[d]&&f<v[d]&&a.part2_length>m[d]&&(a.part2_length=m[d],a.scalefac_compress=d);return a.part2_length==ia.LARGE_BITS};var d=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(a,e){var b,f,l,m,h=X(4),x=e.scalefac;a=0!=e.preflag?2:0;for(l=0;4>l;l++)h[l]=0;if(e.block_type==c.SHORT_TYPE){var y=1;var k=B.nr_of_sfb_block[a][y];for(b=m=0;4>b;b++){var q=k[b]/3;for(l=0;l<q;l++,m++)for(f=0;3>f;f++)x[3*m+f]>h[b]&&(h[b]=x[3*m+f])}}else for(y=0,k=B.nr_of_sfb_block[a][y],b=m=0;4>b;b++)for(q=k[b],l=0;l<q;l++,m++)x[m]>h[b]&&(h[b]=x[m]);q=!1;for(b=0;4>b;b++)h[b]>d[a][b]&&(q=!0);if(!q){e.sfb_partition_table=B.nr_of_sfb_block[a][y];for(b=0;4>b;b++)e.slen[b]=g[h[b]];y=e.slen[0];b=e.slen[1];h=e.slen[2];f=e.slen[3];switch(a){case 0:e.scalefac_compress=(5*y+b<<4)+(h<<2)+f;break;case 1:e.scalefac_compress=400+(5*y+b<<2)+h;break;case 2:e.scalefac_compress=500+3*y+b;break;default:T.err.printf("intensity stereo not implemented yet\n")}}if(!q)for(b=e.part2_length=0;4>b;b++)e.part2_length+=e.slen[b]*e.sfb_partition_table[b];return q};var g=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(a){for(var d=2;576>=d;d+=2){for(var e=0,b;a.scalefac_band.l[++e]<d;);for(b=ha[e][0];a.scalefac_band.l[b+1]>d;)b--;0>b&&(b=ha[e][0]);a.bv_scf[d-2]=b;for(b=ha[e][1];a.scalefac_band.l[b+a.bv_scf[d-2]+2]>d;)b--;0>b&&(b=ha[e][1]);a.bv_scf[d-1]=b}}}function xc(){var c;this.setModules=function(k){c=k};this.ResvFrameBegin=function(k,n){var u=k.internal_flags,E=u.l3_side,B=c.getframebits(k);n.bits=(B-8*u.sideinfo_len)/u.mode_gr;var w=2048*u.mode_gr-8;if(320<k.brate)var f=8*int(1E3*k.brate/(k.out_samplerate/1152)/8+.5);else f=11520,k.strict_ISO&&(f=8*int(32E4/(k.out_samplerate/1152)/8+.5));u.ResvMax=f-B;u.ResvMax>w&&(u.ResvMax=w);if(0>u.ResvMax||k.disable_reservoir)u.ResvMax=0;k=n.bits*u.mode_gr+Math.min(u.ResvSize,u.ResvMax);k>f&&(k=f);E.resvDrain_pre=0;null!=u.pinfo&&(u.pinfo.mean_bits=n.bits/2,u.pinfo.resvsize=u.ResvSize);return k};this.ResvMaxBits=function(c,n,u,E){var k=c.internal_flags,w=k.ResvSize,f=k.ResvMax;0!=E&&(w+=n);0!=(k.substep_shaping&1)&&(f*=.9);u.bits=n;10*w>9*f?(E=w-9*f/10,u.bits+=E,k.substep_shaping|=128):(E=0,k.substep_shaping&=127,c.disable_reservoir||0!=(k.substep_shaping&1)||(u.bits-=.1*n));c=w<6*k.ResvMax/10?w:6*k.ResvMax/10;c-=E;0>c&&(c=0);return c};this.ResvAdjust=function(c,n){c.ResvSize-=n.part2_3_length+n.part2_length};this.ResvFrameEnd=function(c,n){var k,u=c.l3_side;c.ResvSize+=n*c.mode_gr;n=0;u.resvDrain_post=0;u.resvDrain_pre=0;0!=(k=c.ResvSize%8)&&(n+=k);k=c.ResvSize-n-c.ResvMax;0<k&&(n+=k);k=Math.min(8*u.main_data_begin,n)/8;u.resvDrain_pre+=8*k;n-=8*k;c.ResvSize-=8*k;u.main_data_begin-=k;u.resvDrain_post+=n;c.ResvSize-=n}}function qa(){function u(a,e,b){for(;0<b;){if(0==D){D=8;q++;if(a.header[a.w_ptr].write_timing==g){var c=a;T.arraycopy(c.header[c.w_ptr].buf,0,d,q,c.sideinfo_len);q+=c.sideinfo_len;g+=8*c.sideinfo_len;c.w_ptr=c.w_ptr+1&da.MAX_HEADER_BUF-1}d[q]=0}c=Math.min(b,D);b-=c;D-=c;d[q]|=e>>b<<D;g+=c}}function k(a,d){var b=a.internal_flags,c;8<=d&&(u(b,76,8),d-=8);8<=d&&(u(b,65,8),d-=8);8<=d&&(u(b,77,8),d-=8);8<=d&&(u(b,69,8),d-=8);if(32<=d){var h=e.getLameShortVersion();if(32<=d)for(c=0;c<h.length&&8<=d;++c)d-=8,u(b,h.charAt(c),8)}for(;1<=d;--d)u(b,b.ancillary_flag,1),b.ancillary_flag^=a.disable_reservoir?0:1}function n(a,d,e){for(var b=a.header[a.h_ptr].ptr;0<e;){var h=Math.min(e,8-(b&7));e-=h;a.header[a.h_ptr].buf[b>>3]|=d>>e<<8-(b&7)-h;b+=h}a.header[a.h_ptr].ptr=b}function V(a,d){a<<=8;for(var e=0;8>e;e++)a<<=1,d<<=1,0!=((d^a)&65536)&&(d^=32773);return d}function E(a,d){var e=w.ht[d.count1table_select+32],b,h=0,c=d.big_values,g=d.big_values;for(b=(d.count1-d.big_values)/4;0<b;--b){var l=0,f=0;var p=d.l3_enc[c+0];0!=p&&(f+=8,0>d.xr[g+0]&&l++);p=d.l3_enc[c+1];0!=p&&(f+=4,l*=2,0>d.xr[g+1]&&l++);p=d.l3_enc[c+2];0!=p&&(f+=2,l*=2,0>d.xr[g+2]&&l++);p=d.l3_enc[c+3];0!=p&&(f++,l*=2,0>d.xr[g+3]&&l++);c+=4;g+=4;u(a,l+e.table[f],e.hlen[f]);h+=e.hlen[f]}return h}function B(a,d,e,b,h){var c=w.ht[d],g=0;if(0==d)return g;for(;e<b;e+=2){var l=0,f=0,p=c.xlen,r=c.xlen,m=0,C=h.l3_enc[e],k=h.l3_enc[e+1];0!=C&&(0>h.xr[e]&&m++,l--);15<d&&(14<C&&(m|=C-15<<1,f=p,C=15),14<k&&(r=k-15,m<<=p,m|=r,f+=p,k=15),r=16);0!=k&&(m<<=1,0>h.xr[e+1]&&m++,l--);C=C*r+k;f-=l;l+=c.hlen[C];u(a,c.table[C],l);u(a,m,f);g+=l+f}return g}function K(a,d){var e=3*a.scalefac_band.s[3];e>d.big_values&&(e=d.big_values);var b=B(a,d.table_select[0],0,e,d);return b+=B(a,d.table_select[1],e,d.big_values,d)}function f(a,d){var e=d.big_values;var b=d.region0_count+1;var h=a.scalefac_band.l[b];b+=d.region1_count+1;var c=a.scalefac_band.l[b];h>e&&(h=e);c>e&&(c=e);b=B(a,d.table_select[0],0,h,d);b+=B(a,d.table_select[1],h,c,d);return b+=B(a,d.table_select[2],c,e,d)}function b(){this.total=0}function v(d,e){var b=d.internal_flags;var c=b.w_ptr;var h=b.h_ptr-1;-1==h&&(h=da.MAX_HEADER_BUF-1);var l=b.header[h].write_timing-g;e.total=l;if(0<=l){var f=1+h-c;h<c&&(f=1+h-c+da.MAX_HEADER_BUF);l-=8*f*b.sideinfo_len}d=a.getframebits(d);l+=d;e.total+=d;e.total=0!=e.total%8?1+e.total/8:e.total/8;e.total+=q+1;0>l&&T.err.println("strange error flushing buffer ... \n");return l}var a=this,m=null,z=null,e=null,l=null;this.setModules=function(a,d,b,c){m=a;z=d;e=b;l=c};var d=null,g=0,q=0,D=0;this.getframebits=function(a){var d=a.internal_flags;return 8*(0|72E3*(a.version+1)*(0!=d.bitrate_index?w.bitrate_table[a.version][d.bitrate_index]:a.brate)/a.out_samplerate+d.padding)};this.CRC_writeheader=function(a,d){var e=V(d[2]&255,65535);e=V(d[3]&255,e);for(var b=6;b<a.sideinfo_len;b++)e=V(d[b]&255,e);d[4]=byte(e>>8);d[5]=byte(e&255)};this.flush_bitstream=function(a){var d=a.internal_flags,e;var c=d.l3_side;0>(e=v(a,new b))||(k(a,e),d.ResvSize=0,c.main_data_begin=0,d.findReplayGain&&(c=m.GetTitleGain(d.rgdata),d.RadioGain=Math.floor(10*c+.5)|0),d.findPeakSample&&(d.noclipGainChange=Math.ceil(200*Math.log10(d.PeakSample/32767))|0,0<d.noclipGainChange?EQ(a.scale,1)||EQ(a.scale,0)?d.noclipScale=Math.floor(32767/d.PeakSample*100)/100:d.noclipScale=-1:d.noclipScale=-1))};this.add_dummy_byte=function(a,e,b){a=a.internal_flags;for(var c;0<b--;){c=e;for(var h=8;0<h;){0==D&&(D=8,q++,d[q]=0);var l=Math.min(h,D);h-=l;D-=l;d[q]|=c>>h<<D;g+=l}for(c=0;c<da.MAX_HEADER_BUF;++c)a.header[c].write_timing+=8}};this.format_bitstream=function(a){var d=a.internal_flags;var e=d.l3_side;var l=this.getframebits(a);k(a,e.resvDrain_pre);var h=a.internal_flags,p,y;var m=h.l3_side;h.header[h.h_ptr].ptr=0;na.fill(h.header[h.h_ptr].buf,0,h.sideinfo_len,0);16E3>a.out_samplerate?n(h,4094,12):n(h,4095,12);n(h,a.version,1);n(h,1,2);n(h,a.error_protection?0:1,1);n(h,h.bitrate_index,4);n(h,h.samplerate_index,2);n(h,h.padding,1);n(h,a.extension,1);n(h,a.mode.ordinal(),2);n(h,h.mode_ext,2);n(h,a.copyright,1);n(h,a.original,1);n(h,a.emphasis,2);a.error_protection&&n(h,0,16);if(1==a.version){n(h,m.main_data_begin,9);2==h.channels_out?n(h,m.private_bits,3):n(h,m.private_bits,5);for(y=0;y<h.channels_out;y++)for(p=0;4>p;p++)n(h,m.scfsi[y][p],1);for(p=0;2>p;p++)for(y=0;y<h.channels_out;y++){var q=m.tt[p][y];n(h,q.part2_3_length+q.part2_length,12);n(h,q.big_values/2,9);n(h,q.global_gain,8);n(h,q.scalefac_compress,4);q.block_type!=c.NORM_TYPE?(n(h,1,1),n(h,q.block_type,2),n(h,q.mixed_block_flag,1),14==q.table_select[0]&&(q.table_select[0]=16),n(h,q.table_select[0],5),14==q.table_select[1]&&(q.table_select[1]=16),n(h,q.table_select[1],5),n(h,q.subblock_gain[0],3),n(h,q.subblock_gain[1],3),n(h,q.subblock_gain[2],3)):(n(h,0,1),14==q.table_select[0]&&(q.table_select[0]=16),n(h,q.table_select[0],5),14==q.table_select[1]&&(q.table_select[1]=16),n(h,q.table_select[1],5),14==q.table_select[2]&&(q.table_select[2]=16),n(h,q.table_select[2],5),n(h,q.region0_count,4),n(h,q.region1_count,3));n(h,q.preflag,1);n(h,q.scalefac_scale,1);n(h,q.count1table_select,1)}}else for(n(h,m.main_data_begin,8),n(h,m.private_bits,h.channels_out),y=p=0;y<h.channels_out;y++)q=m.tt[p][y],n(h,q.part2_3_length+q.part2_length,12),n(h,q.big_values/2,9),n(h,q.global_gain,8),n(h,q.scalefac_compress,9),q.block_type!=c.NORM_TYPE?(n(h,1,1),n(h,q.block_type,2),n(h,q.mixed_block_flag,1),14==q.table_select[0]&&(q.table_select[0]=16),n(h,q.table_select[0],5),14==q.table_select[1]&&(q.table_select[1]=16),n(h,q.table_select[1],5),n(h,q.subblock_gain[0],3),n(h,q.subblock_gain[1],3),n(h,q.subblock_gain[2],3)):(n(h,0,1),14==q.table_select[0]&&(q.table_select[0]=16),n(h,q.table_select[0],5),14==q.table_select[1]&&(q.table_select[1]=16),n(h,q.table_select[1],5),14==q.table_select[2]&&(q.table_select[2]=16),n(h,q.table_select[2],5),n(h,q.region0_count,4),n(h,q.region1_count,3)),n(h,q.scalefac_scale,1),n(h,q.count1table_select,1);a.error_protection&&CRC_writeheader(h,h.header[h.h_ptr].buf);m=h.h_ptr;h.h_ptr=m+1&da.MAX_HEADER_BUF-1;h.header[h.h_ptr].write_timing=h.header[m].write_timing+l;h.h_ptr==h.w_ptr&&T.err.println("Error: MAX_HEADER_BUF too small in bitstream.c \n");h=8*d.sideinfo_len;var D=0,B=a.internal_flags,z=B.l3_side;if(1==a.version)for(m=0;2>m;m++)for(y=0;y<B.channels_out;y++){var C=z.tt[m][y],I=qb.slen1_tab[C.scalefac_compress],Q=qb.slen2_tab[C.scalefac_compress];for(p=q=0;p<C.sfbdivide;p++)-1!=C.scalefac[p]&&(u(B,C.scalefac[p],I),q+=I);for(;p<C.sfbmax;p++)-1!=C.scalefac[p]&&(u(B,C.scalefac[p],Q),q+=Q);q=C.block_type==c.SHORT_TYPE?q+K(B,C):q+f(B,C);q+=E(B,C);D+=q}else for(y=m=0;y<B.channels_out;y++){C=z.tt[m][y];var S=0;Q=p=q=0;if(C.block_type==c.SHORT_TYPE){for(;4>Q;Q++){var w=C.sfb_partition_table[Q]/3,Z=C.slen[Q];for(I=0;I<w;I++,p++)u(B,Math.max(C.scalefac[3*p],0),Z),u(B,Math.max(C.scalefac[3*p+1],0),Z),u(B,Math.max(C.scalefac[3*p+2],0),Z),S+=3*Z}q+=K(B,C)}else{for(;4>Q;Q++)for(w=C.sfb_partition_table[Q],Z=C.slen[Q],I=0;I<w;I++,p++)u(B,Math.max(C.scalefac[p],0),Z),S+=Z;q+=f(B,C)}q+=E(B,C);D+=S+q}h+=D;k(a,e.resvDrain_post);h+=e.resvDrain_post;e.main_data_begin+=(l-h)/8;v(a,new b)!=d.ResvSize&&T.err.println("Internal buffer inconsistency. flushbits <> ResvSize");8*e.main_data_begin!=d.ResvSize&&(T.err.printf("bit reservoir error: \nl3_side.main_data_begin: %d \nResvoir size:             %d \nresv drain (post)         %d \nresv drain (pre)          %d \nheader and sideinfo:      %d \ndata bits:                %d \ntotal bits:               %d (remainder: %d) \nbitsperframe:             %d \n",8*e.main_data_begin,d.ResvSize,e.resvDrain_post,e.resvDrain_pre,8*d.sideinfo_len,h-e.resvDrain_post-8*d.sideinfo_len,h,h%8,l),T.err.println("This is a fatal error.  It has several possible causes:"),T.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),T.err.println(" 9%%  Your system is overclocked"),T.err.println(" 1%%  bug in LAME encoding library"),d.ResvSize=8*e.main_data_begin);if(1E9<g){for(a=0;a<da.MAX_HEADER_BUF;++a)d.header[a].write_timing-=g;g=0}return 0};this.copy_buffer=function(a,e,b,c,h){var g=q+1;if(0>=g)return 0;if(0!=c&&g>c)return-1;T.arraycopy(d,0,e,b,g);q=-1;D=0;if(0!=h&&(c=X(1),c[0]=a.nMusicCRC,l.updateMusicCRC(c,e,b,g),a.nMusicCRC=c[0],0<g&&(a.VBR_seek_table.nBytesWritten+=g),a.decode_on_the_fly)){c=ca([2,1152]);h=g;for(var f=-1,p;0!=f;)if(f=z.hip_decode1_unclipped(a.hip,e,b,h,c[0],c[1]),h=0,-1==f&&(f=0),0<f){if(a.findPeakSample){for(p=0;p<f;p++)c[0][p]>a.PeakSample?a.PeakSample=c[0][p]:-c[0][p]>a.PeakSample&&(a.PeakSample=-c[0][p]);if(1<a.channels_out)for(p=0;p<f;p++)c[1][p]>a.PeakSample?a.PeakSample=c[1][p]:-c[1][p]>a.PeakSample&&(a.PeakSample=-c[1][p])}if(a.findReplayGain&&m.AnalyzeSamples(a.rgdata,c[0],0,c[1],0,f,a.channels_out)==Y.GAIN_ANALYSIS_ERROR)return-6}}return g};this.init_bit_stream_w=function(a){d=new Int8Array(W.LAME_MAXMP3BUFFER);a.h_ptr=a.w_ptr=0;a.header[a.h_ptr].write_timing=0;q=-1;g=D=0}}function zb(){function c(a,b){var d=a[b+0]&255;d=d<<8|a[b+1]&255;d=d<<8|a[b+2]&255;return d=d<<8|a[b+3]&255}function k(a,b,d){a[b+
0]=d>>24&255;a[b+1]=d>>16&255;a[b+2]=d>>8&255;a[b+3]=d&255}function n(a,b,d){a[b+0]=d>>8&255;a[b+1]=d&255}function V(a,b,d){return 255&(a<<b|d&~(-1<<b))}function E(a,b){var d=a.internal_flags;b[0]=V(b[0],8,255);b[1]=V(b[1],3,7);b[1]=V(b[1],1,16E3>a.out_samplerate?0:1);b[1]=V(b[1],1,a.version);b[1]=V(b[1],2,1);b[1]=V(b[1],1,a.error_protection?0:1);b[2]=V(b[2],4,d.bitrate_index);b[2]=V(b[2],2,d.samplerate_index);b[2]=V(b[2],1,0);b[2]=V(b[2],1,a.extension);b[3]=V(b[3],2,a.mode.ordinal());b[3]=V(b[3],2,d.mode_ext);b[3]=V(b[3],1,a.copyright);b[3]=V(b[3],1,a.original);b[3]=V(b[3],2,a.emphasis);b[0]=255;d=b[1]&241;var e=1==a.version?128:16E3>a.out_samplerate?32:64;a.VBR==G.vbr_off&&(e=a.brate);e=a.free_format?0:255&16*K.BitrateIndex(e,a.version,a.out_samplerate);b[1]=1==a.version?255&(d|10):255&(d|2);d=b[2]&13;b[2]=255&(e|d)}function B(a,b){return b=b>>8^z[(b^a)&255]}var K,f,b;this.setModules=function(a,c,d){K=a;f=c;b=d};var v=zb.NUMTOCENTRIES,a=zb.MAXFRAMESIZE,m=v+4+4+4+4+4+9+1+1+8+1+1+3+1+1+2+
4+2+2,z=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8E3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16E3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32E3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];this.addVbrFrame=function(a){var b=a.internal_flags;var d=b.VBR_seek_table;a=w.bitrate_table[a.version][b.bitrate_index];d.nVbrNumFrames++;d.sum+=a;d.seen++;if(!(d.seen<d.want)&&(d.pos<d.size&&(d.bag[d.pos]=d.sum,d.pos++,d.seen=0),d.pos==d.size)){for(a=1;a<d.size;a+=2)d.bag[a/2]=d.bag[a];d.want*=2;d.pos/=2}};this.getVbrTag=function(a){var b=new VBRTagData,d=0;b.flags=0;var e=a[d+1]>>3&1,f=a[d+2]>>2&3,m=a[d+3]>>6&3,p=a[d+2]>>4&15;p=w.bitrate_table[e][p];b.samprate=14==a[d+1]>>4?w.samplerate_table[2][f]:w.samplerate_table[e][f];f=d=0!=e?3!=m?d+36:d+21:3!=m?d+21:d+13;if(!(new String(a,f,4(),null)).equals("Xing")&&!(new String(a,f,4(),null)).equals("Info"))return null;d+=4;b.hId=e;f=b.flags=c(a,d);d+=4;0!=(f&1)&&(b.frames=c(a,d),d+=4);0!=(f&2)&&(b.bytes=c(a,d),d+=4);if(0!=(f&4)){if(null!=b.toc)for(m=0;m<v;m++)b.toc[m]=a[d+m];d+=v}b.vbrScale=-1;0!=(f&8)&&(b.vbrScale=c(a,d),d+=4);b.headersize=72E3*(e+1)*p/b.samprate;d+=21;e=a[d+0]<<4;e+=a[d+1]>>4;p=(a[d+1]&15)<<8;p+=a[d+2]&255;if(0>e||3E3<e)e=-1;if(0>p||3E3<p)p=-1;b.encDelay=e;b.encPadding=p;return b};this.InitVbrTag=function(b){var e=b.internal_flags;var d=1==b.version?128:16E3>b.out_samplerate?32:64;b.VBR==G.vbr_off&&(d=b.brate);d=72E3*(b.version+1)*d/b.out_samplerate;var c=e.sideinfo_len+m;e.VBR_seek_table.TotalFrameSize=d;if(d<c||d>a)b.bWriteVbrTag=!1;else for(e.VBR_seek_table.nVbrNumFrames=0,e.VBR_seek_table.nBytesWritten=0,e.VBR_seek_table.sum=0,e.VBR_seek_table.seen=0,e.VBR_seek_table.want=1,e.VBR_seek_table.pos=0,null==e.VBR_seek_table.bag&&(e.VBR_seek_table.bag=new int[400],e.VBR_seek_table.size=400),d=new Int8Array(a),E(b,d),e=e.VBR_seek_table.TotalFrameSize,c=0;c<e;++c)f.add_dummy_byte(b,d[c]&255,1)};this.updateMusicCRC=function(a,b,d,c){for(var e=0;e<c;++e)a[0]=B(b[d+e],a[0])};this.getLameTagFrame=function(a,c){var d=a.internal_flags;if(!a.bWriteVbrTag||d.Class_ID!=W.LAME_ID||0>=d.VBR_seek_table.pos)return 0;if(c.length<d.VBR_seek_table.TotalFrameSize)return d.VBR_seek_table.TotalFrameSize;na.fill(c,0,d.VBR_seek_table.TotalFrameSize,0);E(a,c);var e=new Int8Array(v);if(a.free_format)for(var l=1;l<v;++l)e[l]=255&255*l/100;else{var m=d.VBR_seek_table;if(!(0>=m.pos))for(l=1;l<v;++l){var p=0|Math.floor(l/v*m.pos);p>m.pos-1&&(p=m.pos-1);p=0|256*m.bag[p]/m.sum;255<p&&(p=255);e[l]=255&p}}p=d.sideinfo_len;a.error_protection&&(p-=2);c[p++]=0;c[p++]=0;c[p++]=0;c[p++]=0;k(c,p,15);p+=4;k(c,p,d.VBR_seek_table.nVbrNumFrames);p+=4;m=d.VBR_seek_table.nBytesWritten+d.VBR_seek_table.TotalFrameSize;k(c,p,0|m);p+=4;T.arraycopy(e,0,c,p,e.length);p+=e.length;a.error_protection&&f.CRC_writeheader(d,c);var r=0;for(l=0;l<p;l++)r=B(c[l],r);e=p;l=r;var t=a.internal_flags;p=0;r=a.encoder_delay;var u=a.encoder_padding,h=100-10*a.VBR_q-a.quality,x=b.getLameVeryShortVersion();var y=[1,5,3,2,4,0,3];var A=0|(255<a.lowpassfreq/100+.5?255:a.lowpassfreq/100+.5),z=0,w=0,O=a.internal_flags.noise_shaping,F=0,C,I=0!=(a.exp_nspsytune&1);var Q=0!=(a.exp_nspsytune&2);var S=C=!1,ma=a.internal_flags.nogap_total,Z=a.internal_flags.nogap_current,L=a.ATHtype;switch(a.VBR){case vbr_abr:var V=a.VBR_mean_bitrate_kbps;break;case vbr_off:V=a.brate;break;default:V=a.VBR_min_bitrate_kbps}y=0+(a.VBR.ordinal()<y.length?y[a.VBR.ordinal()]:0);t.findReplayGain&&(510<t.RadioGain&&(t.RadioGain=510),-510>t.RadioGain&&(t.RadioGain=-510),w=11264,w=0<=t.RadioGain?w|t.RadioGain:w|512|-t.RadioGain);t.findPeakSample&&(z=Math.abs(0|t.PeakSample/32767*Math.pow(2,23)+.5));-1!=ma&&(0<Z&&(S=!0),Z<ma-1&&(C=!0));I=L+((I?1:0)<<4)+((Q?1:0)<<5)+((C?1:0)<<6)+((S?1:0)<<7);0>h&&(h=0);switch(a.mode){case MONO:Q=0;break;case STEREO:Q=1;break;case DUAL_CHANNEL:Q=2;break;case JOINT_STEREO:Q=a.force_ms?4:3;break;default:Q=7}C=32E3>=a.in_samplerate?0:48E3==a.in_samplerate?2:48E3<a.in_samplerate?3:1;if(a.short_blocks==ra.short_block_forced||a.short_blocks==ra.short_block_dispensed||-1==a.lowpassfreq&&-1==a.highpassfreq||a.scale_left<a.scale_right||a.scale_left>a.scale_right||a.disable_reservoir&&320>a.brate||a.noATH||a.ATHonly||0==L||32E3>=a.in_samplerate)F=1;O=O+(Q<<2)+(F<<5)+(C<<6);t=t.nMusicCRC;k(c,e+p,h);p+=4;for(h=0;9>h;h++)c[e+p+h]=255&x.charAt(h);p+=9;c[e+p]=255&y;p++;c[e+p]=255&A;p++;k(c,e+p,z);p+=4;n(c,e+p,w);p+=2;n(c,e+p,0);p+=2;c[e+p]=255&I;p++;c[e+p]=255<=V?255:255&V;p++;c[e+p]=255&r>>4;c[e+p+1]=255&(r<<4)+(u>>8);c[e+p+2]=255&u;p+=3;c[e+p]=255&O;p++;c[e+p++]=0;n(c,e+p,a.preset);p+=2;k(c,e+p,m);p+=4;n(c,e+p,t);p+=2;for(a=0;a<p;a++)l=B(c[e+a],l);n(c,e+p,l);return d.VBR_seek_table.TotalFrameSize};this.putVbrTag=function(b,c){if(0>=b.internal_flags.VBR_seek_table.pos)return-1;c.seek(c.length());if(0==c.length())return-1;c.seek(0);var d=new Int8Array(10);c.readFully(d);d=(new String(d,"ISO-8859-1")).startsWith("ID3")?0:((d[6]&127)<<21|(d[7]&127)<<14|(d[8]&127)<<7|d[9]&127)+d.length;c.seek(d);d=new Int8Array(a);b=getLameTagFrame(b,d);if(b>d.length)return-1;if(1>b)return 0;c.write(d,0,b);return 0}}function U(c,k,n,w){this.xlen=c;this.linmax=k;this.table=n;this.hlen=w}function xa(c){this.bits=c}function yc(){this.setModules=function(c,k){}}function sb(){this.bits=this.over_SSD=this.over_count=this.max_noise=this.tot_noise=this.over_noise=0}function zc(){this.scale_right=this.scale_left=this.scale=this.out_samplerate=this.in_samplerate=this.num_channels=this.num_samples=this.class_id=0;this.decode_only=this.bWriteVbrTag=this.analysis=!1;this.quality=0;this.mode=la.STEREO;this.write_id3tag_automatic=this.decode_on_the_fly=this.findReplayGain=this.free_format=this.force_ms=!1;this.error_protection=this.emphasis=this.extension=this.original=this.copyright=this.compression_ratio=this.brate=0;this.disable_reservoir=this.strict_ISO=!1;this.quant_comp_short=this.quant_comp=0;this.experimentalY=!1;this.preset=this.exp_nspsytune=this.experimentalZ=0;this.VBR=null;this.maskingadjust_short=this.maskingadjust=this.highpasswidth=this.lowpasswidth=this.highpassfreq=this.lowpassfreq=this.VBR_hard_min=this.VBR_max_bitrate_kbps=this.VBR_min_bitrate_kbps=this.VBR_mean_bitrate_kbps=this.VBR_q=this.VBR_q_frac=0;this.noATH=this.ATHshort=this.ATHonly=!1;this.athaa_sensitivity=this.athaa_loudapprox=this.athaa_type=this.ATHlower=this.ATHcurve=this.ATHtype=0;this.short_blocks=null;this.useTemporal=!1;this.msfix=this.interChRatio=0;this.tune=!1;this.lame_allocated_gfp=this.frameNum=this.framesize=this.encoder_padding=this.encoder_delay=this.version=this.tune_value_a=0;this.internal_flags=null}function Ac(){this.linprebuf=K(2*Y.MAX_ORDER);this.linpre=0;this.lstepbuf=K(Y.MAX_SAMPLES_PER_WINDOW+Y.MAX_ORDER);this.lstep=0;this.loutbuf=K(Y.MAX_SAMPLES_PER_WINDOW+Y.MAX_ORDER);this.lout=0;this.rinprebuf=K(2*Y.MAX_ORDER);this.rinpre=0;this.rstepbuf=K(Y.MAX_SAMPLES_PER_WINDOW+Y.MAX_ORDER);this.rstep=0;this.routbuf=K(Y.MAX_SAMPLES_PER_WINDOW+Y.MAX_ORDER);this.first=this.freqindex=this.rsum=this.lsum=this.totsamp=this.sampleWindow=this.rout=0;this.A=X(0|Y.STEPS_per_dB*Y.MAX_dB);this.B=X(0|Y.STEPS_per_dB*Y.MAX_dB)}function Bc(u){this.quantize=u;this.iteration_loop=function(k,n,u,w){var B=k.internal_flags,E=K(sa.SFBMAX),f=K(576),b=X(2),v=B.l3_side;var a=new xa(0);this.quantize.rv.ResvFrameBegin(k,a);a=a.bits;for(var m=0;m<B.mode_gr;m++){var z=this.quantize.qupvt.on_pe(k,n,b,a,m,m);B.mode_ext==c.MPG_MD_MS_LR&&(this.quantize.ms_convert(B.l3_side,m),this.quantize.qupvt.reduce_side(b,u[m],a,z));for(z=0;z<B.channels_out;z++){var e=v.tt[m][z];if(e.block_type!=c.SHORT_TYPE){var l=0;l=B.PSY.mask_adjust-l}else l=0,l=B.PSY.mask_adjust_short-l;B.masking_lower=Math.pow(10,.1*l);this.quantize.init_outer_loop(B,e);this.quantize.init_xrpow(B,e,f)&&(this.quantize.qupvt.calc_xmin(k,w[m][z],e,E),this.quantize.outer_loop(k,e,E,f,z,b[z]));this.quantize.iteration_finish_one(B,m,z)}}this.quantize.rv.ResvFrameEnd(B,a)}}function Cc(){this.floor=this.decay=this.adjustLimit=this.adjust=this.aaSensitivityP=this.useAdjust=0;this.l=K(c.SBMAX_l);this.s=K(c.SBMAX_s);this.psfb21=K(c.PSFB21);this.psfb12=K(c.PSFB12);this.cb_l=K(c.CBANDS);this.cb_s=K(c.CBANDS);this.eql_w=K(c.BLKSIZE/2)}function za(u,k,n,w){this.l=X(1+c.SBMAX_l);this.s=X(1+c.SBMAX_s);this.psfb21=X(1+c.PSFB21);this.psfb12=X(1+c.PSFB12);var E=this.l,B=this.s;4==arguments.length&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],T.arraycopy(this.arrL,0,E,0,Math.min(this.arrL.length,this.l.length)),T.arraycopy(this.arrS,0,B,0,Math.min(this.arrS.length,this.s.length)),T.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),T.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}function ia(){function u(a,b){b=E.ATHformula(b,a);return b=Math.pow(10,(b-100)/10+a.ATHlower)}function k(a){this.s=a}var n=null,w=null,E=null;this.setModules=function(a,b,d){n=a;w=b;E=d};this.IPOW20=function(b){return a[b]};var B=ia.IXMAX_VAL+2,ha=ia.Q_MAX,f=ia.Q_MAX2;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var b=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=b;this.sfBandIndex=[new za([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new za([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new za([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new za([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new za([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new za([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new za([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new za([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new za([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0,8,16,24,36,52,72,96,124,160,162,164,166,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var v=K(ha+f+1),a=K(ha),m=K(B),z=K(B);this.adj43=z;this.iteration_init=function(b){var e=b.internal_flags,d=e.l3_side;if(0==e.iteration_init_init){e.iteration_init_init=1;d.main_data_begin=0;d=b.internal_flags.ATH.l;for(var g=b.internal_flags.ATH.psfb21,q=b.internal_flags.ATH.s,k=b.internal_flags.ATH.psfb12,p=b.internal_flags,r=b.out_samplerate,t=0;t<c.SBMAX_l;t++){var J=p.scalefac_band.l[t],h=p.scalefac_band.l[t+1];for(d[t]=Ma.MAX_VALUE;J<h;J++){var x=J*r/1152;x=u(b,x);d[t]=Math.min(d[t],x)}}for(t=0;t<c.PSFB21;t++)for(J=p.scalefac_band.psfb21[t],h=p.scalefac_band.psfb21[t+1],g[t]=Ma.MAX_VALUE;J<h;J++)x=J*r/1152,x=u(b,x),g[t]=Math.min(g[t],x);for(t=0;t<c.SBMAX_s;t++){J=p.scalefac_band.s[t];h=p.scalefac_band.s[t+1];for(q[t]=Ma.MAX_VALUE;J<h;J++)x=J*r/384,x=u(b,x),q[t]=Math.min(q[t],x);q[t]*=p.scalefac_band.s[t+1]-p.scalefac_band.s[t]}for(t=0;t<c.PSFB12;t++){J=p.scalefac_band.psfb12[t];h=p.scalefac_band.psfb12[t+1];for(k[t]=Ma.MAX_VALUE;J<h;J++)x=J*r/384,x=u(b,x),k[t]=Math.min(k[t],x);k[t]*=p.scalefac_band.s[13]-p.scalefac_band.s[12]}if(b.noATH){for(t=0;t<c.SBMAX_l;t++)d[t]=1E-20;for(t=0;t<c.PSFB21;t++)g[t]=1E-20;for(t=0;t<c.SBMAX_s;t++)q[t]=1E-20;for(t=0;t<c.PSFB12;t++)k[t]=1E-20}p.ATH.floor=10*Math.log10(u(b,-1));m[0]=0;for(d=1;d<B;d++)m[d]=Math.pow(d,4/3);for(d=0;d<B-1;d++)z[d]=d+1-Math.pow(.5*(m[d]+m[d+1]),.75);z[d]=.5;for(d=0;d<ha;d++)a[d]=Math.pow(2,-.1875*(d-210));for(d=0;d<=ha+f;d++)v[d]=Math.pow(2,.25*(d-210-f));n.huffman_init(e);d=b.exp_nspsytune>>2&63;32<=d&&(d-=64);g=Math.pow(10,d/4/10);d=b.exp_nspsytune>>8&63;32<=d&&(d-=64);q=Math.pow(10,d/4/10);d=b.exp_nspsytune>>14&63;32<=d&&(d-=64);k=Math.pow(10,d/4/10);d=b.exp_nspsytune>>20&63;32<=d&&(d-=64);b=k*Math.pow(10,d/4/10);for(d=0;d<c.SBMAX_l;d++)p=6>=d?g:13>=d?q:20>=d?k:b,e.nsPsy.longfact[d]=p;for(d=0;d<c.SBMAX_s;d++)p=5>=d?g:10>=d?q:11>=d?k:b,e.nsPsy.shortfact[d]=p}};this.on_pe=function(a,b,d,c,f,m){var e=a.internal_flags,g=0,l=X(2),q;g=new xa(g);a=w.ResvMaxBits(a,c,g,m);g=g.bits;var h=g+a;h>da.MAX_BITS_PER_GRANULE&&(h=da.MAX_BITS_PER_GRANULE);for(q=m=0;q<e.channels_out;++q)d[q]=Math.min(da.MAX_BITS_PER_CHANNEL,g/e.channels_out),l[q]=0|d[q]*b[f][q]/700-d[q],l[q]>3*c/4&&(l[q]=3*c/4),0>l[q]&&(l[q]=0),l[q]+d[q]>da.MAX_BITS_PER_CHANNEL&&(l[q]=Math.max(0,da.MAX_BITS_PER_CHANNEL-d[q])),m+=l[q];if(m>a)for(q=0;q<e.channels_out;++q)l[q]=a*l[q]/m;for(q=0;q<e.channels_out;++q)d[q]+=l[q],a-=l[q];for(q=m=0;q<e.channels_out;++q)m+=d[q];if(m>da.MAX_BITS_PER_GRANULE)for(q=0;q<e.channels_out;++q)d[q]*=da.MAX_BITS_PER_GRANULE,d[q]/=m;return h};this.reduce_side=function(a,b,d,c){b=.33*(.5-b)/.5;0>b&&(b=0);.5<b&&(b=.5);b=0|.5*b*(a[0]+a[1]);b>da.MAX_BITS_PER_CHANNEL-
a[0]&&(b=da.MAX_BITS_PER_CHANNEL-a[0]);0>b&&(b=0);125<=a[1]&&(125<a[1]-b?(a[0]<d&&(a[0]+=b),a[1]-=b):(a[0]+=a[1]-125,a[1]=125));b=a[0]+a[1];b>c&&(a[0]=c*a[0]/b,a[1]=c*a[1]/b)};this.athAdjust=function(a,b,d){b=aa.FAST_LOG10_X(b,10);a*=a;var c=0;b-=d;1E-20<a&&(c=1+aa.FAST_LOG10_X(a,10/90.30873362));0>c&&(c=0);return Math.pow(10,.1*(b*c+(d+90.30873362-94.82444863)))};this.calc_xmin=function(a,b,d,f){var e=0,g=a.internal_flags,m,l=0,k=0,v=g.ATH,h=d.xr,x=a.VBR==G.vbr_mtrh?1:0,y=g.masking_lower;if(a.VBR==G.vbr_mtrh||a.VBR==G.vbr_mt)y=1;for(m=0;m<d.psy_lmax;m++){var A=a.VBR==G.vbr_rh||a.VBR==G.vbr_mtrh?athAdjust(v.adjust,v.l[m],v.floor):v.adjust*v.l[m];var n=d.width[m];var u=A/n;var B=2.220446049250313E-16;var z=n>>1;var C=0;do{var I=h[l]*h[l];C+=I;B+=I<u?I:u;l++;I=h[l]*h[l];C+=I;B+=I<u?I:u;l++}while(0<--z);C>A&&k++;m==c.SBPSY_l&&(u=A*g.nsPsy.longfact[m],B<u&&(B=u));0!=x&&(A=B);a.ATHonly||(B=b.en.l[m],0<B&&(u=C*b.thm.l[m]*y/B,0!=x&&(u*=g.nsPsy.longfact[m]),A<u&&(A=u)));0!=x?f[e++]=A:f[e++]=A*g.nsPsy.longfact[m]}C=575;if(d.block_type!=c.SHORT_TYPE)for(A=576;0!=A--&&qa.EQ(h[A],0);)C=A;d.max_nonzero_coeff=C;for(var Q=d.sfb_smin;m<d.psymax;Q++,m+=3){var S;var w=a.VBR==G.vbr_rh||a.VBR==G.vbr_mtrh?athAdjust(v.adjust,v.s[Q],v.floor):v.adjust*v.s[Q];n=d.width[m];for(S=0;3>S;S++){C=0;z=n>>1;u=w/n;B=2.220446049250313E-16;do I=h[l]*h[l],C+=I,B+=I<u?I:u,l++,I=h[l]*h[l],C+=I,B+=I<u?I:u,l++;while(0<--z);C>w&&k++;Q==c.SBPSY_s&&(u=w*g.nsPsy.shortfact[Q],B<u&&(B=u));A=0!=x?B:w;a.ATHonly||a.ATHshort||(B=b.en.s[Q][S],0<B&&(u=C*b.thm.s[Q][S]*y/B,0!=x&&(u*=g.nsPsy.shortfact[Q]),A<u&&(A=u)));0!=x?f[e++]=A:f[e++]=A*g.nsPsy.shortfact[Q]}a.useTemporal&&(f[e-3]>f[e-3+1]&&(f[e-3+1]+=(f[e-3]-f[e-3+1])*g.decay),f[e-3+1]>f[e-3+2]&&(f[e-3+2]+=(f[e-3+1]-f[e-3+2])*g.decay))}return k};this.calc_noise_core=function(a,b,d,c){var e=0,f=b.s,g=a.l3_enc;if(f>a.count1)for(;0!=d--;){var l=a.xr[f];f++;e+=l*l;l=a.xr[f];f++;e+=l*l}else if(f>a.big_values){var k=K(2);k[0]=0;for(k[1]=c;0!=d--;)l=Math.abs(a.xr[f])-k[g[f]],f++,e+=l*l,l=Math.abs(a.xr[f])-
k[g[f]],f++,e+=l*l}else for(;0!=d--;)l=Math.abs(a.xr[f])-m[g[f]]*c,f++,e+=l*l,l=Math.abs(a.xr[f])-m[g[f]]*c,f++,e+=l*l;b.s=f;return e};this.calc_noise=function(a,c,d,f,m){var e=0,g=0,l,q=0,u=0,h=0,x=-20,y=0,A=a.scalefac,n=0;for(l=f.over_SSD=0;l<a.psymax;l++){var B=a.global_gain-(A[n++]+(0!=a.preflag?b[l]:0)<<a.scalefac_scale+1)-8*a.subblock_gain[a.window[l]];if(null!=m&&m.step[l]==B){var z=m.noise[l];y+=a.width[l];d[e++]=z/c[g++];z=m.noise_log[l]}else{z=v[B+ia.Q_MAX2];var w=a.width[l]>>1;y+a.width[l]>a.max_nonzero_coeff&&(w=a.max_nonzero_coeff-y+1,w=0<w?w>>1:0);y=new k(y);z=this.calc_noise_core(a,y,w,z);y=y.s;null!=m&&(m.step[l]=B,m.noise[l]=z);z=d[e++]=z/c[g++];z=aa.FAST_LOG10(Math.max(z,1E-20));null!=m&&(m.noise_log[l]=z)}null!=m&&(m.global_gain=a.global_gain);h+=z;0<z&&(B=Math.max(0|10*z+.5,1),f.over_SSD+=B*B,q++,u+=z);x=Math.max(x,z)}f.over_count=q;f.tot_noise=h;f.over_noise=u;f.max_noise=x;return q};this.set_pinfo=function(a,f,d,g,m){var e=a.internal_flags,l,k,q=0==f.scalefac_scale?.5:1,v=f.scalefac,h=K(sa.SFBMAX),x=K(sa.SFBMAX),y=new sb;calc_xmin(a,d,f,h);calc_noise(f,h,x,y,null);var u=0;var n=f.sfb_lmax;f.block_type!=c.SHORT_TYPE&&0==f.mixed_block_flag&&(n=22);for(l=0;l<n;l++){var B=e.scalefac_band.l[l],z=e.scalefac_band.l[l+1],w=z-B;for(k=0;u<z;u++)k+=f.xr[u]*f.xr[u];k/=w;var C=1E15;e.pinfo.en[g][m][l]=C*k;e.pinfo.xfsf[g][m][l]=C*h[l]*x[l]/w;k=0<d.en.l[l]&&!a.ATHonly?k/d.en.l[l]:0;e.pinfo.thr[g][m][l]=C*Math.max(k*d.thm.l[l],e.ATH.l[l]);e.pinfo.LAMEsfb[g][m][l]=0;0!=f.preflag&&11<=l&&(e.pinfo.LAMEsfb[g][m][l]=-q*b[l]);l<c.SBPSY_l&&(e.pinfo.LAMEsfb[g][m][l]-=q*v[l])}if(f.block_type==c.SHORT_TYPE)for(n=l,l=f.sfb_smin;l<c.SBMAX_s;l++){B=e.scalefac_band.s[l];z=e.scalefac_band.s[l+1];w=z-B;for(var I=0;3>I;I++){k=0;for(C=B;C<z;C++)k+=f.xr[u]*f.xr[u],u++;k=Math.max(k/w,1E-20);C=1E15;e.pinfo.en_s[g][m][3*l+I]=C*k;e.pinfo.xfsf_s[g][m][3*l+I]=C*h[n]*x[n]/w;k=0<d.en.s[l][I]?k/d.en.s[l][I]:0;if(a.ATHonly||a.ATHshort)k=0;e.pinfo.thr_s[g][m][3*l+I]=C*Math.max(k*d.thm.s[l][I],e.ATH.s[l]);e.pinfo.LAMEsfb_s[g][m][3*l+I]=-2*f.subblock_gain[I];l<c.SBPSY_s&&(e.pinfo.LAMEsfb_s[g][m][3*l+I]-=q*v[n]);n++}}e.pinfo.LAMEqss[g][m]=f.global_gain;e.pinfo.LAMEmainbits[g][m]=f.part2_3_length+f.part2_length;e.pinfo.LAMEsfbits[g][m]=f.part2_length;e.pinfo.over[g][m]=y.over_count;e.pinfo.max_noise[g][m]=10*y.max_noise;e.pinfo.over_noise[g][m]=10*y.over_noise;e.pinfo.tot_noise[g][m]=10*y.tot_noise;e.pinfo.over_SSD[g][m]=y.over_SSD}}function Dc(){this.sfb_count1=this.global_gain=0;this.step=X(39);this.noise=K(39);this.noise_log=K(39)}function rb(){this.xr=K(576);this.l3_enc=X(576);this.scalefac=X(sa.SFBMAX);this.mixed_block_flag=this.block_type=this.scalefac_compress=this.global_gain=this.count1=this.big_values=this.part2_3_length=this.xrpow_max=0;this.table_select=X(3);this.subblock_gain=X(4);this.sfbdivide=this.psymax=this.sfbmax=this.psy_lmax=this.sfb_smin=this.sfb_lmax=this.part2_length=this.count1table_select=this.scalefac_scale=this.preflag=this.region1_count=this.region0_count=0;this.width=X(sa.SFBMAX);this.window=X(sa.SFBMAX);this.count1bits=0;this.sfb_partition_table=null;this.slen=X(4);this.max_nonzero_coeff=0;var c=this;this.assign=function(k){c.xr=new Float32Array(k.xr);c.l3_enc=new Int32Array(k.l3_enc);c.scalefac=new Int32Array(k.scalefac);c.xrpow_max=k.xrpow_max;c.part2_3_length=k.part2_3_length;c.big_values=k.big_values;c.count1=k.count1;c.global_gain=k.global_gain;c.scalefac_compress=k.scalefac_compress;c.block_type=k.block_type;c.mixed_block_flag=k.mixed_block_flag;c.table_select=new Int32Array(k.table_select);c.subblock_gain=new Int32Array(k.subblock_gain);c.region0_count=k.region0_count;c.region1_count=k.region1_count;c.preflag=k.preflag;c.scalefac_scale=k.scalefac_scale;c.count1table_select=k.count1table_select;c.part2_length=k.part2_length;c.sfb_lmax=k.sfb_lmax;c.sfb_smin=k.sfb_smin;c.psy_lmax=k.psy_lmax;c.sfbmax=k.sfbmax;c.psymax=k.psymax;c.sfbdivide=k.sfbdivide;c.width=new Int32Array(k.width);c.window=new Int32Array(k.window);c.count1bits=k.count1bits;c.sfb_partition_table=k.sfb_partition_table.slice(0);c.slen=new Int32Array(k.slen);c.max_nonzero_coeff=k.max_nonzero_coeff}}function Ec(){function u(c){this.ordinal=c}function k(c){for(var b=0;b<c.sfbmax;b++)if(0==c.scalefac[b]+c.subblock_gain[c.window[b]])return!1;return!0}var n;this.rv=null;var w;this.qupvt=null;var E,B=new yc,ha;this.setModules=function(c,b,k,a){n=c;this.rv=w=b;this.qupvt=E=k;ha=a;B.setModules(E,ha)};this.ms_convert=function(c,b){for(var f=0;576>f;++f){var a=c.tt[b][0].xr[f],m=c.tt[b][1].xr[f];c.tt[b][0].xr[f]=.5*(a+m)*aa.SQRT2;c.tt[b][1].xr[f]=.5*(a-m)*aa.SQRT2}};this.init_xrpow=function(c,b,k){var a=0|b.max_nonzero_coeff;b.xrpow_max=0;na.fill(k,a,576,0);for(var f,v=f=0;v<=a;++v){var e=Math.abs(b.xr[v]);f+=e;k[v]=Math.sqrt(e*Math.sqrt(e));k[v]>b.xrpow_max&&(b.xrpow_max=k[v])}if(1E-20<f){k=0;0!=(c.substep_shaping&2)&&(k=1);for(a=0;a<b.psymax;a++)c.pseudohalf[a]=k;return!0}na.fill(b.l3_enc,0,576,0);return!1};this.init_outer_loop=function(f,b){b.part2_3_length=0;b.big_values=0;b.count1=0;b.global_gain=210;b.scalefac_compress=0;b.table_select[0]=0;b.table_select[1]=0;b.table_select[2]=0;b.subblock_gain[0]=0;b.subblock_gain[1]=0;b.subblock_gain[2]=0;b.subblock_gain[3]=0;b.region0_count=0;b.region1_count=0;b.preflag=0;b.scalefac_scale=0;b.count1table_select=0;b.part2_length=0;b.sfb_lmax=c.SBPSY_l;b.sfb_smin=c.SBPSY_s;b.psy_lmax=f.sfb21_extra?c.SBMAX_l:c.SBPSY_l;b.psymax=b.psy_lmax;b.sfbmax=b.sfb_lmax;b.sfbdivide=11;for(var k=0;k<c.SBMAX_l;k++)b.width[k]=f.scalefac_band.l[k+1]-f.scalefac_band.l[k],b.window[k]=3;if(b.block_type==c.SHORT_TYPE){var a=K(576);b.sfb_smin=0;b.sfb_lmax=0;0!=b.mixed_block_flag&&(b.sfb_smin=3,b.sfb_lmax=2*f.mode_gr+4);b.psymax=b.sfb_lmax+3*((f.sfb21_extra?c.SBMAX_s:c.SBPSY_s)-b.sfb_smin);b.sfbmax=b.sfb_lmax+3*(c.SBPSY_s-b.sfb_smin);b.sfbdivide=b.sfbmax-18;b.psy_lmax=b.sfb_lmax;var m=f.scalefac_band.l[b.sfb_lmax];T.arraycopy(b.xr,0,a,0,576);for(k=b.sfb_smin;k<c.SBMAX_s;k++)for(var n=f.scalefac_band.s[k],e=f.scalefac_band.s[k+1],l=0;3>l;l++)for(var d=n;d<e;d++)b.xr[m++]=a[3*d+l];a=b.sfb_lmax;for(k=b.sfb_smin;k<c.SBMAX_s;k++)b.width[a]=b.width[a+1]=b.width[a+2]=f.scalefac_band.s[k+1]-f.scalefac_band.s[k],b.window[a]=0,b.window[a+1]=1,b.window[a+2]=2,a+=3}b.count1bits=0;b.sfb_partition_table=E.nr_of_sfb_block[0][0];b.slen[0]=0;b.slen[1]=0;b.slen[2]=0;b.slen[3]=0;b.max_nonzero_coeff=575;na.fill(b.scalefac,0);k=f.ATH;a=b.xr;if(b.block_type!=c.SHORT_TYPE)for(b=!1,m=c.PSFB21-1;0<=m&&!b;m--)for(n=f.scalefac_band.psfb21[m],e=f.scalefac_band.psfb21[m+1],l=E.athAdjust(k.adjust,k.psfb21[m],k.floor),1E-12<f.nsPsy.longfact[21]&&(l*=f.nsPsy.longfact[21]),--e;e>=n;e--)if(Math.abs(a[e])<l)a[e]=0;else{b=!0;break}else for(l=0;3>l;l++)for(b=!1,m=c.PSFB12-1;0<=m&&!b;m--)for(n=3*f.scalefac_band.s[12]+(f.scalefac_band.s[13]-f.scalefac_band.s[12])*l+(f.scalefac_band.psfb12[m]-f.scalefac_band.psfb12[0]),e=n+(f.scalefac_band.psfb12[m+1]-f.scalefac_band.psfb12[m]),d=E.athAdjust(k.adjust,k.psfb12[m],k.floor),1E-12<f.nsPsy.shortfact[12]&&(d*=f.nsPsy.shortfact[12]),--e;e>=n;e--)if(Math.abs(a[e])<d)a[e]=0;else{b=!0;break}};u.BINSEARCH_NONE=new u(0);u.BINSEARCH_UP=new u(1);u.BINSEARCH_DOWN=new u(2);this.trancate_smallspectrums=function(f,b,k,a){var m=K(sa.SFBMAX);if((0!=(f.substep_shaping&4)||b.block_type!=c.SHORT_TYPE)&&0==(f.substep_shaping&128)){E.calc_noise(b,k,m,new sb,null);for(var n=0;576>n;n++){var e=0;0!=b.l3_enc[n]&&(e=Math.abs(b.xr[n]));a[n]=e}n=0;e=8;b.block_type==c.SHORT_TYPE&&(e=6);do{var l,d,g=b.width[e];n+=g;if(!(1<=m[e]||(na.sort(a,n-g,g),qa.EQ(a[n-1],0)))){var q=(1-m[e])*k[e];var v=l=0;do{for(d=1;v+d<g&&!qa.NEQ(a[v+n-g],a[v+n+d-g]);d++);var p=a[v+n-g]*a[v+n-g]*d;if(q<p){0!=v&&(l=a[v+n-g-1]);break}q-=p;v+=d}while(v<g);if(!qa.EQ(l,0)){do Math.abs(b.xr[n-g])<=l&&(b.l3_enc[n-g]=0);while(0<--g)}}}while(++e<b.psymax);b.part2_3_length=ha.noquant_count_bits(f,b,null)}};this.outer_loop=function(f,b,n,a,m,B){var e=f.internal_flags,l=new rb,d=K(576),g=K(sa.SFBMAX),q=new sb,v=new Dc,p=9999999,r=!1,t=!1,w=0,h,x=e.CurrentStep[m],y=!1,A=e.OldValue[m];var z=u.BINSEARCH_NONE;b.global_gain=A;for(h=B-b.part2_length;;){var H=ha.count_bits(e,a,b,null);if(1==x||H==h)break;H>h?(z==u.BINSEARCH_DOWN&&(y=!0),y&&(x/=2),z=u.BINSEARCH_UP,H=x):(z==u.BINSEARCH_UP&&(y=!0),y&&(x/=2),z=u.BINSEARCH_DOWN,H=-x);b.global_gain+=H;0>b.global_gain&&(b.global_gain=0,y=!0);255<b.global_gain&&(b.global_gain=255,y=!0)}for(;H>h&&255>b.global_gain;)b.global_gain++,H=ha.count_bits(e,a,b,null);e.CurrentStep[m]=4<=A-b.global_gain?4:2;e.OldValue[m]=b.global_gain;b.part2_3_length=H;if(0==e.noise_shaping)return 100;E.calc_noise(b,n,g,q,v);q.bits=b.part2_3_length;l.assign(b);m=0;for(T.arraycopy(a,0,d,0,576);!r;){do{h=new sb;y=255;x=0!=(e.substep_shaping&2)?20:3;if(e.sfb21_extra){if(1<g[l.sfbmax])break;if(l.block_type==c.SHORT_TYPE&&(1<g[l.sfbmax+1]||1<g[l.sfbmax+2]))break}A=l;H=a;z=f.internal_flags;var O=A,F=g,C=H,I=f.internal_flags;var Q=0==O.scalefac_scale?1.2968395546510096:1.6817928305074292;for(var S=0,ma=0;ma<O.sfbmax;ma++)S<F[ma]&&(S=F[ma]);ma=I.noise_shaping_amp;3==ma&&(ma=t?2:1);switch(ma){case 2:break;case 1:S=1<S?Math.pow(S,.5):.95*S;break;default:S=1<S?1:.95*S}var Z=0;for(ma=0;ma<O.sfbmax;ma++){var L=O.width[ma];Z+=L;if(!(F[ma]<S)){if(0!=(I.substep_shaping&2)&&(I.pseudohalf[ma]=0==I.pseudohalf[ma]?1:0,0==I.pseudohalf[ma]&&2==I.noise_shaping_amp))break;O.scalefac[ma]++;for(L=-L;0>L;L++)C[Z+L]*=Q,C[Z+L]>O.xrpow_max&&(O.xrpow_max=C[Z+L]);if(2==I.noise_shaping_amp)break}}if(Q=k(A))A=!1;else if(Q=2==z.mode_gr?ha.scale_bitcount(A):ha.scale_bitcount_lsf(z,A)){if(1<z.noise_shaping)if(na.fill(z.pseudohalf,0),0==A.scalefac_scale){Q=A;for(F=O=0;F<Q.sfbmax;F++){I=Q.width[F];C=Q.scalefac[F];0!=Q.preflag&&(C+=E.pretab[F]);O+=I;if(0!=(C&1))for(C++,I=-I;0>I;I++)H[O+I]*=1.2968395546510096,H[O+I]>Q.xrpow_max&&(Q.xrpow_max=H[O+I]);Q.scalefac[F]=C>>1}Q.preflag=0;Q.scalefac_scale=1;Q=!1}else if(A.block_type==c.SHORT_TYPE&&0<z.subblock_gain){b:{Q=z;O=A;F=H;C=O.scalefac;for(H=0;H<O.sfb_lmax;H++)if(16<=C[H]){H=!0;break b}for(I=0;3>I;I++){ma=S=0;for(H=O.sfb_lmax+I;H<O.sfbdivide;H+=3)S<C[H]&&(S=C[H]);for(;H<O.sfbmax;H+=3)ma<C[H]&&(ma=C[H]);if(!(16>S&&8>ma)){if(7<=O.subblock_gain[I]){H=!0;break b}O.subblock_gain[I]++;S=Q.scalefac_band.l[O.sfb_lmax];for(H=O.sfb_lmax+I;H<O.sfbmax;H+=3)if(ma=O.width[H],Z=C[H],Z-=4>>O.scalefac_scale,0<=Z)C[H]=Z,S+=3*ma;else{C[H]=0;Z=E.IPOW20(210+(Z<<O.scalefac_scale+1));S+=ma*(I+1);for(L=-ma;0>L;L++)F[S+L]*=Z,F[S+L]>O.xrpow_max&&(O.xrpow_max=F[S+L]);S+=ma*(3-I-1)}Z=E.IPOW20(202);S+=O.width[H]*(I+1);for(L=-O.width[H];0>L;L++)F[S+L]*=Z,F[S+L]>O.xrpow_max&&(O.xrpow_max=F[S+L])}}H=!1}Q=H||k(A)}Q||(Q=2==z.mode_gr?ha.scale_bitcount(A):ha.scale_bitcount_lsf(z,A));A=!Q}else A=!0;if(!A)break;0!=l.scalefac_scale&&(y=254);A=B-l.part2_length;if(0>=A)break;for(;(l.part2_3_length=ha.count_bits(e,a,l,v))>A&&l.global_gain<=y;)l.global_gain++;if(l.global_gain>y)break;if(0==q.over_count){for(;(l.part2_3_length=ha.count_bits(e,a,l,v))>p&&l.global_gain<=y;)l.global_gain++;if(l.global_gain>y)break}E.calc_noise(l,n,g,h,v);h.bits=l.part2_3_length;z=b.block_type!=c.SHORT_TYPE?f.quant_comp:f.quant_comp_short;y=q;A=h;Q=l;H=g;switch(z){default:case 9:0<y.over_count?(z=A.over_SSD<=y.over_SSD,A.over_SSD==y.over_SSD&&(z=A.bits<y.bits)):z=0>A.max_noise&&10*A.max_noise+A.bits<=10*y.max_noise+y.bits;break;case 0:z=A.over_count<y.over_count||A.over_count==y.over_count&&A.over_noise<y.over_noise||A.over_count==y.over_count&&qa.EQ(A.over_noise,y.over_noise)&&A.tot_noise<y.tot_noise;break;case 8:z=A;F=1E-37;for(O=0;O<Q.psymax;O++)C=H[O],C=aa.FAST_LOG10(.368+.632*C*C*C),F+=C;z.max_noise=Math.max(1E-20,F);case 1:z=A.max_noise<y.max_noise;break;case 2:z=A.tot_noise<y.tot_noise;break;case 3:z=A.tot_noise<y.tot_noise&&A.max_noise<y.max_noise;break;case 4:z=0>=A.max_noise&&.2<y.max_noise||0>=A.max_noise&&0>y.max_noise&&y.max_noise>A.max_noise-.2&&A.tot_noise<y.tot_noise||0>=A.max_noise&&0<y.max_noise&&y.max_noise>A.max_noise-.2&&A.tot_noise<y.tot_noise+y.over_noise||0<A.max_noise&&-.05<y.max_noise&&y.max_noise>A.max_noise-.1&&A.tot_noise+A.over_noise<y.tot_noise+y.over_noise||0<A.max_noise&&-.1<y.max_noise&&y.max_noise>A.max_noise-.15&&A.tot_noise+A.over_noise+A.over_noise<y.tot_noise+y.over_noise+
y.over_noise;break;case 5:z=A.over_noise<y.over_noise||qa.EQ(A.over_noise,y.over_noise)&&A.tot_noise<y.tot_noise;break;case 6:z=A.over_noise<y.over_noise||qa.EQ(A.over_noise,y.over_noise)&&(A.max_noise<y.max_noise||qa.EQ(A.max_noise,y.max_noise)&&A.tot_noise<=y.tot_noise);break;case 7:z=A.over_count<y.over_count||A.over_noise<y.over_noise}0==y.over_count&&(z=z&&A.bits<y.bits);z=z?1:0;if(0!=z)p=b.part2_3_length,q=h,b.assign(l),m=0,T.arraycopy(a,0,d,0,576);else if(0==e.full_outer_loop){if(++m>x&&0==q.over_count)break;if(3==e.noise_shaping_amp&&t&&30<m)break;if(3==e.noise_shaping_amp&&t&&15<l.global_gain-w)break}}while(255>l.global_gain+l.scalefac_scale);3==e.noise_shaping_amp?t?r=!0:(l.assign(b),T.arraycopy(d,0,a,0,576),m=0,w=l.global_gain,t=!0):r=!0}f.VBR==G.vbr_rh||f.VBR==G.vbr_mtrh?T.arraycopy(d,0,a,0,576):0!=(e.substep_shaping&1)&&trancate_smallspectrums(e,b,n,a);return q.over_count};this.iteration_finish_one=function(c,b,k){var a=c.l3_side,f=a.tt[b][k];ha.best_scalefac_store(c,b,k,a);1==c.use_best_huffman&&ha.best_huffman_divide(c,f);w.ResvAdjust(c,f)};this.VBR_encode_granule=function(c,b,k,a,m,n,e){var f=c.internal_flags,d=new rb,g=K(576),q=e,v=(e+n)/2,p=0,r=f.sfb21_extra;na.fill(d.l3_enc,0);do{f.sfb21_extra=v>q-42?!1:r;var t=outer_loop(c,b,k,a,m,v);0>=t?(p=1,e=b.part2_3_length,d.assign(b),T.arraycopy(a,0,g,0,576),e-=32,t=e-n,v=(e+n)/2):(n=v+32,t=e-n,v=(e+n)/2,0!=p&&(p=2,b.assign(d),T.arraycopy(g,0,a,0,576)))}while(12<t);f.sfb21_extra=r;2==p&&T.arraycopy(d.l3_enc,0,b.l3_enc,0,576)};this.get_framebits=function(c,b){var f=c.internal_flags;f.bitrate_index=f.VBR_min_bitrate;n.getframebits(c);f.bitrate_index=1;var a=n.getframebits(c);for(var m=1;m<=f.VBR_max_bitrate;m++)f.bitrate_index=m,a=new xa(a),b[m]=w.ResvFrameBegin(c,a),a=a.bits};this.VBR_old_prepare=function(f,b,k,a,m,n,e,l,d){var g=f.internal_flags,q=1,v=0;g.bitrate_index=g.VBR_max_bitrate;var p=w.ResvFrameBegin(f,new xa(0))/g.mode_gr;get_framebits(f,n);for(var r=0;r<g.mode_gr;r++){var t=E.on_pe(f,b,l[r],p,r,0);g.mode_ext==c.MPG_MD_MS_LR&&(ms_convert(g.l3_side,r),E.reduce_side(l[r],k[r],p,t));for(t=0;t<g.channels_out;++t){var u=g.l3_side.tt[r][t];if(u.block_type!=c.SHORT_TYPE){var h=1.28/(1+Math.exp(3.5-b[r][t]/300))-.05;h=g.PSY.mask_adjust-h}else h=2.56/(1+Math.exp(3.5-b[r][t]/300))-.14,h=g.PSY.mask_adjust_short-h;g.masking_lower=Math.pow(10,.1*h);init_outer_loop(g,u);d[r][t]=E.calc_xmin(f,a[r][t],u,m[r][t]);0!=d[r][t]&&(q=0);e[r][t]=126;v+=l[r][t]}}for(r=0;r<g.mode_gr;r++)for(t=0;t<g.channels_out;t++)v>n[g.VBR_max_bitrate]&&(l[r][t]*=n[g.VBR_max_bitrate],l[r][t]/=v),e[r][t]>l[r][t]&&(e[r][t]=l[r][t]);return q};this.bitpressure_strategy=function(f,b,k,a){for(var m=0;m<f.mode_gr;m++)for(var n=0;n<f.channels_out;n++){for(var e=f.l3_side.tt[m][n],l=b[m][n],d=0,g=0;g<e.psy_lmax;g++)l[d++]*=1+.029*g*g/c.SBMAX_l/c.SBMAX_l;if(e.block_type==c.SHORT_TYPE)for(g=e.sfb_smin;g<c.SBMAX_s;g++)l[d++]*=1+.029*g*g/c.SBMAX_s/c.SBMAX_s,l[d++]*=1+.029*g*g/c.SBMAX_s/c.SBMAX_s,l[d++]*=1+.029*g*g/c.SBMAX_s/c.SBMAX_s;a[m][n]=0|Math.max(k[m][n],.9*a[m][n])}};this.VBR_new_prepare=function(f,b,k,a,m,n){var e=f.internal_flags,l=1,d=0,g=0;if(f.free_format){e.bitrate_index=0;d=new xa(d);var q=w.ResvFrameBegin(f,d);d=d.bits;m[0]=q}else e.bitrate_index=e.VBR_max_bitrate,d=new xa(d),w.ResvFrameBegin(f,d),d=d.bits,get_framebits(f,m),q=m[e.VBR_max_bitrate];for(m=0;m<e.mode_gr;m++){E.on_pe(f,b,n[m],d,m,0);e.mode_ext==c.MPG_MD_MS_LR&&ms_convert(e.l3_side,m);for(var v=0;v<e.channels_out;++v){var p=e.l3_side.tt[m][v];e.masking_lower=Math.pow(10,.1*e.PSY.mask_adjust);init_outer_loop(e,p);0!=E.calc_xmin(f,k[m][v],p,a[m][v])&&(l=0);g+=n[m][v]}}for(m=0;m<e.mode_gr;m++)for(v=0;v<e.channels_out;v++)g>q&&(n[m][v]*=q,n[m][v]/=g);return l};this.calc_target_bits=function(f,b,k,a,m,u){var e=f.internal_flags,l=e.l3_side;e.bitrate_index=e.VBR_max_bitrate;var d=new xa(0);u[0]=w.ResvFrameBegin(f,d);e.bitrate_index=1;d=n.getframebits(f)-8*e.sideinfo_len;m[0]=d/(e.mode_gr*e.channels_out);d=f.VBR_mean_bitrate_kbps*f.framesize*1E3;0!=(e.substep_shaping&1)&&(d*=1.09);d/=f.out_samplerate;d-=8*e.sideinfo_len;d/=e.mode_gr*e.channels_out;var g=.93+.07*(11-f.compression_ratio)/5.5;.9>g&&(g=.9);1<g&&(g=1);for(f=0;f<e.mode_gr;f++){var q=0;for(m=0;m<e.channels_out;m++){a[f][m]=int(g*d);if(700<b[f][m]){var v=int((b[f][m]-700)/1.4),p=l.tt[f][m];a[f][m]=int(g*d);p.block_type==c.SHORT_TYPE&&v<d/2&&(v=d/2);v>3*d/2?v=3*d/2:0>v&&(v=0);a[f][m]+=v}a[f][m]>da.MAX_BITS_PER_CHANNEL&&(a[f][m]=da.MAX_BITS_PER_CHANNEL);q+=a[f][m]}if(q>da.MAX_BITS_PER_GRANULE)for(m=0;m<e.channels_out;++m)a[f][m]*=da.MAX_BITS_PER_GRANULE,a[f][m]/=q}if(e.mode_ext==c.MPG_MD_MS_LR)for(f=0;f<e.mode_gr;f++)E.reduce_side(a[f],k[f],d*e.channels_out,da.MAX_BITS_PER_GRANULE);for(f=b=0;f<e.mode_gr;f++)for(m=0;m<e.channels_out;m++)a[f][m]>da.MAX_BITS_PER_CHANNEL&&(a[f][m]=da.MAX_BITS_PER_CHANNEL),b+=a[f][m];if(b>u[0])for(f=0;f<e.mode_gr;f++)for(m=0;m<e.channels_out;m++)a[f][m]*=u[0],a[f][m]/=b}}function Fc(){function u(b,c,a){for(var f=10,n=c+238-14-286,e=-15;0>e;e++){var l=k[f+-10];var d=b[n+-224]*l;var g=b[c+224]*l;l=k[f+-9];d+=b[n+-160]*l;g+=b[c+160]*l;l=k[f+-8];d+=b[n+-96]*l;g+=b[c+96]*l;l=k[f+-7];d+=b[n+-32]*l;g+=b[c+32]*l;l=k[f+-6];d+=b[n+32]*l;g+=b[c+-32]*l;l=k[f+-5];d+=b[n+96]*l;g+=b[c+-96]*l;l=k[f+-4];d+=b[n+160]*l;g+=b[c+-160]*l;l=k[f+-3];d+=b[n+224]*l;g+=b[c+-224]*l;l=k[f+-2];d+=b[c+-256]*l;g-=b[n+256]*l;l=k[f+-1];d+=b[c+-192]*l;g-=b[n+192]*l;l=k[f+0];d+=b[c+-128]*l;g-=b[n+128]*l;l=k[f+1];d+=b[c+-64]*l;g-=b[n+64]*l;l=k[f+2];d+=b[c+0]*l;g-=b[n+0]*l;l=k[f+3];d+=b[c+64]*l;g-=b[n+-64]*l;l=k[f+4];d+=b[c+128]*l;g-=b[n+-128]*l;l=k[f+5];d+=b[c+192]*l;g-=b[n+-192]*l;d*=k[f+6];l=g-d;a[30+2*e]=g+d;a[31+2*e]=k[f+7]*l;f+=18;c--;n++}g=b[c+-16]*k[f+-10];d=b[c+-32]*k[f+-2];g+=(b[c+-48]-b[c+16])*k[f+-9];d+=b[c+-96]*k[f+-1];g+=(b[c+-80]+b[c+48])*k[f+-8];d+=b[c+-160]*k[f+0];g+=(b[c+-112]-b[c+80])*k[f+-7];d+=b[c+-224]*k[f+1];g+=(b[c+-144]+b[c+112])*k[f+-6];d-=b[c+32]*k[f+2];g+=(b[c+-176]-b[c+144])*k[f+-5];d-=b[c+96]*k[f+3];g+=(b[c+-208]+b[c+176])*k[f+-4];d-=b[c+160]*k[f+4];g+=(b[c+-240]-b[c+208])*k[f+-3];d-=b[c+224];b=d-g;c=d+g;g=a[14];d=a[15]-g;a[31]=c+g;a[30]=b+d;a[15]=b-d;a[14]=c-g;d=a[28]-a[0];a[0]+=a[28];a[28]=d*k[f+-36+7];d=a[29]-a[1];a[1]+=a[29];a[29]=d*k[f+-36+7];d=a[26]-a[2];a[2]+=a[26];a[26]=d*k[f+-72+7];d=a[27]-a[3];a[3]+=a[27];a[27]=d*k[f+-72+7];d=a[24]-a[4];a[4]+=a[24];a[24]=d*k[f+-108+7];d=a[25]-a[5];a[5]+=a[25];a[25]=d*k[f+-108+7];d=a[22]-a[6];a[6]+=a[22];a[22]=d*aa.SQRT2;d=a[23]-a[7];a[7]+=a[23];a[23]=d*aa.SQRT2-a[7];a[7]-=a[6];a[22]-=a[7];a[23]-=a[22];d=a[6];a[6]=a[31]-d;a[31]+=d;d=a[7];a[7]=a[30]-d;a[30]+=d;d=a[22];a[22]=a[15]-d;a[15]+=d;d=a[23];a[23]=a[14]-d;a[14]+=d;d=a[20]-a[8];a[8]+=a[20];a[20]=d*k[f+-180+7];d=a[21]-a[9];a[9]+=a[21];a[21]=d*k[f+-180+7];d=a[18]-a[10];a[10]+=a[18];a[18]=d*k[f+-216+7];d=a[19]-a[11];a[11]+=a[19];a[19]=d*k[f+-216+7];d=a[16]-a[12];a[12]+=a[16];a[16]=d*k[f+-252+7];d=a[17]-a[13];a[13]+=a[17];a[17]=d*k[f+-252+7];d=-a[20]+a[24];a[20]+=a[24];a[24]=d*k[f+-216+7];d=-a[21]+a[25];a[21]+=a[25];a[25]=d*k[f+-216+7];d=a[4]-a[8];a[4]+=a[8];a[8]=d*k[f+-216+7];d=a[5]-a[9];a[5]+=a[9];a[9]=d*k[f+-216+7];d=a[0]-a[12];a[0]+=a[12];a[12]=d*k[f+-72+7];d=a[1]-a[13];a[1]+=a[13];a[13]=d*k[f+-72+7];d=a[16]-a[28];a[16]+=a[28];a[28]=d*k[f+-72+7];d=-a[17]+a[29];a[17]+=a[29];a[29]=d*k[f+-72+7];d=aa.SQRT2*(a[2]-a[10]);a[2]+=a[10];a[10]=d;d=aa.SQRT2*(a[3]-a[11]);a[3]+=a[11];a[11]=d;d=aa.SQRT2*(-a[18]+a[26]);a[18]+=a[26];a[26]=d-a[18];d=aa.SQRT2*(-a[19]+a[27]);a[19]+=a[27];a[27]=d-a[19];d=a[2];a[19]-=a[3];a[3]-=d;a[2]=a[31]-d;a[31]+=d;d=a[3];a[11]-=a[19];a[18]-=d;a[3]=a[30]-d;a[30]+=d;d=a[18];a[27]-=a[11];a[19]-=d;a[18]=a[15]-d;a[15]+=d;d=a[19];a[10]-=d;a[19]=a[14]-d;a[14]+=d;d=a[10];a[11]-=d;a[10]=a[23]-d;a[23]+=d;d=a[11];a[26]-=d;a[11]=a[22]-d;a[22]+=d;d=a[26];a[27]-=d;a[26]=a[7]-d;a[7]+=d;d=a[27];a[27]=a[6]-d;a[6]+=d;d=aa.SQRT2*(a[0]-a[4]);a[0]+=a[4];a[4]=d;d=aa.SQRT2*(a[1]-a[5]);a[1]+=a[5];a[5]=d;d=aa.SQRT2*(a[16]-a[20]);a[16]+=a[20];a[20]=d;d=aa.SQRT2*(a[17]-a[21]);a[17]+=a[21];a[21]=d;d=-aa.SQRT2*(a[8]-a[12]);a[8]+=a[12];a[12]=d-a[8];d=-aa.SQRT2*(a[9]-a[13]);a[9]+=a[13];a[13]=d-a[9];d=-aa.SQRT2*(a[25]-a[29]);a[25]+=a[29];a[29]=d-a[25];d=-aa.SQRT2*(a[24]+a[28]);a[24]-=a[28];a[28]=d-a[24];d=a[24]-a[16];a[24]=d;d=a[20]-d;a[20]=d;d=a[28]-d;a[28]=d;d=a[25]-a[17];a[25]=d;d=a[21]-d;a[21]=d;d=a[29]-d;a[29]=d;d=a[17]-a[1];a[17]=d;d=a[9]-d;a[9]=d;d=a[25]-d;a[25]=d;d=a[5]-d;a[5]=d;d=a[21]-d;a[21]=d;d=a[13]-d;a[13]=d;d=a[29]-d;a[29]=d;d=a[1]-a[0];a[1]=d;d=a[16]-d;a[16]=d;d=a[17]-d;a[17]=d;d=a[8]-d;a[8]=d;d=a[9]-d;a[9]=d;d=a[24]-d;a[24]=d;d=a[25]-d;a[25]=d;d=a[4]-d;a[4]=d;d=a[5]-d;a[5]=d;d=a[20]-d;a[20]=d;d=a[21]-d;a[21]=d;d=a[12]-d;a[12]=d;d=a[13]-d;a[13]=d;d=a[28]-d;a[28]=d;d=a[29]-d;a[29]=d;d=a[0];a[0]+=a[31];a[31]-=d;d=a[1];a[1]+=a[30];a[30]-=d;d=a[16];a[16]+=a[15];a[15]-=d;d=a[17];a[17]+=a[14];a[14]-=d;d=a[8];a[8]+=a[23];a[23]-=d;d=a[9];a[9]+=a[22];a[22]-=d;d=a[24];a[24]+=a[7];a[7]-=d;d=a[25];a[25]+=a[6];a[6]-=d;d=a[4];a[4]+=a[27];a[27]-=d;d=a[5];a[5]+=a[26];a[26]-=d;d=a[20];a[20]+=a[11];a[11]-=d;d=a[21];a[21]+=a[10];a[10]-=d;d=a[12];a[12]+=a[19];a[19]-=d;d=a[13];a[13]+=a[18];a[18]-=d;d=a[28];a[28]+=a[3];a[3]-=d;d=a[29];a[29]+=a[2];a[2]-=d}var k=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.0178904535*aa.SQRT2/2.384E-6,.008938074*aa.SQRT2/2.384E-6,.0015673635*aa.SQRT2/2.384E-6,.001228571*aa.SQRT2/2.384E-6,4.856585E-4*aa.SQRT2/2.384E-6,1.09434E-4*aa.SQRT2/2.384E-6,5.0783E-5*aa.SQRT2/2.384E-6,6.914E-6*aa.SQRT2/2.384E-6,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],n=[[2.382191739347913E-13,6.423305872147834E-13,9.400849094049688E-13,1.122435026096556E-12,1.183840321267481E-12,1.122435026096556E-12,9.40084909404969E-13,6.423305872147839E-13,2.382191739347918E-13,5.456116108943412E-12,4.878985199565852E-12,4.240448995017367E-12,3.559909094758252E-12,2.858043359288075E-12,2.156177623817898E-12,1.475637723558783E-12,8.371015190102974E-13,2.599706096327376E-13,-5.456116108943412E-12,-4.878985199565852E-12,-4.240448995017367E-12,-3.559909094758252E-12,-2.858043359288076E-12,-2.156177623817898E-12,-1.475637723558783E-12,-8.371015190102975E-13,-2.599706096327376E-13,-2.382191739347923E-13,-6.423305872147843E-13,-9.400849094049696E-13,-1.122435026096556E-12,-1.183840321267481E-12,-1.122435026096556E-12,-9.400849094049694E-13,-6.42330587214784E-13,-2.382191739347918E-13],[2.382191739347913E-13,6.423305872147834E-13,9.400849094049688E-13,1.122435026096556E-12,1.183840321267481E-12,1.122435026096556E-12,9.400849094049688E-13,6.423305872147841E-13,2.382191739347918E-13,5.456116108943413E-12,4.878985199565852E-12,4.240448995017367E-12,3.559909094758253E-12,2.858043359288075E-12,2.156177623817898E-12,1.475637723558782E-12,8.371015190102975E-13,2.599706096327376E-13,-5.461314069809755E-12,-4.921085770524055E-12,-4.343405037091838E-12,-3.732668368707687E-12,-3.093523840190885E-12,-2.430835727329465E-12,-1.734679010007751E-12,-9.74825365660928E-13,-2.797435120168326E-13,0,0,0,0,0,0,-2.283748241799531E-13,-4.037858874020686E-13,-2.146547464825323E-13],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2.283748241799531E-13,4.037858874020686E-13,2.146547464825323E-13,5.461314069809755E-12,4.921085770524055E-12,4.343405037091838E-12,3.732668368707687E-12,3.093523840190885E-12,2.430835727329466E-12,1.734679010007751E-12,9.74825365660928E-13,2.797435120168326E-13,-5.456116108943413E-12,-4.878985199565852E-12,-4.240448995017367E-12,-3.559909094758253E-12,-2.858043359288075E-12,-2.156177623817898E-12,-1.475637723558782E-12,-8.371015190102975E-13,-2.599706096327376E-13,-2.382191739347913E-13,-6.423305872147834E-13,-9.400849094049688E-13,-1.122435026096556E-12,-1.183840321267481E-12,-1.122435026096556E-12,-9.400849094049688E-13,-6.423305872147841E-13,-2.382191739347918E-13]],w=n[c.SHORT_TYPE],E=n[c.SHORT_TYPE],B=n[c.SHORT_TYPE],G=n[c.SHORT_TYPE],f=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];this.mdct_sub48=function(b,k,a){for(var m=286,v=0;v<b.channels_out;v++){for(var e=0;e<b.mode_gr;e++){for(var l,d=b.l3_side.tt[e][v],g=d.xr,q=0,D=b.sb_sample[v][1-e],p=0,r=0;9>r;r++)for(u(k,m,D[p]),u(k,m+32,D[p+1]),p+=2,m+=64,l=1;32>l;l+=2)D[p-1][l]*=-1;for(l=0;32>l;l++,q+=18){D=d.block_type;p=b.sb_sample[v][e];var t=b.sb_sample[v][1-e];0!=d.mixed_block_flag&&2>l&&(D=0);if(1E-12>b.amp_filter[l])na.fill(g,q+0,q+18,0);else{if(1>b.amp_filter[l])for(r=0;18>r;r++)t[r][f[l]]*=b.amp_filter[l];if(D==c.SHORT_TYPE){for(r=-3;0>r;r++){var J=n[c.SHORT_TYPE][r+3];g[q+3*r+9]=p[9+r][f[l]]*J-p[8-r][f[l]];g[q+3*r+18]=p[14-r][f[l]]*J+p[15+r][f[l]];g[q+3*r+10]=p[15+r][f[l]]*J-p[14-r][f[l]];g[q+3*r+19]=t[2-r][f[l]]*J+t[3+r][f[l]];g[q+3*r+11]=t[3+r][f[l]]*J-t[2-r][f[l]];g[q+3*r+20]=t[8-r][f[l]]*J+t[9+r][f[l]]}r=g;p=q;for(J=0;3>J;J++){var h=r[p+6]*n[c.SHORT_TYPE][0]-r[p+15];t=r[p+0]*n[c.SHORT_TYPE][2]-r[p+9];var x=h+t;var y=h-t;h=r[p+15]*n[c.SHORT_TYPE][0]+r[p+6];t=r[p+9]*n[c.SHORT_TYPE][2]+r[p+0];var A=h+t;var N=-h+t;t=2.069978111953089E-11*(r[p+3]*n[c.SHORT_TYPE][1]-r[p+12]);h=2.069978111953089E-11*(r[p+12]*n[c.SHORT_TYPE][1]+r[p+3]);r[p+0]=1.90752519173728E-11*x+t;r[p+15]=1.90752519173728E-11*-A+h;y*=1.6519652744032674E-11;A=9.537625958686404E-12*A+h;r[p+3]=y-A;r[p+6]=y+A;x=9.537625958686404E-12*x-t;N*=1.6519652744032674E-11;r[p+9]=x+N;r[p+12]=x-N;p++}}else{J=K(18);for(r=-9;0>r;r++)x=n[D][r+27]*t[r+9][f[l]]+n[D][r+36]*t[8-r][f[l]],y=n[D][r+9]*p[r+9][f[l]]-n[D][r+18]*p[8-r][f[l]],J[r+9]=x-y*w[3+r+9],J[r+18]=x*w[3+r+9]+y;r=g;p=q;x=J;var H=x[17]-x[9];var O=x[15]-x[11];var F=x[14]-x[12];N=x[0]+x[8];A=x[1]+x[7];h=x[2]+x[6];y=x[3]+x[5];r[p+17]=N+h-y-(A-x[4]);J=(N+h-y)*E[19]+(A-x[4]);t=(H-O-F)*E[18];r[p+5]=t+J;r[p+6]=t-J;var C=(x[16]-x[10])*E[18];A=A*E[19]+x[4];t=H*E[12]+C+O*E[13]+F*E[14];J=-N*E[16]+A-h*E[17]+y*E[15];r[p+1]=t+J;r[p+2]=t-J;t=H*E[13]-C-O*E[14]+F*E[12];J=-N*E[17]+A-h*E[15]+y*E[16];r[p+9]=t+J;r[p+10]=t-J;t=H*E[14]-C+O*E[12]-F*E[13];J=N*E[15]-A+h*E[16]-y*E[17];r[p+13]=t+J;r[p+14]=t-J;H=x[8]-x[0];O=x[6]-x[2];F=x[5]-x[3];N=x[17]+x[9];A=x[16]+x[10];h=x[15]+x[11];y=x[14]+x[12];r[p+0]=N+h+y+(A+x[13]);t=(N+h+y)*E[19]-(A+x[13]);J=(H-O+F)*E[18];r[p+11]=t+J;r[p+12]=t-J;C=(x[7]-x[1])*E[18];A=x[13]-A*E[19];t=N*E[15]-
A+h*E[16]+y*E[17];J=H*E[14]+C+O*E[12]+F*E[13];r[p+3]=t+J;r[p+4]=t-J;t=-N*E[17]+A-h*E[15]-y*E[16];J=H*E[13]+C-O*E[14]-F*E[12];r[p+7]=t+J;r[p+8]=t-J;t=-N*E[16]+A-h*E[17]-y*E[15];J=H*E[12]-C+O*E[13]-F*E[14];r[p+15]=t+J;r[p+16]=t-J}}if(D!=c.SHORT_TYPE&&0!=l)for(r=7;0<=r;--r)D=g[q+r]*B[20+r]+g[q+-1-r]*G[28+r],p=g[q+r]*G[28+r]-g[q+-1-r]*B[20+r],g[q+-1-r]=D,g[q+r]=p}}k=a;m=286;if(1==b.mode_gr)for(e=0;18>e;e++)T.arraycopy(b.sb_sample[v][1][e],0,b.sb_sample[v][0][e],0,32)}}}function Xa(){this.thm=new Xb;this.en=new Xb}function c(){var u=c.FFTOFFSET,k=c.MPG_MD_MS_LR,n=null,w=this.psy=null,E=null,B=null;this.setModules=function(c,b,k,a){n=c;w=this.psy=b;E=a;B=k};var ha=new Fc;this.lame_encode_mp3_frame=function(f,b,v,a,m,z){var e=Ob([2,2]);e[0][0]=new Xa;e[0][1]=new Xa;e[1][0]=new Xa;e[1][1]=new Xa;var l=Ob([2,2]);l[0][0]=new Xa;l[0][1]=new Xa;l[1][0]=new Xa;l[1][1]=new Xa;var d=[null,null],g=f.internal_flags,q=ca([2,4]),D=[.5,.5],p=[[0,0],[0,0]],r=[[0,0],[0,0]];d[0]=b;d[1]=v;if(0==g.lame_encode_frame_init){b=f.internal_flags;var t,J;if(0==b.lame_encode_frame_init){v=K(2014);var h=K(2014);b.lame_encode_frame_init=1;for(J=t=0;t<286+576*(1+b.mode_gr);++t)t<576*b.mode_gr?(v[t]=0,2==b.channels_out&&(h[t]=0)):(v[t]=d[0][J],2==b.channels_out&&(h[t]=d[1][J]),++J);for(J=0;J<b.mode_gr;J++)for(t=0;t<b.channels_out;t++)b.l3_side.tt[J][t].block_type=c.SHORT_TYPE;ha.mdct_sub48(b,v,h)}}g.padding=0;0>(g.slot_lag-=g.frac_SpF)&&(g.slot_lag+=f.out_samplerate,g.padding=1);if(0!=g.psymodel)for(h=[null,null],t=0,J=X(2),v=0;v<g.mode_gr;v++){for(b=0;b<g.channels_out;b++)h[b]=d[b],t=576+576*v-c.FFTOFFSET;b=f.VBR==G.vbr_mtrh||f.VBR==G.vbr_mt?w.L3psycho_anal_vbr(f,h,t,v,e,l,p[v],r[v],q[v],J):w.L3psycho_anal_ns(f,h,t,v,e,l,p[v],r[v],q[v],J);if(0!=b)return-4;f.mode==la.JOINT_STEREO&&(D[v]=q[v][2]+q[v][3],0<D[v]&&(D[v]=q[v][3]/D[v]));for(b=0;b<g.channels_out;b++){var x=g.l3_side.tt[v][b];x.block_type=J[b];x.mixed_block_flag=0}}else for(v=0;v<g.mode_gr;v++)for(b=0;b<g.channels_out;b++)g.l3_side.tt[v][b].block_type=c.NORM_TYPE,g.l3_side.tt[v][b].mixed_block_flag=0,r[v][b]=p[v][b]=700;0==g.ATH.useAdjust?g.ATH.adjust=1:(b=g.loudness_sq[0][0],q=g.loudness_sq[1][0],2==g.channels_out?(b+=g.loudness_sq[0][1],q+=g.loudness_sq[1][1]):(b+=b,q+=q),2==g.mode_gr&&(b=Math.max(b,q)),b=.5*b*g.ATH.aaSensitivityP,.03125<b?(1<=g.ATH.adjust?g.ATH.adjust=1:g.ATH.adjust<g.ATH.adjustLimit&&(g.ATH.adjust=g.ATH.adjustLimit),g.ATH.adjustLimit=1):(q=31.98*b+6.25E-4,g.ATH.adjust>=q?(g.ATH.adjust*=.075*q+.925,g.ATH.adjust<q&&(g.ATH.adjust=q)):g.ATH.adjustLimit>=q?g.ATH.adjust=q:g.ATH.adjust<g.ATH.adjustLimit&&(g.ATH.adjust=g.ATH.adjustLimit),g.ATH.adjustLimit=q));ha.mdct_sub48(g,d[0],d[1]);g.mode_ext=c.MPG_MD_LR_LR;if(f.force_ms)g.mode_ext=c.MPG_MD_MS_LR;else if(f.mode==la.JOINT_STEREO){for(v=h=q=0;v<g.mode_gr;v++)for(b=0;b<g.channels_out;b++)q+=r[v][b],h+=p[v][b];q<=1*h&&(q=g.l3_side.tt[0],b=g.l3_side.tt[g.mode_gr-1],q[0].block_type==q[1].block_type&&b[0].block_type==b[1].block_type&&(g.mode_ext=c.MPG_MD_MS_LR))}g.mode_ext==k&&(e=l,p=r);if(f.analysis&&null!=g.pinfo)for(v=0;v<g.mode_gr;v++)for(b=0;b<g.channels_out;b++)g.pinfo.ms_ratio[v]=g.ms_ratio[v],g.pinfo.ms_ener_ratio[v]=D[v],g.pinfo.blocktype[v][b]=g.l3_side.tt[v][b].block_type,g.pinfo.pe[v][b]=p[v][b],T.arraycopy(g.l3_side.tt[v][b].xr,0,g.pinfo.xr[v][b],0,576),g.mode_ext==k&&(g.pinfo.ers[v][b]=g.pinfo.ers[v][b+2],T.arraycopy(g.pinfo.energy[v][b+2],0,g.pinfo.energy[v][b],0,g.pinfo.energy[v][b].length));if(f.VBR==G.vbr_off||f.VBR==G.vbr_abr){for(l=0;18>l;l++)g.nsPsy.pefirbuf[l]=g.nsPsy.pefirbuf[l+
1];for(v=r=0;v<g.mode_gr;v++)for(b=0;b<g.channels_out;b++)r+=p[v][b];g.nsPsy.pefirbuf[18]=r;r=g.nsPsy.pefirbuf[9];for(l=0;9>l;l++)r+=(g.nsPsy.pefirbuf[l]+g.nsPsy.pefirbuf[18-l])*c.fircoef[l];r=3350*g.mode_gr*g.channels_out/r;for(v=0;v<g.mode_gr;v++)for(b=0;b<g.channels_out;b++)p[v][b]*=r}g.iteration_loop.iteration_loop(f,p,D,e);n.format_bitstream(f);a=n.copy_buffer(g,a,m,z,1);f.bWriteVbrTag&&E.addVbrFrame(f);if(f.analysis&&null!=g.pinfo){for(b=0;b<g.channels_out;b++){for(m=0;m<u;m++)g.pinfo.pcmdata[b][m]=g.pinfo.pcmdata[b][m+f.framesize];for(m=u;1600>m;m++)g.pinfo.pcmdata[b][m]=d[b][m-u]}B.set_frame_pinfo(f,e)}g.bitrate_stereoMode_Hist[g.bitrate_index][4]++;g.bitrate_stereoMode_Hist[15][4]++;2==g.channels_out&&(g.bitrate_stereoMode_Hist[g.bitrate_index][g.mode_ext]++,g.bitrate_stereoMode_Hist[15][g.mode_ext]++);for(f=0;f<g.mode_gr;++f)for(d=0;d<g.channels_out;++d)m=g.l3_side.tt[f][d].block_type|0,0!=g.l3_side.tt[f][d].mixed_block_flag&&(m=4),g.bitrate_blockType_Hist[g.bitrate_index][m]++,g.bitrate_blockType_Hist[g.bitrate_index][5]++,g.bitrate_blockType_Hist[15][m]++,g.bitrate_blockType_Hist[15][5]++;return a}}function Gc(){this.size=this.pos=this.want=this.seen=this.sum=0;this.bag=null;this.TotalFrameSize=this.nBytesWritten=this.nVbrNumFrames=0}function Hc(){this.tt=[[null,null],[null,null]];this.resvDrain_post=this.resvDrain_pre=this.private_bits=this.main_data_begin=0;this.scfsi=[X(4),X(4)];for(var c=0;2>c;c++)for(var k=0;2>k;k++)this.tt[c][k]=new rb}function Ic(){this.last_en_subshort=ca([4,9]);this.lastAttacks=X(4);this.pefirbuf=K(19);this.longfact=K(c.SBMAX_l);this.shortfact=K(c.SBMAX_s);this.attackthre_s=this.attackthre=0}function Xb(){this.l=K(c.SBMAX_l);this.s=ca([c.SBMAX_s,3]);var u=this;this.assign=function(k){T.arraycopy(k.l,0,u.l,0,c.SBMAX_l);for(var n=0;n<c.SBMAX_s;n++)for(var w=0;3>w;w++)u.s[n][w]=k.s[n][w]}}function da(){function u(){this.ptr=this.write_timing=0;this.buf=new Int8Array(40)}this.fill_buffer_resample_init=this.iteration_init_init=this.lame_encode_frame_init=this.Class_ID=0;this.mfbuf=ca([2,da.MFSIZE]);this.full_outer_loop=this.use_best_huffman=this.subblock_gain=this.noise_shaping_stop=this.psymodel=this.substep_shaping=this.noise_shaping_amp=this.noise_shaping=this.highpass2=this.highpass1=this.lowpass2=this.lowpass1=this.mode_ext=this.samplerate_index=this.bitrate_index=this.VBR_max_bitrate=this.VBR_min_bitrate=this.mf_size=this.mf_samples_to_encode=this.resample_ratio=this.channels_out=this.channels_in=this.mode_gr=0;this.l3_side=new Hc;this.ms_ratio=K(2);this.slot_lag=this.frac_SpF=this.padding=0;this.tag_spec=null;this.nMusicCRC=0;this.OldValue=X(2);this.CurrentStep=X(2);this.masking_lower=0;this.bv_scf=X(576);this.pseudohalf=X(sa.SFBMAX);this.sfb21_extra=!1;this.inbuf_old=Array(2);this.blackfilt=Array(2*da.BPC+1);this.itime=new Float64Array(2);this.sideinfo_len=0;this.sb_sample=ca([2,2,18,c.SBLIMIT]);this.amp_filter=K(32);this.header=Array(da.MAX_HEADER_BUF);this.ResvMax=this.ResvSize=this.ancillary_flag=this.w_ptr=this.h_ptr=0;this.scalefac_band=new za;this.minval_l=K(c.CBANDS);this.minval_s=K(c.CBANDS);this.nb_1=ca([4,c.CBANDS]);this.nb_2=ca([4,c.CBANDS]);this.nb_s1=ca([4,c.CBANDS]);this.nb_s2=ca([4,c.CBANDS]);this.s3_ll=this.s3_ss=null;this.decay=0;this.thm=Array(4);this.en=Array(4);this.tot_ener=K(4);this.loudness_sq=ca([2,2]);this.loudness_sq_save=K(2);this.mld_l=K(c.SBMAX_l);this.mld_s=K(c.SBMAX_s);this.bm_l=X(c.SBMAX_l);this.bo_l=X(c.SBMAX_l);this.bm_s=X(c.SBMAX_s);this.bo_s=X(c.SBMAX_s);this.npart_s=this.npart_l=0;this.s3ind=Ia([c.CBANDS,2]);this.s3ind_s=Ia([c.CBANDS,2]);this.numlines_s=X(c.CBANDS);this.numlines_l=X(c.CBANDS);this.rnumlines_l=K(c.CBANDS);this.mld_cb_l=K(c.CBANDS);this.mld_cb_s=K(c.CBANDS);this.numlines_l_num1=this.numlines_s_num1=0;this.pe=K(4);this.ms_ener_ratio_old=this.ms_ratio_l_old=this.ms_ratio_s_old=0;this.blocktype_old=X(2);this.nsPsy=new Ic;this.VBR_seek_table=new Gc;this.PSY=this.ATH=null;this.nogap_current=this.nogap_total=0;this.findPeakSample=this.findReplayGain=this.decode_on_the_fly=!0;this.AudiophileGain=this.RadioGain=this.PeakSample=0;this.rgdata=null;this.noclipScale=this.noclipGainChange=0;this.bitrate_stereoMode_Hist=Ia([16,5]);this.bitrate_blockType_Hist=Ia([16,6]);this.hip=this.pinfo=null;this.in_buffer_nsamples=0;this.iteration_loop=this.in_buffer_1=this.in_buffer_0=null;for(var k=0;k<this.en.length;k++)this.en[k]=new Xb;for(k=0;k<this.thm.length;k++)this.thm[k]=new Xb;for(k=0;k<this.header.length;k++)this.header[k]=new u}function Jc(){function u(c,k,f){var b=0;f<<=1;var n=k+f;var a=4;do{var m;var u=a>>1;var e=a;var l=a<<1;var d=l+e;a=l<<1;var g=k;var q=g+u;do{var B=c[g+0]-c[g+e];var p=c[g+0]+c[g+e];var r=c[g+l]-c[g+d];var t=c[g+l]+c[g+d];c[g+l]=p-t;c[g+0]=p+t;c[g+d]=B-r;c[g+e]=B+r;B=c[q+0]-c[q+e];p=c[q+0]+c[q+e];r=aa.SQRT2*c[q+d];t=aa.SQRT2*c[q+l];c[q+l]=p-t;c[q+0]=p+t;c[q+d]=B-r;c[q+e]=B+r;q+=a;g+=a}while(g<n);var E=w[b+0];var h=w[b+1];for(m=1;m<u;m++){var x=1-2*h*h;var y=2*h*E;g=k+m;q=k+e-m;do{var A=y*c[g+e]-x*c[q+e];t=x*c[g+e]+y*c[q+e];B=c[g+0]-t;p=c[g+0]+t;var K=c[q+0]-A;var H=c[q+0]+A;A=y*c[g+d]-x*c[q+d];t=x*c[g+d]+y*c[q+
d];r=c[g+l]-t;t=c[g+l]+t;var O=c[q+l]-A;var F=c[q+l]+A;A=h*t-E*O;t=E*t+h*O;c[g+l]=p-t;c[g+0]=p+t;c[q+d]=K-A;c[q+e]=K+A;A=E*F-h*r;t=h*F+E*r;c[q+l]=H-t;c[q+0]=H+t;c[g+d]=B-A;c[g+e]=B+A;q+=a;g+=a}while(g<n);x=E;E=x*w[b+0]-h*w[b+1];h=x*w[b+1]+h*w[b+0]}b+=2}while(a<f)}var k=K(c.BLKSIZE),n=K(c.BLKSIZE_s/2),w=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475],E=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(k,w,f,b,v){for(k=0;3>k;k++){var a=c.BLKSIZE_s/2,m=65535&192*(k+1),B=c.BLKSIZE_s/8-1;do{var e=E[B<<2]&255;var l=n[e]*b[f][v+e+m];var d=n[127-e]*b[f][v+e+m+128];var g=l-d;l+=d;var q=n[e+64]*b[f][v+e+m+64];d=n[63-e]*b[f][v+e+m+192];var D=q-d;q+=d;a-=4;w[k][a+0]=l+q;w[k][a+2]=l-q;w[k][a+1]=g+D;w[k][a+3]=g-D;l=n[e+1]*b[f][v+e+m+1];d=n[126-e]*b[f][v+e+m+129];g=l-d;l+=d;q=n[e+65]*b[f][v+e+m+65];d=n[62-e]*b[f][v+e+m+193];D=q-d;q+=d;w[k][a+c.BLKSIZE_s/2+0]=l+q;w[k][a+c.BLKSIZE_s/2+2]=l-q;w[k][a+c.BLKSIZE_s/2+1]=g+D;w[k][a+c.BLKSIZE_s/2+3]=g-D}while(0<=--B);u(w[k],a,c.BLKSIZE_s/2)}};this.fft_long=function(n,w,f,b,v){n=c.BLKSIZE/8-1;var a=c.BLKSIZE/2;do{var m=E[n]&255;var B=k[m]*b[f][v+m];var e=k[m+512]*b[f][v+m+512];var l=B-e;B+=e;var d=k[m+256]*b[f][v+m+256];e=k[m+768]*b[f][v+m+768];var g=d-e;d+=e;a-=4;w[a+0]=B+d;w[a+2]=B-d;w[a+1]=l+g;w[a+3]=l-g;B=k[m+1]*b[f][v+m+1];e=k[m+513]*b[f][v+m+513];l=B-e;B+=e;d=k[m+257]*b[f][v+m+257];e=k[m+769]*b[f][v+m+769];g=d-e;d+=e;w[a+c.BLKSIZE/2+0]=B+d;w[a+c.BLKSIZE/2+2]=B-d;w[a+c.BLKSIZE/2+1]=l+g;w[a+c.BLKSIZE/2+3]=l-g}while(0<=--n);u(w,a,c.BLKSIZE/2)};this.init_fft=function(u){for(u=0;u<c.BLKSIZE;u++)k[u]=.42-.5*Math.cos(2*Math.PI*(u+.5)/c.BLKSIZE)+.08*Math.cos(4*Math.PI*(u+.5)/c.BLKSIZE);for(u=0;u<c.BLKSIZE_s/2;u++)n[u]=.5*(1-Math.cos(2*Math.PI*(u+.5)/c.BLKSIZE_s))}}function Pb(){function u(a,d){for(var b=0,h=0;h<c.BLKSIZE/2;++h)b+=a[h]*d.ATH.eql_w[h];return b*=D}function k(a,c,d,b,f,e){if(c>a)if(c<a*r)var g=c/a;else return a+c;else{if(a>=c*r)return a+c;g=a/c}a+=c;if(6>=b+3){if(g>=p)return a;b=0|aa.FAST_LOG10_X(g,16);return a*x[b]}b=0|aa.FAST_LOG10_X(g,16);c=0!=e?f.ATH.cb_s[d]*f.ATH.adjust:f.ATH.cb_l[d]*f.ATH.adjust;return a<t*c?a>c?(d=1,13>=b&&(d=y[b]),c=aa.FAST_LOG10_X(a/c,10/15),a*((h[b]-d)*c+d)):13<b?a:a*y[b]:a*h[b]}function n(a,c,d){0>a&&(a=0);0>c&&(c=0);if(0>=a)return c;if(0>=c)return a;var b=c>a?c/a:a/c;if(-2<=d&&2>=d){if(b>=p)return a+c;d=0|aa.FAST_LOG10_X(b,16);return(a+c)*A[d]}if(b<r)return a+c;a<c&&(a=c);return a}function w(a,d,b,h,f){var e,g,l=0,k=0;for(e=g=0;e<c.SBMAX_s;++g,++e){var m=a.bo_s[e],y=a.npart_s;for(m=m<y?m:y;g<m;)l+=d[g],k+=b[g],g++;a.en[h].s[e][f]=l;a.thm[h].s[e][f]=k;if(g>=y){++e;break}k=a.PSY.bo_s_weight[e];y=1-k;l=k*d[g];k*=b[g];a.en[h].s[e][f]+=l;a.thm[h].s[e][f]+=k;l=y*d[g];k=y*b[g]}for(;e<c.SBMAX_s;++e)a.en[h].s[e][f]=0,a.thm[h].s[e][f]=0}function E(a,d,b,h){var f,e,g=0,l=0;for(f=e=0;f<c.SBMAX_l;++e,++f){var k=a.bo_l[f],m=a.npart_l;for(k=k<m?k:m;e<k;)g+=d[e],l+=b[e],e++;a.en[h].l[f]=g;a.thm[h].l[f]=l;if(e>=m){++f;break}l=a.PSY.bo_l_weight[f];m=1-l;g=l*d[e];l*=b[e];a.en[h].l[f]+=g;a.thm[h].l[f]+=l;g=m*d[e];l=m*b[e]}for(;f<c.SBMAX_l;++f)a.en[h].l[f]=0,a.thm[h].l[f]=0}function B(a,c,d){return 1<=d?a:0>=d?c:0<c?Math.pow(a/c,d)*c:0}function W(a,d){for(var b=309.07,h=0;h<c.SBMAX_s-1;h++)for(var f=0;3>f;f++){var e=a.thm.s[h][f];if(0<e){e*=d;var g=a.en.s[h][f];g>e&&(b=g>1E10*e?b+23.02585092994046*N[h]:b+N[h]*aa.FAST_LOG10(g/e))}}return b}function f(a,d){for(var b=281.0575,h=0;h<c.SBMAX_l-1;h++){var f=a.thm.l[h];if(0<f){f*=d;var e=a.en.l[h];e>f&&(b=e>1E10*f?b+23.02585092994046*H[h]:b+H[h]*aa.FAST_LOG10(e/f))}}return b}function b(a,c,b,d,h){var f,e;for(f=e=0;f<a.npart_l;++f){var g=0,l=0,k;for(k=0;k<a.numlines_l[f];++k,++e){var m=c[e];g+=m;l<m&&(l=m)}b[f]=g;d[f]=l;h[f]=g*a.rnumlines_l[f]}}function v(a,c,b,d){var h=J.length-1,f=0,e=b[f]+b[f+1];if(0<e){var g=c[f];g<c[f+1]&&(g=c[f+1]);e=20*(2*g-e)/(e*(a.numlines_l[f]+a.numlines_l[f+1]-1));e|=0;e>h&&(e=h);d[f]=e}else d[f]=0;for(f=1;f<a.npart_l-1;f++)e=b[f-1]+b[f]+b[f+1],0<e?(g=c[f-1],g<c[f]&&(g=c[f]),g<c[f+1]&&(g=c[f+1]),e=20*(3*g-e)/(e*(a.numlines_l[f-1]+a.numlines_l[f]+a.numlines_l[f+1]-1)),e|=0,e>h&&(e=h),d[f]=e):d[f]=0;e=b[f-1]+b[f];0<e?(g=c[f-1],g<c[f]&&(g=c[f]),e=20*(2*g-e)/(e*(a.numlines_l[f-1]+a.numlines_l[f]-1)),e|=0,e>h&&(e=h),d[f]=e):d[f]=0}function a(a,c,b,d,f,h,e){var g=2*h;f=0<h?Math.pow(10,f):1;for(var l,k,m=0;m<e;++m){var y=a[2][m],p=a[3][m],q=c[0][m],n=c[1][m],x=c[2][m],r=c[3][m];q<=1.58*n&&n<=1.58*q?(l=b[m]*y,k=Math.max(x,Math.min(r,b[m]*p)),l=Math.max(r,Math.min(x,l))):(k=x,l=r);0<h&&(r=d[m]*f,q=Math.min(Math.max(q,r),Math.max(n,r)),x=Math.max(k,r),r=Math.max(l,r),n=x+r,0<n&&q*g<n&&(q=q*g/n,x*=q,r*=q),k=Math.min(x,k),l=Math.min(r,l));k>y&&(k=y);l>p&&(l=p);c[2][m]=k;c[3][m]=l}}function m(a,c){a=0<=a?27*-a:a*c;return-72>=a?0:Math.exp(.2302585093*a)}function z(a){0>a&&(a=0);a*=.001;return 13*Math.atan(.76*a)+3.5*Math.atan(a*a/56.25)}function e(a,b,d,f,h,e,g,l,k,m,y,p){var q=K(c.CBANDS+1),n=l/(15<p?1152:384),x=X(c.HBLKSIZE),r;l/=k;var u=0,C=0;for(r=0;r<c.CBANDS;r++){var t;var A=z(l*u);q[r]=l*u;for(t=u;.34>z(l*t)-
A&&t<=k/2;t++);a[r]=t-u;for(C=r+1;u<t;)x[u++]=r;if(u>k/2){u=k/2;++r;break}}q[r]=l*u;for(u=0;u<p;u++)r=m[u],A=m[u+1],r=0|Math.floor(.5+y*(r-.5)),0>r&&(r=0),t=0|Math.floor(.5+y*(A-.5)),t>k/2&&(t=k/2),d[u]=(x[r]+x[t])/2,b[u]=x[t],g[u]=(n*A-q[b[u]])/(q[b[u]+1]-q[b[u]]),0>g[u]?g[u]=0:1<g[u]&&(g[u]=1),A=z(l*m[u]*y),A=Math.min(A,15.5)/15.5,e[u]=Math.pow(10,1.25*(1-Math.cos(Math.PI*A))-2.5);for(b=u=0;b<C;b++)d=a[b],A=z(l*u),e=z(l*(u+d-1)),f[b]=.5*(A+e),A=z(l*(u-.5)),e=z(l*(u+d-.5)),h[b]=e-A,u+=d;return C}
function l(a,b,d,f,h,e){var g=ca([c.CBANDS,c.CBANDS]),l=0;if(e)for(var k=0;k<b;k++)for(e=0;e<b;e++){var y=d[k]-d[e];y=0<=y?3*y:1.5*y;if(.5<=y&&2.5>=y){var p=y-.5;p=8*(p*p-2*p)}else p=0;y+=.474;y=15.811389+7.5*y-17.5*Math.sqrt(1+y*y);-60>=y?p=0:(y=Math.exp(.2302585093*(p+y)),p=y/.6609193);y=p*f[e];g[k][e]=y*h[k]}else for(e=0;e<b;e++){p=15+Math.min(21/d[e],12);var q;var n;k=p;for(q=0;1E-20<m(q,k);--q);var x=q;for(n=0;1E-12<Math.abs(n-x);)q=(n+x)/2,0<m(q,k)?n=q:x=q;y=x;for(q=0;1E-20<m(q,k);q+=1);x=0;for(n=q;1E-12<Math.abs(n-x);)q=(n+x)/2,0<m(q,k)?x=q:n=q;x=n;var r=0;for(n=0;1E3>=n;++n)q=y+n*(x-y)/1E3,q=m(q,k),r+=q;q=1001/(r*(x-y));for(k=0;k<b;k++)y=q*m(d[k]-d[e],p)*f[e],g[k][e]=y*h[k]}for(k=0;k<b;k++){for(e=0;e<b&&!(0<g[k][e]);e++);a[k][0]=e;for(e=b-1;0<e&&!(0<g[k][e]);e--);a[k][1]=e;l+=a[k][1]-a[k][0]+1}d=K(l);for(k=f=0;k<b;k++)for(e=a[k][0];e<=a[k][1];e++)d[f++]=g[k][e];return d}function d(a){a=z(a);a=Math.min(a,15.5)/15.5;return Math.pow(10,1.25*(1-Math.cos(Math.PI*a))-2.5)}function g(a,c){-.3>a&&(a=3410);a=Math.max(.1,a/1E3);return 3.64*Math.pow(a,-.8)-6.8*Math.exp(-.6*Math.pow(a-3.4,2))+6*Math.exp(-.15*Math.pow(a-8.7,2))+.001*(.6+.04*c)*Math.pow(a,4)}var q=new Jc,D=1/217621504/(c.BLKSIZE/2),p,r,t,J=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749],h=[3.3246*3.3246,3.23837*3.23837,9.9500500969,9.0247369744,8.1854926609,7.0440875649,2.46209*2.46209,2.284*2.284,4.4892710641,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,2.4621061921,2.1508568964,1.37074*1.37074,1.31036*1.31036,1.5691069696,1.4555939904,1.16203*1.16203,1.2715945225,1.09428*1.09428,1.0659*1.0659,1.0779838276,1.0382591025,1],x=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1],y=[5.5396212496,2.29259*2.29259,4.9868695969,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,2.2499700001,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.2339655056,1.0779838276],A=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1],N=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130],H=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1],O=[-1.730326E-17,-.01703172,-1.349528E-17,.0418072,-6.73278E-17,-.0876324,-3.0835E-17,.1863476,-1.104424E-16,-.627638];this.L3psycho_anal_ns=function(a,d,h,e,g,l,m,y,p,n){var x=a.internal_flags,r=ca([2,c.BLKSIZE]),t=ca([2,3,c.BLKSIZE_s]),A=K(c.CBANDS+1),I=K(c.CBANDS+1),C=K(c.CBANDS+2),Q=X(2),S=X(2),z,D,F,H,N,Z,L,V=ca([2,576]),ma=X(c.CBANDS+2),R=X(c.CBANDS+2);na.fill(R,0);var T=x.channels_out;a.mode==la.JOINT_STEREO&&(T=4);var M=a.VBR==G.vbr_off?0==x.ResvMax?0:x.ResvSize/x.ResvMax*.5:a.VBR==G.vbr_rh||a.VBR==G.vbr_mtrh||a.VBR==G.vbr_mt?.6:1;for(z=0;z<x.channels_out;z++){var Y=d[z],ha=h+576-350-21+192;for(F=0;576>F;F++){var U;var da=Y[ha+F+10];for(H=U=0;9>H;H+=2)da+=O[H]*(Y[ha+F+H]+Y[ha+F+21-H]),U+=O[H+1]*(Y[ha+F+H+1]+Y[ha+F+21-H-1]);V[z][F]=da+U}g[e][z].en.assign(x.en[z]);g[e][z].thm.assign(x.thm[z]);2<T&&(l[e][z].en.assign(x.en[z+2]),l[e][z].thm.assign(x.thm[z+2]))}for(z=0;z<T;z++){var Qa=K(12),ya=[0,0,0,0],qa=K(12),ia=1,sa=K(c.CBANDS),Fa=K(c.CBANDS),ta=[0,0,0,0],za=K(c.HBLKSIZE),Wb=ca([3,c.HBLKSIZE_s]);for(F=0;3>F;F++)Qa[F]=x.nsPsy.last_en_subshort[z][F+6],qa[F]=Qa[F]/x.nsPsy.last_en_subshort[z][F+4],ya[0]+=Qa[F];if(2==z)for(F=0;576>F;F++){var Ya=V[0][F];var Xa=V[1][F];V[0][F]=Ya+Xa;V[1][F]=Ya-Xa}var Ia=V[z&1],ec=0;for(F=0;9>F;F++){for(var xa=ec+64,Ga=1;ec<xa;ec++)Ga<Math.abs(Ia[ec])&&(Ga=Math.abs(Ia[ec]));x.nsPsy.last_en_subshort[z][F]=Qa[F+3]=Ga;ya[1+F/3]+=Ga;Ga=Ga>Qa[F+3-2]?Ga/Qa[F+3-2]:Qa[F+3-2]>10*Ga?Qa[F+3-2]/(10*Ga):0;qa[F+3]=Ga}if(a.analysis){var Qb=qa[0];for(F=1;12>F;F++)Qb<qa[F]&&(Qb=qa[F]);x.pinfo.ers[e][z]=x.pinfo.ers_save[z];x.pinfo.ers_save[z]=Qb}var Ma=3==z?x.nsPsy.attackthre_s:x.nsPsy.attackthre;for(F=0;12>F;F++)0==ta[F/3]&&qa[F]>Ma&&(ta[F/3]=F%3+1);for(F=1;4>F;F++)1.7>(ya[F-1]>ya[F]?ya[F-1]/ya[F]:ya[F]/ya[F-1])&&(ta[F]=0,1==F&&(ta[0]=0));0!=ta[0]&&0!=x.nsPsy.lastAttacks[z]&&(ta[0]=0);if(3==x.nsPsy.lastAttacks[z]||0!=ta[0]+ta[1]+ta[2]+ta[3])ia=0,0!=ta[1]&&0!=ta[0]&&(ta[1]=0),0!=ta[2]&&0!=ta[1]&&(ta[2]=0),0!=ta[3]&&0!=ta[2]&&(ta[3]=0);2>z?S[z]=ia:0==ia&&(S[0]=S[1]=0);p[z]=x.tot_ener[z];var P=a,Ha=za,Gb=Wb,La=r,kb=z&1,Ra=t,Na=z&1,cb=e,Aa=z,va=d,qb=h,Va=P.internal_flags;if(2>Aa)q.fft_long(Va,La[kb],Aa,va,qb),q.fft_short(Va,Ra[Na],Aa,va,qb);else if(2==Aa){for(var ja=c.BLKSIZE-1;0<=ja;--ja){var Hb=La[kb+
0][ja],Ib=La[kb+1][ja];La[kb+0][ja]=(Hb+Ib)*aa.SQRT2*.5;La[kb+1][ja]=(Hb-Ib)*aa.SQRT2*.5}for(var Ba=2;0<=Ba;--Ba)for(ja=c.BLKSIZE_s-1;0<=ja;--ja)Hb=Ra[Na+0][Ba][ja],Ib=Ra[Na+1][Ba][ja],Ra[Na+0][Ba][ja]=(Hb+Ib)*aa.SQRT2*.5,Ra[Na+1][Ba][ja]=(Hb-Ib)*aa.SQRT2*.5}Ha[0]=La[kb+0][0];Ha[0]*=Ha[0];for(ja=c.BLKSIZE/2-1;0<=ja;--ja){var fc=La[kb+0][c.BLKSIZE/2-ja],tb=La[kb+0][c.BLKSIZE/2+ja];Ha[c.BLKSIZE/2-ja]=.5*(fc*fc+tb*tb)}for(Ba=2;0<=Ba;--Ba)for(Gb[Ba][0]=Ra[Na+0][Ba][0],Gb[Ba][0]*=Gb[Ba][0],ja=c.BLKSIZE_s/2-1;0<=ja;--ja)fc=Ra[Na+0][Ba][c.BLKSIZE_s/2-ja],tb=Ra[Na+0][Ba][c.BLKSIZE_s/2+ja],Gb[Ba][c.BLKSIZE_s/2-ja]=.5*(fc*fc+tb*tb);var oa=0;for(ja=11;ja<c.HBLKSIZE;ja++)oa+=Ha[ja];Va.tot_ener[Aa]=oa;if(P.analysis){for(ja=0;ja<c.HBLKSIZE;ja++)Va.pinfo.energy[cb][Aa][ja]=Va.pinfo.energy_save[Aa][ja],Va.pinfo.energy_save[Aa][ja]=Ha[ja];Va.pinfo.pe[cb][Aa]=Va.pe[Aa]}2==P.athaa_loudapprox&&2>Aa&&(Va.loudness_sq[cb][Aa]=Va.loudness_sq_save[Aa],Va.loudness_sq_save[Aa]=u(Ha,Va));b(x,za,A,sa,Fa);v(x,sa,Fa,ma);for(L=0;3>L;L++){var ea=void 0,Ab=void 0,Bb=Wb,Sa=I,Za=C,ub=z,zb=L,Ja=a.internal_flags;for(ea=Ab=0;ea<Ja.npart_s;++ea){for(var Rb=0,rb=0,db=Ja.numlines_s[ea],sb=0;sb<db;++sb,++Ab){var Cb=Bb[zb][Ab];Rb+=Cb;rb<Cb&&(rb=Cb)}Sa[ea]=Rb}for(Ab=ea=0;ea<Ja.npart_s;ea++){var Db=Ja.s3ind_s[ea][0],$a=Ja.s3_ss[Ab++]*Sa[Db];for(++Db;Db<=Ja.s3ind_s[ea][1];)$a+=Ja.s3_ss[Ab]*Sa[Db],++Ab,++Db;var vb=2*Ja.nb_s1[ub][ea];Za[ea]=Math.min($a,vb);Ja.blocktype_old[ub&1]==c.SHORT_TYPE&&(vb=16*Ja.nb_s2[ub][ea],Za[ea]=Math.min(vb,Za[ea]));Ja.nb_s2[ub][ea]=Ja.nb_s1[ub][ea];Ja.nb_s1[ub][ea]=$a}for(;ea<=c.CBANDS;++ea)Sa[ea]=0,Za[ea]=0;w(x,I,C,z,L);for(Z=0;Z<c.SBMAX_s;Z++){var Ta=x.thm[z].s[Z][L];Ta*=.8;if(2<=ta[L]||1==ta[L+1]){var wb=0!=L?L-1:2;Ga=B(x.thm[z].s[Z][wb],Ta,.6*M);Ta=Math.min(Ta,Ga)}if(1==ta[L])wb=0!=L?L-1:2,Ga=B(x.thm[z].s[Z][wb],Ta,.3*M),Ta=Math.min(Ta,Ga);else if(0!=L&&3==ta[L-1]||0==L&&3==x.nsPsy.lastAttacks[z])wb=2!=L?L+1:0,Ga=B(x.thm[z].s[Z][wb],Ta,.3*M),Ta=Math.min(Ta,Ga);var Yb=Qa[3*L+3]+Qa[3*L+4]+Qa[3*L+
5];6*Qa[3*L+5]<Yb&&(Ta*=.5,6*Qa[3*L+4]<Yb&&(Ta*=.5));x.thm[z].s[Z][L]=Ta}}x.nsPsy.lastAttacks[z]=ta[2];for(D=N=0;D<x.npart_l;D++){for(var eb=x.s3ind[D][0],Jb=A[eb]*J[ma[eb]],lb=x.s3_ll[N++]*Jb;++eb<=x.s3ind[D][1];)Jb=A[eb]*J[ma[eb]],lb=k(lb,x.s3_ll[N++]*Jb,eb,eb-D,x,0);lb*=.158489319246111;C[D]=x.blocktype_old[z&1]==c.SHORT_TYPE?lb:B(Math.min(lb,Math.min(2*x.nb_1[z][D],16*x.nb_2[z][D])),lb,M);x.nb_2[z][D]=x.nb_1[z][D];x.nb_1[z][D]=lb}for(;D<=c.CBANDS;++D)A[D]=0,C[D]=0;E(x,A,C,z)}if((a.mode==la.STEREO||a.mode==la.JOINT_STEREO)&&0<a.interChRatio){var xb=a.interChRatio,fa=a.internal_flags;if(1<fa.channels_out){for(var Ca=0;Ca<c.SBMAX_l;Ca++){var Sb=fa.thm[0].l[Ca],Eb=fa.thm[1].l[Ca];fa.thm[0].l[Ca]+=Eb*xb;fa.thm[1].l[Ca]+=Sb*xb}for(Ca=0;Ca<c.SBMAX_s;Ca++)for(var fb=0;3>fb;fb++)Sb=fa.thm[0].s[Ca][fb],Eb=fa.thm[1].s[Ca][fb],fa.thm[0].s[Ca][fb]+=Eb*xb,fa.thm[1].s[Ca][fb]+=Sb*xb}}if(a.mode==la.JOINT_STEREO){for(var Oa,ka=0;ka<c.SBMAX_l;ka++)if(!(x.thm[0].l[ka]>1.58*x.thm[1].l[ka]||x.thm[1].l[ka]>1.58*x.thm[0].l[ka])){var Ua=x.mld_l[ka]*x.en[3].l[ka],gb=Math.max(x.thm[2].l[ka],Math.min(x.thm[3].l[ka],Ua));Ua=x.mld_l[ka]*x.en[2].l[ka];var gc=Math.max(x.thm[3].l[ka],Math.min(x.thm[2].l[ka],Ua));x.thm[2].l[ka]=gb;x.thm[3].l[ka]=gc}for(ka=0;ka<c.SBMAX_s;ka++)for(var ua=0;3>ua;ua++)x.thm[0].s[ka][ua]>1.58*x.thm[1].s[ka][ua]||x.thm[1].s[ka][ua]>1.58*x.thm[0].s[ka][ua]||(Ua=x.mld_s[ka]*x.en[3].s[ka][ua],gb=Math.max(x.thm[2].s[ka][ua],Math.min(x.thm[3].s[ka][ua],Ua)),Ua=x.mld_s[ka]*x.en[2].s[ka][ua],gc=Math.max(x.thm[3].s[ka][ua],Math.min(x.thm[2].s[ka][ua],Ua)),x.thm[2].s[ka][ua]=gb,x.thm[3].s[ka][ua]=gc);Oa=a.msfix;if(0<Math.abs(Oa)){var Kb=Oa,hc=Kb,Zb=Math.pow(10,a.ATHlower*x.ATH.adjust);Kb*=2;hc*=2;for(var wa=0;wa<c.SBMAX_l;wa++){var ba=x.ATH.cb_l[x.bm_l[wa]]*Zb;var Wa=Math.min(Math.max(x.thm[0].l[wa],ba),Math.max(x.thm[1].l[wa],ba));var ab=Math.max(x.thm[2].l[wa],ba);var mb=Math.max(x.thm[3].l[wa],ba);if(Wa*Kb<ab+mb){var hb=Wa*hc/(ab+mb);ab*=hb;mb*=hb}x.thm[2].l[wa]=Math.min(ab,x.thm[2].l[wa]);x.thm[3].l[wa]=Math.min(mb,x.thm[3].l[wa])}Zb*=c.BLKSIZE_s/c.BLKSIZE;for(wa=0;wa<c.SBMAX_s;wa++)for(var Da=0;3>Da;Da++)ba=x.ATH.cb_s[x.bm_s[wa]]*Zb,Wa=Math.min(Math.max(x.thm[0].s[wa][Da],ba),Math.max(x.thm[1].s[wa][Da],ba)),ab=Math.max(x.thm[2].s[wa][Da],ba),mb=Math.max(x.thm[3].s[wa][Da],ba),Wa*Kb<ab+mb&&(hb=Wa*Kb/(ab+mb),ab*=hb,mb*=hb),x.thm[2].s[wa][Da]=Math.min(x.thm[2].s[wa][Da],ab),x.thm[3].s[wa][Da]=Math.min(x.thm[3].s[wa][Da],mb)}}var ib=a.internal_flags;a.short_blocks!=ra.short_block_coupled||0!=S[0]&&0!=S[1]||(S[0]=S[1]=0);for(var Ka=0;Ka<ib.channels_out;Ka++)Q[Ka]=c.NORM_TYPE,a.short_blocks==ra.short_block_dispensed&&(S[Ka]=1),a.short_blocks==ra.short_block_forced&&(S[Ka]=0),0!=S[Ka]?ib.blocktype_old[Ka]==c.SHORT_TYPE&&(Q[Ka]=c.STOP_TYPE):(Q[Ka]=c.SHORT_TYPE,ib.blocktype_old[Ka]==c.NORM_TYPE&&(ib.blocktype_old[Ka]=c.START_TYPE),ib.blocktype_old[Ka]==c.STOP_TYPE&&(ib.blocktype_old[Ka]=c.SHORT_TYPE)),n[Ka]=ib.blocktype_old[Ka],ib.blocktype_old[Ka]=Q[Ka];for(z=0;z<T;z++){var Ea=0;if(1<z){var Lb=y;Ea=-2;var Tb=c.NORM_TYPE;if(n[0]==c.SHORT_TYPE||n[1]==c.SHORT_TYPE)Tb=c.SHORT_TYPE;var Fb=l[e][z-2]}else Lb=m,Ea=0,Tb=n[z],Fb=g[e][z];Lb[Ea+z]=Tb==c.SHORT_TYPE?W(Fb,x.masking_lower):f(Fb,x.masking_lower);a.analysis&&(x.pinfo.pe[e][z]=Lb[Ea+z])}return 0};var F=[-1.730326E-17,-.01703172,-1.349528E-17,.0418072,-6.73278E-17,-.0876324,-3.0835E-17,.1863476,-1.104424E-16,-.627638];this.L3psycho_anal_vbr=function(d,h,e,g,l,k,m,x,y,p){for(var r=d.internal_flags,A,t,I=K(c.HBLKSIZE),C=ca([3,c.HBLKSIZE_s]),Q=ca([2,c.BLKSIZE]),z=ca([2,3,c.BLKSIZE_s]),S=ca([4,c.CBANDS]),D=ca([4,c.CBANDS]),O=ca([4,3]),L=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],H=X(2),N=d.mode==la.JOINT_STEREO?4:r.channels_out,Z=ca([2,576]),G=d.internal_flags,V=G.channels_out,ma=d.mode==la.JOINT_STEREO?4:V,R=0;R<V;R++){firbuf=h[R];for(var T=e+576-350-21+192,M=0;576>M;M++){var Y;var ha=firbuf[T+M+10];for(var U=Y=0;9>U;U+=2)ha+=F[U]*(firbuf[T+M+U]+firbuf[T+M+21-U]),Y+=F[U+1]*(firbuf[T+M+U+1]+firbuf[T+M+21-U-1]);Z[R][M]=ha+Y}l[g][R].en.assign(G.en[R]);l[g][R].thm.assign(G.thm[R]);2<ma&&(k[g][R].en.assign(G.en[R+2]),k[g][R].thm.assign(G.thm[R+2]))}for(R=0;R<ma;R++){var da=K(12),ya=K(12),qa=[0,0,0,0],ia=Z[R&1],sa=0,Fa=3==R?G.nsPsy.attackthre_s:G.nsPsy.attackthre,na=1;if(2==R)for(M=0,U=576;0<U;++M,--U){var ta=Z[0][M],za=Z[1][M];Z[0][M]=ta+za;Z[1][M]=ta-za}for(M=0;3>M;M++)ya[M]=G.nsPsy.last_en_subshort[R][M+6],da[M]=ya[M]/G.nsPsy.last_en_subshort[R][M+4],qa[0]+=ya[M];for(M=0;9>M;M++){for(var Xa=sa+64,Ya=1;sa<Xa;sa++)Ya<Math.abs(ia[sa])&&(Ya=Math.abs(ia[sa]));G.nsPsy.last_en_subshort[R][M]=ya[M+3]=Ya;qa[1+M/3]+=Ya;Ya=Ya>ya[M+3-2]?Ya/ya[M+3-2]:ya[M+3-2]>10*Ya?ya[M+3-2]/(10*Ya):0;da[M+3]=Ya}for(M=0;3>M;++M){var Ia=ya[3*M+3]+ya[3*M+4]+ya[3*M+5],Wb=1;6*ya[3*M+5]<Ia&&(Wb*=.5,6*ya[3*M+4]<Ia&&(Wb*=.5));O[R][M]=Wb}if(d.analysis){var xa=da[0];for(M=1;12>M;M++)xa<da[M]&&(xa=da[M]);G.pinfo.ers[g][R]=G.pinfo.ers_save[R];G.pinfo.ers_save[R]=xa}for(M=0;12>M;M++)0==L[R][M/3]&&da[M]>Fa&&(L[R][M/3]=M%3+1);for(M=1;4>M;M++){var Qb=qa[M-1],Ga=qa[M];4E4>Math.max(Qb,Ga)&&Qb<1.7*Ga&&Ga<1.7*Qb&&(1==M&&L[R][0]<=L[R][M]&&(L[R][0]=0),L[R][M]=0)}L[R][0]<=G.nsPsy.lastAttacks[R]&&(L[R][0]=0);if(3==G.nsPsy.lastAttacks[R]||0!=L[R][0]+L[R][1]+L[R][2]+L[R][3])na=0,0!=L[R][1]&&0!=L[R][0]&&(L[R][1]=0),0!=L[R][2]&&0!=L[R][1]&&(L[R][2]=0),0!=L[R][3]&&0!=L[R][2]&&(L[R][3]=0);2>R?H[R]=na:0==na&&(H[0]=H[1]=0);y[R]=G.tot_ener[R]}var qb=d.internal_flags;d.short_blocks!=ra.short_block_coupled||0!=H[0]&&0!=H[1]||(H[0]=H[1]=0);for(var Ma=0;Ma<qb.channels_out;Ma++)d.short_blocks==ra.short_block_dispensed&&(H[Ma]=1),d.short_blocks==ra.short_block_forced&&(H[Ma]=0);for(var P=0;P<N;P++){var Ha=P&1;A=Q;var Gb=d,La=P,kb=g,Ra=I,Na=A,cb=Ha,Aa=Gb.internal_flags;if(2>La)q.fft_long(Aa,Na[cb],La,h,e);else if(2==La)for(var va=c.BLKSIZE-1;0<=va;--va){var rb=Na[cb+0][va],Va=Na[cb+1][va];Na[cb+0][va]=(rb+Va)*aa.SQRT2*.5;Na[cb+1][va]=(rb-Va)*aa.SQRT2*.5}Ra[0]=Na[cb+0][0];Ra[0]*=Ra[0];for(va=c.BLKSIZE/2-1;0<=va;--va){var ja=Na[cb+0][c.BLKSIZE/2-va],Hb=Na[cb+0][c.BLKSIZE/2+va];Ra[c.BLKSIZE/2-va]=.5*(ja*ja+Hb*Hb)}var Ib=0;for(va=11;va<c.HBLKSIZE;va++)Ib+=Ra[va];Aa.tot_ener[La]=Ib;if(Gb.analysis){for(va=0;va<c.HBLKSIZE;va++)Aa.pinfo.energy[kb][La][va]=Aa.pinfo.energy_save[La][va],Aa.pinfo.energy_save[La][va]=Ra[va];Aa.pinfo.pe[kb][La]=Aa.pe[La]}var Ba=P,zb=I,tb=d.internal_flags;2==d.athaa_loudapprox&&2>Ba&&(tb.loudness_sq[g][Ba]=tb.loudness_sq_save[Ba],tb.loudness_sq_save[Ba]=u(zb,tb));if(0!=H[Ha]){var oa=void 0,ea=r,Ab=I,Bb=S[P],Sa=D[P],Za=P,ub=K(c.CBANDS),sb=K(c.CBANDS),Ja=X(c.CBANDS+2);b(ea,Ab,Bb,ub,sb);v(ea,ub,sb,Ja);var Rb=0;for(oa=0;oa<ea.npart_l;oa++){var Xb,db=ea.s3ind[oa][0],cc=ea.s3ind[oa][1],Cb=0,Db=0;Cb=Ja[db];Db+=1;var $a=ea.s3_ll[Rb]*Bb[db]*J[Ja[db]];++Rb;for(++db;db<=cc;){Cb+=Ja[db];Db+=1;var vb=ea.s3_ll[Rb]*Bb[db]*J[Ja[db]];$a=Xb=n($a,vb,db-oa);++Rb;++db}Cb=(1+2*Cb)/(2*Db);var Ta=.5*J[Cb];$a*=Ta;if(ea.blocktype_old[Za&1]==c.SHORT_TYPE){var wb=2*ea.nb_1[Za][oa];Sa[oa]=0<wb?Math.min($a,wb):Math.min($a,.3*Bb[oa])}else{var Yb=16*ea.nb_2[Za][oa],eb=2*ea.nb_1[Za][oa];0>=Yb&&(Yb=$a);0>=eb&&(eb=$a);wb=ea.blocktype_old[Za&1]==c.NORM_TYPE?Math.min(eb,Yb):eb;Sa[oa]=Math.min($a,wb)}ea.nb_2[Za][oa]=ea.nb_1[Za][oa];ea.nb_1[Za][oa]=$a;vb=ub[oa];vb*=ea.minval_l[oa];vb*=Ta;Sa[oa]>vb&&(Sa[oa]=vb);1<ea.masking_lower&&(Sa[oa]*=ea.masking_lower);Sa[oa]>Bb[oa]&&(Sa[oa]=Bb[oa]);1>ea.masking_lower&&(Sa[oa]*=ea.masking_lower)}for(;oa<c.CBANDS;++oa)Bb[oa]=0,Sa[oa]=0}else for(var Jb=r,lb=P,xb=0;xb<Jb.npart_l;xb++)Jb.nb_2[lb][xb]=Jb.nb_1[lb][xb],Jb.nb_1[lb][xb]=0}2==H[0]+H[1]&&d.mode==la.JOINT_STEREO&&a(S,D,r.mld_cb_l,r.ATH.cb_l,d.ATHlower*r.ATH.adjust,d.msfix,r.npart_l);for(P=0;P<N;P++)Ha=P&1,0!=H[Ha]&&E(r,S[P],D[P],P);for(var fa=0;3>fa;fa++){for(P=0;P<N;++P)if(Ha=P&1,0!=H[Ha]){var Ca=r,Sb=P;if(0==fa)for(var Eb=0;Eb<Ca.npart_s;Eb++)Ca.nb_s2[Sb][Eb]=Ca.nb_s1[Sb][Eb],Ca.nb_s1[Sb][Eb]=0}else{t=z;var fb=P,Oa=fa,ka=C,Ua=t,gb=Ha,gc=d.internal_flags;0==Oa&&2>fb&&q.fft_short(gc,Ua[gb],fb,h,e);if(2==fb)for(var ua=c.BLKSIZE_s-1;0<=ua;--ua){var Kb=Ua[gb+0][Oa][ua],hc=Ua[gb+1][Oa][ua];Ua[gb+0][Oa][ua]=(Kb+hc)*aa.SQRT2*.5;Ua[gb+1][Oa][ua]=(Kb-hc)*aa.SQRT2*.5}ka[Oa][0]=Ua[gb+0][Oa][0];ka[Oa][0]*=ka[Oa][0];for(ua=c.BLKSIZE_s/2-1;0<=ua;--ua){var Zb=Ua[gb+0][Oa][c.BLKSIZE_s/2-ua],wa=Ua[gb+0][Oa][c.BLKSIZE_s/2+ua];ka[Oa][c.BLKSIZE_s/2-ua]=.5*(Zb*Zb+wa*wa)}var ba=void 0,Wa=void 0,ab=void 0,mb=C,hb=S[P],Da=D[P],ib=P,Ka=fa,Ea=d.internal_flags,Lb=new float[c.CBANDS],Tb=K(c.CBANDS),Fb=new int[c.CBANDS];for(ba=Wa=0;ba<Ea.npart_s;++ba){var Ob=0,Pb=0,dc=Ea.numlines_s[ba];for(ab=0;ab<dc;++ab,++Wa){var nc=mb[Ka][Wa];Ob+=nc;Pb<nc&&(Pb=nc)}hb[ba]=Ob;Lb[ba]=Pb;Tb[ba]=Ob/dc}for(;ba<c.CBANDS;++ba)Lb[ba]=0,Tb[ba]=0;var Mb=Ea,nb=Lb,Ub=Tb,$b=Fb,ac=J.length-1,pa=0,Pa=Ub[pa]+Ub[pa+1];if(0<Pa){var bb=nb[pa];bb<nb[pa+1]&&(bb=nb[pa+1]);Pa=20*(2*bb-Pa)/(Pa*(Mb.numlines_s[pa]+Mb.numlines_s[pa+1]-1));var ob=0|Pa;ob>ac&&(ob=ac);$b[pa]=ob}else $b[pa]=0;for(pa=1;pa<Mb.npart_s-1;pa++)Pa=Ub[pa-1]+Ub[pa]+Ub[pa+1],0<Pa?(bb=nb[pa-1],bb<nb[pa]&&(bb=nb[pa]),bb<nb[pa+1]&&(bb=nb[pa+1]),Pa=20*(3*bb-Pa)/(Pa*(Mb.numlines_s[pa-1]+Mb.numlines_s[pa]+Mb.numlines_s[pa+
1]-1)),ob=0|Pa,ob>ac&&(ob=ac),$b[pa]=ob):$b[pa]=0;Pa=Ub[pa-1]+Ub[pa];0<Pa?(bb=nb[pa-1],bb<nb[pa]&&(bb=nb[pa]),Pa=20*(2*bb-Pa)/(Pa*(Mb.numlines_s[pa-1]+Mb.numlines_s[pa]-1)),ob=0|Pa,ob>ac&&(ob=ac),$b[pa]=ob):$b[pa]=0;for(Wa=ba=0;ba<Ea.npart_s;ba++){var yb=Ea.s3ind_s[ba][0],mc=Ea.s3ind_s[ba][1];var lc=Fb[yb];var tc=1;var ic=Ea.s3_ss[Wa]*hb[yb]*J[Fb[yb]];++Wa;for(++yb;yb<=mc;){lc+=Fb[yb];tc+=1;var bc=Ea.s3_ss[Wa]*hb[yb]*J[Fb[yb]];ic=n(ic,bc,yb-ba);++Wa;++yb}lc=(1+2*lc)/(2*tc);var uc=.5*J[lc];ic*=uc;Da[ba]=ic;Ea.nb_s2[ib][ba]=Ea.nb_s1[ib][ba];Ea.nb_s1[ib][ba]=ic;bc=Lb[ba];bc*=Ea.minval_s[ba];bc*=uc;Da[ba]>bc&&(Da[ba]=bc);1<Ea.masking_lower&&(Da[ba]*=Ea.masking_lower);Da[ba]>hb[ba]&&(Da[ba]=hb[ba]);1>Ea.masking_lower&&(Da[ba]*=Ea.masking_lower)}for(;ba<c.CBANDS;++ba)hb[ba]=0,Da[ba]=0}0==H[0]+H[1]&&d.mode==la.JOINT_STEREO&&a(S,D,r.mld_cb_s,r.ATH.cb_s,d.ATHlower*r.ATH.adjust,d.msfix,r.npart_s);for(P=0;P<N;++P)Ha=P&1,0==H[Ha]&&w(r,S[P],D[P],P,fa)}for(P=0;P<N;P++)if(Ha=P&1,0==H[Ha])for(var Vb=0;Vb<c.SBMAX_s;Vb++){var vc=K(3);for(fa=0;3>fa;fa++){var jb=r.thm[P].s[Vb][fa];jb*=.8;if(2<=L[P][fa]||1==L[P][fa+1]){var jc=0!=fa?fa-1:2,kc=B(r.thm[P].s[Vb][jc],jb,.36);jb=Math.min(jb,kc)}else if(1==L[P][fa])jc=0!=fa?fa-1:2,kc=B(r.thm[P].s[Vb][jc],jb,.18),jb=Math.min(jb,kc);else if(0!=fa&&3==L[P][fa-1]||0==fa&&3==r.nsPsy.lastAttacks[P])jc=2!=fa?fa+1:0,kc=B(r.thm[P].s[Vb][jc],jb,.18),jb=Math.min(jb,kc);jb*=O[P][fa];vc[fa]=jb}for(fa=0;3>fa;fa++)r.thm[P].s[Vb][fa]=vc[fa]}for(P=0;P<N;P++)r.nsPsy.lastAttacks[P]=L[P][2];for(var Nb=d.internal_flags,pb=0;pb<Nb.channels_out;pb++){var oc=c.NORM_TYPE;0!=H[pb]?Nb.blocktype_old[pb]==c.SHORT_TYPE&&(oc=c.STOP_TYPE):(oc=c.SHORT_TYPE,Nb.blocktype_old[pb]==c.NORM_TYPE&&(Nb.blocktype_old[pb]=c.START_TYPE),Nb.blocktype_old[pb]==c.STOP_TYPE&&(Nb.blocktype_old[pb]=c.SHORT_TYPE));p[pb]=Nb.blocktype_old[pb];Nb.blocktype_old[pb]=oc}for(P=0;P<N;P++){if(1<P){var pc=x;var qc=-2;var rc=c.NORM_TYPE;if(p[0]==c.SHORT_TYPE||p[1]==c.SHORT_TYPE)rc=c.SHORT_TYPE;var sc=k[g][P-2]}else pc=m,qc=0,rc=p[P],sc=l[g][P];pc[qc+P]=rc==c.SHORT_TYPE?W(sc,r.masking_lower):f(sc,r.masking_lower);d.analysis&&(r.pinfo.pe[g][P]=pc[qc+P])}return 0};this.psymodel_init=function(a){var b=a.internal_flags,f,h=!0,g=13,k=0,m=0,x=-8.25,y=-4.5,n=K(c.CBANDS),u=K(c.CBANDS),A=K(c.CBANDS),w=a.out_samplerate;switch(a.experimentalZ){default:case 0:h=!0;break;case 1:h=a.VBR==G.vbr_mtrh||a.VBR==G.vbr_mt?!1:!0;break;case 2:h=!1;break;case 3:g=8,k=-1.75,m=-.0125,x=-8.25,y=-2.25}b.ms_ener_ratio_old=.25;b.blocktype_old[0]=b.blocktype_old[1]=c.NORM_TYPE;for(f=0;4>f;++f){for(var v=0;v<c.CBANDS;++v)b.nb_1[f][v]=1E20,b.nb_2[f][v]=1E20,b.nb_s1[f][v]=b.nb_s2[f][v]=1;for(var z=0;z<c.SBMAX_l;z++)b.en[f].l[z]=1E20,b.thm[f].l[z]=1E20;for(v=0;3>v;++v){for(z=0;z<c.SBMAX_s;z++)b.en[f].s[z][v]=1E20,b.thm[f].s[z][v]=1E20;b.nsPsy.lastAttacks[f]=0}for(v=0;9>v;v++)b.nsPsy.last_en_subshort[f][v]=10}b.loudness_sq_save[0]=b.loudness_sq_save[1]=0;b.npart_l=e(b.numlines_l,b.bo_l,b.bm_l,n,u,b.mld_l,b.PSY.bo_l_weight,w,c.BLKSIZE,b.scalefac_band.l,c.BLKSIZE/1152,c.SBMAX_l);for(f=0;f<b.npart_l;f++)z=k,n[f]>=g&&(z=m*(n[f]-g)/(24-g)+k*(24-n[f])/(24-g)),A[f]=Math.pow(10,z/10),b.rnumlines_l[f]=0<b.numlines_l[f]?1/b.numlines_l[f]:0;b.s3_ll=l(b.s3ind,b.npart_l,n,u,A,h);for(f=v=0;f<b.npart_l;f++){m=Ma.MAX_VALUE;for(z=0;z<b.numlines_l[f];z++,v++)k=w*v/(1E3*c.BLKSIZE),k=this.ATHformula(1E3*k,a)-20,k=Math.pow(10,.1*k),k*=b.numlines_l[f],m>k&&(m=k);b.ATH.cb_l[f]=m;m=-20+20*n[f]/10;6<m&&(m=100);-15>m&&(m=-15);m-=8;b.minval_l[f]=Math.pow(10,m/10)*b.numlines_l[f]}b.npart_s=e(b.numlines_s,b.bo_s,b.bm_s,n,u,b.mld_s,b.PSY.bo_s_weight,w,c.BLKSIZE_s,b.scalefac_band.s,c.BLKSIZE_s/384,c.SBMAX_s);for(f=v=0;f<b.npart_s;f++){z=x;n[f]>=g&&(z=y*(n[f]-g)/(24-g)+x*(24-n[f])/(24-g));A[f]=Math.pow(10,z/10);m=Ma.MAX_VALUE;for(z=0;z<b.numlines_s[f];z++,v++)k=w*v/(1E3*c.BLKSIZE_s),k=this.ATHformula(1E3*k,a)-20,k=Math.pow(10,.1*k),k*=b.numlines_s[f],m>k&&(m=k);b.ATH.cb_s[f]=m;m=-7+7*n[f]/12;12<n[f]&&(m*=1+3.1*Math.log(1+m));12>n[f]&&(m*=1+2.3*Math.log(1-m));-15>m&&(m=-15);m-=8;b.minval_s[f]=Math.pow(10,m/10)*b.numlines_s[f]}b.s3_ss=l(b.s3ind_s,b.npart_s,n,u,A,h);p=Math.pow(10,.5625);r=Math.pow(10,1.5);t=Math.pow(10,1.5);q.init_fft(b);b.decay=Math.exp(-2.302585092994046/(.01*w/192));f=3.5;0!=(a.exp_nspsytune&2)&&(f=1);0<Math.abs(a.msfix)&&(f=a.msfix);a.msfix=f;for(h=0;h<b.npart_l;h++)b.s3ind[h][1]>b.npart_l-1&&(b.s3ind[h][1]=b.npart_l-1);b.ATH.decay=Math.pow(10,576*b.mode_gr/w*-1.2);b.ATH.adjust=.01;b.ATH.adjustLimit=1;if(-1!=a.ATHtype){v=a.out_samplerate/c.BLKSIZE;for(f=k=h=0;f<c.BLKSIZE/2;++f)k+=v,b.ATH.eql_w[f]=1/Math.pow(10,this.ATHformula(k,a)/10),h+=b.ATH.eql_w[f];h=1/h;for(f=c.BLKSIZE/2;0<=--f;)b.ATH.eql_w[f]*=h}for(h=v=0;h<b.npart_s;++h)for(f=0;f<b.numlines_s[h];++f)++v;for(h=v=0;h<b.npart_l;++h)for(f=0;f<b.numlines_l[h];++f)++v;for(f=v=0;f<b.npart_l;f++)k=w*(v+b.numlines_l[f]/2)/(1*c.BLKSIZE),b.mld_cb_l[f]=d(k),v+=b.numlines_l[f];for(;f<c.CBANDS;++f)b.mld_cb_l[f]=1;for(f=v=0;f<b.npart_s;f++)k=w*(v+b.numlines_s[f]/2)/(1*c.BLKSIZE_s),b.mld_cb_s[f]=d(k),v+=b.numlines_s[f];for(;f<c.CBANDS;++f)b.mld_cb_s[f]=1;return 0};this.ATHformula=function(a,b){switch(b.ATHtype){case 0:a=g(a,9);break;case 1:a=g(a,-1);break;case 2:a=g(a,0);break;case 3:a=g(a,1)+6;break;case 4:a=g(a,b.ATHcurve);break;default:a=g(a,0)}return a}}function W(){function u(){this.mask_adjust_short=this.mask_adjust=0;this.bo_l_weight=K(c.SBMAX_l);this.bo_s_weight=K(c.SBMAX_s)}function k(){this.lowerlimit=0}function n(a,b){this.lowpass=b}function V(a){return 1<a?0:0>=a?1:Math.cos(Math.PI/2*a)}function E(a,b){switch(a){case 44100:return b.version=1,0;case 48E3:return b.version=1;case 32E3:return b.version=1,2;case 22050:return b.version=0;case 24E3:return b.version=0,1;case 16E3:return b.version=0,2;case 11025:return b.version=0;case 12E3:return b.version=0,1;case 8E3:return b.version=0,2;default:return b.version=0,-1}}function B(a,b,d){16E3>d&&(b=2);d=w.bitrate_table[b][1];for(var c=2;14>=c;c++)0<w.bitrate_table[b][c]&&Math.abs(w.bitrate_table[b][c]-a)<Math.abs(d-a)&&(d=w.bitrate_table[b][c]);return d}function U(a,b,d){16E3>d&&(b=2);for(d=0;14>=d;d++)if(0<w.bitrate_table[b][d]&&w.bitrate_table[b][d]==a)return d;return-1}function f(a,b){var d=[new n(8,2E3),new n(16,3700),new n(24,3900),new n(32,5500),new n(40,7E3),new n(48,7500),new n(56,1E4),new n(64,11E3),new n(80,13500),new n(96,15100),new n(112,15600),new n(128,17E3),new n(160,17500),new n(192,18600),new n(224,19400),new n(256,19700),new n(320,20500)];b=e.nearestBitrateFullIndex(b);a.lowerlimit=d[b].lowpass}function b(a){var b=c.BLKSIZE+a.framesize-c.FFTOFFSET;return b=Math.max(b,512+a.framesize-32)}function v(f,g,k,p,q,n,r){var h=f.internal_flags,x=0,y=[null,null],u=[null,null];if(4294479419!=h.Class_ID)return-3;if(0==p)return 0;var t=d.copy_buffer(h,q,n,r,0);if(0>t)return t;n+=t;x+=t;u[0]=g;u[1]=k;if(qa.NEQ(f.scale,0)&&qa.NEQ(f.scale,1))for(t=0;t<p;++t)u[0][t]*=f.scale,2==h.channels_out&&(u[1][t]*=f.scale);if(qa.NEQ(f.scale_left,0)&&qa.NEQ(f.scale_left,1))for(t=0;t<p;++t)u[0][t]*=f.scale_left;if(qa.NEQ(f.scale_right,0)&&qa.NEQ(f.scale_right,1))for(t=0;t<p;++t)u[1][t]*=f.scale_right;if(2==f.num_channels&&1==h.channels_out)for(t=0;t<p;++t)u[0][t]=.5*(u[0][t]+u[1][t]),u[1][t]=0;g=b(f);y[0]=h.mfbuf[0];y[1]=h.mfbuf[1];for(k=0;0<p;){var v=[null,null];v[0]=u[0];v[1]=u[1];t=new a;var A=f;var w=y;var B=k,E=p,D=t,H=A.internal_flags;if(.9999>H.resample_ratio||1.0001<H.resample_ratio)for(var O=0;O<H.channels_out;O++){var G=new m,J=D,N,V=w[O],T=H.mf_size,U=A.framesize,W=v[O],X=B,aa=E,ha=G,la=O,ca=A.internal_flags,ia=0,sa=A.out_samplerate/z(A.out_samplerate,A.in_samplerate);sa>da.BPC&&(sa=da.BPC);var ra=1E-4>Math.abs(ca.resample_ratio-Math.floor(.5+ca.resample_ratio))?1:0;var R=1/ca.resample_ratio;1<R&&(R=1);var na=31;0==na%2&&--na;na+=ra;ra=na+1;if(0==ca.fill_buffer_resample_init){ca.inbuf_old[0]=K(ra);ca.inbuf_old[1]=K(ra);for(N=0;N<=2*sa;++N)ca.blackfilt[N]=K(ra);ca.itime[0]=0;for(ia=ca.itime[1]=0;ia<=2*sa;ia++){var M=0,za=(ia-sa)/(2*sa);for(N=0;N<=na;N++){var Fa=ca.blackfilt[ia],Ia=N,xa=N-za,Qa=Math.PI*R;xa/=na;0>xa&&(xa=0);1<xa&&(xa=1);var Ma=xa-.5;xa=.42-.5*Math.cos(2*xa*Math.PI)+.08*Math.cos(4*xa*Math.PI);M+=Fa[Ia]=1E-9>Math.abs(Ma)?Qa/Math.PI:xa*Math.sin(na*Qa*Ma)/(Math.PI*na*Ma)}for(N=0;N<=na;N++)ca.blackfilt[ia][N]/=M}ca.fill_buffer_resample_init=1}M=ca.inbuf_old[la];for(R=0;R<U;R++){N=R*ca.resample_ratio;ia=0|Math.floor(N-ca.itime[la]);if(na+ia-na/2>=aa)break;za=N-ca.itime[la]-(ia+na%2*.5);za=0|Math.floor(2*za*sa+sa+.5);for(N=Fa=0;N<=na;++N)Ia=0|N+ia-na/2,Fa+=(0>Ia?M[ra+Ia]:W[X+Ia])*ca.blackfilt[za][N];V[T+R]=Fa}ha.num_used=Math.min(aa,na+ia-na/2);ca.itime[la]+=ha.num_used-
R*ca.resample_ratio;if(ha.num_used>=ra)for(N=0;N<ra;N++)M[N]=W[X+ha.num_used+N-ra];else{V=ra-ha.num_used;for(N=0;N<V;++N)M[N]=M[N+ha.num_used];for(ia=0;N<ra;++N,++ia)M[N]=W[X+ia]}J.n_out=R;D.n_in=G.num_used}else for(D.n_out=Math.min(A.framesize,E),D.n_in=D.n_out,A=0;A<D.n_out;++A)w[0][H.mf_size+A]=v[0][B+A],2==H.channels_out&&(w[1][H.mf_size+A]=v[1][B+A]);w=t.n_in;t=t.n_out;if(h.findReplayGain&&!h.decode_on_the_fly&&l.AnalyzeSamples(h.rgdata,y[0],h.mf_size,y[1],h.mf_size,t,h.channels_out)==Y.GAIN_ANALYSIS_ERROR)return-6;p-=w;k+=w;h.mf_size+=t;1>h.mf_samples_to_encode&&(h.mf_samples_to_encode=c.ENCDELAY+c.POSTDELAY);h.mf_samples_to_encode+=t;if(h.mf_size>=g){w=r-x;0==r&&(w=0);t=f;w=e.enc.lame_encode_mp3_frame(t,y[0],y[1],q,n,w);t.frameNum++;t=w;if(0>t)return t;n+=t;x+=t;h.mf_size-=f.framesize;h.mf_samples_to_encode-=f.framesize;for(w=0;w<h.channels_out;w++)for(t=0;t<h.mf_size;t++)y[w][t]=y[w][t+f.framesize]}}return x}function a(){this.n_out=this.n_in=0}function m(){this.num_used=0}function z(a,b){return 0!=b?z(b,a%b):a}var e=this;W.V9=410;W.V8=420;W.V7=430;W.V6=440;W.V5=450;W.V4=460;W.V3=470;W.V2=480;W.V1=490;W.V0=500;W.R3MIX=1E3;W.STANDARD=1001;W.EXTREME=1002;W.INSANE=1003;W.STANDARD_FAST=1004;W.EXTREME_FAST=1005;W.MEDIUM=1006;W.MEDIUM_FAST=1007;W.LAME_MAXMP3BUFFER=147456;var l,d,g,q,D,p=new Pb,r,t,J;this.enc=new c;this.setModules=function(a,b,c,f,e,k,m,n,u){l=a;d=b;g=c;q=f;D=e;r=k;t=n;J=u;this.enc.setModules(d,p,q,r)};this.lame_init=function(){var a=new zc;a.class_id=4294479419;var b=a.internal_flags=new da;a.mode=la.NOT_SET;a.original=1;a.in_samplerate=44100;a.num_channels=2;a.num_samples=-1;a.bWriteVbrTag=!0;a.quality=-1;a.short_blocks=null;b.subblock_gain=-1;a.lowpassfreq=0;a.highpassfreq=0;a.lowpasswidth=-1;a.highpasswidth=-1;a.VBR=G.vbr_off;a.VBR_q=4;a.ATHcurve=-1;a.VBR_mean_bitrate_kbps=128;a.VBR_min_bitrate_kbps=0;a.VBR_max_bitrate_kbps=0;a.VBR_hard_min=0;b.VBR_min_bitrate=1;b.VBR_max_bitrate=13;a.quant_comp=-1;a.quant_comp_short=-1;a.msfix=-1;b.resample_ratio=1;b.OldValue[0]=180;b.OldValue[1]=180;b.CurrentStep[0]=4;b.CurrentStep[1]=4;b.masking_lower=1;b.nsPsy.attackthre=-1;b.nsPsy.attackthre_s=-1;a.scale=-1;a.athaa_type=-1;a.ATHtype=-1;a.athaa_loudapprox=-1;a.athaa_sensitivity=0;a.useTemporal=null;a.interChRatio=-1;b.mf_samples_to_encode=c.ENCDELAY+c.POSTDELAY;a.encoder_padding=0;b.mf_size=c.ENCDELAY-c.MDCTDELAY;a.findReplayGain=!1;a.decode_on_the_fly=!1;b.decode_on_the_fly=!1;b.findReplayGain=!1;b.findPeakSample=!1;b.RadioGain=0;b.AudiophileGain=0;b.noclipGainChange=0;b.noclipScale=-1;a.preset=0;a.write_id3tag_automatic=!0;a.lame_allocated_gfp=1;return a};this.nearestBitrateFullIndex=function(a){var b=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320];var d=b[16];var c=16;var f=b[16];var e=16;for(var h=0;16>h;h++)if(Math.max(a,b[h+1])!=a){d=b[h+1];c=h+1;f=b[h];e=h;break}return d-a>a-f?e:c};this.lame_init_params=function(a){var b=a.internal_flags;b.Class_ID=0;null==b.ATH&&(b.ATH=new Cc);null==b.PSY&&(b.PSY=new u);null==b.rgdata&&(b.rgdata=new Ac);b.channels_in=a.num_channels;1==b.channels_in&&(a.mode=la.MONO);b.channels_out=a.mode==la.MONO?1:2;b.mode_ext=c.MPG_MD_MS_LR;a.mode==la.MONO&&(a.force_ms=!1);a.VBR==G.vbr_off&&128!=a.VBR_mean_bitrate_kbps&&0==a.brate&&(a.brate=a.VBR_mean_bitrate_kbps);a.VBR!=G.vbr_off&&a.VBR!=G.vbr_mtrh&&a.VBR!=G.vbr_mt&&(a.free_format=!1);a.VBR==G.vbr_off&&0==a.brate&&qa.EQ(a.compression_ratio,0)&&(a.compression_ratio=11.025);a.VBR==G.vbr_off&&0<a.compression_ratio&&(0==a.out_samplerate&&(a.out_samplerate=map2MP3Frequency(int(.97*a.in_samplerate))),a.brate=0|16*a.out_samplerate*b.channels_out/(1E3*a.compression_ratio),b.samplerate_index=E(a.out_samplerate,a),a.free_format||(a.brate=B(a.brate,a.version,a.out_samplerate)));0!=a.out_samplerate&&(16E3>a.out_samplerate?(a.VBR_mean_bitrate_kbps=Math.max(a.VBR_mean_bitrate_kbps,8),a.VBR_mean_bitrate_kbps=Math.min(a.VBR_mean_bitrate_kbps,64)):32E3>a.out_samplerate?(a.VBR_mean_bitrate_kbps=Math.max(a.VBR_mean_bitrate_kbps,8),a.VBR_mean_bitrate_kbps=Math.min(a.VBR_mean_bitrate_kbps,160)):(a.VBR_mean_bitrate_kbps=Math.max(a.VBR_mean_bitrate_kbps,32),a.VBR_mean_bitrate_kbps=Math.min(a.VBR_mean_bitrate_kbps,320)));if(0==a.lowpassfreq){switch(a.VBR){case G.vbr_off:var e=new k;f(e,a.brate);e=e.lowerlimit;break;case G.vbr_abr:e=new k;f(e,a.VBR_mean_bitrate_kbps);e=e.lowerlimit;break;case G.vbr_rh:var h=[19500,19E3,18600,18E3,17500,16E3,15600,14900,12500,1E4,3950];if(0<=a.VBR_q&&9>=a.VBR_q){e=h[a.VBR_q];h=h[a.VBR_q+1];var m=a.VBR_q_frac;e=linear_int(e,h,m)}else e=19500;break;default:h=[19500,19E3,18500,18E3,17500,16500,15500,14500,12500,9500,3950],0<=a.VBR_q&&9>=a.VBR_q?(e=h[a.VBR_q],h=h[a.VBR_q+1],m=a.VBR_q_frac,e=linear_int(e,h,m)):e=19500}a.mode!=la.MONO||a.VBR!=G.vbr_off&&a.VBR!=G.vbr_abr||(e*=1.5);a.lowpassfreq=e|0}0==a.out_samplerate&&(2*a.lowpassfreq>a.in_samplerate&&(a.lowpassfreq=a.in_samplerate/2),e=a.lowpassfreq|0,h=a.in_samplerate,m=44100,48E3<=h?m=48E3:44100<=h?m=44100:32E3<=h?m=32E3:24E3<=h?m=24E3:22050<=h?m=22050:16E3<=h?m=16E3:12E3<=h?m=12E3:11025<=h?m=11025:8E3<=h&&(m=8E3),-1==e?e=m:(15960>=e&&(m=44100),15250>=e&&(m=32E3),11220>=e&&(m=24E3),9970>=e&&(m=22050),7230>=e&&(m=16E3),5420>=e&&(m=12E3),4510>=e&&(m=11025),3970>=e&&(m=8E3),e=h<m?44100<h?48E3:32E3<h?44100:24E3<h?32E3:22050<h?24E3:16E3<h?22050:12E3<h?16E3:11025<h?12E3:8E3<h?11025:8E3:m),a.out_samplerate=e);a.lowpassfreq=Math.min(20500,a.lowpassfreq);a.lowpassfreq=Math.min(a.out_samplerate/2,a.lowpassfreq);a.VBR==G.vbr_off&&(a.compression_ratio=16*a.out_samplerate*b.channels_out/(1E3*a.brate));a.VBR==G.vbr_abr&&(a.compression_ratio=16*a.out_samplerate*b.channels_out/(1E3*a.VBR_mean_bitrate_kbps));a.bWriteVbrTag||(a.findReplayGain=!1,a.decode_on_the_fly=!1,b.findPeakSample=!1);b.findReplayGain=a.findReplayGain;b.decode_on_the_fly=a.decode_on_the_fly;b.decode_on_the_fly&&(b.findPeakSample=!0);if(b.findReplayGain&&l.InitGainAnalysis(b.rgdata,a.out_samplerate)==Y.INIT_GAIN_ANALYSIS_ERROR)return a.internal_flags=null,-6;b.decode_on_the_fly&&!a.decode_only&&(null!=b.hip&&J.hip_decode_exit(b.hip),b.hip=J.hip_decode_init());b.mode_gr=24E3>=a.out_samplerate?1:2;a.framesize=576*b.mode_gr;a.encoder_delay=c.ENCDELAY;b.resample_ratio=a.in_samplerate/a.out_samplerate;switch(a.VBR){case G.vbr_mt:case G.vbr_rh:case G.vbr_mtrh:a.compression_ratio=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5][a.VBR_q];break;case G.vbr_abr:a.compression_ratio=16*a.out_samplerate*b.channels_out/(1E3*a.VBR_mean_bitrate_kbps);break;default:a.compression_ratio=16*a.out_samplerate*b.channels_out/(1E3*a.brate)}a.mode==la.NOT_SET&&(a.mode=la.JOINT_STEREO);0<a.highpassfreq?(b.highpass1=2*a.highpassfreq,b.highpass2=0<=a.highpasswidth?2*(a.highpassfreq+a.highpasswidth):2*a.highpassfreq,b.highpass1/=a.out_samplerate,b.highpass2/=a.out_samplerate):(b.highpass1=0,b.highpass2=0);0<a.lowpassfreq?(b.lowpass2=2*a.lowpassfreq,0<=a.lowpasswidth?(b.lowpass1=2*(a.lowpassfreq-a.lowpasswidth),0>b.lowpass1&&(b.lowpass1=0)):b.lowpass1=2*a.lowpassfreq,b.lowpass1/=a.out_samplerate,b.lowpass2/=a.out_samplerate):(b.lowpass1=0,b.lowpass2=0);e=a.internal_flags;var n=32,v=-1;if(0<e.lowpass1){var z=999;for(h=0;31>=h;h++)m=h/31,m>=e.lowpass2&&(n=Math.min(n,h)),e.lowpass1<m&&m<e.lowpass2&&(z=Math.min(z,h));e.lowpass1=999==z?(n-.75)/31:(z-.75)/31;e.lowpass2=n/31}0<e.highpass2&&e.highpass2<.75/31*.9&&(e.highpass1=0,e.highpass2=0,T.err.println("Warning: highpass filter disabled.  highpass frequency too small\n"));if(0<e.highpass2){n=-1;for(h=0;31>=h;h++)m=h/31,m<=e.highpass1&&(v=Math.max(v,h)),e.highpass1<m&&m<e.highpass2&&(n=Math.max(n,h));e.highpass1=v/31;e.highpass2=-1==n?(v+.75)/31:(n+.75)/31}for(h=0;32>h;h++)m=h/31,v=e.highpass2>e.highpass1?V((e.highpass2-m)/(e.highpass2-e.highpass1+1E-20)):1,m=e.lowpass2>e.lowpass1?V((m-e.lowpass1)/(e.lowpass2-e.lowpass1+1E-20)):1,e.amp_filter[h]=v*m;b.samplerate_index=E(a.out_samplerate,a);if(0>b.samplerate_index)return a.internal_flags=null,-1;if(a.VBR==G.vbr_off)if(a.free_format)b.bitrate_index=0;else{if(a.brate=B(a.brate,a.version,a.out_samplerate),b.bitrate_index=U(a.brate,a.version,a.out_samplerate),0>=b.bitrate_index)return a.internal_flags=null,-1}else b.bitrate_index=1;a.analysis&&(a.bWriteVbrTag=!1);null!=b.pinfo&&(a.bWriteVbrTag=!1);d.init_bit_stream_w(b);e=b.samplerate_index+3*a.version+6*(16E3>a.out_samplerate?1:0);for(h=0;h<c.SBMAX_l+1;h++)b.scalefac_band.l[h]=q.sfBandIndex[e].l[h];for(h=0;h<c.PSFB21+1;h++)m=(b.scalefac_band.l[22]-b.scalefac_band.l[21])/c.PSFB21,m=b.scalefac_band.l[21]+h*m,b.scalefac_band.psfb21[h]=m;b.scalefac_band.psfb21[c.PSFB21]=576;for(h=0;h<c.SBMAX_s+1;h++)b.scalefac_band.s[h]=q.sfBandIndex[e].s[h];for(h=0;h<c.PSFB12+1;h++)m=(b.scalefac_band.s[13]-
b.scalefac_band.s[12])/c.PSFB12,m=b.scalefac_band.s[12]+h*m,b.scalefac_band.psfb12[h]=m;b.scalefac_band.psfb12[c.PSFB12]=192;b.sideinfo_len=1==a.version?1==b.channels_out?21:36:1==b.channels_out?13:21;a.error_protection&&(b.sideinfo_len+=2);e=a.internal_flags;a.frameNum=0;a.write_id3tag_automatic&&t.id3tag_write_v2(a);e.bitrate_stereoMode_Hist=Ia([16,5]);e.bitrate_blockType_Hist=Ia([16,6]);e.PeakSample=0;a.bWriteVbrTag&&r.InitVbrTag(a);b.Class_ID=4294479419;for(e=0;19>e;e++)b.nsPsy.pefirbuf[e]=700*b.mode_gr*b.channels_out;-1==a.ATHtype&&(a.ATHtype=4);switch(a.VBR){case G.vbr_mt:a.VBR=G.vbr_mtrh;case G.vbr_mtrh:null==a.useTemporal&&(a.useTemporal=!1);g.apply_preset(a,500-10*a.VBR_q,0);0>a.quality&&(a.quality=LAME_DEFAULT_QUALITY);5>a.quality&&(a.quality=0);5<a.quality&&(a.quality=5);b.PSY.mask_adjust=a.maskingadjust;b.PSY.mask_adjust_short=a.maskingadjust_short;b.sfb21_extra=a.experimentalY?!1:44E3<a.out_samplerate;b.iteration_loop=new VBRNewIterationLoop(D);break;case G.vbr_rh:g.apply_preset(a,500-10*a.VBR_q,0);b.PSY.mask_adjust=a.maskingadjust;b.PSY.mask_adjust_short=a.maskingadjust_short;b.sfb21_extra=a.experimentalY?!1:44E3<a.out_samplerate;6<a.quality&&(a.quality=6);0>a.quality&&(a.quality=LAME_DEFAULT_QUALITY);b.iteration_loop=new VBROldIterationLoop(D);break;default:b.sfb21_extra=!1,0>a.quality&&(a.quality=LAME_DEFAULT_QUALITY),e=a.VBR,e==G.vbr_off&&(a.VBR_mean_bitrate_kbps=a.brate),g.apply_preset(a,a.VBR_mean_bitrate_kbps,0),a.VBR=e,b.PSY.mask_adjust=a.maskingadjust,b.PSY.mask_adjust_short=a.maskingadjust_short,b.iteration_loop=e==G.vbr_off?new Bc(D):new ABRIterationLoop(D)}if(a.VBR!=G.vbr_off){b.VBR_min_bitrate=1;b.VBR_max_bitrate=14;16E3>a.out_samplerate&&(b.VBR_max_bitrate=8);if(0!=a.VBR_min_bitrate_kbps&&(a.VBR_min_bitrate_kbps=B(a.VBR_min_bitrate_kbps,a.version,a.out_samplerate),b.VBR_min_bitrate=U(a.VBR_min_bitrate_kbps,a.version,a.out_samplerate),0>b.VBR_min_bitrate)||0!=a.VBR_max_bitrate_kbps&&(a.VBR_max_bitrate_kbps=B(a.VBR_max_bitrate_kbps,a.version,a.out_samplerate),b.VBR_max_bitrate=U(a.VBR_max_bitrate_kbps,a.version,a.out_samplerate),0>b.VBR_max_bitrate))return-1;a.VBR_min_bitrate_kbps=w.bitrate_table[a.version][b.VBR_min_bitrate];a.VBR_max_bitrate_kbps=w.bitrate_table[a.version][b.VBR_max_bitrate];a.VBR_mean_bitrate_kbps=Math.min(w.bitrate_table[a.version][b.VBR_max_bitrate],a.VBR_mean_bitrate_kbps);a.VBR_mean_bitrate_kbps=Math.max(w.bitrate_table[a.version][b.VBR_min_bitrate],a.VBR_mean_bitrate_kbps)}a.tune&&(b.PSY.mask_adjust+=a.tune_value_a,b.PSY.mask_adjust_short+=a.tune_value_a);e=a.internal_flags;switch(a.quality){default:case 9:e.psymodel=0;e.noise_shaping=0;e.noise_shaping_amp=0;e.noise_shaping_stop=0;e.use_best_huffman=0;e.full_outer_loop=0;break;case 8:a.quality=7;case 7:e.psymodel=1;e.noise_shaping=0;e.noise_shaping_amp=0;e.noise_shaping_stop=0;e.use_best_huffman=0;e.full_outer_loop=0;break;case 6:e.psymodel=1;0==e.noise_shaping&&(e.noise_shaping=1);e.noise_shaping_amp=0;e.noise_shaping_stop=0;-1==e.subblock_gain&&(e.subblock_gain=1);e.use_best_huffman=0;e.full_outer_loop=0;break;case 5:e.psymodel=1;0==e.noise_shaping&&(e.noise_shaping=1);e.noise_shaping_amp=0;e.noise_shaping_stop=0;-1==e.subblock_gain&&(e.subblock_gain=1);e.use_best_huffman=0;e.full_outer_loop=0;break;case 4:e.psymodel=1;0==e.noise_shaping&&(e.noise_shaping=1);e.noise_shaping_amp=0;e.noise_shaping_stop=0;-1==e.subblock_gain&&(e.subblock_gain=1);e.use_best_huffman=1;e.full_outer_loop=0;break;case 3:e.psymodel=1;0==e.noise_shaping&&(e.noise_shaping=1);e.noise_shaping_amp=1;e.noise_shaping_stop=1;-1==e.subblock_gain&&(e.subblock_gain=1);e.use_best_huffman=1;e.full_outer_loop=0;break;case 2:e.psymodel=1;0==e.noise_shaping&&(e.noise_shaping=1);0==e.substep_shaping&&(e.substep_shaping=2);e.noise_shaping_amp=1;e.noise_shaping_stop=1;-1==e.subblock_gain&&(e.subblock_gain=1);e.use_best_huffman=1;e.full_outer_loop=0;break;case 1:e.psymodel=1;0==e.noise_shaping&&(e.noise_shaping=1);0==e.substep_shaping&&(e.substep_shaping=2);e.noise_shaping_amp=2;e.noise_shaping_stop=1;-1==e.subblock_gain&&(e.subblock_gain=1);e.use_best_huffman=1;e.full_outer_loop=0;break;case 0:e.psymodel=1,0==e.noise_shaping&&(e.noise_shaping=1),0==e.substep_shaping&&(e.substep_shaping=2),e.noise_shaping_amp=2,e.noise_shaping_stop=1,-1==e.subblock_gain&&(e.subblock_gain=1),e.use_best_huffman=1,e.full_outer_loop=0}b.ATH.useAdjust=0>a.athaa_type?3:a.athaa_type;b.ATH.aaSensitivityP=Math.pow(10,a.athaa_sensitivity/-10);null==a.short_blocks&&(a.short_blocks=ra.short_block_allowed);a.short_blocks!=ra.short_block_allowed||a.mode!=la.JOINT_STEREO&&a.mode!=la.STEREO||(a.short_blocks=ra.short_block_coupled);0>a.quant_comp&&(a.quant_comp=1);0>a.quant_comp_short&&(a.quant_comp_short=0);0>a.msfix&&(a.msfix=0);a.exp_nspsytune|=1;0>a.internal_flags.nsPsy.attackthre&&(a.internal_flags.nsPsy.attackthre=Pb.NSATTACKTHRE);0>a.internal_flags.nsPsy.attackthre_s&&(a.internal_flags.nsPsy.attackthre_s=Pb.NSATTACKTHRE_S);0>a.scale&&(a.scale=1);0>a.ATHtype&&(a.ATHtype=4);0>a.ATHcurve&&(a.ATHcurve=4);0>a.athaa_loudapprox&&(a.athaa_loudapprox=2);0>a.interChRatio&&(a.interChRatio=0);null==a.useTemporal&&(a.useTemporal=!0);b.slot_lag=b.frac_SpF=0;a.VBR==G.vbr_off&&(b.slot_lag=b.frac_SpF=72E3*(a.version+1)*a.brate%a.out_samplerate|0);q.iteration_init(a);p.psymodel_init(a);return 0};this.lame_encode_flush=function(a,e,f,g){var k=a.internal_flags,l=dc([2,1152]),h=0,m=k.mf_samples_to_encode-c.POSTDELAY,p=b(a);if(1>k.mf_samples_to_encode)return 0;var n=0;a.in_samplerate!=a.out_samplerate&&(m+=16*a.out_samplerate/a.in_samplerate);var q=a.framesize-m%a.framesize;576>q&&(q+=a.framesize);a.encoder_padding=q;for(q=(m+q)/a.framesize;0<q&&0<=h;){var r=p-k.mf_size;m=a.frameNum;r*=a.in_samplerate;r/=a.out_samplerate;1152<r&&(r=1152);1>r&&(r=1);h=g-n;0==g&&(h=0);h=this.lame_encode_buffer(a,l[0],l[1],r,e,f,h);f+=h;n+=h;q-=m!=a.frameNum?1:0}k.mf_samples_to_encode=0;if(0>h)return h;h=g-n;0==g&&(h=0);d.flush_bitstream(a);h=d.copy_buffer(k,e,f,h,1);if(0>h)return h;f+=h;n+=h;h=g-n;0==g&&(h=0);if(a.write_id3tag_automatic){t.id3tag_write_v1(a);h=d.copy_buffer(k,e,f,h,0);if(0>h)return h;n+=h}return n};this.lame_encode_buffer=function(a,b,d,c,e,f,g){var h=a.internal_flags,k=[null,null];if(4294479419!=h.Class_ID)return-3;if(0==c)return 0;if(null==h.in_buffer_0||h.in_buffer_nsamples<c)h.in_buffer_0=K(c),h.in_buffer_1=K(c),h.in_buffer_nsamples=c;k[0]=h.in_buffer_0;k[1]=h.in_buffer_1;for(var l=0;l<c;l++)k[0][l]=b[l],1<h.channels_in&&(k[1][l]=d[l]);return v(a,k[0],k[1],c,e,f,g)}}function Kc(){this.setModules=function(c,k){}}function Lc(){this.setModules=function(c,k,n){}}function Mc(){}
function Nc(){this.setModules=function(c,k){}}function Fa(){this.sampleRate=this.channels=this.dataLen=this.dataOffset=0}function cc(c){return c.charCodeAt(0)<<24|c.charCodeAt(1)<<16|c.charCodeAt(2)<<8|c.charCodeAt(3)}var na={fill:function(c,k,n,w){if(2==arguments.length)for(var u=0;u<c.length;u++)c[u]=arguments[1];else for(u=k;u<n;u++)c[u]=w}},T={arraycopy:function(c,k,n,w,E){for(E=k+E;k<E;)n[w++]=c[k++]}},aa={SQRT2:1.4142135623730951,FAST_LOG10:function(c){return Math.log10(c)},FAST_LOG10_X:function(c,k){return Math.log10(c)*k}};ra.short_block_allowed=new ra(0);ra.short_block_coupled=new ra(1);ra.short_block_dispensed=new ra(2);ra.short_block_forced=new ra(3);var Ma={MAX_VALUE:3.4028235E38};G.vbr_off=new G(0);G.vbr_mt=new G(1);G.vbr_rh=new G(2);G.vbr_abr=new G(3);G.vbr_mtrh=new G(4);G.vbr_default=G.vbr_mtrh;la.STEREO=new la(0);la.JOINT_STEREO=new la(1);la.DUAL_CHANNEL=new la(2);la.MONO=new la(3);la.NOT_SET=new la(4);Y.STEPS_per_dB=100;Y.MAX_dB=120;Y.GAIN_NOT_ENOUGH_SAMPLES=-24601;Y.GAIN_ANALYSIS_ERROR=0;Y.GAIN_ANALYSIS_OK=1;Y.INIT_GAIN_ANALYSIS_ERROR=0;Y.INIT_GAIN_ANALYSIS_OK=1;Y.YULE_ORDER=10;Y.MAX_ORDER=Y.YULE_ORDER;Y.MAX_SAMP_FREQ=48E3;Y.RMS_WINDOW_TIME_NUMERATOR=1;Y.RMS_WINDOW_TIME_DENOMINATOR=20;Y.MAX_SAMPLES_PER_WINDOW=Y.MAX_SAMP_FREQ*Y.RMS_WINDOW_TIME_NUMERATOR/Y.RMS_WINDOW_TIME_DENOMINATOR+1;qa.EQ=function(c,k){return Math.abs(c)>Math.abs(k)?Math.abs(c-k)<=1E-6*Math.abs(c):Math.abs(c-k)<=1E-6*Math.abs(k)};qa.NEQ=function(c,k){return!qa.EQ(c,k)};zb.NUMTOCENTRIES=100;zb.MAXFRAMESIZE=2880;var w={t1HB:[1,1,1,0],t2HB:[1,2,1,3,1,1,3,2,0],t3HB:[3,2,1,1,1,1,3,2,0],t5HB:[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0],t6HB:[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0],t7HB:[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0],t8HB:[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0],t9HB:[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0],t10HB:[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0],t11HB:[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0],t12HB:[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0],t13HB:[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1],t15HB:[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0],t16HB:[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3],t24HB:[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3],t32HB:[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16],t33HB:[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0],t1l:[1,4,3,5],t2l:[1,4,7,4,5,7,6,7,8],t3l:[2,3,7,4,4,7,6,7,8],t5l:[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10],t6l:[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9],t7l:[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12],t8l:[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13],t9l:[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11],t10l:[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13],t11l:[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12],t12l:[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12],t13l:[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18],t15l:[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15],t16_5l:[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12],t16l:[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10],t24l:[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6],t32l:[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10],t33l:[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8]};w.ht=[new U(0,0,null,null),new U(2,0,w.t1HB,w.t1l),new U(3,0,w.t2HB,w.t2l),new U(3,0,w.t3HB,w.t3l),new U(0,0,null,null),new U(4,0,w.t5HB,w.t5l),new U(4,0,w.t6HB,w.t6l),new U(6,0,w.t7HB,w.t7l),new U(6,0,w.t8HB,w.t8l),new U(6,0,w.t9HB,w.t9l),new U(8,0,w.t10HB,w.t10l),new U(8,0,w.t11HB,w.t11l),new U(8,0,w.t12HB,w.t12l),new U(16,0,w.t13HB,w.t13l),new U(0,0,null,w.t16_5l),new U(16,0,w.t15HB,w.t15l),new U(1,1,w.t16HB,w.t16l),new U(2,3,w.t16HB,w.t16l),new U(3,7,w.t16HB,w.t16l),new U(4,15,w.t16HB,w.t16l),new U(6,63,w.t16HB,w.t16l),new U(8,255,w.t16HB,w.t16l),new U(10,1023,w.t16HB,w.t16l),new U(13,8191,w.t16HB,w.t16l),new U(4,15,w.t24HB,w.t24l),new U(5,31,w.t24HB,w.t24l),new U(6,63,w.t24HB,w.t24l),new U(7,127,w.t24HB,w.t24l),new U(8,255,w.t24HB,w.t24l),new U(9,511,w.t24HB,w.t24l),new U(11,2047,w.t24HB,w.t24l),new U(13,8191,w.t24HB,w.t24l),new U(0,0,w.t32HB,w.t32l),new U(0,0,w.t33HB,w.t33l)];w.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366];w.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296];w.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369];w.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]];w.samplerate_table=[[22050,24E3,16E3,-1],[44100,48E3,32E3,-1],[11025,12E3,8E3,-1]];w.scfsi_band=[0,6,11,16,21];ia.Q_MAX=257;ia.Q_MAX2=116;ia.LARGE_BITS=1E5;ia.IXMAX_VAL=8206;var sa={};sa.SFBMAX=3*c.SBMAX_s;c.ENCDELAY=576;c.POSTDELAY=1152;c.MDCTDELAY=48;c.FFTOFFSET=224+c.MDCTDELAY;c.DECDELAY=528;c.SBLIMIT=32;c.CBANDS=64;c.SBPSY_l=21;c.SBPSY_s=12;c.SBMAX_l=22;c.SBMAX_s=13;c.PSFB21=6;c.PSFB12=6;c.BLKSIZE=1024;c.HBLKSIZE=c.BLKSIZE/2+1;c.BLKSIZE_s=256;c.HBLKSIZE_s=c.BLKSIZE_s/2+1;c.NORM_TYPE=0;c.START_TYPE=1;c.SHORT_TYPE=2;c.STOP_TYPE=3;c.MPG_MD_LR_LR=0;c.MPG_MD_LR_I=1;c.MPG_MD_MS_LR=2;c.MPG_MD_MS_I=3;c.fircoef=[-.1039435,-.1892065,-.0432472*5,-.155915,3.898045E-17,.0467745*5,.50455,.756825,.187098*5];da.MFSIZE=3456+c.ENCDELAY-c.MDCTDELAY;da.MAX_HEADER_BUF=256;da.MAX_BITS_PER_CHANNEL=4095;da.MAX_BITS_PER_GRANULE=7680;da.BPC=320;Fa.RIFF=cc("RIFF");Fa.WAVE=cc("WAVE");Fa.fmt_=cc("fmt ");Fa.data=cc("data");Fa.readHeader=function(c){var k=new Fa,n=c.getUint32(0,!1);if(Fa.RIFF==n&&(c.getUint32(4,!0),Fa.WAVE==c.getUint32(8,!1)&&Fa.fmt_==c.getUint32(12,!1))){var u=c.getUint32(16,!0),w=20;switch(u){case 16:case 18:k.channels=c.getUint16(w+2,!0);k.sampleRate=c.getUint32(w+
4,!0);break;default:throw"extended fmt chunk not implemented";}w+=u;u=Fa.data;for(var B=0;u!=n;){n=c.getUint32(w,!1);B=c.getUint32(w+4,!0);if(u==n)break;w+=B+8}k.dataLen=B;k.dataOffset=w+8;return k}};sa.SFBMAX=3*c.SBMAX_s;lamejs.Mp3Encoder=function(c,k,n){3!=arguments.length&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),c=1,k=44100,n=128);var u=new W,w=new Kc,B=new Y,G=new qa,f=new wc,b=new ia,v=new Ec,a=new zb,m=new mc,z=new Nc,e=new xc,l=new qb,d=new Lc,g=new Mc;u.setModules(B,G,f,b,v,a,m,z,g);G.setModules(B,g,m,a);z.setModules(G,m);f.setModules(u);v.setModules(G,e,b,l);b.setModules(l,e,u.enc.psy);e.setModules(G);l.setModules(b);a.setModules(u,G,m);w.setModules(d,g);d.setModules(m,z,f);var q=u.lame_init();q.num_channels=c;q.in_samplerate=k;q.brate=n;q.mode=la.STEREO;q.quality=3;q.bWriteVbrTag=!1;q.disable_reservoir=!0;q.write_id3tag_automatic=!1;u.lame_init_params(q);var D=1152,p=0|1.25*D+7200,r=new Int8Array(p);this.encodeBuffer=function(a,b){1==c&&(b=a);a.length>D&&(D=a.length,p=0|1.25*D+7200,r=new Int8Array(p));a=u.lame_encode_buffer(q,a,b,a.length,r,0,p);return new Int8Array(r.subarray(0,a))};this.flush=function(){var a=u.lame_encode_flush(q,r,0,p);return new Int8Array(r.subarray(0,a))}};lamejs.WavHeader=Fa}lamejs();"use strict";var WaveSurfer={defaultParams:{height:128,waveColor:"#999",progressColor:"#555",cursorColor:"#333",cursorWidth:1,skipLength:2,minPxPerSec:20,pixelRatio:window.devicePixelRatio,fillParent:!0,scrollParent:!1,hideScrollbar:!1,normalize:!1,audioContext:null,container:null,dragSelection:!0,loopSelection:!0,audioRate:1,interact:!0,renderer:"Canvas",backend:"WebAudio",mediaType:"audio"},init:function(t){if(this.params=WaveSurfer.util.extend({},this.defaultParams,t),this.container="string"==typeof t.container?document.querySelector(this.params.container):this.params.container,!this.container)throw new Error("Container element not found");if(this.mediaContainer="undefined"==typeof this.params.mediaContainer?this.container:"string"==typeof this.params.mediaContainer?document.querySelector(this.params.mediaContainer):this.params.mediaContainer,!this.mediaContainer)throw new Error("Media Container element not found");this.savedVolume=0,this.isMuted=!1,this.createDrawer(),this.createBackend()},createDrawer:function(){var t=this;this.drawer=Object.create(WaveSurfer.Drawer[this.params.renderer]),this.drawer.init(this.container,this.params),this.drawer.on("redraw",function(){t.drawBuffer(),t.drawer.progress(t.backend.getPlayedPercents())}),this.drawer.on("click",function(e,i){setTimeout(function(){t.seekTo(i)},0)}),this.drawer.on("scroll",function(e){t.fireEvent("scroll",e)})},createBackend:function(){var t=this;this.backend&&this.backend.destroy(),"WebAudio"!=this.params.backend||WaveSurfer.WebAudio.supportsWebAudio()||(this.params.backend="AudioElement"),this.backend=Object.create(WaveSurfer[this.params.backend]),this.backend.init(this.params),this.backend.on("finish",function(){t.fireEvent("finish")}),this.backend.on("audioprocess",function(e){t.fireEvent("audioprocess",e)})},restartAnimationLoop:function(){var t=this,e=window.requestAnimationFrame||window.webkitRequestAnimationFrame,i=function(){t.backend.isPaused()||(t.drawer.progress(t.backend.getPlayedPercents()),e(i))};i()},getDuration:function(){return this.backend.getDuration()},getCurrentTime:function(){return this.backend.getCurrentTime()},play:function(t,e){this.backend.play(t,e),this.restartAnimationLoop(),this.fireEvent("play")},pause:function(){this.backend.pause(),this.fireEvent("pause")},playPause:function(){this.backend.isPaused()?this.play():this.pause()},skipBackward:function(t){this.skip(-t||-this.params.skipLength)},skipForward:function(t){this.skip(t||this.params.skipLength)},skip:function(t){var e=this.getCurrentTime()||0,i=this.getDuration()||1;e=Math.max(0,Math.min(i,e+(t||0))),this.seekAndCenter(e/i)},seekAndCenter:function(t){this.seekTo(t),this.drawer.recenter(t)},seekTo:function(t){var e=this.backend.isPaused(),i=this.params.scrollParent;e&&(this.params.scrollParent=!1),this.backend.seekTo(t*this.getDuration()),this.drawer.progress(this.backend.getPlayedPercents()),e||(this.backend.pause(),this.backend.play()),this.params.scrollParent=i,this.fireEvent("seek",t)},stop:function(){this.pause(),this.seekTo(0),this.drawer.progress(0)},setVolume:function(t){this.backend.setVolume(t)},setPlaybackRate:function(t){this.backend.setPlaybackRate(t)},toggleMute:function(){this.isMuted?(this.backend.setVolume(this.savedVolume),this.isMuted=!1):(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0)},toggleScroll:function(){this.params.scrollParent=!this.params.scrollParent,this.drawBuffer()},toggleInteraction:function(){this.params.interact=!this.params.interact},drawBuffer:function(){var t=Math.round(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio),e=this.drawer.getWidth(),i=t;this.params.fillParent&&(!this.params.scrollParent||e>t)&&(i=e);var r=this.backend.getPeaks(i);this.drawer.drawPeaks(r,i),this.fireEvent("redraw",r,i)},loadArrayBuffer:function(t){var e=this;this.backend.decodeArrayBuffer(t,function(t){e.loadDecodedBuffer(t)},function(){e.fireEvent("error","Error decoding audiobuffer")})},loadDecodedBuffer:function(t){this.empty(),this.backend.load(t),this.drawBuffer(),this.fireEvent("ready")},loadBlob:function(t){var e=this,i=new FileReader;i.addEventListener("progress",function(t){e.onProgress(t)}),i.addEventListener("load",function(t){e.empty(),e.loadArrayBuffer(t.target.result)}),i.addEventListener("error",function(){e.fireEvent("error","Error reading file")}),i.readAsArrayBuffer(t)},load:function(t,e){switch(this.params.backend){case"WebAudio":return this.loadBuffer(t);case"AudioElement":case"MediaElement":return this.loadMediaElement(t,e)}},loadBuffer:function(t){return this.empty(),this.downloadArrayBuffer(t,this.loadArrayBuffer.bind(this))},loadMediaElement:function(t,e){this.empty(),this.backend.load(t,this.mediaContainer,e),this.backend.once("canplay",function(){this.drawBuffer(),this.fireEvent("ready")}.bind(this)),this.backend.once("error",function(t){this.fireEvent("error",t)}.bind(this)),!e&&this.backend.supportsWebAudio()&&this.downloadArrayBuffer(t,function(t){this.backend.decodeArrayBuffer(t,function(t){this.backend.buffer=t,this.drawBuffer()}.bind(this))}.bind(this))},downloadArrayBuffer:function(t,e){var i=this,r=WaveSurfer.util.ajax({url:t,responseType:"arraybuffer"});return r.on("progress",function(t){i.onProgress(t)}),r.on("success",e),r.on("error",function(t){i.fireEvent("error","XHR error: "+t.target.statusText)}),r},onProgress:function(t){if(t.lengthComputable)var e=t.loaded/t.total;else e=t.loaded/(t.loaded+1e6);this.fireEvent("loading",Math.round(100*e),t.target)},exportPCM:function(t,e,i){t=t||1024,e=e||1e4,i=i||!1;var r=this.backend.getPeaks(t,e),s=[].map.call(r,function(t){return Math.round(t*e)/e}),a=JSON.stringify(s);return i||window.open("data:application/json;charset=utf-8,"+encodeURIComponent(a)),a},empty:function(){this.backend.isPaused()||(this.stop(),this.backend.disconnectSource()),this.drawer.progress(0),this.drawer.setWidth(0),this.drawer.drawPeaks({length:this.drawer.getWidth()},0)},destroy:function(){this.fireEvent("destroy"),this.unAll(),this.backend.destroy(),this.drawer.destroy()}};WaveSurfer.Observer={on:function(t,e){this.handlers||(this.handlers={});var i=this.handlers[t];i||(i=this.handlers[t]=[]),i.push(e)},un:function(t,e){if(this.handlers){var i=this.handlers[t];if(i)
if(e)
for(var r=i.length-1;r>=0;r--)i[r]==e&&i.splice(r,1);else i.length=0}},unAll:function(){this.handlers=null},once:function(t,e){var i=this,r=function(){e.apply(this,arguments),setTimeout(function(){i.un(t,r)},0)};this.on(t,r)},fireEvent:function(t){if(this.handlers){var e=this.handlers[t],i=Array.prototype.slice.call(arguments,1);e&&e.forEach(function(t){t.apply(null,i)})}}},WaveSurfer.util={extend:function(t){var e=Array.prototype.slice.call(arguments,1);return e.forEach(function(e){Object.keys(e).forEach(function(i){t[i]=e[i]})}),t},getId:function(){return"wavesurfer_"+Math.random().toString(32).substring(2)},max:function(t,e){for(var i=-1/0,r=0,s=t.length;s>r;r++){var a=t[r];null!=e&&(a=Math.abs(a-e)),a>i&&(i=a)}
return i},ajax:function(t){var e=Object.create(WaveSurfer.Observer),i=new XMLHttpRequest,r=!1;return i.open(t.method||"GET",t.url,!0),i.responseType=t.responseType,i.addEventListener("progress",function(t){e.fireEvent("progress",t),t.lengthComputable&&t.loaded==t.total&&(r=!0)}),i.addEventListener("load",function(t){r||e.fireEvent("progress",t),e.fireEvent("load",t),200==i.status||206==i.status?e.fireEvent("success",i.response,t):e.fireEvent("error",t)}),i.addEventListener("error",function(t){e.fireEvent("error",t)}),i.send(),e.xhr=i,e}},WaveSurfer.util.extend(WaveSurfer,WaveSurfer.Observer),WaveSurfer.WebAudio={scriptBufferSize:256,fftSize:128,PLAYING_STATE:0,PAUSED_STATE:1,FINISHED_STATE:2,supportsWebAudio:function(){return!(!window.AudioContext&&!window.webkitAudioContext)},getAudioContext:function(){return WaveSurfer.WebAudio.audioContext||(WaveSurfer.WebAudio.audioContext=new(window.AudioContext||window.webkitAudioContext)),WaveSurfer.WebAudio.audioContext},getOfflineAudioContext:function(t){return WaveSurfer.WebAudio.offlineAudioContext||(WaveSurfer.WebAudio.offlineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,t)),WaveSurfer.WebAudio.offlineAudioContext},init:function(t){this.params=t,this.ac=t.audioContext||this.getAudioContext(),this.lastPlay=this.ac.currentTime,this.startPosition=0,this.states=[Object.create(WaveSurfer.WebAudio.state.playing),Object.create(WaveSurfer.WebAudio.state.paused),Object.create(WaveSurfer.WebAudio.state.finished)],this.setState(this.PAUSED_STATE),this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode(),this.setPlaybackRate(this.params.audioRate)},disconnectFilters:function(){this.filters&&(this.filters.forEach(function(t){t&&t.disconnect()}),this.filters=null)},setState:function(t){this.state!==this.states[t]&&(this.state=this.states[t],this.state.init.call(this))},setFilter:function(){this.setFilters([].slice.call(arguments))},setFilters:function(t){this.disconnectFilters(),t&&t.length?(this.filters=t,t.reduce(function(t,e){return t.connect(e),e},this.analyser).connect(this.gainNode)):this.analyser.connect(this.gainNode)},createScriptNode:function(){var t=this,e=this.scriptBufferSize;this.scriptNode=this.ac.createScriptProcessor?this.ac.createScriptProcessor(e):this.ac.createJavaScriptNode(e),this.scriptNode.connect(this.ac.destination),this.scriptNode.onaudioprocess=function(){var e=t.getCurrentTime();t.state===t.states[t.PLAYING_STATE]&&t.fireEvent("audioprocess",e),t.buffer&&e>t.getDuration()&&t.setState(t.FINISHED_STATE)}},createAnalyserNode:function(){this.analyser=this.ac.createAnalyser(),this.analyser.fftSize=this.fftSize,this.analyserData=new Uint8Array(this.analyser.frequencyBinCount),this.analyser.connect(this.gainNode)},createVolumeNode:function(){this.gainNode=this.ac.createGain?this.ac.createGain():this.ac.createGainNode(),this.gainNode.connect(this.ac.destination)},setVolume:function(t){this.gainNode.gain.value=t},getVolume:function(){return this.gainNode.gain.value},decodeArrayBuffer:function(t,e,i){this.offlineAc||(this.offlineAc=this.getOfflineAudioContext(this.ac?this.ac.sampleRate:44100)),this.offlineAc.decodeAudioData(t,function(t){e(t)}.bind(this),i)},getPeaks:function(t){for(var e=this.buffer,i=e.length/t,r=~~(i/10)||1,s=e.numberOfChannels,a=new Float32Array(t),n=0;s>n;n++)
for(var o=e.getChannelData(n),h=0;t>h;h++){for(var u=~~(h*i),c=~~(u+i),d=0,l=u;c>l;l+=r){var f=o[l];f>d?d=f:-f>d&&(d=-f)}(0==n||d>a[h])&&(a[h]=d)}
return a},getPlayedPercents:function(){return this.state.getPlayedPercents.call(this)},disconnectSource:function(){this.source&&this.source.disconnect()},waveform:function(){return this.analyser.getByteTimeDomainData(this.analyserData),this.analyserData},destroy:function(){this.isPaused()||this.pause(),this.unAll(),this.buffer=null,this.disconnectFilters(),this.disconnectSource(),this.gainNode.disconnect(),this.scriptNode.disconnect(),this.analyser.disconnect()},load:function(t){this.startPosition=0,this.lastPlay=this.ac.currentTime,this.buffer=t,this.createSource()},createSource:function(){this.disconnectSource(),this.source=this.ac.createBufferSource(),this.source.start=this.source.start||this.source.noteGrainOn,this.source.stop=this.source.stop||this.source.noteOff,this.source.playbackRate.value=this.playbackRate,this.source.buffer=this.buffer,this.source.connect(this.analyser)},isPaused:function(){return this.state!==this.states[this.PLAYING_STATE]},getDuration:function(){return void 0===this.buffer?0:this.buffer.duration},seekTo:function(t,e){return null==t&&(t=this.getCurrentTime(),t>=this.getDuration()&&(t=0)),null==e&&(e=this.getDuration()),this.startPosition=t,this.lastPlay=this.ac.currentTime,this.state===this.states[this.FINISHED_STATE]&&this.setState(this.PAUSED_STATE),{start:t,end:e}},getPlayedTime:function(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate},play:function(t,e){this.createSource();var i=this.seekTo(t,e);t=i.start,e=i.end,this.source.start(0,t,e-t),this.setState(this.PLAYING_STATE)},pause:function(){this.startPosition+=this.getPlayedTime(),this.source&&this.source.stop(0),this.setState(this.PAUSED_STATE)},getCurrentTime:function(){return this.state.getCurrentTime.call(this)},setPlaybackRate:function(t){t=t||1,this.isPaused()?this.playbackRate=t:(this.pause(),this.playbackRate=t,this.play())}},WaveSurfer.WebAudio.state={},WaveSurfer.WebAudio.state.playing={init:function(){},getPlayedPercents:function(){var t=this.getDuration();return this.getCurrentTime()/t||0},getCurrentTime:function(){return this.startPosition+this.getPlayedTime()}},WaveSurfer.WebAudio.state.paused={init:function(){},getPlayedPercents:function(){var t=this.getDuration();return this.getCurrentTime()/t||0},getCurrentTime:function(){return this.startPosition}},WaveSurfer.WebAudio.state.finished={init:function(){this.fireEvent("finish")},getPlayedPercents:function(){return 1},getCurrentTime:function(){return this.getDuration()}},WaveSurfer.util.extend(WaveSurfer.WebAudio,WaveSurfer.Observer),WaveSurfer.MediaElement=Object.create(WaveSurfer.WebAudio),WaveSurfer.util.extend(WaveSurfer.MediaElement,{init:function(t){this.params=t,this.media={currentTime:0,duration:0,paused:!0,playbackRate:1,play:function(){},pause:function(){}},this.mediaType=t.mediaType.toLowerCase(),this.ac=t.audioContext||this.getAudioContext(),this.elementPosition=t.elementPosition},load:function(t,e,i){var r=this,s=document.createElement(this.mediaType);s.controls=!1,s.autoplay=!1,s.preload="auto",s.src=t,s.addEventListener("error",function(){r.fireEvent("error","Error loading media element")}),s.addEventListener("canplay",function(){r.fireEvent("canplay")}),s.addEventListener("ended",function(){r.fireEvent("finish")}),s.addEventListener("timeupdate",function(){r.fireEvent("audioprocess",r.getCurrentTime())});var a=e.querySelector(this.mediaType);a&&e.removeChild(a),e.appendChild(s),this.media=s,this.peaks=i,this.setPlaybackRate(this.playbackRate)},isPaused:function(){return this.media.paused},getDuration:function(){var t=this.media.duration;return t>=1/0&&(t=this.media.seekable.end()),t},getCurrentTime:function(){return this.media.currentTime},getPlayedPercents:function(){return this.getCurrentTime()/this.getDuration()||0},setPlaybackRate:function(t){this.playbackRate=t||1,this.media.playbackRate=this.playbackRate},seekTo:function(t){null!=t&&(this.media.currentTime=t)},play:function(t){this.seekTo(t),this.media.play()},pause:function(){this.media.pause()},getPeaks:function(t){return this.buffer?WaveSurfer.WebAudio.getPeaks.call(this,t):this.peaks||[]},getVolume:function(){return this.media.volume},setVolume:function(t){this.media.volume=t},destroy:function(){this.pause(),this.unAll(),this.media.parentNode&&this.media.parentNode.removeChild(this.media),this.media=null}}),WaveSurfer.AudioElement=WaveSurfer.MediaElement,WaveSurfer.Drawer={init:function(t,e){this.container=t,this.params=e,this.width=0,this.height=e.height*this.params.pixelRatio,this.lastPos=0,this.createWrapper(),this.createElements()},createWrapper:function(){this.wrapper=this.container.appendChild(document.createElement("wave")),this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"}),(this.params.fillParent||this.params.scrollParent)&&this.style(this.wrapper,{width:"100%",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"}),this.setupWrapperEvents()},handleEvent:function(t){t.preventDefault();var e=this.wrapper.getBoundingClientRect();return(t.clientX-e.left+this.wrapper.scrollLeft)/this.wrapper.scrollWidth||0},setupWrapperEvents:function(){var t=this;this.wrapper.addEventListener("click",function(e){var i=t.wrapper.offsetHeight-t.wrapper.clientHeight;if(0!=i){var r=t.wrapper.getBoundingClientRect();if(e.clientY>=r.bottom-i)return}
t.params.interact&&t.fireEvent("click",e,t.handleEvent(e))}),this.wrapper.addEventListener("scroll",function(e){t.fireEvent("scroll",e)})},drawPeaks:function(t,e){if(this.resetScroll(),this.setWidth(e),this.params.normalize)var i=WaveSurfer.util.max(t);else i=1;this.drawWave(t,i)},style:function(t,e){return Object.keys(e).forEach(function(i){t.style[i]!=e[i]&&(t.style[i]=e[i])}),t},resetScroll:function(){null!==this.wrapper&&(this.wrapper.scrollLeft=0)},recenter:function(t){var e=this.wrapper.scrollWidth*t;this.recenterOnPosition(e,!0)},recenterOnPosition:function(t,e){var i=this.wrapper.scrollLeft,r=~~(this.wrapper.clientWidth/2),s=t-r,a=s-i,n=this.wrapper.scrollWidth-this.wrapper.clientWidth;if(0!=n){if(!e&&a>=-r&&r>a){var o=5;a=Math.max(-o,Math.min(o,a)),s=i+a}
s=Math.max(0,Math.min(n,s)),s!=i&&(this.wrapper.scrollLeft=s)}},getWidth:function(){return Math.round(this.container.clientWidth*this.params.pixelRatio)},setWidth:function(t){t!=this.width&&(this.width=t,this.params.fillParent||this.params.scrollParent?this.style(this.wrapper,{width:""}):this.style(this.wrapper,{width:~~(this.width/this.params.pixelRatio)+"px"}),this.updateWidth())},progress:function(t){var e=1/this.params.pixelRatio,i=Math.round(t*this.width)*e;if(i<this.lastPos||i-this.lastPos>=e){if(this.lastPos=i,this.params.scrollParent){var r=~~(this.wrapper.scrollWidth*t);this.recenterOnPosition(r)}
this.updateProgress(t)}},destroy:function(){this.unAll(),this.container.removeChild(this.wrapper),this.wrapper=null},createElements:function(){},updateWidth:function(){},drawWave:function(){},clearWave:function(){},updateProgress:function(){}},WaveSurfer.util.extend(WaveSurfer.Drawer,WaveSurfer.Observer),WaveSurfer.Drawer.Canvas=Object.create(WaveSurfer.Drawer),WaveSurfer.util.extend(WaveSurfer.Drawer.Canvas,{createElements:function(){var t=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:1}));if(this.waveCc=t.getContext("2d"),this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:2,overflow:"hidden",width:"0",height:this.params.height+"px",borderRightStyle:"solid",borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})),this.params.waveColor!=this.params.progressColor){var e=this.progressWave.appendChild(document.createElement("canvas"));this.progressCc=e.getContext("2d")}},updateWidth:function(){var t=Math.round(this.width/this.params.pixelRatio);this.waveCc.canvas.width=this.width,this.waveCc.canvas.height=this.height,this.style(this.waveCc.canvas,{width:t+"px"}),this.progressCc&&(this.progressCc.canvas.width=this.width,this.progressCc.canvas.height=this.height,this.style(this.progressCc.canvas,{width:t+"px"})),this.clearWave()},clearWave:function(){this.waveCc.clearRect(0,0,this.width,this.height),this.progressCc&&this.progressCc.clearRect(0,0,this.width,this.height)},drawWave:function(t,e){var i=.5/this.params.pixelRatio,r=this.height/2,s=r/e,a=t.length,n=1;this.params.fillParent&&this.width!=a&&(n=this.width/a),this.waveCc.fillStyle=this.params.waveColor,this.progressCc&&(this.progressCc.fillStyle=this.params.progressColor),[this.waveCc,this.progressCc].forEach(function(e){if(e){e.beginPath(),e.moveTo(i,r);for(var o=0;a>o;o++){var h=Math.round(t[o]*s);e.lineTo(o*n+i,r+h)}
e.lineTo(this.width+i,r),e.moveTo(i,r);for(var o=0;a>o;o++){var h=Math.round(t[o]*s);e.lineTo(o*n+i,r-h)}
e.lineTo(this.width+i,r),e.fill(),e.fillRect(0,r-i,this.width,i)}},this)},updateProgress:function(t){var e=Math.round(this.width*t)/this.params.pixelRatio;this.style(this.progressWave,{width:e+"px"})}});!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(t="undefined"!=typeof globalThis?globalThis:t||self).MP3Tag=r()}(this,(function(){"use strict";function t(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),e.push.apply(e,n)}return e}function r(r){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?t(Object(n),!0).forEach((function(t){a(r,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach((function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(n,t))}))}return r}function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function n(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function i(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,r,e){return r&&i(t.prototype,r),e&&i(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}function u(t){return u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},u(t)}function c(t,r){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},c(t,r)}function s(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function f(t,r,e){return f=s()?Reflect.construct.bind():function(t,r,e){var n=[null];n.push.apply(n,r);var i=new(Function.bind.apply(t,n));return e&&c(i,e.prototype),i},f.apply(null,arguments)}function l(t){var r="function"==typeof Map?new Map:void 0;return l=function(t){if(null===t||(e=t,-1===Function.toString.call(e).indexOf("[native code]")))return t;var e;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,n)}function n(){return f(t,arguments,u(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),c(n,t)},l(t)}function h(t,r){if(r&&("object"==typeof r||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function v(t){return function(t){if(Array.isArray(t))return g(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,r){if(!t)return;if("string"==typeof t)return g(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return g(t,r)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var p,d,y="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},w=function(t){try{return!!t()}catch(t){return!0}},b=!w((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),m=!w((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),E=m,A=Function.prototype,S=A.bind,T=A.call,O=E&&S.bind(T,T),x=E?function(t){return t&&O(t)}:function(t){return t&&function(){return T.apply(t,arguments)}},I=function(t){return null==t},k=I,R=TypeError,P=function(t){if(k(t))throw R("Can't call method on "+t);return t},C=P,L=Object,U=function(t){return L(C(t))},j=U,M=x({}.hasOwnProperty),D=Object.hasOwn||function(t,r){return M(j(t),r)},B=b,F=D,_=Function.prototype,N=B&&Object.getOwnPropertyDescriptor,V=F(_,"name"),G={EXISTS:V,PROPER:V&&"something"===function(){}.name,CONFIGURABLE:V&&(!B||B&&N(_,"name").configurable)},W={},Y=function(t){return t&&t.Math==Math&&t},$=Y("object"==typeof globalThis&&globalThis)||Y("object"==typeof window&&window)||Y("object"==typeof self&&self)||Y("object"==typeof y&&y)||function(){return this}()||Function("return this")(),z=function(t){return"function"==typeof t},H=z,K="object"==typeof document&&document.all,X=void 0===K&&void 0!==K?function(t){return"object"==typeof t?null!==t:H(t)||t===K}:function(t){return"object"==typeof t?null!==t:H(t)},J=X,q=$.document,Z=J(q)&&J(q.createElement),Q=function(t){return Z?q.createElement(t):{}},tt=Q,rt=!b&&!w((function(){return 7!=Object.defineProperty(tt("div"),"a",{get:function(){return 7}}).a})),et=b&&w((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),nt=X,it=String,ot=TypeError,at=function(t){if(nt(t))return t;throw ot(it(t)+" is not an object")},ut=m,ct=Function.prototype.call,st=ut?ct.bind(ct):function(){return ct.apply(ct,arguments)},ft=$,lt=z,ht=function(t){return lt(t)?t:void 0},vt=function(t,r){return arguments.length<2?ht(ft[t]):ft[t]&&ft[t][r]},gt=x({}.isPrototypeOf),pt=vt("navigator","userAgent")||"",dt=$,yt=pt,wt=dt.process,bt=dt.Deno,mt=wt&&wt.versions||bt&&bt.version,Et=mt&&mt.v8;Et&&(d=(p=Et.split("."))[0]>0&&p[0]<4?1:+(p[0]+p[1])),!d&&yt&&(!(p=yt.match(/Edge\/(\d+)/))||p[1]>=74)&&(p=yt.match(/Chrome\/(\d+)/))&&(d=+p[1]);var At=d,St=At,Tt=w,Ot=!!Object.getOwnPropertySymbols&&!Tt((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&St&&St<41})),xt=Ot&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,It=vt,kt=z,Rt=gt,Pt=Object,Ct=xt?function(t){return"symbol"==typeof t}:function(t){var r=It("Symbol");return kt(r)&&Rt(r.prototype,Pt(t))},Lt=String,Ut=function(t){try{return Lt(t)}catch(t){return"Object"}},jt=z,Mt=Ut,Dt=TypeError,Bt=function(t){if(jt(t))return t;throw Dt(Mt(t)+" is not a function")},Ft=Bt,_t=I,Nt=function(t,r){var e=t[r];return _t(e)?void 0:Ft(e)},Vt=st,Gt=z,Wt=X,Yt=TypeError,$t={exports:{}},zt=$,Ht=Object.defineProperty,Kt=function(t,r){try{Ht(zt,t,{value:r,configurable:!0,writable:!0})}catch(e){zt[t]=r}return r},Xt=Kt,Jt="__core-js_shared__",qt=$[Jt]||Xt(Jt,{}),Zt=qt;($t.exports=function(t,r){return Zt[t]||(Zt[t]=void 0!==r?r:{})})("versions",[]).push({version:"3.25.1",mode:"global",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.25.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Qt=x,tr=0,rr=Math.random(),er=Qt(1..toString),nr=function(t){return"Symbol("+(void 0===t?"":t)+")_"+er(++tr+rr,36)},ir=$,or=$t.exports,ar=D,ur=nr,cr=Ot,sr=xt,fr=or("wks"),lr=ir.Symbol,hr=lr&&lr.for,vr=sr?lr:lr&&lr.withoutSetter||ur,gr=function(t){if(!ar(fr,t)||!cr&&"string"!=typeof fr[t]){var r="Symbol."+t;cr&&ar(lr,t)?fr[t]=lr[t]:fr[t]=sr&&hr?hr(r):vr(r)}return fr[t]},pr=st,dr=X,yr=Ct,wr=Nt,br=function(t,r){var e,n;if("string"===r&&Gt(e=t.toString)&&!Wt(n=Vt(e,t)))return n;if(Gt(e=t.valueOf)&&!Wt(n=Vt(e,t)))return n;if("string"!==r&&Gt(e=t.toString)&&!Wt(n=Vt(e,t)))return n;throw Yt("Can't convert object to primitive value")},mr=TypeError,Er=gr("toPrimitive"),Ar=function(t,r){if(!dr(t)||yr(t))return t;var e,n=wr(t,Er);if(n){if(void 0===r&&(r="default"),e=pr(n,t,r),!dr(e)||yr(e))return e;throw mr("Can't convert object to primitive value")}return void 0===r&&(r="number"),br(t,r)},Sr=Ar,Tr=Ct,Or=function(t){var r=Sr(t,"string");return Tr(r)?r:r+""},xr=b,Ir=rt,kr=et,Rr=at,Pr=Or,Cr=TypeError,Lr=Object.defineProperty,Ur=Object.getOwnPropertyDescriptor,jr="enumerable",Mr="configurable",Dr="writable";W.f=xr?kr?function(t,r,e){if(Rr(t),r=Pr(r),Rr(e),"function"==typeof t&&"prototype"===r&&"value"in e&&Dr in e&&!e.writable){var n=Ur(t,r);n&&n.writable&&(t[r]=e.value,e={configurable:Mr in e?e.configurable:n.configurable,enumerable:jr in e?e.enumerable:n.enumerable,writable:!1})}return Lr(t,r,e)}:Lr:function(t,r,e){if(Rr(t),r=Pr(r),Rr(e),Ir)try{return Lr(t,r,e)}catch(t){}if("get"in e||"set"in e)throw Cr("Accessors not supported");return"value"in e&&(t[r]=e.value),t};var Br=b,Fr=G.EXISTS,_r=x,Nr=W.f,Vr=Function.prototype,Gr=_r(Vr.toString),Wr=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,Yr=_r(Wr.exec);Br&&!Fr&&Nr(Vr,"name",{configurable:!0,get:function(){try{return Yr(Wr,Gr(this))[1]}catch(t){return""}}});var $r={},zr={},Hr={}.propertyIsEnumerable,Kr=Object.getOwnPropertyDescriptor,Xr=Kr&&!Hr.call({1:2},1);zr.f=Xr?function(t){var r=Kr(this,t);return!!r&&r.enumerable}:Hr;var Jr=function(t,r){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:r}},qr=x,Zr=qr({}.toString),Qr=qr("".slice),te=function(t){return Qr(Zr(t),8,-1)},re=w,ee=te,ne=Object,ie=x("".split),oe=re((function(){return!ne("z").propertyIsEnumerable(0)}))?function(t){return"String"==ee(t)?ie(t,""):ne(t)}:ne,ae=oe,ue=P,ce=function(t){return ae(ue(t))},se=b,fe=st,le=zr,he=Jr,ve=ce,ge=Or,pe=D,de=rt,ye=Object.getOwnPropertyDescriptor;$r.f=se?ye:function(t,r){if(t=ve(t),r=ge(r),de)try{return ye(t,r)}catch(t){}if(pe(t,r))return he(!fe(le.f,t,r),t[r])};var we=W,be=Jr,me=b?function(t,r,e){return we.f(t,r,be(1,e))}:function(t,r,e){return t[r]=e,t},Ee={exports:{}},Ae=z,Se=qt,Te=x(Function.toString);Ae(Se.inspectSource)||(Se.inspectSource=function(t){return Te(t)});var Oe,xe,Ie,ke=Se.inspectSource,Re=z,Pe=$.WeakMap,Ce=Re(Pe)&&/native code/.test(String(Pe)),Le=$t.exports,Ue=nr,je=Le("keys"),Me=function(t){return je[t]||(je[t]=Ue(t))},De={},Be=Ce,Fe=$,_e=x,Ne=X,Ve=me,Ge=D,We=qt,Ye=Me,$e=De,ze="Object already initialized",He=Fe.TypeError,Ke=Fe.WeakMap;if(Be||We.state){var Xe=We.state||(We.state=new Ke),Je=_e(Xe.get),qe=_e(Xe.has),Ze=_e(Xe.set);Oe=function(t,r){if(qe(Xe,t))throw He(ze);return r.facade=t,Ze(Xe,t,r),r},xe=function(t){return Je(Xe,t)||{}},Ie=function(t){return qe(Xe,t)}}else{var Qe=Ye("state");$e[Qe]=!0,Oe=function(t,r){if(Ge(t,Qe))throw He(ze);return r.facade=t,Ve(t,Qe,r),r},xe=function(t){return Ge(t,Qe)?t[Qe]:{}},Ie=function(t){return Ge(t,Qe)}}var tn={set:Oe,get:xe,has:Ie,enforce:function(t){return Ie(t)?xe(t):Oe(t,{})},getterFor:function(t){return function(r){var e;if(!Ne(r)||(e=xe(r)).type!==t)throw He("Incompatible receiver, "+t+" required");return e}}},rn=w,en=z,nn=D,on=b,an=G.CONFIGURABLE,un=ke,cn=tn.enforce,sn=tn.get,fn=Object.defineProperty,ln=on&&!rn((function(){return 8!==fn((function(){}),"length",{value:8}).length})),hn=String(String).split("String"),vn=Ee.exports=function(t,r,e){"Symbol("===String(r).slice(0,7)&&(r="["+String(r).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),e&&e.getter&&(r="get "+r),e&&e.setter&&(r="set "+r),(!nn(t,"name")||an&&t.name!==r)&&(on?fn(t,"name",{value:r,configurable:!0}):t.name=r),ln&&e&&nn(e,"arity")&&t.length!==e.arity&&fn(t,"length",{value:e.arity});try{e&&nn(e,"constructor")&&e.constructor?on&&fn(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var n=cn(t);return nn(n,"source")||(n.source=hn.join("string"==typeof r?r:"")),t};Function.prototype.toString=vn((function(){return en(this)&&sn(this).source||un(this)}),"toString");var gn=z,pn=W,dn=Ee.exports,yn=Kt,wn=function(t,r,e,n){n||(n={});var i=n.enumerable,o=void 0!==n.name?n.name:r;if(gn(e)&&dn(e,o,n),n.global)i?t[r]=e:yn(r,e);else{try{n.unsafe?t[r]&&(i=!0):delete t[r]}catch(t){}i?t[r]=e:pn.f(t,r,{value:e,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return t},bn={},mn=Math.ceil,En=Math.floor,An=Math.trunc||function(t){var r=+t;return(r>0?En:mn)(r)},Sn=function(t){var r=+t;return r!=r||0===r?0:An(r)},Tn=Sn,On=Math.max,xn=Math.min,In=function(t,r){var e=Tn(t);return e<0?On(e+r,0):xn(e,r)},kn=Sn,Rn=Math.min,Pn=function(t){return t>0?Rn(kn(t),9007199254740991):0},Cn=Pn,Ln=function(t){return Cn(t.length)},Un=ce,jn=In,Mn=Ln,Dn=function(t){return function(r,e,n){var i,o=Un(r),a=Mn(o),u=jn(n,a);if(t&&e!=e){for(;a>u;)if((i=o[u++])!=i)return!0}else for(;a>u;u++)if((t||u in o)&&o[u]===e)return t||u||0;return!t&&-1}},Bn={includes:Dn(!0),indexOf:Dn(!1)},Fn=D,_n=ce,Nn=Bn.indexOf,Vn=De,Gn=x([].push),Wn=function(t,r){var e,n=_n(t),i=0,o=[];for(e in n)!Fn(Vn,e)&&Fn(n,e)&&Gn(o,e);for(;r.length>i;)Fn(n,e=r[i++])&&(~Nn(o,e)||Gn(o,e));return o},Yn=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],$n=Wn,zn=Yn.concat("length","prototype");bn.f=Object.getOwnPropertyNames||function(t){return $n(t,zn)};var Hn={};Hn.f=Object.getOwnPropertySymbols;var Kn=vt,Xn=bn,Jn=Hn,qn=at,Zn=x([].concat),Qn=Kn("Reflect","ownKeys")||function(t){var r=Xn.f(qn(t)),e=Jn.f;return e?Zn(r,e(t)):r},ti=D,ri=Qn,ei=$r,ni=W,ii=function(t,r,e){for(var n=ri(r),i=ni.f,o=ei.f,a=0;a<n.length;a++){var u=n[a];ti(t,u)||e&&ti(e,u)||i(t,u,o(r,u))}},oi=w,ai=z,ui=/#|\.prototype\./,ci=function(t,r){var e=fi[si(t)];return e==hi||e!=li&&(ai(r)?oi(r):!!r)},si=ci.normalize=function(t){return String(t).replace(ui,".").toLowerCase()},fi=ci.data={},li=ci.NATIVE="N",hi=ci.POLYFILL="P",vi=ci,gi=$,pi=$r.f,di=me,yi=wn,wi=Kt,bi=ii,mi=vi,Ei=function(t,r){var e,n,i,o,a,u=t.target,c=t.global,s=t.stat;if(e=c?gi:s?gi[u]||wi(u,{}):(gi[u]||{}).prototype)for(n in r){if(o=r[n],i=t.dontCallGetSet?(a=pi(e,n))&&a.value:e[n],!mi(c?n:u+(s?".":"#")+n,t.forced)&&void 0!==i){if(typeof o==typeof i)continue;bi(o,i)}(t.sham||i&&i.sham)&&di(o,"sham",!0),yi(e,n,o,t)}},Ai={},Si=Wn,Ti=Yn,Oi=Object.keys||function(t){return Si(t,Ti)},xi=b,Ii=et,ki=W,Ri=at,Pi=ce,Ci=Oi;Ai.f=xi&&!Ii?Object.defineProperties:function(t,r){Ri(t);for(var e,n=Pi(r),i=Ci(r),o=i.length,a=0;o>a;)ki.f(t,e=i[a++],n[e]);return t};var Li=Ei,Ui=b,ji=Ai.f;Li({target:"Object",stat:!0,forced:Object.defineProperties!==ji,sham:!Ui},{defineProperties:ji});var Mi=te,Di=Array.isArray||function(t){return"Array"==Mi(t)};Ei({target:"Array",stat:!0},{isArray:Di});var Bi={};Bi[gr("toStringTag")]="z";var Fi,_i="[object z]"===String(Bi),Ni=_i,Vi=z,Gi=te,Wi=gr("toStringTag"),Yi=Object,$i="Arguments"==Gi(function(){return arguments}()),zi=Ni?Gi:function(t){var r,e,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(e=function(t,r){try{return t[r]}catch(t){}}(r=Yi(t),Wi))?e:$i?Gi(r):"Object"==(n=Gi(r))&&Vi(r.callee)?"Arguments":n},Hi=zi,Ki=String,Xi=function(t){if("Symbol"===Hi(t))throw TypeError("Cannot convert a Symbol value to a string");return Ki(t)},Ji=at,qi=function(){var t=Ji(this),r="";return t.hasIndices&&(r+="d"),t.global&&(r+="g"),t.ignoreCase&&(r+="i"),t.multiline&&(r+="m"),t.dotAll&&(r+="s"),t.unicode&&(r+="u"),t.unicodeSets&&(r+="v"),t.sticky&&(r+="y"),r},Zi=w,Qi=$.RegExp,to=Zi((function(){var t=Qi("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),ro=to||Zi((function(){return!Qi("a","y").sticky})),eo=to||Zi((function(){var t=Qi("^r","gy");return t.lastIndex=2,null!=t.exec("str")})),no={BROKEN_CARET:eo,MISSED_STICKY:ro,UNSUPPORTED_Y:to},io=vt("document","documentElement"),oo=at,ao=Ai,uo=Yn,co=De,so=io,fo=Q,lo=Me("IE_PROTO"),ho=function(){},vo=function(t){return"<script>"+t+"</"+"script>"},go=function(t){t.write(vo("")),t.close();var r=t.parentWindow.Object;return t=null,r},po=function(){try{Fi=new ActiveXObject("htmlfile")}catch(t){}var t,r;po="undefined"!=typeof document?document.domain&&Fi?go(Fi):((r=fo("iframe")).style.display="none",so.appendChild(r),r.src=String("javascript:"),(t=r.contentWindow.document).open(),t.write(vo("document.F=Object")),t.close(),t.F):go(Fi);for(var e=uo.length;e--;)delete po.prototype[uo[e]];return po()};co[lo]=!0;var yo=Object.create||function(t,r){var e;return null!==t?(ho.prototype=oo(t),e=new ho,ho.prototype=null,e[lo]=t):e=po(),void 0===r?e:ao.f(e,r)},wo=w,bo=$.RegExp,mo=wo((function(){var t=bo(".","s");return!(t.dotAll&&t.exec("\n")&&"s"===t.flags)})),Eo=w,Ao=$.RegExp,So=Eo((function(){var t=Ao("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")})),To=st,Oo=x,xo=Xi,Io=qi,ko=no,Ro=$t.exports,Po=yo,Co=tn.get,Lo=mo,Uo=So,jo=Ro("native-string-replace",String.prototype.replace),Mo=RegExp.prototype.exec,Do=Mo,Bo=Oo("".charAt),Fo=Oo("".indexOf),_o=Oo("".replace),No=Oo("".slice),Vo=function(){var t=/a/,r=/b*/g;return To(Mo,t,"a"),To(Mo,r,"a"),0!==t.lastIndex||0!==r.lastIndex}(),Go=ko.BROKEN_CARET,Wo=void 0!==/()??/.exec("")[1];(Vo||Wo||Go||Lo||Uo)&&(Do=function(t){var r,e,n,i,o,a,u,c=this,s=Co(c),f=xo(t),l=s.raw;if(l)return l.lastIndex=c.lastIndex,r=To(Do,l,f),c.lastIndex=l.lastIndex,r;var h=s.groups,v=Go&&c.sticky,g=To(Io,c),p=c.source,d=0,y=f;if(v&&(g=_o(g,"y",""),-1===Fo(g,"g")&&(g+="g"),y=No(f,c.lastIndex),c.lastIndex>0&&(!c.multiline||c.multiline&&"\n"!==Bo(f,c.lastIndex-1))&&(p="(?: "+p+")",y=" "+y,d++),e=new RegExp("^(?:"+p+")",g)),Wo&&(e=new RegExp("^"+p+"$(?!\\s)",g)),Vo&&(n=c.lastIndex),i=To(Mo,v?e:c,y),v?i?(i.input=No(i.input,d),i[0]=No(i[0],d),i.index=c.lastIndex,c.lastIndex+=i[0].length):c.lastIndex=0:Vo&&i&&(c.lastIndex=c.global?i.index+i[0].length:n),Wo&&i&&i.length>1&&To(jo,i[0],e,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(i[o]=void 0)})),i&&h)for(i.groups=a=Po(null),o=0;o<h.length;o++)a[(u=h[o])[0]]=i[u[1]];return i});var Yo=Do;Ei({target:"RegExp",proto:!0,forced:/./.exec!==Yo},{exec:Yo});var $o=m,zo=Function.prototype,Ho=zo.apply,Ko=zo.call,Xo="object"==typeof Reflect&&Reflect.apply||($o?Ko.bind(Ho):function(){return Ko.apply(Ho,arguments)}),Jo=x,qo=wn,Zo=Yo,Qo=w,ta=gr,ra=me,ea=ta("species"),na=RegExp.prototype,ia=function(t,r,e,n){var i=ta(t),o=!Qo((function(){var r={};return r[i]=function(){return 7},7!=""[t](r)})),a=o&&!Qo((function(){var r=!1,e=/a/;return"split"===t&&((e={}).constructor={},e.constructor[ea]=function(){return e},e.flags="",e[i]=/./[i]),e.exec=function(){return r=!0,null},e[i](""),!r}));if(!o||!a||e){var u=Jo(/./[i]),c=r(i,""[t],(function(t,r,e,n,i){var a=Jo(t),c=r.exec;return c===Zo||c===na.exec?o&&!i?{done:!0,value:u(r,e,n)}:{done:!0,value:a(e,r,n)}:{done:!1}}));qo(String.prototype,t,c[0]),qo(na,i,c[1])}n&&ra(na[i],"sham",!0)},oa=X,aa=te,ua=gr("match"),ca=function(t){var r;return oa(t)&&(void 0!==(r=t[ua])?!!r:"RegExp"==aa(t))},sa=x,fa=w,la=z,ha=zi,va=ke,ga=function(){},pa=[],da=vt("Reflect","construct"),ya=/^\s*(?:class|function)\b/,wa=sa(ya.exec),ba=!ya.exec(ga),ma=function(t){if(!la(t))return!1;try{return da(ga,pa,t),!0}catch(t){return!1}},Ea=function(t){if(!la(t))return!1;switch(ha(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return ba||!!wa(ya,va(t))}catch(t){return!0}};Ea.sham=!0;var Aa=!da||fa((function(){var t;return ma(ma.call)||!ma(Object)||!ma((function(){t=!0}))||t}))?Ea:ma,Sa=Aa,Ta=Ut,Oa=TypeError,xa=function(t){if(Sa(t))return t;throw Oa(Ta(t)+" is not a constructor")},Ia=at,ka=xa,Ra=I,Pa=gr("species"),Ca=function(t,r){var e,n=Ia(t).constructor;return void 0===n||Ra(e=Ia(n)[Pa])?r:ka(e)},La=x,Ua=Sn,ja=Xi,Ma=P,Da=La("".charAt),Ba=La("".charCodeAt),Fa=La("".slice),_a=function(t){return function(r,e){var n,i,o=ja(Ma(r)),a=Ua(e),u=o.length;return a<0||a>=u?t?"":void 0:(n=Ba(o,a))<55296||n>56319||a+1===u||(i=Ba(o,a+1))<56320||i>57343?t?Da(o,a):n:t?Fa(o,a,a+2):i-56320+(n-55296<<10)+65536}},Na={codeAt:_a(!1),charAt:_a(!0)}.charAt,Va=function(t,r,e){return r+(e?Na(t,r).length:1)},Ga=Or,Wa=W,Ya=Jr,$a=function(t,r,e){var n=Ga(r);n in t?Wa.f(t,n,Ya(0,e)):t[n]=e},za=In,Ha=Ln,Ka=$a,Xa=Array,Ja=Math.max,qa=function(t,r,e){for(var n=Ha(t),i=za(r,n),o=za(void 0===e?n:e,n),a=Xa(Ja(o-i,0)),u=0;i<o;i++,u++)Ka(a,u,t[i]);return a.length=u,a},Za=st,Qa=at,tu=z,ru=te,eu=Yo,nu=TypeError,iu=function(t,r){var e=t.exec;if(tu(e)){var n=Za(e,t,r);return null!==n&&Qa(n),n}if("RegExp"===ru(t))return Za(eu,t,r);throw nu("RegExp#exec called on incompatible receiver")},ou=Xo,au=st,uu=x,cu=ia,su=at,fu=I,lu=ca,hu=P,vu=Ca,gu=Va,pu=Pn,du=Xi,yu=Nt,wu=qa,bu=iu,mu=Yo,Eu=w,Au=no.UNSUPPORTED_Y,Su=4294967295,Tu=Math.min,Ou=[].push,xu=uu(/./.exec),Iu=uu(Ou),ku=uu("".slice),Ru=!Eu((function(){var t=/(?:)/,r=t.exec;t.exec=function(){return r.apply(this,arguments)};var e="ab".split(t);return 2!==e.length||"a"!==e[0]||"b"!==e[1]}));cu("split",(function(t,r,e){var n;return n="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(t,e){var n=du(hu(this)),i=void 0===e?Su:e>>>0;if(0===i)return[];if(void 0===t)return[n];if(!lu(t))return au(r,n,t,i);for(var o,a,u,c=[],s=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),f=0,l=new RegExp(t.source,s+"g");(o=au(mu,l,n))&&!((a=l.lastIndex)>f&&(Iu(c,ku(n,f,o.index)),o.length>1&&o.index<n.length&&ou(Ou,c,wu(o,1)),u=o[0].length,f=a,c.length>=i));)l.lastIndex===o.index&&l.lastIndex++;return f===n.length?!u&&xu(l,"")||Iu(c,""):Iu(c,ku(n,f)),c.length>i?wu(c,0,i):c}:"0".split(void 0,0).length?function(t,e){return void 0===t&&0===e?[]:au(r,this,t,e)}:r,[function(r,e){var i=hu(this),o=fu(r)?void 0:yu(r,t);return o?au(o,r,i,e):au(n,du(i),r,e)},function(t,i){var o=su(this),a=du(t),u=e(n,o,a,i,n!==r);if(u.done)return u.value;var c=vu(o,RegExp),s=o.unicode,f=(o.ignoreCase?"i":"")+(o.multiline?"m":"")+(o.unicode?"u":"")+(Au?"g":"y"),l=new c(Au?"^(?:"+o.source+")":o,f),h=void 0===i?Su:i>>>0;if(0===h)return[];if(0===a.length)return null===bu(l,a)?[a]:[];for(var v=0,g=0,p=[];g<a.length;){l.lastIndex=Au?0:g;var d,y=bu(l,Au?ku(a,g):a);if(null===y||(d=Tu(pu(l.lastIndex+(Au?g:0)),a.length))===v)g=gu(a,g,s);else{if(Iu(p,ku(a,v,g)),p.length===h)return p;for(var w=1;w<=y.length-1;w++)if(Iu(p,y[w]),p.length===h)return p;g=v=d}}return Iu(p,ku(a,v)),p}]}),!Ru,Au);var Pu=gr,Cu=yo,Lu=W.f,Uu=Pu("unscopables"),ju=Array.prototype;null==ju[Uu]&&Lu(ju,Uu,{configurable:!0,value:Cu(null)});var Mu,Du,Bu,Fu=function(t){ju[Uu][t]=!0},_u={},Nu=!w((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),Vu=D,Gu=z,Wu=U,Yu=Nu,$u=Me("IE_PROTO"),zu=Object,Hu=zu.prototype,Ku=Yu?zu.getPrototypeOf:function(t){var r=Wu(t);if(Vu(r,$u))return r[$u];var e=r.constructor;return Gu(e)&&r instanceof e?e.prototype:r instanceof zu?Hu:null},Xu=w,Ju=z,qu=X,Zu=Ku,Qu=wn,tc=gr("iterator"),rc=!1;[].keys&&("next"in(Bu=[].keys())?(Du=Zu(Zu(Bu)))!==Object.prototype&&(Mu=Du):rc=!0);var ec=!qu(Mu)||Xu((function(){var t={};return Mu[tc].call(t)!==t}));ec&&(Mu={}),Ju(Mu[tc])||Qu(Mu,tc,(function(){return this}));var nc={IteratorPrototype:Mu,BUGGY_SAFARI_ITERATORS:rc},ic=W.f,oc=D,ac=gr("toStringTag"),uc=function(t,r,e){t&&!e&&(t=t.prototype),t&&!oc(t,ac)&&ic(t,ac,{configurable:!0,value:r})},cc=nc.IteratorPrototype,sc=yo,fc=Jr,lc=uc,hc=_u,vc=function(){return this},gc=z,pc=String,dc=TypeError,yc=x,wc=at,bc=function(t){if("object"==typeof t||gc(t))return t;throw dc("Can't set "+pc(t)+" as a prototype")},mc=Object.setPrototypeOf||("__proto__"in{}?function(){var t,r=!1,e={};try{(t=yc(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(e,[]),r=e instanceof Array}catch(t){}return function(e,n){return wc(e),bc(n),r?t(e,n):e.__proto__=n,e}}():void 0),Ec=Ei,Ac=st,Sc=z,Tc=function(t,r,e,n){var i=r+" Iterator";return t.prototype=sc(cc,{next:fc(+!n,e)}),lc(t,i,!1),hc[i]=vc,t},Oc=Ku,xc=mc,Ic=uc,kc=me,Rc=wn,Pc=_u,Cc=G.PROPER,Lc=G.CONFIGURABLE,Uc=nc.IteratorPrototype,jc=nc.BUGGY_SAFARI_ITERATORS,Mc=gr("iterator"),Dc="keys",Bc="values",Fc="entries",_c=function(){return this},Nc=ce,Vc=Fu,Gc=_u,Wc=tn,Yc=W.f,$c=function(t,r,e,n,i,o,a){Tc(e,r,n);var u,c,s,f=function(t){if(t===i&&p)return p;if(!jc&&t in v)return v[t];switch(t){case Dc:case Bc:case Fc:return function(){return new e(this,t)}}return function(){return new e(this)}},l=r+" Iterator",h=!1,v=t.prototype,g=v[Mc]||v["@@iterator"]||i&&v[i],p=!jc&&g||f(i),d="Array"==r&&v.entries||g;if(d&&(u=Oc(d.call(new t)))!==Object.prototype&&u.next&&(Oc(u)!==Uc&&(xc?xc(u,Uc):Sc(u[Mc])||Rc(u,Mc,_c)),Ic(u,l,!0)),Cc&&i==Bc&&g&&g.name!==Bc&&(Lc?kc(v,"name",Bc):(h=!0,p=function(){return Ac(g,this)})),i)if(c={values:f(Bc),keys:o?p:f(Dc),entries:f(Fc)},a)for(s in c)(jc||h||!(s in v))&&Rc(v,s,c[s]);else Ec({target:r,proto:!0,forced:jc||h},c);return v[Mc]!==p&&Rc(v,Mc,p,{name:i}),Pc[r]=p,c},zc=function(t,r){return{value:t,done:r}},Hc=b,Kc="Array Iterator",Xc=Wc.set,Jc=Wc.getterFor(Kc),qc=$c(Array,"Array",(function(t,r){Xc(this,{type:Kc,target:Nc(t),index:0,kind:r})}),(function(){var t=Jc(this),r=t.target,e=t.kind,n=t.index++;return!r||n>=r.length?(t.target=void 0,zc(void 0,!0)):zc("keys"==e?n:"values"==e?r[n]:[n,r[n]],!1)}),"values"),Zc=Gc.Arguments=Gc.Array;if(Vc("keys"),Vc("values"),Vc("entries"),Hc&&"values"!==Zc.name)try{Yc(Zc,"name",{value:"values"})}catch(t){}var Qc="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,ts=wn,rs=gt,es=TypeError,ns=function(t,r){if(rs(r,t))return t;throw es("Incorrect invocation")},is=Sn,os=Pn,as=RangeError,us=function(t){if(void 0===t)return 0;var r=is(t),e=os(r);if(r!==e)throw as("Wrong length or index");return e},cs=Array,ss=Math.abs,fs=Math.pow,ls=Math.floor,hs=Math.log,vs=Math.LN2,gs={pack:function(t,r,e){var n,i,o,a=cs(e),u=8*e-r-1,c=(1<<u)-1,s=c>>1,f=23===r?fs(2,-24)-fs(2,-77):0,l=t<0||0===t&&1/t<0?1:0,h=0;for((t=ss(t))!=t||t===1/0?(i=t!=t?1:0,n=c):(n=ls(hs(t)/vs),t*(o=fs(2,-n))<1&&(n--,o*=2),(t+=n+s>=1?f/o:f*fs(2,1-s))*o>=2&&(n++,o/=2),n+s>=c?(i=0,n=c):n+s>=1?(i=(t*o-1)*fs(2,r),n+=s):(i=t*fs(2,s-1)*fs(2,r),n=0));r>=8;)a[h++]=255&i,i/=256,r-=8;for(n=n<<r|i,u+=r;u>0;)a[h++]=255&n,n/=256,u-=8;return a[--h]|=128*l,a},unpack:function(t,r){var e,n=t.length,i=8*n-r-1,o=(1<<i)-1,a=o>>1,u=i-7,c=n-1,s=t[c--],f=127&s;for(s>>=7;u>0;)f=256*f+t[c--],u-=8;for(e=f&(1<<-u)-1,f>>=-u,u+=r;u>0;)e=256*e+t[c--],u-=8;if(0===f)f=1-a;else{if(f===o)return e?NaN:s?-1/0:1/0;e+=fs(2,r),f-=a}return(s?-1:1)*e*fs(2,f-r)}},ps=U,ds=In,ys=Ln,ws=function(t){for(var r=ps(this),e=ys(r),n=arguments.length,i=ds(n>1?arguments[1]:void 0,e),o=n>2?arguments[2]:void 0,a=void 0===o?e:ds(o,e);a>i;)r[i++]=t;return r},bs=$,ms=x,Es=b,As=Qc,Ss=G,Ts=me,Os=function(t,r,e){for(var n in r)ts(t,n,r[n],e);return t},xs=w,Is=ns,ks=Sn,Rs=Pn,Ps=us,Cs=gs,Ls=Ku,Us=mc,js=bn.f,Ms=W.f,Ds=ws,Bs=qa,Fs=uc,_s=Ss.PROPER,Ns=Ss.CONFIGURABLE,Vs=tn.get,Gs=tn.set,Ws="ArrayBuffer",Ys="DataView",$s="Wrong index",zs=bs.ArrayBuffer,Hs=zs,Ks=Hs&&Hs.prototype,Xs=bs.DataView,Js=Xs&&Xs.prototype,qs=Object.prototype,Zs=bs.Array,Qs=bs.RangeError,tf=ms(Ds),rf=ms([].reverse),ef=Cs.pack,nf=Cs.unpack,of=function(t){return[255&t]},af=function(t){return[255&t,t>>8&255]},uf=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},cf=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},sf=function(t){return ef(t,23,4)},ff=function(t){return ef(t,52,8)},lf=function(t,r){Ms(t.prototype,r,{get:function(){return Vs(this)[r]}})},hf=function(t,r,e,n){var i=Ps(e),o=Vs(t);if(i+r>o.byteLength)throw Qs($s);var a=Vs(o.buffer).bytes,u=i+o.byteOffset,c=Bs(a,u,u+r);return n?c:rf(c)},vf=function(t,r,e,n,i,o){var a=Ps(e),u=Vs(t);if(a+r>u.byteLength)throw Qs($s);for(var c=Vs(u.buffer).bytes,s=a+u.byteOffset,f=n(+i),l=0;l<r;l++)c[s+l]=f[o?l:r-l-1]};if(As){var gf=_s&&zs.name!==Ws;if(xs((function(){zs(1)}))&&xs((function(){new zs(-1)}))&&!xs((function(){return new zs,new zs(1.5),new zs(NaN),1!=zs.length||gf&&!Ns})))gf&&Ns&&Ts(zs,"name",Ws);else{(Hs=function(t){return Is(this,Ks),new zs(Ps(t))}).prototype=Ks;for(var pf,df=js(zs),yf=0;df.length>yf;)(pf=df[yf++])in Hs||Ts(Hs,pf,zs[pf]);Ks.constructor=Hs}Us&&Ls(Js)!==qs&&Us(Js,qs);var wf=new Xs(new Hs(2)),bf=ms(Js.setInt8);wf.setInt8(0,2147483648),wf.setInt8(1,2147483649),!wf.getInt8(0)&&wf.getInt8(1)||Os(Js,{setInt8:function(t,r){bf(this,t,r<<24>>24)},setUint8:function(t,r){bf(this,t,r<<24>>24)}},{unsafe:!0})}else Ks=(Hs=function(t){Is(this,Ks);var r=Ps(t);Gs(this,{bytes:tf(Zs(r),0),byteLength:r}),Es||(this.byteLength=r)}).prototype,Js=(Xs=function(t,r,e){Is(this,Js),Is(t,Ks);var n=Vs(t).byteLength,i=ks(r);if(i<0||i>n)throw Qs("Wrong offset");if(i+(e=void 0===e?n-i:Rs(e))>n)throw Qs("Wrong length");Gs(this,{buffer:t,byteLength:e,byteOffset:i}),Es||(this.buffer=t,this.byteLength=e,this.byteOffset=i)}).prototype,Es&&(lf(Hs,"byteLength"),lf(Xs,"buffer"),lf(Xs,"byteLength"),lf(Xs,"byteOffset")),Os(Js,{getInt8:function(t){return hf(this,1,t)[0]<<24>>24},getUint8:function(t){return hf(this,1,t)[0]},getInt16:function(t){var r=hf(this,2,t,arguments.length>1?arguments[1]:void 0);return(r[1]<<8|r[0])<<16>>16},getUint16:function(t){var r=hf(this,2,t,arguments.length>1?arguments[1]:void 0);return r[1]<<8|r[0]},getInt32:function(t){return cf(hf(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function(t){return cf(hf(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(t){return nf(hf(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(t){return nf(hf(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(t,r){vf(this,1,t,of,r)},setUint8:function(t,r){vf(this,1,t,of,r)},setInt16:function(t,r){vf(this,2,t,af,r,arguments.length>2?arguments[2]:void 0)},setUint16:function(t,r){vf(this,2,t,af,r,arguments.length>2?arguments[2]:void 0)},setInt32:function(t,r){vf(this,4,t,uf,r,arguments.length>2?arguments[2]:void 0)},setUint32:function(t,r){vf(this,4,t,uf,r,arguments.length>2?arguments[2]:void 0)},setFloat32:function(t,r){vf(this,4,t,sf,r,arguments.length>2?arguments[2]:void 0)},setFloat64:function(t,r){vf(this,8,t,ff,r,arguments.length>2?arguments[2]:void 0)}});Fs(Hs,Ws),Fs(Xs,Ys);var mf={ArrayBuffer:Hs,DataView:Xs},Ef=Ei,Af=x,Sf=w,Tf=at,Of=In,xf=Pn,If=Ca,kf=mf.ArrayBuffer,Rf=mf.DataView,Pf=Rf.prototype,Cf=Af(kf.prototype.slice),Lf=Af(Pf.getUint8),Uf=Af(Pf.setUint8);Ef({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:Sf((function(){return!new kf(2).slice(1,void 0).byteLength}))},{slice:function(t,r){if(Cf&&void 0===r)return Cf(Tf(this),t);for(var e=Tf(this).byteLength,n=Of(t,e),i=Of(void 0===r?e:r,e),o=new(If(this,kf))(xf(i-n)),a=new Rf(this),u=new Rf(o),c=0;n<i;)Uf(u,c++,Lf(a,n++));return o}});var jf=zi,Mf=_i?{}.toString:function(){return"[object "+jf(this)+"]"};_i||wn(Object.prototype,"toString",Mf,{unsafe:!0});var Df={exports:{}},Bf=gr("iterator"),Ff=!1;try{var _f=0,Nf={next:function(){return{done:!!_f++}},return:function(){Ff=!0}};Nf[Bf]=function(){return this},Array.from(Nf,(function(){throw 2}))}catch(t){}var Vf,Gf,Wf,Yf=Qc,$f=b,zf=$,Hf=z,Kf=X,Xf=D,Jf=zi,qf=Ut,Zf=me,Qf=wn,tl=W.f,rl=gt,el=Ku,nl=mc,il=gr,ol=nr,al=tn.enforce,ul=tn.get,cl=zf.Int8Array,sl=cl&&cl.prototype,fl=zf.Uint8ClampedArray,ll=fl&&fl.prototype,hl=cl&&el(cl),vl=sl&&el(sl),gl=Object.prototype,pl=zf.TypeError,dl=il("toStringTag"),yl=ol("TYPED_ARRAY_TAG"),wl="TypedArrayConstructor",bl=Yf&&!!nl&&"Opera"!==Jf(zf.opera),ml=!1,El={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Al={BigInt64Array:8,BigUint64Array:8},Sl=function(t){var r=el(t);if(Kf(r)){var e=ul(r);return e&&Xf(e,wl)?e.TypedArrayConstructor:Sl(r)}},Tl=function(t){if(!Kf(t))return!1;var r=Jf(t);return Xf(El,r)||Xf(Al,r)};for(Vf in El)(Wf=(Gf=zf[Vf])&&Gf.prototype)?al(Wf).TypedArrayConstructor=Gf:bl=!1;for(Vf in Al)(Wf=(Gf=zf[Vf])&&Gf.prototype)&&(al(Wf).TypedArrayConstructor=Gf);if((!bl||!Hf(hl)||hl===Function.prototype)&&(hl=function(){throw pl("Incorrect invocation")},bl))for(Vf in El)zf[Vf]&&nl(zf[Vf],hl);if((!bl||!vl||vl===gl)&&(vl=hl.prototype,bl))for(Vf in El)zf[Vf]&&nl(zf[Vf].prototype,vl);if(bl&&el(ll)!==vl&&nl(ll,vl),$f&&!Xf(vl,dl))for(Vf in ml=!0,tl(vl,dl,{get:function(){return Kf(this)?this[yl]:void 0}}),El)zf[Vf]&&Zf(zf[Vf],yl,Vf);var Ol={NATIVE_ARRAY_BUFFER_VIEWS:bl,TYPED_ARRAY_TAG:ml&&yl,aTypedArray:function(t){if(Tl(t))return t;throw pl("Target is not a typed array")},aTypedArrayConstructor:function(t){if(Hf(t)&&(!nl||rl(hl,t)))return t;throw pl(qf(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,r,e,n){if($f){if(e)for(var i in El){var o=zf[i];if(o&&Xf(o.prototype,t))try{delete o.prototype[t]}catch(e){try{o.prototype[t]=r}catch(t){}}}vl[t]&&!e||Qf(vl,t,e?r:bl&&sl[t]||r,n)}},exportTypedArrayStaticMethod:function(t,r,e){var n,i;if($f){if(nl){if(e)for(n in El)if((i=zf[n])&&Xf(i,t))try{delete i[t]}catch(t){}if(hl[t]&&!e)return;try{return Qf(hl,t,e?r:bl&&hl[t]||r)}catch(t){}}for(n in El)!(i=zf[n])||i[t]&&!e||Qf(i,t,r)}},getTypedArrayConstructor:Sl,isView:function(t){if(!Kf(t))return!1;var r=Jf(t);return"DataView"===r||Xf(El,r)||Xf(Al,r)},isTypedArray:Tl,TypedArray:hl,TypedArrayPrototype:vl},xl=$,Il=w,kl=function(t,r){if(!r&&!Ff)return!1;var e=!1;try{var n={};n[Bf]=function(){return{next:function(){return{done:e=!0}}}},t(n)}catch(t){}return e},Rl=Ol.NATIVE_ARRAY_BUFFER_VIEWS,Pl=xl.ArrayBuffer,Cl=xl.Int8Array,Ll=!Rl||!Il((function(){Cl(1)}))||!Il((function(){new Cl(-1)}))||!kl((function(t){new Cl,new Cl(null),new Cl(1.5),new Cl(t)}),!0)||Il((function(){return 1!==new Cl(new Pl(2),1,void 0).length})),Ul=X,jl=Math.floor,Ml=Number.isInteger||function(t){return!Ul(t)&&isFinite(t)&&jl(t)===t},Dl=Sn,Bl=RangeError,Fl=function(t){var r=Dl(t);if(r<0)throw Bl("The argument can't be less than 0");return r},_l=RangeError,Nl=function(t,r){var e=Fl(t);if(e%r)throw _l("Wrong offset");return e},Vl=Bt,Gl=m,Wl=x(x.bind),Yl=function(t,r){return Vl(t),void 0===r?t:Gl?Wl(t,r):function(){return t.apply(r,arguments)}},$l=zi,zl=Nt,Hl=I,Kl=_u,Xl=gr("iterator"),Jl=function(t){if(!Hl(t))return zl(t,Xl)||zl(t,"@@iterator")||Kl[$l(t)]},ql=st,Zl=Bt,Ql=at,th=Ut,rh=Jl,eh=TypeError,nh=_u,ih=gr("iterator"),oh=Array.prototype,ah=zi,uh=x("".slice),ch=Ar,sh=TypeError,fh=function(t){var r=ch(t,"number");if("number"==typeof r)throw sh("Can't convert number to bigint");return BigInt(r)},lh=Yl,hh=st,vh=xa,gh=U,ph=Ln,dh=function(t,r){var e=arguments.length<2?rh(t):r;if(Zl(e))return Ql(ql(e,t));throw eh(th(t)+" is not iterable")},yh=Jl,wh=function(t){return void 0!==t&&(nh.Array===t||oh[ih]===t)},bh=function(t){return"Big"===uh(ah(t),0,3)},mh=Ol.aTypedArrayConstructor,Eh=fh,Ah=Di,Sh=Aa,Th=X,Oh=gr("species"),xh=Array,Ih=function(t){var r;return Ah(t)&&(r=t.constructor,(Sh(r)&&(r===xh||Ah(r.prototype))||Th(r)&&null===(r=r[Oh]))&&(r=void 0)),void 0===r?xh:r},kh=function(t,r){return new(Ih(t))(0===r?0:r)},Rh=Yl,Ph=oe,Ch=U,Lh=Ln,Uh=kh,jh=x([].push),Mh=function(t){var r=1==t,e=2==t,n=3==t,i=4==t,o=6==t,a=7==t,u=5==t||o;return function(c,s,f,l){for(var h,v,g=Ch(c),p=Ph(g),d=Rh(s,f),y=Lh(p),w=0,b=l||Uh,m=r?b(c,y):e||a?b(c,0):void 0;y>w;w++)if((u||w in p)&&(v=d(h=p[w],w,g),t))if(r)m[w]=v;else if(v)switch(t){case 3:return!0;case 5:return h;case 6:return w;case 2:jh(m,h)}else switch(t){case 4:return!1;case 7:jh(m,h)}return o?-1:n||i?i:m}},Dh={forEach:Mh(0),map:Mh(1),filter:Mh(2),some:Mh(3),every:Mh(4),find:Mh(5),findIndex:Mh(6),filterReject:Mh(7)},Bh=vt,Fh=W,_h=b,Nh=gr("species"),Vh=function(t){var r=Bh(t),e=Fh.f;_h&&r&&!r[Nh]&&e(r,Nh,{configurable:!0,get:function(){return this}})},Gh=z,Wh=X,Yh=mc,$h=function(t,r,e){var n,i;return Yh&&Gh(n=r.constructor)&&n!==e&&Wh(i=n.prototype)&&i!==e.prototype&&Yh(t,i),t},zh=Ei,Hh=$,Kh=st,Xh=b,Jh=Ll,qh=Ol,Zh=mf,Qh=ns,tv=Jr,rv=me,ev=Ml,nv=Pn,iv=us,ov=Nl,av=Or,uv=D,cv=zi,sv=X,fv=Ct,lv=yo,hv=gt,vv=mc,gv=bn.f,pv=function(t){var r,e,n,i,o,a,u,c,s=vh(this),f=gh(t),l=arguments.length,h=l>1?arguments[1]:void 0,v=void 0!==h,g=yh(f);if(g&&!wh(g))for(c=(u=dh(f,g)).next,f=[];!(a=hh(c,u)).done;)f.push(a.value);for(v&&l>2&&(h=lh(h,arguments[2])),e=ph(f),n=new(mh(s))(e),i=bh(n),r=0;e>r;r++)o=v?h(f[r],r):f[r],n[r]=i?Eh(o):+o;return n},dv=Dh.forEach,yv=Vh,wv=W,bv=$r,mv=$h,Ev=tn.get,Av=tn.set,Sv=tn.enforce,Tv=wv.f,Ov=bv.f,xv=Math.round,Iv=Hh.RangeError,kv=Zh.ArrayBuffer,Rv=kv.prototype,Pv=Zh.DataView,Cv=qh.NATIVE_ARRAY_BUFFER_VIEWS,Lv=qh.TYPED_ARRAY_TAG,Uv=qh.TypedArray,jv=qh.TypedArrayPrototype,Mv=qh.aTypedArrayConstructor,Dv=qh.isTypedArray,Bv="BYTES_PER_ELEMENT",Fv="Wrong length",_v=function(t,r){Mv(t);for(var e=0,n=r.length,i=new t(n);n>e;)i[e]=r[e++];return i},Nv=function(t,r){Tv(t,r,{get:function(){return Ev(this)[r]}})},Vv=function(t){var r;return hv(Rv,t)||"ArrayBuffer"==(r=cv(t))||"SharedArrayBuffer"==r},Gv=function(t,r){return Dv(t)&&!fv(r)&&r in t&&ev(+r)&&r>=0},Wv=function(t,r){return r=av(r),Gv(t,r)?tv(2,t[r]):Ov(t,r)},Yv=function(t,r,e){return r=av(r),!(Gv(t,r)&&sv(e)&&uv(e,"value"))||uv(e,"get")||uv(e,"set")||e.configurable||uv(e,"writable")&&!e.writable||uv(e,"enumerable")&&!e.enumerable?Tv(t,r,e):(t[r]=e.value,t)};Xh?(Cv||(bv.f=Wv,wv.f=Yv,Nv(jv,"buffer"),Nv(jv,"byteOffset"),Nv(jv,"byteLength"),Nv(jv,"length")),zh({target:"Object",stat:!0,forced:!Cv},{getOwnPropertyDescriptor:Wv,defineProperty:Yv}),Df.exports=function(t,r,e){var n=t.match(/\d+$/)[0]/8,i=t+(e?"Clamped":"")+"Array",o="get"+t,a="set"+t,u=Hh[i],c=u,s=c&&c.prototype,f={},l=function(t,r){Tv(t,r,{get:function(){return function(t,r){var e=Ev(t);return e.view[o](r*n+e.byteOffset,!0)}(this,r)},set:function(t){return function(t,r,i){var o=Ev(t);e&&(i=(i=xv(i))<0?0:i>255?255:255&i),o.view[a](r*n+o.byteOffset,i,!0)}(this,r,t)},enumerable:!0})};Cv?Jh&&(c=r((function(t,r,e,i){return Qh(t,s),mv(sv(r)?Vv(r)?void 0!==i?new u(r,ov(e,n),i):void 0!==e?new u(r,ov(e,n)):new u(r):Dv(r)?_v(c,r):Kh(pv,c,r):new u(iv(r)),t,c)})),vv&&vv(c,Uv),dv(gv(u),(function(t){t in c||rv(c,t,u[t])})),c.prototype=s):(c=r((function(t,r,e,i){Qh(t,s);var o,a,u,f=0,h=0;if(sv(r)){if(!Vv(r))return Dv(r)?_v(c,r):Kh(pv,c,r);o=r,h=ov(e,n);var v=r.byteLength;if(void 0===i){if(v%n)throw Iv(Fv);if((a=v-h)<0)throw Iv(Fv)}else if((a=nv(i)*n)+h>v)throw Iv(Fv);u=a/n}else u=iv(r),o=new kv(a=u*n);for(Av(t,{buffer:o,byteOffset:h,byteLength:a,length:u,view:new Pv(o)});f<u;)l(t,f++)})),vv&&vv(c,Uv),s=c.prototype=lv(jv)),s.constructor!==c&&rv(s,"constructor",c),Sv(s).TypedArrayConstructor=c,Lv&&rv(s,Lv,i);var h=c!=u;f[i]=c,zh({global:!0,constructor:!0,forced:h,sham:!Cv},f),Bv in c||rv(c,Bv,n),Bv in s||rv(s,Bv,n),yv(i)}):Df.exports=function(){},(0,Df.exports)("Uint8",(function(t){return function(r,e,n){return t(this,r,e,n)}}));var $v=Ut,zv=TypeError,Hv=U,Kv=In,Xv=Ln,Jv=function(t,r){if(!delete t[r])throw zv("Cannot delete property "+$v(r)+" of "+$v(t))},qv=Math.min,Zv=[].copyWithin||function(t,r){var e=Hv(this),n=Xv(e),i=Kv(t,n),o=Kv(r,n),a=arguments.length>2?arguments[2]:void 0,u=qv((void 0===a?n:Kv(a,n))-o,n-i),c=1;for(o<i&&i<o+u&&(c=-1,o+=u-1,i+=u-1);u-->0;)o in e?e[i]=e[o]:Jv(e,i),i+=c,o+=c;return e},Qv=Ol,tg=x(Zv),rg=Qv.aTypedArray;(0,Qv.exportTypedArrayMethod)("copyWithin",(function(t,r){return tg(rg(this),t,r,arguments.length>2?arguments[2]:void 0)}));var eg=Dh.every,ng=Ol.aTypedArray;(0,Ol.exportTypedArrayMethod)("every",(function(t){return eg(ng(this),t,arguments.length>1?arguments[1]:void 0)}));var ig=ws,og=fh,ag=zi,ug=st,cg=w,sg=Ol.aTypedArray,fg=Ol.exportTypedArrayMethod,lg=x("".slice);fg("fill",(function(t){var r=arguments.length;sg(this);var e="Big"===lg(ag(this),0,3)?og(t):+t;return ug(ig,this,e,r>1?arguments[1]:void 0,r>2?arguments[2]:void 0)}),cg((function(){var t=0;return new Int8Array(2).fill({valueOf:function(){return t++}}),1!==t})));var hg=Ln,vg=Ca,gg=Ol.aTypedArrayConstructor,pg=Ol.getTypedArrayConstructor,dg=function(t){return gg(vg(t,pg(t)))},yg=function(t,r){for(var e=0,n=hg(r),i=new t(n);n>e;)i[e]=r[e++];return i},wg=dg,bg=Dh.filter,mg=function(t,r){return yg(wg(t),r)},Eg=Ol.aTypedArray;(0,Ol.exportTypedArrayMethod)("filter",(function(t){var r=bg(Eg(this),t,arguments.length>1?arguments[1]:void 0);return mg(this,r)}));var Ag=Dh.find,Sg=Ol.aTypedArray;(0,Ol.exportTypedArrayMethod)("find",(function(t){return Ag(Sg(this),t,arguments.length>1?arguments[1]:void 0)}));var Tg=Dh.findIndex,Og=Ol.aTypedArray;(0,Ol.exportTypedArrayMethod)("findIndex",(function(t){return Tg(Og(this),t,arguments.length>1?arguments[1]:void 0)}));var xg=Dh.forEach,Ig=Ol.aTypedArray;(0,Ol.exportTypedArrayMethod)("forEach",(function(t){xg(Ig(this),t,arguments.length>1?arguments[1]:void 0)}));var kg=Bn.includes,Rg=Ol.aTypedArray;(0,Ol.exportTypedArrayMethod)("includes",(function(t){return kg(Rg(this),t,arguments.length>1?arguments[1]:void 0)}));var Pg=Bn.indexOf,Cg=Ol.aTypedArray;(0,Ol.exportTypedArrayMethod)("indexOf",(function(t){return Pg(Cg(this),t,arguments.length>1?arguments[1]:void 0)}));var Lg=$,Ug=w,jg=x,Mg=Ol,Dg=qc,Bg=gr("iterator"),Fg=Lg.Uint8Array,_g=jg(Dg.values),Ng=jg(Dg.keys),Vg=jg(Dg.entries),Gg=Mg.aTypedArray,Wg=Mg.exportTypedArrayMethod,Yg=Fg&&Fg.prototype,$g=!Ug((function(){Yg[Bg].call([1])})),zg=!!Yg&&Yg.values&&Yg[Bg]===Yg.values&&"values"===Yg.values.name,Hg=function(){return _g(Gg(this))};Wg("entries",(function(){return Vg(Gg(this))}),$g),Wg("keys",(function(){return Ng(Gg(this))}),$g),Wg("values",Hg,$g||!zg,{name:"values"}),Wg(Bg,Hg,$g||!zg,{name:"values"});var Kg=Ol.aTypedArray,Xg=Ol.exportTypedArrayMethod,Jg=x([].join);Xg("join",(function(t){return Jg(Kg(this),t)}));var qg=w,Zg=function(t,r){var e=[][t];return!!e&&qg((function(){e.call(null,r||function(){return 1},1)}))},Qg=Xo,tp=ce,rp=Sn,ep=Ln,np=Zg,ip=Math.min,op=[].lastIndexOf,ap=!!op&&1/[1].lastIndexOf(1,-0)<0,up=np("lastIndexOf"),cp=ap||!up?function(t){if(ap)return Qg(op,this,arguments)||0;var r=tp(this),e=ep(r),n=e-1;for(arguments.length>1&&(n=ip(n,rp(arguments[1]))),n<0&&(n=e+n);n>=0;n--)if(n in r&&r[n]===t)return n||0;return-1}:op,sp=Xo,fp=cp,lp=Ol.aTypedArray;(0,Ol.exportTypedArrayMethod)("lastIndexOf",(function(t){var r=arguments.length;return sp(fp,lp(this),r>1?[t,arguments[1]]:[t])}));var hp=Dh.map,vp=dg,gp=Ol.aTypedArray;(0,Ol.exportTypedArrayMethod)("map",(function(t){return hp(gp(this),t,arguments.length>1?arguments[1]:void 0,(function(t,r){return new(vp(t))(r)}))}));var pp=Bt,dp=U,yp=oe,wp=Ln,bp=TypeError,mp=function(t){return function(r,e,n,i){pp(e);var o=dp(r),a=yp(o),u=wp(o),c=t?u-1:0,s=t?-1:1;if(n<2)for(;;){if(c in a){i=a[c],c+=s;break}if(c+=s,t?c<0:u<=c)throw bp("Reduce of empty array with no initial value")}for(;t?c>=0:u>c;c+=s)c in a&&(i=e(i,a[c],c,o));return i}},Ep={left:mp(!1),right:mp(!0)},Ap=Ep.left,Sp=Ol.aTypedArray;(0,Ol.exportTypedArrayMethod)("reduce",(function(t){var r=arguments.length;return Ap(Sp(this),t,r,r>1?arguments[1]:void 0)}));var Tp=Ep.right,Op=Ol.aTypedArray;(0,Ol.exportTypedArrayMethod)("reduceRight",(function(t){var r=arguments.length;return Tp(Op(this),t,r,r>1?arguments[1]:void 0)}));var xp=Ol.aTypedArray,Ip=Ol.exportTypedArrayMethod,kp=Math.floor;Ip("reverse",(function(){for(var t,r=this,e=xp(r).length,n=kp(e/2),i=0;i<n;)t=r[i],r[i++]=r[--e],r[e]=t;return r}));var Rp=$,Pp=st,Cp=Ol,Lp=Ln,Up=Nl,jp=U,Mp=w,Dp=Rp.RangeError,Bp=Rp.Int8Array,Fp=Bp&&Bp.prototype,_p=Fp&&Fp.set,Np=Cp.aTypedArray,Vp=Cp.exportTypedArrayMethod,Gp=!Mp((function(){var t=new Uint8ClampedArray(2);return Pp(_p,t,{length:1,0:3},1),3!==t[1]})),Wp=Gp&&Cp.NATIVE_ARRAY_BUFFER_VIEWS&&Mp((function(){var t=new Bp(2);return t.set(1),t.set("2",1),0!==t[0]||2!==t[1]}));Vp("set",(function(t){Np(this);var r=Up(arguments.length>1?arguments[1]:void 0,1),e=jp(t);if(Gp)return Pp(_p,this,e,r);var n=this.length,i=Lp(e),o=0;if(i+r>n)throw Dp("Wrong length");for(;o<i;)this[r+o]=e[o++]}),!Gp||Wp);var Yp=x([].slice),$p=dg,zp=Yp,Hp=Ol.aTypedArray;(0,Ol.exportTypedArrayMethod)("slice",(function(t,r){for(var e=zp(Hp(this),t,r),n=$p(this),i=0,o=e.length,a=new n(o);o>i;)a[i]=e[i++];return a}),w((function(){new Int8Array(1).slice()})));var Kp=Dh.some,Xp=Ol.aTypedArray;(0,Ol.exportTypedArrayMethod)("some",(function(t){return Kp(Xp(this),t,arguments.length>1?arguments[1]:void 0)}));var Jp=qa,qp=Math.floor,Zp=function(t,r){var e=t.length,n=qp(e/2);return e<8?Qp(t,r):td(t,Zp(Jp(t,0,n),r),Zp(Jp(t,n),r),r)},Qp=function(t,r){for(var e,n,i=t.length,o=1;o<i;){for(n=o,e=t[o];n&&r(t[n-1],e)>0;)t[n]=t[--n];n!==o++&&(t[n]=e)}return t},td=function(t,r,e,n){for(var i=r.length,o=e.length,a=0,u=0;a<i||u<o;)t[a+u]=a<i&&u<o?n(r[a],e[u])<=0?r[a++]:e[u++]:a<i?r[a++]:e[u++];return t},rd=Zp,ed=pt.match(/firefox\/(\d+)/i),nd=!!ed&&+ed[1],id=/MSIE|Trident/.test(pt),od=pt.match(/AppleWebKit\/(\d+)\./),ad=!!od&&+od[1],ud=x,cd=w,sd=Bt,fd=rd,ld=nd,hd=id,vd=At,gd=ad,pd=Ol.aTypedArray,dd=Ol.exportTypedArrayMethod,yd=$.Uint16Array,wd=yd&&ud(yd.prototype.sort),bd=!(!wd||cd((function(){wd(new yd(2),null)}))&&cd((function(){wd(new yd(2),{})}))),md=!!wd&&!cd((function(){if(vd)return vd<74;if(ld)return ld<67;if(hd)return!0;if(gd)return gd<602;var t,r,e=new yd(516),n=Array(516);for(t=0;t<516;t++)r=t%4,e[t]=515-t,n[t]=t-2*r+3;for(wd(e,(function(t,r){return(t/4|0)-(r/4|0)})),t=0;t<516;t++)if(e[t]!==n[t])return!0}));dd("sort",(function(t){return void 0!==t&&sd(t),md?wd(this,t):fd(pd(this),function(t){return function(r,e){return void 0!==t?+t(r,e)||0:e!=e?-1:r!=r?1:0===r&&0===e?1/r>0&&1/e<0?1:-1:r>e}}(t))}),!md||bd);var Ed=Pn,Ad=In,Sd=dg,Td=Ol.aTypedArray;(0,Ol.exportTypedArrayMethod)("subarray",(function(t,r){var e=Td(this),n=e.length,i=Ad(t,n);return new(Sd(e))(e.buffer,e.byteOffset+i*e.BYTES_PER_ELEMENT,Ed((void 0===r?n:Ad(r,n))-i))}));var Od=Xo,xd=Ol,Id=w,kd=Yp,Rd=$.Int8Array,Pd=xd.aTypedArray,Cd=xd.exportTypedArrayMethod,Ld=[].toLocaleString,Ud=!!Rd&&Id((function(){Ld.call(new Rd(1))}));Cd("toLocaleString",(function(){return Od(Ld,Ud?kd(Pd(this)):Pd(this),kd(arguments))}),Id((function(){return[1,2].toLocaleString()!=new Rd([1,2]).toLocaleString()}))||!Id((function(){Rd.prototype.toLocaleString.call([1,2])})));var jd=Ol.exportTypedArrayMethod,Md=w,Dd=x,Bd=$.Uint8Array,Fd=Bd&&Bd.prototype||{},_d=[].toString,Nd=Dd([].join);Md((function(){_d.call({})}))&&(_d=function(){return Nd(this)});var Vd=Fd.toString!=_d;jd("toString",_d,Vd);var Gd=w,Wd=At,Yd=gr("species"),$d=function(t){return Wd>=51||!Gd((function(){var r=[];return(r.constructor={})[Yd]=function(){return{foo:1}},1!==r[t](Boolean).foo}))},zd=Ei,Hd=Di,Kd=Aa,Xd=X,Jd=In,qd=Ln,Zd=ce,Qd=$a,ty=gr,ry=Yp,ey=$d("slice"),ny=ty("species"),iy=Array,oy=Math.max;zd({target:"Array",proto:!0,forced:!ey},{slice:function(t,r){var e,n,i,o=Zd(this),a=qd(o),u=Jd(t,a),c=Jd(void 0===r?a:r,a);if(Hd(o)&&(e=o.constructor,(Kd(e)&&(e===iy||Hd(e.prototype))||Xd(e)&&null===(e=e[ny]))&&(e=void 0),e===iy||void 0===e))return ry(o,u,c);for(n=new(void 0===e?iy:e)(oy(c-u,0)),i=0;u<c;u++,i++)u in o&&Qd(n,i,o[u]);return n.length=i,n}});Ei({target:"ArrayBuffer",stat:!0,forced:!Ol.NATIVE_ARRAY_BUFFER_VIEWS},{isView:Ol.isView});var ay=Vh,uy="ArrayBuffer",cy=mf.ArrayBuffer;Ei({global:!0,constructor:!0,forced:$.ArrayBuffer!==cy},{ArrayBuffer:cy}),ay(uy);var sy=TypeError,fy=Ei,ly=w,hy=Di,vy=X,gy=U,py=Ln,dy=function(t){if(t>9007199254740991)throw sy("Maximum allowed index exceeded");return t},yy=$a,wy=kh,by=$d,my=At,Ey=gr("isConcatSpreadable"),Ay=my>=51||!ly((function(){var t=[];return t[Ey]=!1,t.concat()[0]!==t})),Sy=by("concat"),Ty=function(t){if(!vy(t))return!1;var r=t[Ey];return void 0!==r?!!r:hy(t)};fy({target:"Array",proto:!0,arity:1,forced:!Ay||!Sy},{concat:function(t){var r,e,n,i,o,a=gy(this),u=wy(a,0),c=0;for(r=-1,n=arguments.length;r<n;r++)if(Ty(o=-1===r?a:arguments[r]))for(i=py(o),dy(c+i),e=0;e<i;e++,c++)e in o&&yy(u,c,o[e]);else dy(c+1),yy(u,c++,o);return u.length=c,u}});var Oy,xy=ca,Iy=TypeError,ky=function(t){if(xy(t))throw Iy("The method doesn't accept regular expressions");return t},Ry=gr("match"),Py=function(t){var r=/./;try{"/./"[t](r)}catch(e){try{return r[Ry]=!1,"/./"[t](r)}catch(t){}}return!1},Cy=Ei,Ly=x,Uy=$r.f,jy=Pn,My=Xi,Dy=ky,By=P,Fy=Py,_y=Ly("".endsWith),Ny=Ly("".slice),Vy=Math.min,Gy=Fy("endsWith");Cy({target:"String",proto:!0,forced:!!(Gy||(Oy=Uy(String.prototype,"endsWith"),!Oy||Oy.writable))&&!Gy},{endsWith:function(t){var r=My(By(this));Dy(t);var e=arguments.length>1?arguments[1]:void 0,n=r.length,i=void 0===e?n:Vy(jy(e),n),o=My(t);return _y?_y(r,o,i):Ny(r,i-o.length,i)===o}}),Ei({global:!0,constructor:!0,forced:!Qc},{DataView:mf.DataView}),(0,Df.exports)("Uint16",(function(t){return function(r,e,n){return t(this,r,e,n)}}));var Wy=Dh.forEach,Yy=Zg("forEach")?[].forEach:function(t){return Wy(this,t,arguments.length>1?arguments[1]:void 0)};Ei({target:"Array",proto:!0,forced:[].forEach!=Yy},{forEach:Yy});var $y=Q("span").classList,zy=$y&&$y.constructor&&$y.constructor.prototype,Hy=$,Ky={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Xy=zy===Object.prototype?void 0:zy,Jy=Yy,qy=me,Zy=function(t){if(t&&t.forEach!==Jy)try{qy(t,"forEach",Jy)}catch(r){t.forEach=Jy}};for(var Qy in Ky)Ky[Qy]&&Zy(Hy[Qy]&&Hy[Qy].prototype);function tw(t){var r="",e=0,n=0,i=0,o=0;for(e+=239===t[0]&&187===t[1]&&191===t[2]?3:0;e<t.length;)switch((n=t[e++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r+=String.fromCharCode(n);break;case 12:case 13:i=t[e++],r+=String.fromCharCode((31&n)<<6|63&i);break;case 14:i=t[e++],o=t[e++],r+=String.fromCharCode((15&n)<<12|(63&i)<<6|(63&o)<<0);break;default:r+=""}return r}function rw(t){for(var r=[],e=0;e<t.length;e++){var n=t.charCodeAt(e);n<128?r.push(n):n<2048?r.push(192|n>>6,128|63&n):n<55296||n>=57344?r.push(224|n>>12,128|n>>6&63,128|63&n):(e++,n=65536+((1023&n)<<10|1023&t.charCodeAt(e)),r.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n))}return r}function ew(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"windows1251",e=[];switch(r){case"utf-8":e=rw(t);break;case"utf-16":case"utf-16be":for(var n=new ArrayBuffer(2*t.length),i=new Uint16Array(n),o=new Uint8Array(n),a=0;a<t.length;a++)i[a]=t.charCodeAt(a);e=[255,254],o.forEach((function(t){return e.push(t)}));break;default:for(var u=0;u<t.length;u++)e.push(t.charCodeAt(u))}return e}function nw(t){return t instanceof ArrayBuffer||"undefined"!=typeof Buffer&&t instanceof Buffer}Zy(Xy);var iw=function(t){!function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&c(t,r)}(a,t);var r,e,i=(r=a,e=s(),function(){var t,n=u(r);if(e){var i=u(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return h(this,t)});function a(){n(this,a);for(var t=arguments.length,r=new Array(t),e=0;e<t;e++)r[e]=arguments[e];return("number"==typeof r[0]||Array.isArray(r[0]))&&(r[0]=new Uint8Array(r[0])),ArrayBuffer.isView(r[0])&&(r[0]=r[0].buffer),i.call.apply(i,[this].concat(r))}return o(a,[{key:"getString",value:function(t,r){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"windows1251",n="",i=this.getUint8(t,r);switch(Array.isArray(i)||(i=[i]),e){case"utf8":case"utf-8":n=tw(i);break;case"utf16":case"utf16be":case"utf-16":case"utf-16be":var o=null;255===i[0]&&254===i[1]?o=!0:254===i[0]&&255===i[1]&&(o=!1),null!==o&&(t+=2,r-=2),n=this.getUint16String(t,r,!0===o);break;default:n=this.getUint8String(t,r)}return{string:n.endsWith("\0")?n.substr(0,n.length-1):n,length:i.length}}},{key:"getCString",value:function(t){var r,e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"windows1251",i=this.byteLength-t;switch(n){case"utf16":case"utf16be":case"utf-16":case"utf-16be":e=2,r=this.getUint16(t,i);break;default:e=1,r=this.getUint8(t,i)}Array.isArray(r)||(r=[r]);for(var o=0;o<r.length;o++)if(0===r[o]){i=(o+1)*e;break}return this.getString(t,i,n)}},{key:"getUint8String",value:function(t,r){var e=this.getUint8(t,r),n="";Array.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++){n+=String.fromCharCode(e[i])}return n}},{key:"getUint16String",value:function(t,r){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.getUint16(t,r,e),i="";Array.isArray(n)||(n=[n]);for(var o=0;o<n.length;o++){var a=String.fromCharCode(n[o]);i+=a}return i}},{key:"getUint8",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=t+r,n=[];if(this.byteLength-e<0)return!1;for(var i=t;i<e;i++){var o=DataView.prototype.getUint8.call(this,i);n.push(o)}return 1===n.length?n[0]:n}},{key:"getUint16",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r%2!=0&&(r-=1);var n=t+r,i=[];if(this.byteLength-n<0)return!1;for(var o=t;o<n;o+=2){var a=DataView.prototype.getUint16.call(this,o,e);i.push(a)}return 1===i.length?i[0]:i}}],[{key:"isViewable",value:function(t){return!!(nw(t)||Array.isArray(t)||ArrayBuffer.isView(t))}}]),a}(l(DataView)),ow=x,aw=U,uw=Math.floor,cw=ow("".charAt),sw=ow("".replace),fw=ow("".slice),lw=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,hw=/\$([$&'`]|\d{1,2})/g,vw=Xo,gw=st,pw=x,dw=ia,yw=w,ww=at,bw=z,mw=I,Ew=Sn,Aw=Pn,Sw=Xi,Tw=P,Ow=Va,xw=Nt,Iw=function(t,r,e,n,i,o){var a=e+t.length,u=n.length,c=hw;return void 0!==i&&(i=aw(i),c=lw),sw(o,c,(function(o,c){var s;switch(cw(c,0)){case"$":return"$";case"&":return t;case"`":return fw(r,0,e);case"'":return fw(r,a);case"<":s=i[fw(c,1,-1)];break;default:var f=+c;if(0===f)return o;if(f>u){var l=uw(f/10);return 0===l?o:l<=u?void 0===n[l-1]?cw(c,1):n[l-1]+cw(c,1):o}s=n[f-1]}return void 0===s?"":s}))},kw=iu,Rw=gr("replace"),Pw=Math.max,Cw=Math.min,Lw=pw([].concat),Uw=pw([].push),jw=pw("".indexOf),Mw=pw("".slice),Dw="$0"==="a".replace(/./,"$0"),Bw=!!/./[Rw]&&""===/./[Rw]("a","$0"),Fw=!yw((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}));dw("replace",(function(t,r,e){var n=Bw?"$":"$0";return[function(t,e){var n=Tw(this),i=mw(t)?void 0:xw(t,Rw);return i?gw(i,t,n,e):gw(r,Sw(n),t,e)},function(t,i){var o=ww(this),a=Sw(t);if("string"==typeof i&&-1===jw(i,n)&&-1===jw(i,"$<")){var u=e(r,o,a,i);if(u.done)return u.value}var c=bw(i);c||(i=Sw(i));var s=o.global;if(s){var f=o.unicode;o.lastIndex=0}for(var l=[];;){var h=kw(o,a);if(null===h)break;if(Uw(l,h),!s)break;""===Sw(h[0])&&(o.lastIndex=Ow(a,Aw(o.lastIndex),f))}for(var v,g="",p=0,d=0;d<l.length;d++){for(var y=Sw((h=l[d])[0]),w=Pw(Cw(Ew(h.index),a.length),0),b=[],m=1;m<h.length;m++)Uw(b,void 0===(v=h[m])?v:String(v));var E=h.groups;if(c){var A=Lw([y],b,w,a);void 0!==E&&Uw(A,E);var S=Sw(vw(i,void 0,A))}else S=Iw(y,a,w,b,E,i);w>=p&&(g+=Mw(a,p,w)+S,p=w+y.length)}return g+Mw(a,p)}]}),!Fw||!Dw||Bw);var _w=x,Nw=wn,Vw=Date.prototype,Gw="Invalid Date",Ww="toString",Yw=_w(Vw.toString),$w=_w(Vw.getTime);String(new Date(NaN))!=Gw&&Nw(Vw,Ww,(function(){var t=$w(this);return t==t?Yw(this):Gw}));var zw=st,Hw=D,Kw=gt,Xw=qi,Jw=RegExp.prototype,qw=function(t){var r=t.flags;return void 0!==r||"flags"in Jw||Hw(t,"flags")||!Kw(Jw,t)?r:zw(Xw,t)},Zw=G.PROPER,Qw=wn,tb=at,rb=Xi,eb=w,nb=qw,ib="toString",ob=RegExp.prototype.toString,ab=eb((function(){return"/a/b"!=ob.call({source:"a",flags:"b"})})),ub=Zw&&ob.name!=ib;(ab||ub)&&Qw(RegExp.prototype,ib,(function(){var t=tb(this);return"/"+rb(t.source)+"/"+rb(nb(t))}),{unsafe:!0});var cb="\t\n\v\f\r  áââââââââââââ¯âã\u2028\u2029\ufeff",sb=P,fb=Xi,lb=x("".replace),hb="[\t\n\v\f\r  áââââââââââââ¯âã\u2028\u2029\ufeff]",vb=RegExp("^"+hb+hb+"*"),gb=RegExp(hb+hb+"*$"),pb=function(t){return function(r){var e=fb(sb(r));return 1&t&&(e=lb(e,vb,"")),2&t&&(e=lb(e,gb,"")),e}},db={start:pb(1),end:pb(2),trim:pb(3)},yb=$,wb=w,bb=x,mb=Xi,Eb=db.trim,Ab=cb,Sb=yb.parseInt,Tb=yb.Symbol,Ob=Tb&&Tb.iterator,xb=/^[+-]?0x/i,Ib=bb(xb.exec),kb=8!==Sb(Ab+"08")||22!==Sb(Ab+"0x16")||Ob&&!wb((function(){Sb(Object(Ob))}))?function(t,r){var e=Eb(mb(t));return Sb(e,r>>>0||(Ib(xb,e)?16:10))}:Sb;Ei({global:!0,forced:parseInt!=kb},{parseInt:kb});var Rb=Bn.includes,Pb=Fu;Ei({target:"Array",proto:!0,forced:w((function(){return!Array(1).includes()}))},{includes:function(t){return Rb(this,t,arguments.length>1?arguments[1]:void 0)}}),Pb("includes");var Cb=Ei,Lb=Bn.indexOf,Ub=Zg,jb=x([].indexOf),Mb=!!jb&&1/jb([1],1,-0)<0,Db=Ub("indexOf");function Bb(t,r){return(t&1<<r)>0}function Fb(t,r){return t|1<<r}function _b(t){for(var r=0,e=2130706432;e;)r>>=1,r|=t&e,e>>=8;return r}function Nb(t){for(var r=0,e=127;2147483647^e;)r=t&~e,r<<=1,r|=t&e,e=(e+1<<8)-1,t=r;return r}function Vb(){for(var t=[],r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];return e.forEach((function(r){r.forEach?r.forEach((function(r){return t.push(r)})):t.push(r)})),new Uint8Array(t)}function Gb(t,r){for(var e=[],n=(t=t||[]).length,i=r-n,o=0;o<i;o++)e.push(0);for(var a=0;a<n;a++)e.push(t[a]);return e}Cb({target:"Array",proto:!0,forced:Mb||!Db},{indexOf:function(t){var r=arguments.length>1?arguments[1]:void 0;return Mb?jb(this,t,r)||0:Lb(this,t,r)}});var Wb=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound Clip","Gospel","Noise","Alt. Rock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental Rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta Rap","Top 40","Christian Rap","Pop/Funk","Jungle","Native American","Cabaret","New Wave","Psychedelic","Rave","Showtunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock & Roll","Hard Rock","Folk","Folk-Rock","National Folk","Swing","Fast-Fusion","Bebop","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow Rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber Music","Sonata","Symphony","Booty Bass","Primus","Porn Groove","Satire","Slow Jam","Club","Tango","Samba","Folklore","Ballad","Power Ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum Solo","A Cappella","Euro-House","Dance Hall","Goa","Drum & Bass","Club-House","Hardcore","Terror","Indie","BritPop","Afro-Punk","Polsk Punk","Beat","Christian Gangsta Rap","Heavy Metal","Black Metal","Crossover","Contemporary Christian","Christian Rock","Merengue","Salsa","Thrash Metal","Anime","JPop","Synthpop","Abstract","Art Rock","Baroque","Bhangra","Big Beat","Breakbeat","Chillout","Downtempo","Dub","EBM","Eclectic","Electro","Electroclash","Emo","Experimental","Garage","Global","IDM","Illbient","Industro-Goth","Jam Band","Krautrock","Leftfield","Lounge","Math Rock","New Romantic","Nu-Breakz","Post-Punk","Post-Rock","Psytrance","Shoegaze","Space Rock","Trop Rock","World Music","Neoclassical","Audiobook","Audio Theatre","Neue Deutsche Welle","Podcast","Indie Rock","G-Funk","Dubstep","Garage Rock","Psybient"];function Yb(t){var r=t.byteLength-128;return r>-1&&"TAG"===new iw(t,r).getString(0,3).string}function $b(t){var r=new iw(t,t.byteLength-128),e=r.getString(3,30,"utf-8").string.replace(/\0/g,""),n=r.getString(33,30,"utf-8").string.replace(/\0/g,""),i=r.getString(63,30,"utf-8").string.replace(/\0/g,""),o=r.getString(93,4,"utf-8").string.replace(/\0/g,""),a=r.getUint8(126).toString()||"";return{tags:{title:e,artist:n,album:i,year:o,track:a,comment:r.getString(97,null!==a?28:30,"utf-8").string.replace(/\0/g,""),genre:Wb[r.getUint8(127)]||""},details:{version:a?1:0,size:128}}}function zb(t,r){var e=t.title,n=t.artist,i=t.album,o=t.year,a=t.comment,u=t.track,c=t.genre;if("string"!=typeof e)throw new Error("Title is not a string");if(ew(e,"utf-8").length>30)throw new Error("Title length exceeds 30 characters");if("string"!=typeof n)throw new Error("Artist is not a string");if(ew(n,"utf-8").length>30)throw new Error("Artist length exceeds 30 characters");if("string"!=typeof i)throw new Error("Album is not a string");if(ew(i,"utf-8").length>30)throw new Error("Album length exceeds 30 characters");if("string"!=typeof o)throw new Error("Year is not a string");if(ew(o,"utf-8").length>4)throw new Error("Year length exceeds 4 characters");if("string"!=typeof a)throw new Error("Comment is not a string");if("string"!=typeof u)throw new Error("Track is not a string");if(parseInt(u)>255||parseInt(u)<0)throw new Error("Track should be in range 255 - 0");if(""!==u){if(ew(a,"utf-8").length>28)throw new Error("Comment length exceeds 28 characters")}else if(ew(a,"utf-8").length>30)throw new Error("Comment length exceeds 30 characters");if("string"!=typeof c)throw new Error("Genre is not a string");if(r&&!Wb.includes(c)&&""!==c)throw new Error("Unknown genre");return!0}function Hb(t){var r=t.title,e=t.artist,n=t.album,i=t.year,o=t.comment,a=t.track,u=t.genre;for(r=ew(r,"utf-8"),e=ew(e,"utf-8"),n=ew(n,"utf-8"),i=ew(i,"utf-8"),o=ew(o,"utf-8"),u=Wb.indexOf(u);r.length<30;)r.push(0);for(;e.length<30;)e.push(0);for(;n.length<30;)n.push(0);for(;i.length<4;)i.push(0);if(""!==a){for(;o.length<28;)o.push(0);o.push(0,parseInt(a))}else for(;o.length<30;)o.push(0);return Vb(84,65,71,r,e,n,i,o,u>-1?u:12).buffer}var Kb=Ee.exports,Xb=W,Jb=function(t,r,e){return e.get&&Kb(e.get,r,{getter:!0}),e.set&&Kb(e.set,r,{setter:!0}),Xb.f(t,r,e)},qb=b,Zb=Jb,Qb=qi,tm=w,rm=$.RegExp,em=rm.prototype,nm=qb&&tm((function(){var t=!0;try{rm(".","d")}catch(r){t=!1}var r={},e="",n=t?"dgimsy":"gimsy",i=function(t,n){Object.defineProperty(r,t,{get:function(){return e+=n,!0}})},o={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var a in t&&(o.hasIndices="d"),o)i(a,o[a]);return Object.getOwnPropertyDescriptor(em,"flags").get.call(r)!==n||e!==n}));nm&&Zb(em,"flags",{configurable:!0,get:Qb});var im=Ei,om=ky,am=P,um=Xi,cm=Py,sm=x("".indexOf);im({target:"String",proto:!0,forced:!cm("includes")},{includes:function(t){return!!~sm(um(am(this)),um(om(t)),arguments.length>1?arguments[1]:void 0)}});var fm=U,lm=Oi;function hm(t,r){var e={};switch(r){case 3:e.unsynchronisation=Bb(t,7),e.extendedHeader=Bb(t,6),e.experimentalIndicator=Bb(t,5);break;case 4:e.unsynchronisation=Bb(t,7),e.extendedHeader=Bb(t,6),e.experimentalIndicator=Bb(t,5),e.footerPresent=Bb(t,4)}return e}Ei({target:"Object",stat:!0,forced:w((function(){lm(1)}))},{keys:function(t){return lm(fm(t))}});var vm=["windows1251","utf-16","utf-16be","utf-8"];function gm(t,r){var e=new iw(t),n=vm[e.getUint8(0)],i=e.byteLength-1;return 3===r?e.getCString(1,n).string.replace(/\//g,"\\\\"):e.getString(1,i,n).string.replace(/\0/g,"\\\\")}function pm(t,r){var e=new iw(t),n=vm[e.getUint8(0)],i=e.byteLength-1;return 3===r?e.getCString(1,n).string:e.getString(1,i,n).string.replace(/\0/g,"\\\\")}function dm(t,r){return new iw(t).getCString(0).string}function ym(t,r){var e=new iw(t),n=vm[e.getUint8(0)],i=e.getCString(4,n),o=i.length+4,a=e.byteLength-o,u=e.getString(o,a,n);return{language:e.getString(1,3).string,descriptor:i.string,text:u.string}}function wm(t,r){var e=new iw(t),n=vm[e.getUint8(0)],i=e.byteLength-1;return e.getString(1,i,n).string}var bm=st,mm=at,Em=I,Am=Pn,Sm=Xi,Tm=P,Om=Nt,xm=Va,Im=iu;ia("match",(function(t,r,e){return[function(r){var e=Tm(this),n=Em(r)?void 0:Om(r,t);return n?bm(n,r,e):new RegExp(r)[t](Sm(e))},function(t){var n=mm(this),i=Sm(t),o=e(r,n,i);if(o.done)return o.value;if(!n.global)return Im(n,i);var a=n.unicode;n.lastIndex=0;for(var u,c=[],s=0;null!==(u=Im(n,i));){var f=Sm(u[0]);c[s]=f,""===f&&(n.lastIndex=xm(i,Am(n.lastIndex),a)),s++}return 0===s?null:c}]}));var km={},Rm=te,Pm=ce,Cm=bn.f,Lm=qa,Um="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];km.f=function(t){return Um&&"Window"==Rm(t)?function(t){try{return Cm(t)}catch(t){return Lm(Um)}}(t):Cm(Pm(t))};var jm={},Mm=gr;jm.f=Mm;var Dm=$,Bm=D,Fm=jm,_m=W.f,Nm=st,Vm=vt,Gm=gr,Wm=wn,Ym=Ei,$m=$,zm=st,Hm=x,Km=b,Xm=Ot,Jm=w,qm=D,Zm=gt,Qm=at,tE=ce,rE=Or,eE=Xi,nE=Jr,iE=yo,oE=Oi,aE=bn,uE=km,cE=Hn,sE=$r,fE=W,lE=Ai,hE=zr,vE=wn,gE=$t.exports,pE=De,dE=nr,yE=gr,wE=jm,bE=function(t){var r=Dm.Symbol||(Dm.Symbol={});Bm(r,t)||_m(r,t,{value:Fm.f(t)})},mE=function(){var t=Vm("Symbol"),r=t&&t.prototype,e=r&&r.valueOf,n=Gm("toPrimitive");r&&!r[n]&&Wm(r,n,(function(t){return Nm(e,this)}),{arity:1})},EE=uc,AE=tn,SE=Dh.forEach,TE=Me("hidden"),OE="Symbol",xE=AE.set,IE=AE.getterFor(OE),kE=Object.prototype,RE=$m.Symbol,PE=RE&&RE.prototype,CE=$m.TypeError,LE=$m.QObject,UE=sE.f,jE=fE.f,ME=uE.f,DE=hE.f,BE=Hm([].push),FE=gE("symbols"),_E=gE("op-symbols"),NE=gE("wks"),VE=!LE||!LE.prototype||!LE.prototype.findChild,GE=Km&&Jm((function(){return 7!=iE(jE({},"a",{get:function(){return jE(this,"a",{value:7}).a}})).a}))?function(t,r,e){var n=UE(kE,r);n&&delete kE[r],jE(t,r,e),n&&t!==kE&&jE(kE,r,n)}:jE,WE=function(t,r){var e=FE[t]=iE(PE);return xE(e,{type:OE,tag:t,description:r}),Km||(e.description=r),e},YE=function(t,r,e){t===kE&&YE(_E,r,e),Qm(t);var n=rE(r);return Qm(e),qm(FE,n)?(e.enumerable?(qm(t,TE)&&t[TE][n]&&(t[TE][n]=!1),e=iE(e,{enumerable:nE(0,!1)})):(qm(t,TE)||jE(t,TE,nE(1,{})),t[TE][n]=!0),GE(t,n,e)):jE(t,n,e)},$E=function(t,r){Qm(t);var e=tE(r),n=oE(e).concat(XE(e));return SE(n,(function(r){Km&&!zm(zE,e,r)||YE(t,r,e[r])})),t},zE=function(t){var r=rE(t),e=zm(DE,this,r);return!(this===kE&&qm(FE,r)&&!qm(_E,r))&&(!(e||!qm(this,r)||!qm(FE,r)||qm(this,TE)&&this[TE][r])||e)},HE=function(t,r){var e=tE(t),n=rE(r);if(e!==kE||!qm(FE,n)||qm(_E,n)){var i=UE(e,n);return!i||!qm(FE,n)||qm(e,TE)&&e[TE][n]||(i.enumerable=!0),i}},KE=function(t){var r=ME(tE(t)),e=[];return SE(r,(function(t){qm(FE,t)||qm(pE,t)||BE(e,t)})),e},XE=function(t){var r=t===kE,e=ME(r?_E:tE(t)),n=[];return SE(e,(function(t){!qm(FE,t)||r&&!qm(kE,t)||BE(n,FE[t])})),n};Xm||(RE=function(){if(Zm(PE,this))throw CE("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?eE(arguments[0]):void 0,r=dE(t),e=function(t){this===kE&&zm(e,_E,t),qm(this,TE)&&qm(this[TE],r)&&(this[TE][r]=!1),GE(this,r,nE(1,t))};return Km&&VE&&GE(kE,r,{configurable:!0,set:e}),WE(r,t)},vE(PE=RE.prototype,"toString",(function(){return IE(this).tag})),vE(RE,"withoutSetter",(function(t){return WE(dE(t),t)})),hE.f=zE,fE.f=YE,lE.f=$E,sE.f=HE,aE.f=uE.f=KE,cE.f=XE,wE.f=function(t){return WE(yE(t),t)},Km&&(jE(PE,"description",{configurable:!0,get:function(){return IE(this).description}}),vE(kE,"propertyIsEnumerable",zE,{unsafe:!0}))),Ym({global:!0,constructor:!0,wrap:!0,forced:!Xm,sham:!Xm},{Symbol:RE}),SE(oE(NE),(function(t){bE(t)})),Ym({target:OE,stat:!0,forced:!Xm},{useSetter:function(){VE=!0},useSimple:function(){VE=!1}}),Ym({target:"Object",stat:!0,forced:!Xm,sham:!Km},{create:function(t,r){return void 0===r?iE(t):$E(iE(t),r)},defineProperty:YE,defineProperties:$E,getOwnPropertyDescriptor:HE}),Ym({target:"Object",stat:!0,forced:!Xm},{getOwnPropertyNames:KE}),mE(),EE(RE,OE),pE[TE]=!0;var JE=Ot&&!!Symbol.for&&!!Symbol.keyFor,qE=Ei,ZE=vt,QE=D,tA=Xi,rA=$t.exports,eA=JE,nA=rA("string-to-symbol-registry"),iA=rA("symbol-to-string-registry");qE({target:"Symbol",stat:!0,forced:!eA},{for:function(t){var r=tA(t);if(QE(nA,r))return nA[r];var e=ZE("Symbol")(r);return nA[r]=e,iA[e]=r,e}});var oA=Ei,aA=D,uA=Ct,cA=Ut,sA=JE,fA=(0,$t.exports)("symbol-to-string-registry");oA({target:"Symbol",stat:!0,forced:!sA},{keyFor:function(t){if(!uA(t))throw TypeError(cA(t)+" is not a symbol");if(aA(fA,t))return fA[t]}});var lA=Ei,hA=vt,vA=Xo,gA=st,pA=x,dA=w,yA=Di,wA=z,bA=X,mA=Ct,EA=Yp,AA=Ot,SA=hA("JSON","stringify"),TA=pA(/./.exec),OA=pA("".charAt),xA=pA("".charCodeAt),IA=pA("".replace),kA=pA(1..toString),RA=/[\uD800-\uDFFF]/g,PA=/^[\uD800-\uDBFF]$/,CA=/^[\uDC00-\uDFFF]$/,LA=!AA||dA((function(){var t=hA("Symbol")();return"[null]"!=SA([t])||"{}"!=SA({a:t})||"{}"!=SA(Object(t))})),UA=dA((function(){return'"\\udf06\\ud834"'!==SA("\udf06\ud834")||'"\\udead"'!==SA("\udead")})),jA=function(t,r){var e=EA(arguments),n=r;if((bA(r)||void 0!==t)&&!mA(t))return yA(r)||(r=function(t,r){if(wA(n)&&(r=gA(n,this,t,r)),!mA(r))return r}),e[1]=r,vA(SA,null,e)},MA=function(t,r,e){var n=OA(e,r-1),i=OA(e,r+1);return TA(PA,t)&&!TA(CA,i)||TA(CA,t)&&!TA(PA,n)?"\\u"+kA(xA(t,0),16):t};SA&&lA({target:"JSON",stat:!0,arity:3,forced:LA||UA},{stringify:function(t,r,e){var n=EA(arguments),i=vA(LA?jA:SA,null,n);return UA&&"string"==typeof i?IA(i,RA,MA):i}});var DA=Hn,BA=U;Ei({target:"Object",stat:!0,forced:!Ot||w((function(){DA.f(1)}))},{getOwnPropertySymbols:function(t){var r=DA.f;return r?r(BA(t)):[]}});var FA=Ei,_A=b,NA=$,VA=x,GA=D,WA=z,YA=gt,$A=Xi,zA=W.f,HA=ii,KA=NA.Symbol,XA=KA&&KA.prototype;if(_A&&WA(KA)&&(!("description"in XA)||void 0!==KA().description)){var JA={},qA=function(){var t=arguments.length<1||void 0===arguments[0]?void 0:$A(arguments[0]),r=YA(XA,this)?new KA(t):void 0===t?KA():KA(t);return""===t&&(JA[r]=!0),r};HA(qA,KA),qA.prototype=XA,XA.constructor=qA;var ZA="Symbol(test)"==String(KA("test")),QA=VA(XA.valueOf),tS=VA(XA.toString),rS=/^Symbol\((.*)\)[^)]+$/,eS=VA("".replace),nS=VA("".slice);zA(XA,"description",{configurable:!0,get:function(){var t=QA(this);if(GA(JA,t))return"";var r=tS(t),e=ZA?nS(r,7,-1):eS(r,rS,"$1");return""===e?void 0:e}}),FA({global:!0,constructor:!0,forced:!0},{Symbol:qA})}var iS=Dh.every;Ei({target:"Array",proto:!0,forced:!Zg("every")},{every:function(t){return iS(this,t,arguments.length>1?arguments[1]:void 0)}});var oS,aS,uS=Ei,cS=st,sS=z,fS=at,lS=Xi,hS=(oS=!1,(aS=/[ac]/).exec=function(){return oS=!0,/./.exec.apply(this,arguments)},!0===aS.test("abc")&&oS),vS=/./.test;uS({target:"RegExp",proto:!0,forced:!hS},{test:function(t){var r=fS(this),e=lS(t),n=r.exec;if(!sS(n))return cS(vS,r,e);var i=cS(n,r,e);return null!==i&&(fS(i),!0)}});var gS=W.f,pS=b,dS=$,yS=x,wS=vi,bS=$h,mS=me,ES=bn.f,AS=gt,SS=ca,TS=Xi,OS=qw,xS=no,IS=function(t,r,e){e in t||gS(t,e,{configurable:!0,get:function(){return r[e]},set:function(t){r[e]=t}})},kS=wn,RS=w,PS=D,CS=tn.enforce,LS=Vh,US=mo,jS=So,MS=gr("match"),DS=dS.RegExp,BS=DS.prototype,FS=dS.SyntaxError,_S=yS(BS.exec),NS=yS("".charAt),VS=yS("".replace),GS=yS("".indexOf),WS=yS("".slice),YS=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,$S=/a/g,zS=/a/g,HS=new DS($S)!==$S,KS=xS.MISSED_STICKY,XS=xS.UNSUPPORTED_Y,JS=pS&&(!HS||KS||US||jS||RS((function(){return zS[MS]=!1,DS($S)!=$S||DS(zS)==zS||"/a/i"!=DS($S,"i")})));if(wS("RegExp",JS)){for(var qS=function(t,r){var e,n,i,o,a,u,c=AS(BS,this),s=SS(t),f=void 0===r,l=[],h=t;if(!c&&s&&f&&t.constructor===qS)return t;if((s||AS(BS,t))&&(t=t.source,f&&(r=OS(h))),t=void 0===t?"":TS(t),r=void 0===r?"":TS(r),h=t,US&&"dotAll"in $S&&(n=!!r&&GS(r,"s")>-1)&&(r=VS(r,/s/g,"")),e=r,KS&&"sticky"in $S&&(i=!!r&&GS(r,"y")>-1)&&XS&&(r=VS(r,/y/g,"")),jS&&(o=function(t){for(var r,e=t.length,n=0,i="",o=[],a={},u=!1,c=!1,s=0,f="";n<=e;n++){if("\\"===(r=NS(t,n)))r+=NS(t,++n);else if("]"===r)u=!1;else if(!u)switch(!0){case"["===r:u=!0;break;case"("===r:_S(YS,WS(t,n+1))&&(n+=2,c=!0),i+=r,s++;continue;case">"===r&&c:if(""===f||PS(a,f))throw new FS("Invalid capture group name");a[f]=!0,o[o.length]=[f,s],c=!1,f="";continue}c?f+=r:i+=r}return[i,o]}(t),t=o[0],l=o[1]),a=bS(DS(t,r),c?this:BS,qS),(n||i||l.length)&&(u=CS(a),n&&(u.dotAll=!0,u.raw=qS(function(t){for(var r,e=t.length,n=0,i="",o=!1;n<=e;n++)"\\"!==(r=NS(t,n))?o||"."!==r?("["===r?o=!0:"]"===r&&(o=!1),i+=r):i+="[\\s\\S]":i+=r+NS(t,++n);return i}(t),e)),i&&(u.sticky=!0),l.length&&(u.groups=l)),t!==h)try{mS(a,"source",""===h?"(?:)":h)}catch(t){}return a},ZS=ES(DS),QS=0;ZS.length>QS;)IS(qS,DS,ZS[QS++]);BS.constructor=qS,qS.prototype=BS,kS(dS,"RegExp",qS,{constructor:!0})}LS("RegExp");var tT=b,rT=no.MISSED_STICKY,eT=te,nT=Jb,iT=tn.get,oT=RegExp.prototype,aT=TypeError;tT&&rT&&nT(oT,"sticky",{configurable:!0,get:function(){if(this!==oT){if("RegExp"===eT(this))return!!iT(this).sticky;throw aT("Incompatible receiver, RegExp required")}}});var uT="(\\d{4})",cT="(0[1-9]|1[0-2])",sT="(0[1-9]|1\\d|2\\d|3[0-1])",fT="(0\\d|1\\d|2\\d|3\\d|4\\d|5\\d)",lT=new RegExp("^(".concat(uT,"(-").concat(cT,"(-").concat(sT,"(T").concat("(0\\d|1\\d|2[0-3])","(:").concat(fT,"(:").concat("(0\\d|1\\d|2\\d|3\\d|4\\d|5\\d)",")?)?)?)?)?)$"));function hT(t,r){for(var e=!1,n=0;n<t.length&&!e;){if(vT(t[n],r)){e=!0;break}n++}return e}function vT(t,r){for(var n in t){if(e(t[n])!==e(r[n]))return!1;switch(e(t[n])){case"object":if(!vT(t[n],r[n]))return!1;break;case"function":if(void 0===r[n]||t[n].toString()!==r[n].toString())return!1;break;default:if(t[n]!==r[n])return!1}}for(var i in r)if(void 0===t[i])return!1;return!0}function gT(t,r){var n={};for(var i in r){var o=r[i],a=t[i];if(void 0!==a)if("object"===e(o))n[i]=gT(a,o);else n[i]=e(o)===e(a)?a:o;else n[i]=o}return n}var pT=/^(.*)$/,dT=/^([0-9]+)(\/[0-9]+)?$/,yT=/^(https?):\/\/[^\s/$.?#]+\.[^\s]*/,wT=/^([a-z]{3}|XXX)$/,bT=/(image\/[a-z0-9!#$&.+\-^_]+){0,129}/,mT=/^((\[\d{1,}:\d{2}\.\d{3}\]) (.*))/;function ET(t,r,e){if("string"!=typeof t)throw new Error("Value is not a string");if(e&&!t.match(pT))throw new Error("Newlines are not allowed");return!0}function AT(t,r,e){return 3===r?t=[t]:4===r&&(t=t.split("\\\\")),t.forEach((function(t){if(ET(t,0,e),"string"!=typeof t&&"number"!=typeof t)throw new Error("Value is not a string/number");var r=t.match(dT);if(e&&"string"==typeof t){if(null===r)throw new Error("Invalid format (eg. 1/2)");var n=parseInt(r[1]),i=r[2]?parseInt(r[2].substr(1)):null;if(null!==i&&n>i)throw new Error("Position is greater then total")}})),!0}function ST(t,r,e){return 3===r?t=[t]:4===r&&(t=t.split("\\\\")),t.forEach((function(t){if(ET(t,0,e),3===r&&e&&!t.match(/^(\d{4})$/))throw new Error("Value is not 4 numeric characters");if(4===r&&e&&!t.match(lT))throw new Error("Time frames must follow ISO 8601")})),!0}function TT(t,r,e){if(ET(t,0,e),e&&!t.match(yT))throw new Error("Invalid URL");return!0}function OT(t,r,e){var n=[];return t.forEach((function(t){if(ET(t.language,0,e),ET(t.descriptor,0,e),"string"!=typeof t.text)throw new Error("Text is not a string");if(e&&!t.language.match(wT))throw new Error("Language must follow ISO 639-2");var r={language:t.language,descriptor:t.descriptor};if(e&&hT(n,r))throw new Error("Language and descriptor should not duplicate");n.push(r)})),!0}function xT(t,r,e,n){for(var i=0;i<r.length;i++){var o=r[i],a=t[o];if(a){if(!iw.isViewable(a))throw new Error("".concat(n,".").concat(o," must be viewable"));if(new iw(a).byteLength>e)throw new Error("".concat(n,".").concat(o," exceeds bits limit"))}}}function IT(t,r,e,n){var i=ew(t),o=new iw(4);o.setUint32(0,3===e?r:Nb(r));var a=[0,0];return 4===e&&n.unsynchronisation&&(a[1]=Fb(a[1],1)),4===e&&n.dataLengthIndicator&&(a[1]=Fb(a[1],0)),Vb(i,o.getUint8(0,4),a)}function kT(t,r){var e=new iw(4),n=function(t){for(var r=[],e=0;e<t.length;)r.push(t[e]),255===t[e]&&(t[e+1]>=224||0===t[e+1])&&r.push(0),e++;return r}(t),i=[];return 4===r&&(e.setUint32(0,Nb(t.length)),i.push.apply(i,v(e.getUint8(0,4)))),n.forEach((function(t){return i.push(t)})),new Uint8Array(i)}function RT(t,r){var e=r.id,n=r.version,i=r.unsynch,o=0,a=[];switch(n){case 3:o=1,a=ew(t.replace("\\\\","/")+"\0","utf-16");break;case 4:o=3,a=ew(t.replace("\\\\","\0")+"\0","utf-8")}var u=Vb(o,a);return i&&(u=kT(u,n)),Vb(IT(e,u.length,n,{unsynchronisation:i,dataLengthIndicator:i}),u)}function PT(t,r){var e=r.id,n=r.version,i=r.unsynch,o=[];switch(n){case 3:o=ew(t.replace("\\\\","/")+"\0");break;case 4:o=ew(t.replace("\\\\","\0")+"\0")}var a=Vb(0,o);return i&&(a=kT(a,n)),Vb(IT(e,a.length,n,{unsynchronisation:i,dataLengthIndicator:i}),a)}function CT(t,r){var e=r.version;return 3===e?t=t.toString().split("\\\\")[0]:4===e&&(t=t.toString().replace("\\\\","\0")),PT(t,r)}function LT(t,r){var e=r.id,n=r.version,i=r.unsynch,o=ew(t+"\0");return i&&(o=kT(o,n)),Vb(IT(e,o.length,n,{unsynchronisation:i,dataLengthIndicator:i}),o)}function UT(t,r){var e=r.id,n=r.version,i=r.unsynch,o=[];return t.forEach((function(t){var r,a,u=0,c=ew(t.language);switch(n){case 3:u=1,r=ew(t.descriptor+"\0","utf-16"),a=ew(t.text+"\0","utf-16");break;case 4:u=3,r=ew(t.descriptor+"\0","utf-8"),a=ew(t.text+"\0","utf-8")}var s=Vb(u,c,r,a);i&&(s=kT(s,n)),Vb(IT(e,s.length,n,{unsynchronisation:i,dataLengthIndicator:i}),s).forEach((function(t){return o.push(t)}))})),o}(0,Df.exports)("Int16",(function(t){return function(r,e,n){return t(this,r,e,n)}}));var jT={parse:function(t,r){var e=new iw(t),n=vm[e.getUint8(0)],i=e.getCString(1),o=e.getUint8(i.length+1),a=e.getCString(i.length+2,n),u=i.length+a.length+2,c=e.byteLength-u,s=e.getUint8(u,c);return{format:i.string,type:o,description:a.string,data:s}},validate:function(t,r,e){var n=[];return t.forEach((function(t){if(ET(t.format,0,e),ET(t.description,0,e),"number"!=typeof t.type)throw new Error("Type is not a number");if(t.type>255||t.type<0)throw new Error("Type should be in range of 0 - 255");if(!iw.isViewable(t.data))throw new Error("Image data should be viewable");if(e){if(t.type>21||t.type<0)throw new Error("Type should be in range of 0 - 21");if(!t.format.match(bT))throw new Error("Format should be an image MIME");if(t.description.length>64)throw new Error("Description should not exceed 64");if(hT(n,t.description))throw new Error("Description should not duplicate");n.push(t.description)}})),!0},write:function(t,r){var e=r.id,n=r.version,i=r.unsynch,o=[];return t.forEach((function(t){var r=0,a=ew(t.format+"\0"),u=new Uint8Array(t.data),c=[];switch(n){case 3:r=1,c=ew(t.description+"\0","utf-16");break;case 4:r=3,c=ew(t.description+"\0","utf-8")}var s=Vb(r,a,t.type,c,u);i&&(s=kT(s,n)),Vb(IT(e,s.length,n,{unsynchronisation:i,dataLengthIndicator:i}),s).forEach((function(t){return o.push(t)}))})),o},version:[3,4]},MT={parse:ym,validate:OT,write:UT,version:[3,4]},DT={parse:function(t,r){var e=new iw(t),n=vm[e.getUint8(0)],i=e.getCString(1),o=e.getCString(i.length+1,n),a=e.getCString(o.length+i.length+1,n),u=i.length+o.length+a.length+1,c=e.byteLength-u,s=e.getUint8(u,c);return{format:i.string,filename:o.string,description:a.string,object:s}},validate:function(t,r,e){var n=[];return t.forEach((function(t){if(ET(t.format,0,e),ET(t.filename,0,e),ET(t.description,0,e),!iw.isViewable(t.object))throw new Error("Object data should be viewable");if(e&&hT(n,t.description))throw new Error("GEOB description should not duplicate");n.push(t.description)})),!0},write:function(t,r){var e=r.id,n=r.version,i=r.unsynch,o=[];return t.forEach((function(t){var r,a,u,c=ew(t.format+"\0"),s=new Uint8Array(t.object);switch(n){case 3:r=1,a=ew(t.filename+"\0","utf-16"),u=ew(t.description+"\0","utf-16");break;case 4:r=3,a=ew(t.filename+"\0","utf-8"),u=ew(t.description+"\0","utf-8")}var f=Vb(r,c,a,u,s);i&&(f=kT(f,n)),Vb(IT(e,f.length,n,{unsynchronisation:i,dataLengthIndicator:i}),f).forEach((function(t){return o.push(t)}))})),o},version:[3,4]},BT={parse:function(t,r){var e=new iw(t),n=vm[e.getUint8(0)],i=e.byteLength-1;return e.getString(1,i,n).string.replace(/\0/g,"\\\\")},validate:ET,write:function(t,r){return r.version=4,RT(t,r)},version:[3]},FT={parse:function(t,r){var e=new iw(t);return{data:e.getUint8(0,e.byteLength)}},validate:function(t,r,e){if(!iw.isViewable(t.data))throw new Error("Data should be viewable");return!0},write:function(t,r){var e=r.id,n=r.version,i=r.unsynch;return i&&(t.data=kT(t.data,n)),Vb(IT(e,t.data.length,n,{unsynchronisation:i,dataLengthIndicator:i}),t.data)},version:[3,4]},_T={parse:function(t,r){var e=new iw(t),n=vm[e.getUint8(0)],i=e.getString(1,3),o=e.getCString(4),a=e.getString(o.length+4,8),u=o.length+a.length+4,c=e.byteLength-u,s=e.getString(u,c,n);return{currencyCode:i.string,currencyPrice:o.string,date:a.string,seller:s.string}},validate:function(t,r,e){if(ET(t.date,0,e),ET(t.seller,0,e),ET(t.currencyCode,0,e),ET(t.currencyPrice,0,e),e){if(!t.date.match("".concat(uT).concat(cT).concat(sT)))throw new Error("Date is not valid (format: YYYYMMDD)");if(!t.currencyCode.match(/^([A-Z]{3})$/))throw new Error("Currency code is not valid (eg. USD)");if(!t.currencyPrice.match(/^(\d*)\.(\d+)$/))throw new Error("Currency price is not valid (eg. 2.00)")}return!0},write:function(t,r){var e,n=r.id,i=r.version,o=r.unsynch,a=0,u=ew(t.currencyCode),c=ew(t.currencyPrice+"\0"),s=ew(t.date);switch(i){case 3:a=1,e=ew(t.seller,"utf-16");break;case 4:a=3,e=ew(t.seller,"utf-8")}var f=Vb(a,u,c,s,e);return o&&(f=kT(f,i)),Vb(IT(n,f.length,i,{unsynchronisation:o,dataLengthIndicator:o}),f)},version:[3,4]},NT={parse:function(t,r){var e=new iw(t),n=e.getCString(0),i=e.getUint8(n.length,e.byteLength-n.length);return{ownerId:n.string,data:i}},validate:function(t,r,e){var n=[];return t.forEach((function(t){if(ET(t.ownerId,0,e),!iw.isViewable(t.data))throw new Error("Data should be viewable");if(e&&hT(n,t.data))throw new Error("Data should not duplicate");n.push(t.data)})),!0},write:function(t,r){var e=r.id,n=r.version,i=r.unsynch,o=[];return t.forEach((function(t){var r=Vb(ew(t.ownerId),new Uint8Array(t.data));i&&(r=kT(r,n)),Vb(IT(e,r.length,n,{unsynchronisation:i,dataLengthIndicator:i}),r).forEach((function(t){return o.push(t)}))})),o},version:[3,4]},VT={parse:function(t,r){for(var e=new iw(t),n=e.getUint8(0),i=e.getUint8(1),o=[],a=Math.ceil(i/8),u=2;u<e.byteLength;u+=a)o.push(e.getUint8(u,a));return{bitsvolume:i,incdec:{right:Bb(n,0),left:Bb(n,1),rightback:Bb(n,2),leftback:Bb(n,3),center:Bb(n,4),bass:Bb(n,5)},volumechange:{right:void 0!==o[0]?o[0]:[],left:void 0!==o[1]?o[1]:[],rightback:void 0!==o[4]?o[4]:[],leftback:void 0!==o[5]?o[5]:[],center:void 0!==o[8]?o[8]:[],bass:void 0!==o[10]?o[10]:[]},peakvolume:{right:void 0!==o[2]?o[2]:[],left:void 0!==o[3]?o[3]:[],rightback:void 0!==o[6]?o[6]:[],leftback:void 0!==o[7]?o[7]:[],center:void 0!==o[9]?o[9]:[],bass:void 0!==o[11]?o[11]:[]}}},validate:function(t,r,n){if("object"!==e(t))throw new Error("Values must be an object");var i=t.volumechange,o=t.peakvolume,a=t.bitsvolume||16,u=Math.ceil(a/8);if(a&&(a<0||a>255))throw new Error("Bits volume should be in the range of 0 - 255");if(n&&0===a)throw new Error("Bits used for volume description may not be 0");var c=["right","left","rightback","leftback","center","bass"];return i&&xT(i,c,u,"volumechange"),o&&xT(o,c,u,"peakvolume"),!0},write:function(t,r){var e=r.id,n=r.version,i=r.unsynch,o=[],a=t.bitsvolume||16,u=Math.ceil(a/8),c=0;t.incdec&&(t.incdec.right&&(c=Fb(c,0)),t.incdec.left&&(c=Fb(c,1)),t.incdec.rightback&&(c=Fb(c,2)),t.incdec.leftback&&(c=Fb(c,3)),t.incdec.center&&(c=Fb(c,4)),t.incdec.bass&&(c=Fb(c,5))),o.push(c),o.push(a);var s=t.volumechange||{},f=t.peakvolume||{},l=Gb(s.right,u),h=Gb(s.left,u),v=Gb(f.right,u),g=Gb(f.left,u);if(l.forEach((function(t){return o.push(t)})),h.forEach((function(t){return o.push(t)})),v.forEach((function(t){return o.push(t)})),g.forEach((function(t){return o.push(t)})),s.rightback||s.leftback||f.rightback||f.leftback||s.center||f.center||s.bass||f.bass){var p=Gb(s.rightback,u),d=Gb(s.leftback,u),y=Gb(f.rightback,u),w=Gb(f.leftback,u);p.forEach((function(t){return o.push(t)})),d.forEach((function(t){return o.push(t)})),y.forEach((function(t){return o.push(t)})),w.forEach((function(t){return o.push(t)}))}if(s.center||f.center||s.bass||f.bass){var b=Gb(s.center,u),m=Gb(f.center,u);b.forEach((function(t){return o.push(t)})),m.forEach((function(t){return o.push(t)}))}if(s.bass||f.bass){var E=Gb(s.bass,u),A=Gb(f.bass,u);E.forEach((function(t){return o.push(t)})),A.forEach((function(t){return o.push(t)}))}var S=i?kT(o):o;return Vb(IT(e,S.length,n,{unsynchronisation:i,dataLengthIndicator:i}),S)},version:[3]},GT={parse:function(t,r){for(var e=new iw(t),n=e.getCString(0),i=[],o=n.length;o<e.byteLength;){var a=e.getUint8(o),u=e.getInt16(o+1,!0),c=e.getUint8(o+3),s=Math.ceil(c/8),f=e.getUint8(o+4,s);i.push({type:a,volumeadjust:u,bitspeak:c,peakvolume:Array.isArray(f)?f:[f]}),o+=4+s}return{identification:n.string,channels:i}},validate:function(t,r,e){var n=[];t.forEach((function(t){if(!Array.isArray(t.channels))throw new Error("Channels should be an array");for(var r=0;r<t.channels.length;r++){var i=t.channels[r];if("number"!=typeof i.type)throw new Error("Type of channel should be a number");if(e&&(i.type<0||i.type>8))throw new Error("Type of channel should be in the range of 0 - 8");if("number"!=typeof i.volumeadjust)throw new Error("Volume adjustment should be a number");if("number"!=typeof i.bitspeak)throw new Error("Bits representing peak should be a number");if(i.bitspeak<0||i.bitspeak>255)throw new Error("Bits representing peak should be in range of 0 - 255");if(!iw.isViewable(i.peakvolume))throw new Error("Peak volume must be viewable");if(new iw(i.peakvolume).byteLength>Math.ceil(i.bitspeak/8))throw new Error("Peak volume exceeds bits limit")}var o={identification:t.identification};if(e&&hT(n,o))throw new Error("RVA2 identification should be unique");n.push(o)}))},write:function(t,r){var e=r.id,n=r.version,i=r.unsynch,o=[];return t.forEach((function(t){for(var r=ew(t.identification+"\0"),a=0;a<t.channels.length;a++){var u=t.channels[a],c=u.type,s=new Int16Array([u.volumeadjust]),f=new Uint8Array(s.buffer),l=u.bitspeak,h=Math.ceil(l/8);r=Vb(r,c,f,l,Gb(u.peakvolume,h))}Vb(IT(e,r.length,n,{unsynchronisation:i,dataLengthIndicator:i}),r).forEach((function(t){return o.push(t)}))})),o},version:[4]},WT={parse:function(t,r){return new iw(t).getUint32(0)}},YT={parse:function(t,r){var e=new iw(t);return{group:e.getUint8(0),signature:e.getUint8(1,e.byteLength-1)}},validate:function(t,r,e){var n=[];return t.forEach((function(t){if("number"!=typeof t.group)throw new Error("Group ID is not a number");if(t.group<0||t.group>255)throw new Error("Group ID should be in the range of 0 - 255");if(!iw.isViewable(t.signature))throw new Error("Signature should be viewable");if(e&&hT(n,t))throw new Error("SIGN contents should not be identical to others");n.push(t)})),!0},write:function(t,r){var e=r.id,n=r.version,i=r.unsynch,o=[];return t.forEach((function(t){var r=new Uint8Array(t.signature),a=Vb(t.group,r);i&&(a=kT(a,n)),Vb(IT(e,a.length,n,{unsynchronisation:i,dataLengthIndicator:i}),a).forEach((function(t){return o.push(t)}))})),o},version:[4]},$T={parse:function(t,r){for(var e=new iw(t),n=vm[e.getUint8(0)],i=e.getString(1,3).string,o=e.getUint8(4),a=e.getUint8(5),u=e.getCString(6,n),c=u.length+6,s=e.byteLength-c,f=e.getUint8(c,s),l="",h=0;h<f.length;h+=4){var v=new iw(f),g=v.getCString(h),p=v.getUint32(h+g.length),d=Math.floor(p/6e4).toString(),y=Math.floor(p%6e4/1e3).toString();y=1===y.length?"0"+y:y;for(var w=(p%1e3).toString();w.length<3;)w="0"+w;l+="[".concat(d,":").concat(y,".").concat(w,"] ").concat(g.string),h+=g.length}return{language:i,format:o,type:a,descriptor:u.string,lyrics:l}},validate:function(t,r,e){var n=[];return t.forEach((function(t){if(ET(t.language,0,e),ET(t.descriptor,0,e),"string"!=typeof t.lyrics)throw new Error("Lyrics is not a string");if("number"!=typeof t.type)throw new Error("Type is not a number");if(t.type>255||t.type<0)throw new Error("Type should be in range of 0 - 255");if("number"!=typeof t.format)throw new Error("Format is not a number");if(t.format>255||t.format<0)throw new Error("Format should be in range of 0 - 255");if(e){if(!t.language.match(wT))throw new Error("Language must follow ISO 639-2");if(t.type>6||t.type<0)throw new Error("Type should be in range of 0 - 6");if(t.format>2||t.format<1)throw new Error("Format should be either 1 or 2");if(!t.lyrics.split("\n").every((function(t){return mT.test(t)})))throw new Error("Lyrics must follow this format: [mm:ss.xxx]");var r={language:t.language,descriptor:t.descriptor};if(hT(n,r))throw new Error("1 SYLT with same language and descriptor only");n.push(r)}})),!0},write:function(t,r){var e=r.id,n=r.version,i=r.unsynch,o=[];return t.forEach((function(t){var r=0,a=ew(t.language),u=[];switch(n){case 3:r=1,u=ew(t.descriptor+"\0","utf-16");break;case 4:r=3,u=ew(t.descriptor+"\0","utf-8")}var c=/^(\[\d{1,}:\d{2}\.\d{3}\]) ?(.*)/,s=[];t.lyrics.replace(/\r\n/,"\n").split("\n").forEach((function(t){if(""!==t){var r=c.exec(t),e=parseInt(r[1].replace(/[^0-9]/g,"")),n=ew((r[2]||"")+"\n\0"),i=new iw(4);i.setUint32(0,e),s=Vb(s,n,i.getUint8(0,4))}}));var f=Vb(r,a,t.format,t.type,u,s);i&&(f=kT(f,n)),Vb(IT(e,f.length,n,{unsynchronisation:i,dataLengthIndicator:i}),f).forEach((function(t){return o.push(t)}))})),o},version:[3,4]},zT={parse:function(t,r){var e=new iw(t);return{format:e.getUint8(0),data:e.getUint8(1,e.byteLength-1)}},validate:function(t,r,e){if(!iw.isViewable(t.data))throw new Error("Data should be viewable");if("number"!=typeof t.format)throw new Error("Format is not a number");if(t.format>255||t.format<0)throw new Error("Format should be in range of 0 - 255");if(e&&(t.format>2||t.format<1))throw new Error("Invalid timestamp");return!0},write:function(t,r){var e=r.id,n=r.version,i=r.unsynch,o=Vb(t.format,t.data);return i&&(o=kT(o,n)),Vb(IT(e,o.length,n,{unsynchronisation:i,dataLengthIndicator:i}),o)},version:[3,4]},HT={parse:gm,validate:ET,write:RT,version:[3,4]},KT={parse:gm,validate:ET,write:PT,version:[3,4]},XT={parse:gm,validate:ET,write:RT,version:[3,4]},JT={parse:gm,validate:ET,write:RT,version:[3,4]},qT={parse:gm,validate:ET,write:RT,version:[3,4]},ZT={parse:gm,validate:ST,write:PT,version:[3]},QT={parse:gm,validate:ST,write:PT,version:[4]},tO={parse:gm,validate:ET,write:PT,version:[3]},rO={parse:gm,validate:ST,write:PT,version:[4]},eO={parse:gm,validate:ST,write:PT,version:[4]},nO={parse:gm,validate:ST,write:PT,version:[4]},iO={parse:gm,validate:ST,write:PT,version:[4]},oO={parse:gm,validate:ET,write:RT,version:[3,4]},aO={parse:gm,validate:ET,write:RT,version:[3,4]},uO={parse:gm,validate:ET,write:RT,version:[3,4]},cO={parse:gm,validate:ST,write:PT,version:[3]},sO={parse:gm,validate:ET,write:RT,version:[4]},fO={parse:gm,validate:ET,write:RT,version:[3,4]},lO={parse:gm,validate:ET,write:RT,version:[3,4]},hO={parse:gm,validate:ET,write:RT,version:[3,4]},vO={parse:gm,validate:function(t,r,e){return 3===r?t=[t]:4===r&&(t=t.split("\\\\")),t.forEach((function(t){if(ET(t,0,e),e&&!t.match(/^([A-Gb#mo]{1,3})$/))throw new Error("Invalid TKEY Format (eg Cbm)")})),!0},write:PT,version:[3,4]},gO={parse:gm,validate:function(t,r,e){return 3===r?t=[t]:4===r&&(t=t.split("\\\\")),t.forEach((function(t){if(ET(t,0,e),e&&!t.match(wT))throw new Error("Language must follow ISO 639-2")})),!0},write:PT,version:[3,4]},pO={parse:gm,validate:ET,write:PT,version:[3,4]},dO={parse:gm,validate:ET,write:RT,version:[4]},yO={parse:gm,validate:ET,write:RT,version:[3,4]},wO={parse:gm,validate:ET,write:RT,version:[4]},bO={parse:gm,validate:ET,write:RT,version:[3,4]},mO={parse:gm,validate:ET,write:RT,version:[3,4]},EO={parse:gm,validate:ET,write:RT,version:[3,4]},AO={parse:gm,validate:ET,write:RT,version:[3,4]},SO={parse:gm,validate:ST,write:PT,version:[3]},TO={parse:gm,validate:ET,write:RT,version:[3,4]},OO={parse:gm,validate:ET,write:RT,version:[3,4]},xO={parse:gm,validate:ET,write:RT,version:[3,4]},IO={parse:gm,validate:ET,write:RT,version:[3,4]},kO={parse:gm,validate:ET,write:RT,version:[3,4]},RO={parse:pm,validate:AT,write:CT,version:[3,4]},PO={parse:gm,validate:ET,write:RT,version:[4]},CO={parse:gm,validate:ET,write:RT,version:[3,4]},LO={parse:pm,validate:AT,write:CT,version:[3,4]},UO={parse:gm,validate:ET,write:RT,version:[3]},jO={parse:gm,validate:ET,write:RT,version:[3,4]},MO={parse:gm,validate:ET,write:RT,version:[3,4]},DO={parse:gm,validate:ET,write:PT,version:[3]},BO={parse:gm,validate:ET,write:RT,version:[4]},FO={parse:gm,validate:ET,write:RT,version:[4]},_O={parse:gm,validate:ET,write:RT,version:[4]},NO={parse:gm,validate:ET,write:RT,version:[4]},VO={parse:gm,validate:function(t,r,e){return 3===r?t=[t]:4===r&&(t=t.split("\\\\")),t.forEach((function(t){if(ET(t,0,e),e&&!t.match(/^([A-Z0-9]{12})$/))throw new Error("Invalid ISRC format")})),!0},write:PT,version:[3,4]},GO={parse:gm,validate:ET,write:RT,version:[3,4]},WO={parse:gm,validate:ET,write:RT,version:[4]},YO={parse:gm,validate:ST,write:PT,version:[3]},$O={parse:function(t,r){var e=new iw(t),n=vm[e.getUint8(0)],i=e.getCString(1,n),o=i.length+1,a=e.byteLength-o,u=e.getString(o,a,n);return{description:i.string,text:u.string}},validate:function(t,r,e){var n=[];return t.forEach((function(t){if(ET(t.description,0,e),ET(t.text,0,e),e&&hT(n,t.description))throw new Error("Description should not duplicate");n.push(t.description)})),!0},write:function(t,r){var e=r.id,n=r.version,i=r.unsynch,o=[];return t.forEach((function(t){var r,a,u=0;switch(n){case 3:u=1,r=ew(t.description+"\0","utf-16"),a=ew(t.text+"\0","utf-16");break;case 4:u=3,r=ew(t.description+"\0","utf-8"),a=ew(t.text+"\0","utf-8")}var c=Vb(u,r,a);i&&(c=kT(c,n)),Vb(IT(e,c.length,n,{unsynchronisation:i,dataLengthIndicator:i}),c).forEach((function(t){return o.push(t)}))})),o},version:[3,4]},zO={parse:function(t,r){var e=new iw(t),n=e.getCString(0),i=e.getUint8(n.length,e.byteLength-n.length);return{ownerId:n.string,id:i}},validate:function(t,r,e){var n=[];return t.forEach((function(t){if(ET(t.ownerId,0,e),!iw.isViewable(t.id))throw new Error("ID should be viewable");if(e){if(""===t.ownerId)throw new Error("ownerId should not be blank");if((t.id.byteLength||t.id.length||0)>64)throw new Error("ID bytelength should not exceed 64 bytes");if(hT(n,t.ownerId))throw new Error("ownerId should not duplicate");n.push(t.ownerId)}})),!0},write:function(t,r){var e=r.id,n=r.version,i=r.unsynch,o=[];return t.forEach((function(t){var r=Vb(ew(t.ownerId+"\0"),new Uint8Array(t.id));i&&(r=kT(r,n)),Vb(IT(e,r.length,n,{unsynchronisation:i,dataLengthIndicator:i}),r).forEach((function(t){return o.push(t)}))})),o},version:[3,4]},HO={parse:function(t,r){var e=new iw(t),n=vm[e.getUint8(0)];return{language:e.getString(1,3).string,text:e.getString(4,e.byteLength-4,n).string}},validate:function(t,r,e){return t.forEach((function(t){if(ET(t.language,0,e),"string"!=typeof t.text)throw new Error("Text is not a string");if(e&&!t.language.match(wT))throw new Error("Language must follow ISO 639-2")})),!0},write:function(t,r){var e,n=r.id,i=r.version,o=r.unsynch,a=[],u=0,c=ew(t.language);switch(i){case 3:u=1,e=ew(t.text+"\0","utf-16");break;case 4:u=3,e=ew(t.text+"\0","utf-8")}var s=Vb(u,c,e);return o&&(s=kT(s,i)),Vb(IT(n,s.length,i,{unsynchronisation:o,dataLengthIndicator:o}),s).forEach((function(t){return a.push(t)})),a},version:[3,4]},KO={parse:ym,validate:OT,write:UT,version:[3,4]},XO={parse:dm,validate:TT,write:LT,version:[3,4]},JO={parse:dm,validate:TT,write:LT,version:[3,4]},qO={parse:wm,validate:TT,write:PT,version:[3,4]},ZO={parse:wm,validate:TT,write:PT,version:[3,4]},QO={parse:dm,validate:TT,write:LT,version:[3,4]},tx={parse:dm,validate:TT,write:LT,version:[3,4]},rx={parse:dm,validate:TT,write:LT,version:[3,4]},ex={parse:dm,validate:TT,write:LT,version:[3,4]},nx={parse:dm,validate:TT,write:LT,version:[3,4]},ix={parse:dm,validate:TT,write:LT,version:[3,4]},ox={parse:function(t,r){var e=new iw(t),n=vm[e.getUint8(0)],i=e.getCString(1,n),o=i.length+1,a=e.byteLength-o,u=e.getString(o,a);return{description:i.string,url:u.string}},validate:function(t,r,e){var n=[];return t.forEach((function(t){if(ET(t.description,0,e),TT(t.url,0,e),e&&hT(n,t.description))throw new Error("Description should not duplicate");n.push(t.description)})),!0},write:function(t,r){var e=r.id,n=r.version,i=r.unsynch,o=[];return t.forEach((function(t){var r,a,u=0;switch(n){case 3:u=1,r=ew(t.description+"\0","utf-16"),a=ew(t.url+"\0");break;case 4:u=3,r=ew(t.description+"\0","utf-8"),a=ew(t.url+"\0")}var c=Vb(u,r,a);i&&(c=kT(c,n)),Vb(IT(e,c.length,n,{unsynchronisation:i,dataLengthIndicator:i}),c).forEach((function(t){return o.push(t)}))})),o},version:[3,4]},ax=Object.freeze({__proto__:null,APIC:jT,COMM:MT,GEOB:DT,IPLS:BT,MCDI:FT,OWNE:_T,PRIV:NT,RVAD:VT,RVA2:GT,SEEK:WT,SIGN:YT,SYLT:$T,SYTC:zT,TALB:HT,TBPM:KT,TCOM:XT,TCON:JT,TCOP:qT,TDAT:ZT,TDEN:QT,TDLY:tO,TDOR:rO,TDRC:eO,TDRL:nO,TDTG:iO,TENC:oO,TEXT:aO,TFLT:uO,TIME:cO,TIPL:sO,TIT1:fO,TIT2:lO,TIT3:hO,TKEY:vO,TLAN:gO,TLEN:pO,TMCL:dO,TMED:yO,TMOO:wO,TOAL:bO,TOFN:mO,TOLY:EO,TOPE:AO,TORY:SO,TOWN:TO,TPE1:OO,TPE2:xO,TPE3:IO,TPE4:kO,TPOS:RO,TPRO:PO,TPUB:CO,TRCK:LO,TRDA:UO,TRSN:jO,TRSO:MO,TSIZ:DO,TSOA:BO,TSOC:FO,TSOP:_O,TSOT:NO,TSRC:VO,TSSE:GO,TSST:WO,TYER:YO,TXXX:$O,UFID:zO,USER:HO,USLT:KO,WCOM:XO,WCOP:JO,WFED:qO,TGID:ZO,WOAF:QO,WOAR:tx,WOAS:rx,WORS:ex,WPAY:nx,WPUB:ix,WXXX:ox});function ux(t){return"ID3"===new iw(t).getString(0,3).string}function cx(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=new iw(t,r),i=n.getUint8(3,2),o=_b(n.getUint32(6)),a=hm(n.getUint8(5),i[0]),u={version:i,flags:a,size:o},c={};if(3!==i[0]&&4!==i[0])throw new Error("Unknown ID3v2 major version");for(var s=10,f=o,l=function(t){switch(e(t.value)){case"number":case"string":t.value=t.value.toString(),c[t.id]?c[t.id]+="\\\\"+t.value:c[t.id]=t.value;break;case"object":["USER","OWNE","MCDI","RVAD","SYTC"].includes(t.id)?c[t.id]=t.value:c[t.id]?c[t.id].push(t.value):c[t.id]=[t.value]}};s<o;){var h=n.getUint8(s,f),v=sx(h,{version:i,flags:a});if(!v)break;if(s+=v.size+10,f-=v.size+10,"SEEK"===v.id){var g=cx(t,s+v.value);for(var p in g)l({id:p,value:g[p]})}else l({id:v.id,value:v.value})}return{tags:c,details:u}}function sx(t,r){var e=new iw(t);if(0===e.getUint8(0))return!1;var n={},i=r.version,o=r.flags,a=e.getUint32(4);n.id=e.getUint8String(0,4),n.flags=function(t,r){var e={};switch(r){case 3:e.tagAlterPreservation=Bb(t[0],7),e.fileAlterPreservation=Bb(t[0],6),e.readOnly=Bb(t[0],5),e.compression=Bb(t[1],7),e.encryption=Bb(t[1],6),e.groupingIdentity=Bb(t[1],5);break;case 4:e.tagAlterPreservation=Bb(t[0],6),e.fileAlterPreservation=Bb(t[0],5),e.readOnly=Bb(t[0],4),e.groupingIdentity=Bb(t[1],6),e.compression=Bb(t[1],3),e.encryption=Bb(t[1],2),e.unsynchronisation=Bb(t[1],1),e.dataLengthIndicator=Bb(t[1],0)}return e}(e.getUint8(8,2),i[0]),n.size=4===i[0]?_b(a):a;var u,c=ax[n.id],s=10,f=n.size,l=n.size;if(!c)return console.warn("Skipping unsupported frame: ".concat(n.id)),n;n.flags.dataLengthIndicator&&(f=_b(e.getUint32(s)),s+=4,l-=4);var h=o.unsynchronisation;if(4===i&&(h=n.flags.unsynchronisation),h){var v=e.getUint8(s,l),g=function(t){for(var r=[],e=0;e<t.length;)r.push(t[e]),255===t[e]&&0===t[e+1]&&e++,e++;return r}(Array.isArray(v)?v:[v]);u=new Uint8Array(g)}else{var p=e.getUint8(s,f);u=new Uint8Array(Array.isArray(p)?p:[p])}return n.value=c.parse(u.buffer,i[0]),n}function fx(t,r,e){var n=e.version;if(3!==n&&4!==n)throw new Error("Unknown provided version");for(var i in t)if(Object.keys(ax).includes(i)){var o=ax[i];if(r&&!o.version.includes(n))throw new Error("".concat(i," is not supported in ID3v2.").concat(n));try{o.validate(t[i],n,r)}catch(t){throw new Error("".concat(t.message," at ").concat(i))}}return!0}function lx(t,r){var e=r.version,n=r.padding,i=r.unsynch,o=[73,68,51,e,0],a=0,u=new iw(4),c=new Uint8Array(n),s=[];for(var f in t){ax[f].write(t[f],{id:f,version:e,unsynch:i}).forEach((function(t){return s.push(t)}))}return i&&(a=Fb(a,7)),u.setUint32(0,Nb(s.length)),Vb(o,a,u.getUint8(0,4),s,c).buffer}var hx=function(){function t(r){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(n(this,t),!nw(r))throw new TypeError("buffer is not ArrayBuffer/Buffer");this.name="MP3Tag",this.version="3.3.2",this.verbose=e,this.buffer=r,this.tags={},this.error=""}return o(t,[{key:"read",value:function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.tags={},this.error="";try{this.tags=t.readBuffer(this.buffer,r,this.verbose)}catch(t){this.error=t.message}return this.tags}},{key:"save",value:function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.error="";var e=this.buffer;try{e=t.writeBuffer(this.buffer,this.tags,r,this.verbose)}catch(t){this.error=t.message}return""===this.error&&(this.buffer=e),this.buffer}},{key:"remove",value:function(){return this.tags={},this.error="",this.buffer=this.getAudio(),!0}},{key:"getAudio",value:function(){return t.getAudioBuffer(this.buffer)}}],[{key:"readBuffer",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!nw(t))throw new TypeError("buffer is not ArrayBuffer/Buffer");var i={};if((e=gT(e,{id3v1:!0,id3v2:!0})).id3v1&&Yb(t)){n&&console.log("ID3v1 found, reading...");var o=$b(t),a=o.tags,u=o.details;n&&console.log("ID3v1 reading finished"),i.v1=r({},a),i.v1Details=u}if(e.id3v2&&ux(t)){n&&console.log("ID3v2 found, reading...");var c=cx(t),s=c.tags,f=c.details;n&&console.log("ID3v2 reading finished"),i.v2=r({},s),i.v2Details=f}return Object.defineProperties(i,{title:{get:function(){return this.v2&&this.v2.TIT2||this.v1&&this.v1.title||""},set:function(t){this.v2&&(this.v2.TIT2=t),this.v1&&(this.v1.title=t)}},artist:{get:function(){return this.v2&&this.v2.TPE1||this.v1&&this.v1.artist||""},set:function(t){this.v2&&(this.v2.TPE1=t),this.v1&&(this.v1.artist=t)}},album:{get:function(){return this.v2&&this.v2.TALB||this.v1&&this.v1.album||""},set:function(t){this.v2&&(this.v2.TALB=t),this.v1&&(this.v1.album=t)}},year:{get:function(){return this.v2&&(this.v2.TYER||this.v2.TDRC)||this.v1&&this.v1.year||""},set:function(t){if(this.v2){var r=this.v2Details.version[0];3===r?this.v2.TYER=t:4===r&&(this.v2.TDRC=t)}this.v1&&(this.v1.year=t)}},comment:{get:function(){var t="";if(this.v2&&this.v2.COMM){var r=this.v2.COMM;Array.isArray(r)&&r.length>0&&(t=r[0].text)}else this.v1&&this.v1.comment&&(t=this.v1.comment);return t},set:function(t){this.v2&&(this.v2.COMM=[{language:"eng",descriptor:"",text:t}]),this.v1&&(this.v1.comment=t)}},track:{get:function(){return this.v2&&this.v2.TRCK&&this.v2.TRCK.split("/")[0]||this.v1&&this.v1.track||""},set:function(t){this.v2&&(this.v2.TRCK=t),this.v1&&(this.v1.track=t)}},genre:{get:function(){return this.v2&&this.v2.TCON||this.v1&&this.v1.genre||""},set:function(t){this.v2&&(this.v2.TCON=t),this.v1&&(this.v1.genre=t)}}}),i}},{key:"writeBuffer",value:function(r,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=e.v2Details?e.v2Details.version[0]:3,a=new Uint8Array(t.getAudioBuffer(r));if((n=gT(n,{strict:!1,id3v1:{include:!1},id3v2:{include:!0,unsynch:!1,version:o,padding:2048}})).id3v1.include){i&&console.log("Validating ID3v1..."),zb(e.v1,n.strict),i&&console.log("Writing ID3v1...");var u=Hb(e.v1),c=new Uint8Array(u);a=Vb(a,c)}if(n.id3v2.include){i&&console.log("Validating ID3v2..."),fx(e.v2,n.strict,n.id3v2),i&&console.log("Writing ID3v2...");var s=lx(e.v2,n.id3v2),f=new Uint8Array(s);a=Vb(f,a)}return a.buffer}},{key:"getAudioBuffer",value:function(t){if(!nw(t))throw new TypeError("buffer is not ArrayBuffer/Buffer");Yb(t)&&(t=t.slice(0,t.byteLength-128));for(var r=new iw(t),e=0,n=0;n<r.byteLength;){if(255===r.getUint8(n)&&251===r.getUint8(n+1)){e=n;break}n++}return t.slice(e)}}]),t}();return hx}));class InstrumentManager{constructor(){this._locked=new Set();this._loaded=new Set();this._clones=new Map();}
reset(){this._locked=new Set();this._clones=new Map();}
numBaseInst(){return settings.instruments.length;}
instId(baseId,cloneIndex){console.assert(this.isBaseId(baseId),baseId);return baseId+cloneIndex*kCloneOffset;}
baseId(instId){return instId%kCloneOffset;}
cloneIndex(instId){return Math.floor(instId/kCloneOffset);}
isBaseId(instId){return instId<kCloneOffset;}
isClone(instId){return!this.isBaseId(instId);}
isValidId(instId){return settings.instruments[this.baseId(instId)]!=null;}
cloneInstrument(instId){const baseId=this.baseId(instId);const clones=this._getClonesFor(baseId);let cloneIndex=1;for(;cloneIndex<clones.length;++cloneIndex){if(!clones[cloneIndex])break;}
const cloneInstId=this.instId(baseId,cloneIndex);this.ensureLoaded(cloneInstId);return cloneInstId;}
deleteClone(instId){console.assert(this.isClone(instId));this._getClonesFor(this.baseId(instId))[this.cloneIndex(instId)]=false;}
undeleteClone(instId){console.assert(this.isClone(instId));const clones=this._getClonesFor(this.baseId(instId));const cloneIndex=this.cloneIndex(instId);console.assert(clones[cloneIndex]===false);clones[cloneIndex]=true;}
_getClonesFor(baseId){if(!this._clones.has(baseId))this._clones.set(baseId,[true]);return this._clones.get(baseId);}
ensureLoaded(instId){if(!this.isValidId(instId))return;if(this.isClone(instId)){const clones=this._getClonesFor(this.baseId(instId));const cloneIndex=this.cloneIndex(instId);if(!clones[cloneIndex]){clones[cloneIndex]=true;updateUiForInstrumentClones();}}
if(!this._loaded.has(instId)){this._loaded.add(instId);audioSystem.loadInstrument(instId);}}
_forEachClone(baseId,fn){fn(baseId);if(this._clones.has(baseId)){const clones=this._clones.get(baseId);for(let cloneIndex=1;cloneIndex<clones.length;++cloneIndex){if(clones[cloneIndex]){fn(this.instId(baseId,cloneIndex));}}}}
forEach(fn){for(let baseId=0;baseId<this.numBaseInst();++baseId){this._forEachClone(baseId,fn);}}
forEachByCategory(fn){for(const category in settings.instrumentCategories){for(const baseId of settings.instrumentCategories[category]){this._forEachClone(baseId,(instId)=>fn(category,instId));}}}
isLocked(instId){return this._locked.has(instId);}
setLocked(instId,lock){if(lock){this._locked.add(instId);}else{this._locked.delete(instId);}
return lock;}
toggleLocked(instId){return this.setLocked(instId,!this.isLocked(instId));}
isDrum(instId){const baseId=this.baseId(instId);return baseId==2||baseId==31||baseId==36||baseId==39||baseId==40||baseId==42||baseId==53;}
isSampler(instId){const baseId=this.baseId(instId);return baseId==41||(baseId>=43&&baseId<=52)||baseId==54||baseId>=56;}
isVariableLength(instId){return this.isSampler(instId)||this.isSynth(instId);}
getFadeTime(instId){return settings.fadeTimes[this.baseId(instId)]??1;}
getSamplerTimePerNote(instId){const baseId=this.baseId(instId);if(baseId==44){return 41;}else if(baseId==54||baseId==57||baseId==56){return 12;}else{return 16;}}
isSynth(instId){const baseId=this.baseId(instId);return(baseId>=13&&baseId<=16)||baseId===55;}
isCustomSynth(instId){return this.baseId(instId)===55;}
getSynthWaveform(i){return['sine','square','sawtooth','triangle'][i];}
synthType(instId){console.assert(this.isSynth(instId));const baseId=this.baseId(instId);return this.getSynthWaveform(baseId-13);}
isSustained(instId){const baseId=this.baseId(instId);return baseId==4||baseId==23||baseId==53||this.isSampler(instId)||this.isSynth(instId);}
isDarkColor(instId){const baseId=this.baseId(instId);return baseId==5||baseId==12||baseId==25||baseId==28||baseId==29||baseId==37||baseId==38||baseId==44||baseId==45||baseId==48||baseId==53||baseId==54;}
getTypingKeyboardOctaveOffset(instId){const baseId=this.baseId(instId);if(baseId==2||baseId==5)return 2;if(baseId==1||baseId==11||baseId==18)return 4;return 3;}
getBaseName(instId){return settings.instruments[this.baseId(instId)];}
getDefaultName(instId){const baseName=this.getBaseName(instId);const cloneIndex=this.cloneIndex(instId);return cloneIndex>0?`${baseName} ${cloneIndex + 1}`:baseName;}
protoName(instId,name){if(name==null)name='';return this.getDefaultName(instId)==name?'':name;}
getDisplayBaseInst(displayOrderIndex){return settings.instrumentDisplayOrder[displayOrderIndex];}
getKeyboardMin(instId){return settings.min[this.baseId(instId)];}
getKeyboardMax(instId){return settings.max[this.baseId(instId)];}
getVolume(instId){return settings.volume[this.baseId(instId)]??1;}
getOriginalBpm(instId){return settings.originalBpm[this.baseId(instId)];}
getNoteName(instId,i){if(i<this.getKeyboardMin(instId)||i>this.getKeyboardMax(instId)){return'';}
const j=settings.numNotes-i-1;const baseId=this.baseId(instId);if(baseId==2||baseId==31){return settings.percussion[j-8];}else if(baseId==36){return settings.percussion_808[j-51];}else if(baseId==39){return settings.percussion_8bit[j-59];}else if(baseId==40){return settings.percussion_2013[j-37];}else if(baseId==42){return settings.percussion_909[j-49];}else if(baseId==53){return settings.percussion_2023[j];}else{return piano[j];}}
getColor(instId){let[a,r,g,b]=settings.instrumentColors[this.baseId(instId)];if(this.isClone(instId)){const cloneIndex=this.cloneIndex(instId);r+=clamp(Math.round(32*Math.sin(cloneIndex*2.3)),0,255);g+=clamp(Math.round(32*Math.sin(cloneIndex*1.8)),0,255);b+=clamp(Math.round(32*Math.sin(cloneIndex*1.3)),0,255);}
return[255,r,g,b];}
getVolumeWeight(instId,noteType){const weight=settings.volumeWeights[instMgr.baseId(instId)];if(isNaN(weight)){return weight[noteType]??0;}else{return weight??1;}}
getMidiDrumNote(instId,noteIndex){const baseId=instMgr.baseId(instrument);if(baseId==36){return kMidiDrumMap808[noteIndex];}else if(baseId==39){return kMidiDrumMap8Bit[noteIndex];}else if(baseId==42){return kMidiDrumMap909[noteIndex];}else if(baseId==40){return kMidiDrumMap2013[noteIndex]}else{return noteIndex+12;}}}
const instMgr=new InstrumentManager();const kCloneOffset=settings.instrumentCloneOffset;const kMidiDrumMap808={36:39,37:56,38:44,39:43,49:49,41:51,42:47,46:48,};const kMidiDrumMap8Bit={36:43,37:47,38:46,39:48,49:44,41:43,42:45,46:45,};const kMidiDrumMap909={36:41,37:51,38:43,39:52,49:57,41:46,42:54,46:55,};const kMidiDrumMap2013={36:43,37:67,38:45,39:46,49:57,41:56,42:50,46:52,};const kSampleMap={41:['A1','C2','D#2','F#2','A2','C3','D#3','F#3','A3','C4','D#4','F#4','A4','C5','D#5','F#5','A5','C6','D#6','F#6','A6','C7','D#7','F#7','A7','C8'],43:['A1','C2','D#2','F#2','A2','C3','D#3','F#3','A3','C4','D#4','F#4','A4','C5','D#5','F#5','A5','C6','D#6','F#6','A6','C7','D#7','F#7','A7','C8'],44:['C3','D#3','F#3','A3','C4','D#4','F#4','A4','C5','D#5','F#5','A5','C6','D#6','F#6','A6','C7'],45:['C3','C#3','D3','D#3','E3','F3','F#3','G3','G#3','A3','A#3','B3','C4','C#4','D4','D#4','E4','F4','F#4','G4','G#4','A4','A#4','B4','C5','C#5','D5','D#5','E5','F5','F#5','G5','G#5','A5','A#5','B5','C6','C#6','D6','D#6','E6','F6','F#6','G6','G#6','A6','A#6','B6','C7',],46:['G4','A#4','C5','E5','G5','A#5','C6','E6','G6','A#6','C7','E7','G7','A#7','C8'],47:['A1','C2','D#2','F2','A2','C3','D#3','F3','A3','C4','D#4','F4','A4','C5','D#5','F5','A5','C6','D#6','F6','A6','C7','D#7','F7','A7','C8'],48:['E2','G2','A#2','C#3','E3','G3','A#3','C#4','E4','G4','A#4','C#5'],49:['C2','D2','E2','F#2','G#2','A#2','C3','D3','E3','F#3','G#3','A#3','C4','D4','E4','F#4','G#4','A#4','C5','D5','E5','F#5','G#5','A#5','C6','D6','E6','F#6','G#6','A#6','C7','D7','E7'],50:['G3','A#3','C4','E4','G4','A#4','C5','E5','G5','A#5','C6'],51:['G3','A#3','C4','E4','G4','A#4','C5','E5','G5','A#5','C6'],52:['C2','E2','G2','A#2','C3','E3','G3','A#3','C4','E4','G4','A#4','C5','E5','G5','A#5','C6','E6','G6','A#6','C7','E7','G7','A#7'],54:['C2','E2','G2','A#2','C3','E3','G3','A#3','C4','E4','G4','A#4'],56:['C2','E2','G2','A#2','C3','E3','G3','A#3','C4','E4','G4','A#4','C5','E5','G5','A#5','C6','E6','G6','A#6','C7','E7','G7','A#7'],57:['C2','E2','G2','A#2','C3','E3','G3','A#3','C4','E4','G4','A#4','C5','E5','G5','A#5','C6','E6','G6','A#6','C7','E7','G7','A#7'],};const fileNamePattern=/\/([A-Za-z0-9_]+\.[a-z]{3})\?*/;class AsyncCache{constructor(){this.map=new Map();}
get(key,factory){if(this.map.has(key))return this.map.get(key);let promiseRunning=false;const promise=new Promise((resolve,reject)=>{window.setTimeout(async()=>{promiseRunning=true;try{resolve(await factory());}catch(e){reject(e);}},0);});this.map.set(key,promise);console.assert(!promiseRunning);return promise;}}
class SampleManager{static _sampleTypeEnum=Object.freeze({INSTRUMENT:0,REVERB:1,METRONOME:2,});_isLoading=false;_progressBar=null;constructor(){this.samples=new AsyncCache();this.progress=new Map();this.samplers=new AsyncCache();this.waveShaperCurves=[];this.onAllLoadedCallbacks=[];}
_getProgress(){let bytesTotal=0;let bytesReceived=0;for(const prog of this.progress.values()){bytesReceived+=prog[0];bytesTotal+=prog[1];}
if(bytesTotal==0){return 1;}else{return bytesReceived/bytesTotal;}}
addOnAllLoadedCallback(fn){const progress=this._getProgress();if(progress>=1){fn();}else{this.onAllLoadedCallbacks.push(fn);}}
async updateProgress(){const progress=this._getProgress();await this._progressBar.setProgress(progress);if(progress>=1||isNaN(progress)){this._isLoading=false;this._progressBar.complete();onLoadSoundComplete();for(const fn of this.onAllLoadedCallbacks)fn();this.onAllLoadedCallbacks=[];this.progress=new Map();}}
getSamplerInstrument(ctx,instId){const baseId=instMgr.baseId(instId);return this.samplers.get(baseId,async()=>{const sample=await this._getSample(ctx,'/app/instruments/sampler/'+baseId+'.'+window.audioFormat+'?v='+settings.audioVersion,instId,SampleManager._sampleTypeEnum.INSTRUMENT);return new Sampler(baseId,kSampleMap[baseId],sample,instMgr.getKeyboardMin(baseId));});}
getInstrument(ctx,instId){const baseId=instMgr.baseId(instId);let url=null;if(settings.offline){url=audioData[baseId+'.'+window.audioFormat];}else{url='/app/instruments/'+baseId+'.'+window.audioFormat+'?v='+settings.audioVersion;}
return this._getSample(ctx,url,instId,SampleManager._sampleTypeEnum.INSTRUMENT);}
getConvolver(ctx,convId){return this._getSample(ctx,'/app/impulses/'+kReverbData[convId].impulse,convId,SampleManager._sampleTypeEnum.REVERB);}
getMetronome(ctx){return this._getSample(ctx,'/app/metronome.wav',null,SampleManager._sampleTypeEnum.METRONOME);}
_getLoadingTitle(id,sampleType){if(sampleType==SampleManager._sampleTypeEnum.INSTRUMENT){return'"'+getInstrumentName(null,id)+'"';}else if(sampleType==SampleManager._sampleTypeEnum.REVERB){return'"'+kReverbData[id].name+'" Reverb';}else if(sampleType==SampleManager._sampleTypeEnum.METRONOME){return'"Metronome"';}else{return'<Unknown>';}}
_getSample(ctx,url,id,sampleType){return this.samples.get(url,async()=>{activateLoading();if(this._isLoading){await this._progressBar.setTitle('Loading samples...');}else{this._isLoading=true;this._progressBar=new ProgressBar();await this._progressBar.setScale(0.7);await this._progressBar.setTitle('Loading '+this._getLoadingTitle(id,sampleType)+'...');}
await this._progressBar.start();let filename=fileNamePattern.exec(url)[1];let total=settings.sampleSize[filename]*1.1;this.progress.set(url,[0,total]);await this.updateProgress();const response=await asyncXMLHttpRequest(url,'arraybuffer',async e=>{this.progress.set(url,[Math.min(total,e.loaded),total]);await this.updateProgress();});const buffer=await ctx.decodeAudioData(response);this.progress.set(url,[total,total]);await this.updateProgress();return buffer;});}
getWaveShaperCurve(kind){if(this.waveShaperCurves[kind]==null){const data=kDistortData[kind];const shaper=new Float32Array(2*kDistortCurveResolution+1);for(let i=0;i<shaper.length;++i){const x=i/kDistortCurveResolution-1;shaper[i]=data.curve(x);}
this.waveShaperCurves[kind]=shaper;}
return this.waveShaperCurves[kind];}}
const sampleManager=new SampleManager();class SamplerNote{constructor(sample,timeOffset,semiTones){this.sample=sample;this.timeOffset=timeOffset;this.detune=semiTones*100;}}
class Sampler{constructor(baseId,noteNames,sample,offset=0){this.offset=offset;this.samplerNotes=[];const noteIds=noteNames.map(name=>noteNameToIndex(name));const first=instMgr.getKeyboardMin(baseId);for(let i=first,j=0;i<=instMgr.getKeyboardMax(baseId);++i){while(j<noteIds.length&&noteIds[j]<i)++j;const lower=j>0?i-noteIds[j-1]:Infinity;const upper=j<noteIds.length?noteIds[j]-i:Infinity;const timePerNote=instMgr.getSamplerTimePerNote(baseId);if(lower<upper){const timeOffset=(j-1)*timePerNote;this.samplerNotes[i-first]=new SamplerNote(sample,timeOffset,lower);}else{const timeOffset=j*timePerNote;this.samplerNotes[i-first]=new SamplerNote(sample,timeOffset,-upper);}}}
getNote(i){return this.samplerNotes[i-this.offset];}}
const kMp3Bitrate=256;const kLFOVolume=0;const kLFOPitch=1;const kLFOFilter=2;const kLFOFactors={};kLFOFactors[kLFOVolume]=1/100;kLFOFactors[kLFOPitch]=2;kLFOFactors[kLFOFilter]=200;const kFilterTypes=['lowpass','highpass','bandpass'];class AudioSystemEq{constructor(ctx,toNode){this.low=0;this.mid=0;this.high=0;const kLowFrequency=100;const kHighFrequency=3000;const kMidFrequency=Math.sqrt(kLowFrequency*kHighFrequency);const kMidFilterQ=0.3;this.lowNode=ctx.createBiquadFilter();this.lowNode.type='lowshelf';this.lowNode.frequency.value=kLowFrequency;this.midNode=ctx.createBiquadFilter();this.midNode.type='peaking';this.midNode.frequency.value=kMidFrequency;this.midNode.Q.value=kMidFilterQ;this.highNode=ctx.createBiquadFilter();this.highNode.type='highshelf';this.highNode.frequency.value=kHighFrequency;this.lowNode.connect(this.midNode);this.midNode.connect(this.highNode);this.highNode.connect(toNode);}
cancelScheduledValues(t){this.lowNode.gain.cancelScheduledValues(t);this.midNode.gain.cancelScheduledValues(t);this.highNode.gain.cancelScheduledValues(t);}
setEq(low,mid,high){this.lowNode.gain.setValueAtTime(low,0);this.midNode.gain.setValueAtTime(mid,0);this.highNode.gain.setValueAtTime(high,0);this.low=low;this.mid=mid;this.high=high;}
disconnect(toNode){this.highNode.disconnect(toNode);}}
class AudioSystemReverb{constructor(ctx,toNode){this.kind=0;this.volume=1;this.wetNode=ctx.createGain();this.dryNode=ctx.createGain();this.wetNode.gain.value=0;this.dryNode.gain.value=1;this.dryNode.connect(toNode);}
blendVolume(volume,t){if(this.kind!=0){this.wetNode.gain.linearRampToValueAtTime(volume,t);this.dryNode.gain.linearRampToValueAtTime(1-volume,t);}}
cancelScheduledValues(t){if(this.kind!=0){this.wetNode.gain.cancelScheduledValues(t);this.dryNode.gain.cancelScheduledValues(t);}}}
class AudioSystemStereoPan{constructor(ctx,toNode){this.panNode=ctx.createStereoPanner();this.panNode.connect(toNode);this.pan=0;}
setPan(value){this.pan=value;this.panNode.pan.setValueAtTime(value,0);}
blendPan(value,t){this.panNode.pan.linearRampToValueAtTime(value,t);}
cancelScheduledValues(t){this.panNode.pan.cancelScheduledValues(t);}}
class AudioSystemDistort{constructor(ctx,toNode){this.kind=0;this.volume=0;this.dryNode=ctx.createGain();this.postNode=ctx.createGain();this.dryNode.gain.value=1;this.postNode.gain.value=1;this.dryNode.connect(this.postNode);this.postNode.connect(toNode);this.shaperNode=null;this.wetNode=null;}
reconnect(oldToNode,newToNode){this.postNode.disconnect(oldToNode);this.postNode.connect(newToNode);}
setDistort(ctx,kind,volume,fromNode){if(kind!=this.kind){if(kind!=0){if(this.shaperNode==null){this.shaperNode=ctx.createWaveShaper();this.wetNode=ctx.createGain();this.shaperNode.connect(this.wetNode);this.shaperNode.oversample='none';this.wetNode.connect(this.postNode);fromNode.connect(this.shaperNode);}
this.shaperNode.curve=sampleManager.getWaveShaperCurve(kind);}else{if(this.shaperNode!=null){this.wetNode.disconnect(this.postNode);this.shaperNode.disconnect(this.wetNode);fromNode.disconnect(this.shaperNode);this.shaperNode=null;this.wetNode=null;}}}
if(kind!=0){this.wetNode.gain.setValueAtTime(volume,0);this.dryNode.gain.setValueAtTime(1-volume,0);}else{this.dryNode.gain.setValueAtTime(1,0);}
this.kind=kind;this.volume=volume;}
blendVolume(volume,t){if(this.kind!=0){this.wetNode.gain.linearRampToValueAtTime(volume,t);this.dryNode.gain.linearRampToValueAtTime(1-volume,t);}}
cancelScheduledValues(t){if(this.kind!=0){this.wetNode.gain.cancelScheduledValues(t);this.dryNode.gain.cancelScheduledValues(t);}}}
class AudioSystemInstrument{constructor(ctx,destNode,instId){this.ctx=ctx;this.instId=instId;this.volume=1;this.delay=false;this.detune=0;this.disabledByMute=false;this.disabledBySolo=false;this.reverb=new AudioSystemReverb(ctx,destNode);this.gainNode=ctx.createGain();this.gainNode.connect(this.reverb.wetNode);this.gainNode.connect(this.reverb.dryNode);this.pan=new AudioSystemStereoPan(ctx,this.gainNode);this.distort=new AudioSystemDistort(ctx,this.pan.panNode);this.inputNode=ctx.createGain();this.inputNode.gain.value=1;this.inputNode.connect(this.distort.dryNode);this.eq=null;this.sound=null;this.synth=null;this.sampler=null;this.updateVolume();}
enabled(){return!(this.disabledByMute||this.disabledBySolo);}
getSynthNote(i){if(this.synth==null){if(instMgr.isCustomSynth(this.instId)){this.synth=new AudioSystemSynth(this.ctx);}else{this.synth=new AudioSystemLegacySynth(this.instId);}}
return this.synth.getNote(this.ctx,this.inputNode,i);}
setVolume(value){this.volume=value;this.updateVolume();}
blendVolume(value,t){if(this.enabled()){this.gainNode.gain.linearRampToValueAtTime(value*instMgr.getVolume(this.instId),t);}}
updateVolume(){if(this.enabled()){this.gainNode.gain.setValueAtTime(this.volume*instMgr.getVolume(this.instId),0);}else{this.gainNode.gain.setValueAtTime(0,0);}}
setPan(value){this.pan.setPan(value);}
blendPan(value,t){this.pan.blendPan(value,t);}
setEq(enabled,low,mid,high){if(enabled){if(this.eq==null){this.eq=new AudioSystemEq(this.ctx,this.pan.panNode);this.distort.reconnect(this.pan.panNode,this.eq.lowNode);}
this.eq.setEq(low,mid,high);}else{if(this.eq){this.eq.disconnect(this.pan.panNode);this.distort.reconnect(this.eq.lowNode,this.pan.panNode);this.eq=null;}}}
setEqHigh(high){if(this.eq)this.eq.highNode.gain.setValueAtTime(high,0);}
setEqMid(mid){if(this.eq)this.eq.midNode.gain.setValueAtTime(mid,0);}
setEqLow(low){if(this.eq)this.eq.lowNode.gain.setValueAtTime(low,0);}
blendEqHigh(hi,t){this.eq?.highNode.gain.linearRampToValueAtTime(hi,t);}
blendEqMid(mid,t){this.eq?.midNode.gain.linearRampToValueAtTime(mid,t);}
blendEqLow(low,t){this.eq?.lowNode.gain.linearRampToValueAtTime(low,t);}
blendReverbVolume(volume,t){this.reverb.blendVolume(volume,t);}
setDistortType(kind){this.setDistort(kind,this.distort.volume);}
setDistortGain(volume){this.setDistort(this.distort.kind,volume);}
blendDistortGain(volume,t){this.distort.blendVolume(volume,t);}
setDistort(kind,gain){this.distort.setDistort(this.ctx,kind,gain,this.inputNode);}
startLFO(){this.synth.startLFO();}
stopLFO(){this.synth.stopLFO();}
cancelScheduledValues(t){this.gainNode.gain.cancelScheduledValues(t);this.pan.cancelScheduledValues(t);this.eq?.cancelScheduledValues(t);this.reverb.cancelScheduledValues(t);this.distort.cancelScheduledValues(t);}}
class AudioSystemLegacySynth{constructor(instId){this.oscillatorType=instMgr.synthType(instId);this.notes=[];}
getNote(ctx,inputNode,i){if(this.notes[i]==null){this.notes[i]=new AudioSystemLegacySynthNote(ctx,this.oscillatorType,i,inputNode);}
return this.notes[i];}}
class AudioSystemSynth{constructor(ctx){this.synthId='sine';this.lfoType='sine';this.context=ctx;this.filter=ctx.createBiquadFilter();this.filter.type='lowpass';this.filter.frequency.value=20000;this.filter.Q.value=10;this.lfoIntensity=ctx.createGain();this.lfoIntensity.gain.value=0.0;this.lastLFOFreq=2;this.lfoGain=ctx.createGain();this.lfoTarget=kLFOVolume;this.filter.connect(this.lfoGain);this.envelopeEnabled=false;this.attack=0;this.decay=0;this.sustain=0;this.release=0;this.setLFORate(4);}
setSynthType(value){this.synthId=value;}
setFilter(value){this.filter.frequency.value=value;}
blendFilter(value,t){this.filter.frequency.linearRampToValueAtTime(value,t);}
setFilterType(value){this.filter.type=kFilterTypes[value];}
setFilterQ(value){this.filter.Q.value=value;}
blendFilterQ(value,t){this.filter.Q.linearRampToValueAtTime(value,t);}
createLFO(){if(this.lfo)return;this.lfo=this.context.createOscillator();this.lfo.type=this.lfoType;this.lfo.frequency.value=this.lastLFOFreq;this.lfo.connect(this.lfoIntensity);if(this.lfoTarget===kLFOVolume){this.lfoIntensity.connect(this.lfoGain.gain);}else if(this.lfoTarget===kLFOFilter){this.lfoIntensity.connect(this.filter.frequency);}}
destroyLFO(){if(!this.lfo)return;this.lfo.disconnect(this.lfoIntensity);this.lfoIntensity.disconnect();this.lfo=null;}
remapLFOTarget(){try{this.lfoIntensity.disconnect();if(this.lfoTarget===kLFOVolume){this.lfoIntensity.connect(this.lfoGain.gain);}else if(this.lfoTarget===kLFOFilter){this.lfoIntensity.connect(this.filter.frequency);}}catch{console.warn('[Synth] Failed to remap LFO target');}}
setLFOFrequency(value){this.lastLFOFreq=value;if(this.lfo){this.lfo.frequency.value=value;}}
blendLFOFrequency(value,t){this.lastLFOFreq=value;if(this.lfo){this.lfo.frequency.linearRampToValueAtTime(value,t);}}
setLFORate(denom){this.setLFOFrequency(denom*(bpm/60)/getTimeSig());}
setLFOIntensity(value){this.lfoIntensity.gain.value=value;}
blendLFOIntensity(value,t){this.lfoIntensity.gain.linearRampToValueAtTime(value,t);}
setLFOEnabled(lfoEnabled,restart=true){this.lfoEnabled=lfoEnabled;if(restart){if(!this.lfoEnabled){this.stopLFO();}else{try{this.startLFO();}catch{}}}}
startLFO(){this.createLFO();try{if(this.lfoEnabled){this.lfo.start();}}catch{}}
stopLFO(){try{this.lfo.stop();}catch{}
this.destroyLFO();}
setLFOType(value){this.lfoType=value;if(this.lfo){this.lfo.type=value;}}
setLFOTarget(target,remap=true){this.lfoTarget=target;if(remap){this.remapLFOTarget();}}
setADSREnabled(value){this.envelopeEnabled=value;}
setAttack(value){this.attack=value}
blendAttack(value,t){this.attack=value}
setDecay(value){this.decay=value}
blendDecay(value,t){this.decay=value}
setSustain(value){this.sustain=value}
blendSustain(value,t){this.sustain=value}
setRelease(value){this.release=value}
blendRelease(value,t){this.release=value}
getNote(ctx,toNode,i){this.lfoGain.connect(toNode);return new AudioSystemSynthNote(ctx,this.synthId,i,this.filter,this.attack,this.decay,this.sustain,this.release,this.envelopeEnabled,(this.lfoTarget===kLFOPitch)?this.lfoIntensity:null);}}
class AudioSystemLegacySynthNote{constructor(ctx,oscillatorType,i,toNode){this.oscillatorNode=ctx.createOscillator();this.oscillatorNode.type=oscillatorType;this.oscillatorNode.frequency.value=getFrequency(i);this.gainNode=ctx.createGain();this.gainNode.gain.value=0;this.oscillatorNode.connect(this.gainNode);this.gainNode.connect(toNode);this.offTime=0;this.initDetune=0;this.oscillatorNode.start(0);}}
class AudioSystemEnvelopeGenerator{constructor(ctx,attack,decay,sustain,release){this.context=ctx;this.gain=this.context.createGain();this.attack=attack;if(this.attack<1.40130e-45)this.attack=0.001;this.decay=decay;if(this.decay<1.40130e-45)this.decay=0.001;this.sustain=sustain;if(this.sustain<1.40130e-45)this.sustain=0.001;this.release=release;if(this.release<1.40130e-45)this.release=0.001;}
trigger(){const time=this.context.currentTime;this.gain.gain.setValueAtTime(0,time);this.gain.gain.linearRampToValueAtTime(1,time+this.attack);this.gain.gain.linearRampToValueAtTime(this.sustain,time+this.attack+this.decay);}
end(endTime){if(typeof this.gain.gain.cancelAndHoldAtTime=='function'){this.gain.gain.cancelAndHoldAtTime(endTime);}else{let holdValue=this.gain.gain.value;this.gain.gain.cancelScheduledValues(endTime);this.gain.gain.value=holdValue;}
this.gain.gain.linearRampToValueAtTime(0,endTime+this.release+0.01);return endTime+this.release+0.02;}}
class AudioSystemSynthNote{constructor(ctx,synthType,i,toNode,attack,decay,sustain,release,useADSR,pitchControl=null,functionOnEnd=()=>{}){this.oscillatorNode=ctx.createOscillator();this.oscillatorNode.type=synthType??'sine';this.oscillatorNode.frequency.value=getFrequency(i);this.gainNode=ctx.createGain();this.gainNode.gain.value=0;this.oscillatorNode.connect(this.gainNode);this.offTime=0;this.initDetune=0;this.hasEnvelope=useADSR;if(useADSR){this.envelope=new AudioSystemEnvelopeGenerator(ctx,attack,decay,sustain,release);this.gainNode.connect(this.envelope.gain);this.envelope.gain.connect(toNode);}else{this.gainNode.connect(toNode);}
if(pitchControl){pitchControl.connect(this.oscillatorNode.detune);}
this.setupEndedEvents=(offTime)=>{if(useADSR){this.envelope.end(offTime);}else{this.gainNode.gain.setTargetAtTime(0,offTime,0.01);}
setTimeout(()=>{try{if(pitchControl){pitchControl.disconnect(this.oscillatorNode.detune);}
this.oscillatorNode.stop();this.oscillatorNode.disconnect();this.gainNode.disconnect();}catch{}
if(functionOnEnd){functionOnEnd();}},(offTime-ctx.currentTime+release+0.01)*1000);};this.oscillatorNode.start(0);}}
class AudioSystem{constructor(offline,sampleRate,songLengthInSeconds){this.sampleRate=sampleRate;this.songLengthInSeconds=songLengthInSeconds;this.offline=offline;this.unsupportedBrowser=false;this.instruments=new Map();this.songVolume=1;this.finalVolume=1;this.baseDelayTime=0;this.unconvolvedDelay=null;this.convolvers=new Map();this.soloingInstrument=null;this.trackedNotes=new Map();this.trackedNoteTimeouts=new Map();this.manuallyTrackedNotes=new Map();this.play=null;this.isMp3=true;this.hasAudioRecorder=false;this.recording=false;this.onRecordingFinish=null;this.audioTrack=null;this.audioTrackSource=null;this.audioTrackPlaying=false;this.metronome=null;window.addEventListener('click',this.unlock_sound,false);window.addEventListener('touchend',this.unlock_sound,false);}
createDelayNodes(dest){const delayInput=this.audioContext.createGain();const delayAGain=this.audioContext.createGain();const delayBGain=this.audioContext.createGain();const delayA=this.audioContext.createDelay(10);const delayB=this.audioContext.createDelay(10);delayInput.gain.value=1;delayAGain.gain.value=0.5;delayBGain.gain.value=0.25;delayInput.connect(delayA);delayInput.connect(delayB);delayA.connect(delayAGain);delayB.connect(delayBGain);delayAGain.connect(dest);delayAGain.connect(delayB);delayBGain.connect(dest);const update=()=>{delayA.delayTime.value=this.baseDelayTime;delayB.delayTime.value=2*this.baseDelayTime;};update();return{input:delayInput,update:update,};}
init(){if(this.offline&&typeof OfflineAudioContext!='undefined'&&OfflineAudioContext.prototype.suspend!=null){this.play=(instId,note,length,delay,volume,trackNote)=>this.playWebkit(instId,note,length,delay,volume,trackNote);const bufferSize=this.sampleRate*(this.songLengthInSeconds+10);this.audioContext=new OfflineAudioContext(2,bufferSize,this.sampleRate);}else{this.offline=false;if(typeof AudioContext!='undefined'){this.play=(instId,note,length,delay,volume,trackNote)=>this.playWebkit(instId,note,length,delay,volume,trackNote);this.audioContext=new AudioContext();}else{this.play=()=>{};this.unsupportedBrowser=true;return;}}
this.finalGain=this.audioContext.createGain();this.finalGain.connect(this.audioContext.destination);this.clamp=this.audioContext.createWaveShaper();this.clamp.oversample='none';this.clamp.curve=new Float32Array([-1,1]);this.clamp.connect(this.finalGain);this.destination=this.audioContext.createGain();this.destination.connect(this.clamp);this.unconvolvedDelay=this.createDelayNodes(this.destination);}
unlock_sound(){if(this.audioContext==null)return;if(this.offline)return;this.audioContext.resume().then(()=>{var buffer=this.audioContext.createBuffer(1,1,22050);var source=this.audioContext.createBufferSource();source.buffer=buffer;source.connect(this.destination);source.start?source.start(0):source.noteOn(0);});window.removeEventListener('click',this.unlock_sound,false);window.removeEventListener('touchend',this.unlock_sound,false);}
setTimeout(callback,timeMs){this.audioContext.suspend(this.time()+timeMs/1000).then(()=>{callback();this.audioContext.resume();});}
time(){return this.audioContext.currentTime;}
prepareRecording(){this.recording=true;SequencerView.fastGraphics=true;SequencerView.repaint();if(this.offline){return;}
var startRecording=()=>{this.rawAudioRecorder=new AudioWorkletNode(this.audioContext,'RawAudioRecorder');this.finalGain.disconnect(this.audioContext.destination);this.finalGain.connect(this.rawAudioRecorder);this.rawAudioRecorder.connect(this.audioContext.destination);this.rawAudioRecorder.port.onmessage=e=>{this.encodeAudio(e.data[0],e.data[1]);};};if(!this.hasAudioRecorder){this.audioContext.audioWorklet.addModule('/app/raw_audio_recorder.js').then(startRecording);this.hasAudioRecorder=true;}else{startRecording();}}
startRecording(onFinish){if(!this.recording)return;this.onRecordingFinish=onFinish;if(this.offline){this.audioContext.startRendering().then(buffer=>{this.stopRecording(buffer);});}}
encodeMp3(left,right){let l=toInt16Array(left);let r=toInt16Array(right);console.assert(l.length==r.length);const[start,end]=trimSilence(l,r);l=l.subarray(start,end);r=r.subarray(start,end);let encoder=new lamejs.Mp3Encoder(2,this.audioContext.sampleRate,kMp3Bitrate);const blk=1152;let data=[];function add(d){if(d.length>0)data.push(d);}
for(let i=0;i<l.length;i+=blk){add(encoder.encodeBuffer(l.subarray(i,i+blk),r.subarray(i,i+blk)));}
add(encoder.flush());const author=document.querySelector('#sequence_info a[href^="/members/"]')?.textContent;let authorName=author;if(!author&&settings&&settings.username){authorName=settings.username;}
let mp3Blob=new Blob(data,{type:'audio/mp3'});mp3Blob.arrayBuffer().then((a)=>{let mp3Tag=new MP3Tag(a);mp3Tag.tags.v2={};mp3Tag.tags.v2.TIT2=getTitle();mp3Tag.tags.v2.TPE1=authorName;mp3Blob=mp3Tag.save();saveBlob(getTitle()+'.mp3',[mp3Blob],'audio/mp3');});}
encodeWav(left,right){let l=toInt16Array(left);let r=toInt16Array(right);console.assert(l.length==r.length);const[start,end]=trimSilence(l,r);l=l.subarray(start,end);r=r.subarray(start,end);const bitsPerSample=16;const samplesPerSec=Math.floor(this.audioContext.sampleRate);const channels=2;const sizeOfRIFFChunk=12;const sizeOfFormatChunk=24;const sizeOfDataChunk=l.byteLength+r.byteLength+8;const data=new Uint8Array(sizeOfRIFFChunk+sizeOfFormatChunk+sizeOfDataChunk);let i=0;function splitNumToBytesAndAdd(n,bytes){for(let j=0;j<bytes;j++){data[i+j]=n&255;n>>=8;}
i+=bytes;}
function add(...elems){for(let j=0;j<elems.length;j++){data[i+j]=elems[j];}
i+=elems.length;}
{add(0x52,0x49,0x46,0x46);splitNumToBytesAndAdd(data.length-8,4);add(0x57,0x41,0x56,0x45);add(0x66,0x6d,0x74,0x20);splitNumToBytesAndAdd(sizeOfFormatChunk-8,4);add(0x1,0x0);add(channels,0x0);splitNumToBytesAndAdd(samplesPerSec,4);splitNumToBytesAndAdd(channels*samplesPerSec*bitsPerSample/8,4);splitNumToBytesAndAdd(channels*bitsPerSample/8,2);add(bitsPerSample,0x0);add(0x64,0x61,0x74,0x61);splitNumToBytesAndAdd(sizeOfDataChunk-8,4);}
for(let j=0;j<l.length;j++){splitNumToBytesAndAdd(l[j],2);splitNumToBytesAndAdd(r[j],2);}
saveBlob(getTitle()+'.wav',[data],'audio/wav');}
encodeAudio(left,right){this.isMp3?this.encodeMp3(left,right):this.encodeWav(left,right);}
stopRecording(offlineBuffer){if(!this.recording)return;this.recording=false;if(this.onRecordingFinish!=null)this.onRecordingFinish();SequencerView.fastGraphics=initialFastGraphics;SequencerView.repaint();if(!this.offline){this.rawAudioRecorder.port.postMessage('stop');this.finalGain.disconnect(this.rawAudioRecorder);this.finalGain.connect(this.audioContext.destination);this.rawAudioRecorder.disconnect(this.audioContext.destination);}else if(offlineBuffer!=null){this.encodeAudio([offlineBuffer.getChannelData(0)],[offlineBuffer.getChannelData(1)]);}}
setTimePerNote(time){this.setBaseDelayTime(time/500);}
setBaseDelayTime(time){this.baseDelayTime=time;this.unconvolvedDelay.update();for(const convolver of this.convolvers.values()){if(convolver.delay)convolver.delay.update();}}
setDelay(instId,delay){const inst=this.loadInstrument(instId);if(delay!=inst.delay){this.setDelayAndReverb(inst,delay,inst.reverb.kind,inst.reverb.volume);}}
getConvolver(reverbType,needDelay){if(reverbType==0){return{dest:this.destination,delay:this.unconvolvedDelay,};}
if(!this.convolvers.has(reverbType)){const convolver=this.audioContext.createConvolver();this.convolvers.set(reverbType,{dest:convolver,delay:null,});sampleManager.getConvolver(this.audioContext,reverbType).then(buffer=>{convolver.normalize=(reverbType==1);convolver.buffer=buffer;convolver.connect(this.destination);});}
const convolver=this.convolvers.get(reverbType);if(needDelay&&convolver.delay==null){if(reverbType==1){convolver.delay=this.unconvolvedDelay;}else{convolver.delay=this.createDelayNodes(convolver.dest);}}
return convolver;}
setReverb(instId,reverbType){const inst=this.loadInstrument(instId);if(reverbType!=inst.reverb.kind){this.setDelayAndReverb(inst,inst.delay,reverbType,inst.reverb.volume);}}
setReverbVolume(instId,volume){const inst=this.loadInstrument(instId);this.setDelayAndReverb(inst,inst.delay,inst.reverb.kind,volume);}
blendReverbVolume(instId,volume,dt){this.loadInstrument(instId).blendReverbVolume(volume,this.time()+dt);}
setDelayAndReverb(inst,delay,reverbType,reverbVolume){const oldDelay=inst.delay;const oldReverb=inst.reverb.kind;const oldConv=this.getConvolver(oldReverb,oldDelay);const newConv=this.getConvolver(reverbType,delay);try{if(oldReverb){inst.reverb.wetNode.disconnect(oldConv.dest);if(oldDelay)inst.reverb.wetNode.disconnect(oldConv.delay.input);}
if(oldDelay)inst.reverb.dryNode.disconnect(this.unconvolvedDelay.input);}catch(e){console.log(inst.instId,oldDelay,delay,oldReverb,reverbType,reverbVolume,e);}
if(reverbType){inst.reverb.wetNode.connect(newConv.dest);inst.reverb.wetNode.gain.setValueAtTime(reverbVolume,0);inst.reverb.dryNode.gain.setValueAtTime(1-reverbVolume,0);if(delay)inst.reverb.wetNode.connect(newConv.delay.input);}else{inst.reverb.dryNode.gain.setValueAtTime(1,0);}
if(delay)inst.reverb.dryNode.connect(this.unconvolvedDelay.input);inst.delay=delay;inst.reverb.kind=reverbType;inst.reverb.volume=reverbVolume;}
setVolume(volume){this.destination.gain.setValueAtTime(this.songVolume=volume,this.time());}
blendVolume(volume,dt){this.destination.gain.linearRampToValueAtTime(volume,this.time()+dt);}
setFinalVolume(volume){this.finalGain.gain.setValueAtTime(this.finalVolume=volume,this.time());}
setInstrumentVolume(instId,value){this.loadInstrument(instId).setVolume(value);}
getInstrumentVolume(instId){return this.instruments.get(instId)?.volume??1;}
blendInstrumentVolume(instId,value,dt){this.instruments.get(instId)?.blendVolume(value,this.time()+dt);}
updateVolume(instId){this.instruments.get(instId)?.updateVolume();}
setPan(instId,value){this.loadInstrument(instId).setPan(value);}
blendPan(instId,value,dt){this.instruments.get(instId)?.blendPan(value,this.time()+dt);}
setDetune(instId,value){value=parseFloat(value);this.loadInstrument(instId).detune=value;this.blendDetune(instId,value,0.01);}
blendDetune(instId,value,dt){var t=this.time()+dt;this.forEachTrackedNote(instId,note=>{note.detune.linearRampToValueAtTime(value+numSan(note.initDetune),t);});}
setEqHigh(instId,high){this.instruments.get(instId)?.setEqHigh(high);}
setEqMid(instId,mid){this.instruments.get(instId)?.setEqMid(mid);}
setEqLow(instId,low){this.instruments.get(instId)?.setEqLow(low);}
blendEqHigh(instId,high,dt){this.instruments.get(instId)?.blendEqHigh(high,this.time()+dt);}
blendEqMid(instId,mid,dt){this.instruments.get(instId)?.blendEqMid(mid,this.time()+dt);}
blendEqLow(instId,low,dt){this.instruments.get(instId)?.blendEqLow(low,this.time()+dt);}
setEq(instId,enabled,low,mid,high){this.loadInstrument(instId).setEq(enabled,low,mid,high);}
setDistort(instId,kind,gain){this.loadInstrument(instId).setDistort(kind,gain);}
setDistortType(instId,kind){this.instruments.get(instId)?.setDistortType(kind);}
setDistortGain(instId,gain){this.instruments.get(instId)?.setDistortGain(gain);}
blendDistortGain(instId,gain,dt){this.instruments.get(instId)?.blendDistortGain(gain,this.time()+dt);}
setSynthType(instId,type,refresh=true){this.instruments.get(instId)?.synth.setSynthType(type,refresh);}
setSynthFilter(instId,value){this.instruments.get(instId)?.synth.setFilter(value);}
blendSynthFilter(instId,value,dt){this.instruments.get(instId).synth.blendFilter(value,this.time()+dt);}
setSynthFilterType(instId,value){this.instruments.get(instId)?.synth.setFilterType(value);}
setSynthFilterResonance(instId,value){this.instruments.get(instId)?.synth.setFilterQ(value);}
blendSynthFilterResonance(instId,value,dt){this.instruments.get(instId).synth.blendFilterQ(value,this.time()+dt);}
setLFOEnabled(instId,value,restart=true){this.instruments.get(instId)?.synth.setLFOEnabled(value,restart);}
setLFOIntensity(instId,value){this.instruments.get(instId)?.synth.setLFOIntensity(value);}
blendLFOIntensity(instId,value,dt){this.instruments.get(instId)?.synth.blendLFOIntensity(value,dt);}
setLFORate(instId,value,asFreq=false){if(asFreq){this.instruments.get(instId)?.synth.setLFOFrequency(value);}else{this.instruments.get(instId)?.synth.setLFORate(value);}}
blendLFORateHz(instId,value,dt){this.instruments.get(instId).synth.blendLFOFrequency(value,this.time()+dt);}
startAllLFO(){this.forEachInstrument((i)=>{let synth=this.instruments.get(i)?.synth;if(synth&&synth instanceof AudioSystemSynth)synth.startLFO();})}
stopAllLFO(){this.forEachInstrument((i)=>{let synth=this.instruments.get(i)?.synth;if(synth&&synth instanceof AudioSystemSynth)synth.stopLFO();})}
setLFOType(instId,value){this.instruments.get(instId)?.synth.setLFOType(value);}
setLFOTarget(instId,value,remap=true){this.instruments.get(instId)?.synth.setLFOTarget(value,remap);}
setADSREnabled(instId,value){this.instruments.get(instId)?.synth.setADSREnabled(value);}
setAttack(instId,value){this.instruments.get(instId)?.synth.setAttack(value);}
blendAttack(instId,value,dt){this.instruments.get(instId).synth.blendAttack(value,this.time()+dt);}
setDecay(instId,value){this.instruments.get(instId)?.synth.setDecay(value);}
blendDecay(instId,value,dt){this.instruments.get(instId).synth.blendAttack(value,this.time()+dt);}
setSustain(instId,value){this.instruments.get(instId)?.synth.setSustain(value);}
blendSustain(instId,value,dt){this.instruments.get(instId).synth.blendSustain(value,this.time()+dt);}
setRelease(instId,value){this.instruments.get(instId)?.synth.setRelease(value);}
blendRelease(instId,value,dt){this.instruments.get(instId).synth.blendRelease(value,this.time()+dt);}
clearAllScheduledValueChanges(){let t=this.time();for(const inst of this.instruments.values()){inst.cancelScheduledValues(t);}
this.destination.gain.cancelScheduledValues(t);}
setSolo(instId){if(this.soloingInstrument==instId){this.soloingInstrument=null;}else{this.soloingInstrument=instId;}
for(const inst of this.instruments.values()){inst.disabledBySolo=(this.soloingInstrument!=null&&inst.instId!=this.soloingInstrument);inst.updateVolume();}}
getMute(instId){return this.instruments.get(instId)?.disabledByMute??false;}
setMute(instId){const inst=this.instruments.get(instId);inst.disabledByMute=!inst.disabledByMute;inst.updateVolume();}
trackNote(instId,note){if(!this.trackedNotes.has(instId)){this.trackedNotes.set(instId,new Set());}
const notes=this.trackedNotes.get(instId);notes.add(note);note.onended=()=>notes.delete(note);}
trackNoteByTimeout(instId,note,offTime){if(!this.trackedNotes.has(instId)){this.trackedNotes.set(instId,new Set());}
const notes=this.trackedNotes.get(instId);notes.add(note);if(this.offline){return;}
if(this.trackedNoteTimeouts.has(note)){window.clearTimeout(this.trackedNoteTimeouts.get(note));}
this.trackedNoteTimeouts.set(note,window.setTimeout(()=>{notes.delete(note);this.trackedNoteTimeouts.delete(note);},(offTime-this.audioContext.currentTime)*1000));}
forEachTrackedNote(instId,callback){if(this.trackedNotes.has(instId)){for(var n of this.trackedNotes.get(instId)){callback(n);}}}
playWebkit(instId,note,length,delay,volume,trackNote){delay=delay?delay:0;const startTime=this.time()+delay;if(instMgr.isSynth(instId)){this.playSynthNote(instId,note,length,delay,volume,trackNote);return;}
const inst=this.instruments.get(instId);const source=this.audioContext.createBufferSource();if(trackNote)this.trackNote(instId,source);if(instMgr.isSampler(instId)){const fadeTime=instMgr.getFadeTime(instId);const noteGain=this.playSamplerNote(source,inst,note,volume,startTime,length+fadeTime);if(noteGain==null)return null;this.stopSamplerNote(noteGain,volume,fadeTime,startTime+length);}else{const isSustained=instMgr.isSustained(instId);let noteGain=null;if(isSustained||volume!=1){noteGain=this.audioContext.createGain();noteGain.connect(inst.inputNode);noteGain.gain.value=volume;source.connect(noteGain);}else{source.connect(inst.inputNode);}
const sample=inst.sound;if(sample==null)return;source.buffer=sample;source.initDetune=0;const offset=30/instMgr.getOriginalBpm(instId)*(note-instMgr.getKeyboardMin(instId));const sampleLength=30/instMgr.getOriginalBpm(instId)-0.05;source.start(startTime,offset,sampleLength);if(isSustained){noteGain.gain.setTargetAtTime(0,startTime+length,instMgr.getFadeTime(instId));}}
source.detune.setValueAtTime(inst.detune+source.initDetune,0);}
async playMetronome(firstBeat=false){if(this.metronome==null)return;const source=this.audioContext.createBufferSource();source.buffer=this.metronome;source.connect(this.destination);source.start(0,firstBeat?0:1/8,1/8);}
noteOn(instId,note,volume,trackNote){let key=this.manuallyTrackedNoteKey(instId,note);let stopFunction=()=>{};const startTime=this.time();if(instMgr.isSampler(instId)){const inst=this.instruments.get(instId);const source=this.audioContext.createBufferSource();if(trackNote)this.trackNote(instId,source);const noteGain=this.playSamplerNote(source,inst,note,volume,startTime);if(noteGain==null)return null;stopFunction=()=>{const fadeTime=instMgr.getFadeTime(instId);this.stopSamplerNote(noteGain,volume,fadeTime,this.time());this.manuallyTrackedNotes.delete(key);};}else if(instMgr.isSynth(instId)){const inst=this.instruments.get(instId);const synthNote=inst.getSynthNote(note);if(synthNote){const gain=synthNote.gainNode.gain;const onTime=this.audioContext.currentTime+0.01;gain.setTargetAtTime(volume,onTime,0.01);synthNote.oscillatorNode.detune.setValueAtTime(inst.detune,0);if(synthNote.offTime>onTime){}
stopFunction=()=>{gain.setTargetAtTime(0,this.time()+0.01,0.01);synthNote.offTime=this.time();this.manuallyTrackedNotes.delete(key);};}}
this.manuallyTrackedNotes.set(key,stopFunction);}
noteOff(instId,note){let key=this.manuallyTrackedNoteKey(instId,note);if(this.manuallyTrackedNotes.has(key)){this.manuallyTrackedNotes.get(key)();}}
manuallyTrackedNoteKey(instId,note){return instId+'_'+note;};playSynthNote(instId,i,length,delay,volume,trackNote){const inst=this.instruments.get(instId);const synthNote=inst.getSynthNote(i);if(synthNote){const gain=synthNote.gainNode.gain;const onTime=this.audioContext.currentTime+delay+0.01;const offTime=onTime+length;gain.setTargetAtTime(volume,onTime,0.01);synthNote.oscillatorNode.detune.setValueAtTime(inst.detune,0);if(synthNote.hasEnvelope)synthNote.envelope.trigger();synthNote.oscillatorNode.detune.value=inst.detune;if(synthNote.offTime>onTime&&synthNote.offTime<offTime){gain.setTargetAtTime(volume,synthNote.offTime,0.01);}
if(offTime>synthNote.offTime){if(instMgr.isCustomSynth(instId)){synthNote.setupEndedEvents(offTime);}else{gain.setTargetAtTime(0,offTime,0.01);}
synthNote.offTime=offTime;if(trackNote){this.trackNoteByTimeout(instId,synthNote.oscillatorNode,offTime);}}}}
playSamplerNote(source,inst,note,volume,startTime,lengthPlusFadeTime=Infinity){const sampler=inst.sampler;if(sampler==null)return;const noteGain=this.audioContext.createGain();noteGain.connect(inst.inputNode);noteGain.gain.value=volume;source.connect(noteGain);const samplerNote=sampler.getNote(note);source.buffer=samplerNote.sample;source.initDetune=samplerNote.detune;source.detune.setValueAtTime(inst.detune+source.initDetune,0);source.start(startTime,samplerNote.timeOffset,Math.min(lengthPlusFadeTime,instMgr.getSamplerTimePerNote(inst.instId)));return noteGain;}
stopSamplerNote(noteGain,volume,fadeTime,stopTime){const timeConstant=Math.log(fadeTime+1)/5.298317366548036;const transitionTime=0.9*fadeTime;const transitionValue=volume*Math.exp(-transitionTime/timeConstant);noteGain.gain.setTargetAtTime(0,stopTime,timeConstant);noteGain.gain.setValueAtTime(transitionValue,stopTime+transitionTime);noteGain.gain.linearRampToValueAtTime(0,stopTime+fadeTime);}
loadInstrument(instId){instId=parseInt(instId);if(this.instruments.has(instId))return this.instruments.get(instId);const inst=new AudioSystemInstrument(this.audioContext,this.destination,instId);this.instruments.set(instId,inst);if(instMgr.isSampler(instId)){sampleManager.getSamplerInstrument(this.audioContext,instId).then(sampler=>inst.sampler=sampler);}else if(instMgr.isSynth(instId)){if(instMgr.isCustomSynth(instId)){inst.synth=new AudioSystemSynth(this.audioContext);}else{inst.synth=new AudioSystemLegacySynth(instId);}
this.playSynthNote(instId,pianoToIndex['C4'],0.01,0,0.0001);}else{sampleManager.getInstrument(this.audioContext,instId).then(buffer=>inst.sound=buffer);}
return inst;}
async loadMetronome(){this.metronome=await sampleManager.getMetronome(this.audioContext);}
forEachInstrument(fn){for(const instId of this.instruments.keys())fn(instId);}
loadAudioTrack(arrayBuffer,onLoad){this.audioContext.decodeAudioData(arrayBuffer,buffer=>{this.audioTrack=buffer;onLoad(buffer);},e=>{this.audioTrack=null;message('Error loading audio track');audioTrackLoading.style.display='none';audioTrackSelect.style.display='block';});}
removeAudioTrack(){if(this.audioTrack!=null){if(this.audioTrackPlaying){this.stopAudioTrack();}
this.audioTrack=null;}}
playAudioTrack(offset){if(this.audioTrack!=null){if(this.audioTrackPlaying){this.stopAudioTrack();}
this.audioTrackPlaying=true;this.audioTrackSource=this.audioContext.createBufferSource();this.audioTrackSource.buffer=this.audioTrack;this.audioTrackSource.loop=false;this.audioTrackSource.connect(this.destination);this.audioTrackSource.start(0,offset);}}
stopAudioTrack(){if(this.audioTrackSource!=null){this.audioTrackSource.stop();this.audioTrackSource=null;}}
isSamplerInstrument(instId){return instId==41||instId==43||instId==44||instId==45||instId==46||instId==47||instId==48||instId==49||instId==50||instId==51||instId==52||instId>=54;}
ensureLoaded(instId){this.loadInstrument(instId);}
copyStateFromOtherSystem(other){for(const otherInst of other.instruments.values()){const instId=otherInst.instId;const inst=this.loadInstrument(instId);this.setDelayAndReverb(inst,otherInst.delay,otherInst.reverb.kind,otherInst.reverb.volume);this.setInstrumentVolume(instId,otherInst.volume);this.setPan(instId,otherInst.pan.pan);this.setDistort(instId,otherInst.distort.kind,otherInst.distort.volume);inst.enabled=otherInst.enabled;const eq=otherInst.eq;if(eq!=null){this.setEq(instId,true,eq.low,eq.mid,eq.high);}else{this.setEq(instId,false,0,0,0);}
const synth=otherInst.synth;if(synth!=null&&synth instanceof AudioSystemSynth){this.instruments.get(instId).synth=new AudioSystemSynth(this.audioContext);this.setADSREnabled(instId,synth.envelopeEnabled);this.setAttack(instId,synth.attack);this.setDecay(instId,synth.decay);this.setSustain(instId,synth.sustain);this.setRelease(instId,synth.release);this.setLFOEnabled(instId,synth.lfoEnabled);this.setLFOIntensity(instId,synth.lfoIntensity?.gain?.value??0);this.setLFORate(instId,synth.lastLFOFreq,true);this.setLFOTarget(instId,synth.lfoTarget);this.setLFOType(instId,synth.lfoType);this.setSynthType(instId,synth.synthId);this.setSynthFilter(instId,synth.filter.frequency.value);this.setSynthFilterResonance(instId,synth.filter.Q.value);this.setSynthFilterType(instId,kFilterTypes.indexOf(synth.filter.type));}
inst.detune=otherInst.detune;}
this.soloingInstrument=other.soloingInstrument;this.setBaseDelayTime(other.baseDelayTime);this.setVolume(other.songVolume);this.setFinalVolume(other.finalVolume);}}
let realtimeAudioSystem=new AudioSystem(false);let audioSystem=realtimeAudioSystem;function enableRealtimeAudioSystem(){audioSystem=realtimeAudioSystem;}
function enableOfflineAudioSystem(songLengthInSeconds){audioSystem=new AudioSystem(true,realtimeAudioSystem.audioContext.sampleRate,songLengthInSeconds);audioSystem.init();audioSystem.copyStateFromOtherSystem(realtimeAudioSystem);}
function restartAudioSystem(){const newSystem=new AudioSystem(false);newSystem.init();newSystem.copyStateFromOtherSystem(realtimeAudioSystem);realtimeAudioSystem.audioContext.close();realtimeAudioSystem=audioSystem=newSystem;}
function toInt16Array(a){let n=0;for(let i=0;i<a.length;++i)n+=a[i].length;let b=new Int16Array(n);for(let i=0,j=0;i<a.length;++i){a[i].forEach(x=>b[j++]=Math.min(Math.max(32768*x,-32768),32767));}
return b;};function trimSilence(l,r){let start=0,end=0;for(let i=0;i<l.length;++i){if(l[i]!=0||r[i]!=0){start=i;break;}}
for(let i=l.length-1;i>=0;--i){if(l[i]!=0||r[i]!=0){end=i+1;break;}}
return[start,end];}
var endpoint='/app/api';function isNumber(n){return!isNaN(parseFloat(n))&&isFinite(n);}
function numSan(x,valueIfNaN=0){return isNumber(x)?x:valueIfNaN;}
function clamp(x,lo,hi){return Math.min(Math.max(x,lo),hi);}
if(!Array.prototype.indexOf){Array.prototype.indexOf=function(obj,start){for(var i=(start||0),j=this.length;i<j;i++){if(this[i]===obj){return i;}}
return-1;};}
const piano=[];const pianoToIndex={};const midiNoteNames=[];const midiNoteNamesToIndex={};(()=>{let k=0;for(let i=7;i>=2;--i){for(let j=settings.pianoNotes.length-1;j>=0;--j){const name=settings.pianoNotes[j]+i;piano.push(name);pianoToIndex[name]=k;const midiIndex=12*(i+1)+j;midiNoteNames[midiIndex]=name;midiNoteNamesToIndex[name]=midiIndex;++k;}}})();function noteNameToIndex(name){if(name.length<2||name.length>3)return null;const split=name[1]=='#'?2:1;const note=settings.pianoNotes.indexOf(name.substring(0,split));if(note==-1)return null;const octave=parseInt(name.substring(split));if(isNaN(octave))return null;return note+((octave-2)*12);}
function detectScale(notes){var scaleFrequency={};for(var i=0;i<settings.scales.length;i++){scaleFrequency[i]=0;}
var totalNotes=0;for(var i=0;i<notes.length;i++){var note=notes[i].type.substring(0,notes[i].type.length-1);if(instMgr.isDrum(notes[i].instrument)||notes[i].volume==0)continue;totalNotes++;for(var j=0;j<settings.scales.length;j++){if(settings.scales[j].indexOf(note)>-1){scaleFrequency[j]++;}}}
var maxScale;var maxFrequency=0;for(var i=0;i<settings.scales.length;i++){if(scaleFrequency[i]>maxFrequency){maxFrequency=scaleFrequency[i];maxScale=i;}}
var f=maxFrequency/totalNotes;if(f>0.9){return maxScale;}else{return-1;}}
function updateScale(notes){var scaleIndex=detectScale(notes);if(scaleIndex>0){scale=settings.scales[scaleIndex];keySelect.selectedIndex=scaleIndex;$(keySelect).selectmenu('refresh');updateGridImage();SequencerView.repaint();}}
function getDefaultInstrumentSettings(){return{name:'',color:[],volume:1,delay:false,reverb:false,reverbType:1,reverbVolume:1,distort:false,distortType:1,distortVolume:0,pan:0,eq:{enabled:false,low:0,mid:0,high:0},detune:0,};}
function getDefaultSongSettings(){return{timeSig:4,instruments:{},volume:1,};}
function Note(song,type,time,length,instrument,volume=1){this.song=song;this.time=time;this.intTime=Math.floor(time);this.fracTime=this.time-this.intTime;this.type=type;this.length=length;this.instrument=instrument;this.volume=volume;this.selected=false;this.id=song.nextId++;this.offsetX=0;this.offsetY=0;this.offsetWidth=0;}
Note.prototype.toString=function(startTime){var str=(this.time-startTime)+' '+this.type+' '+this.length+' '+this.instrument;if(this.volume!=1)str+=' '+this.volume;return str;};function Song(noteData,songSettings){this.nextId=0;this.playing=false;this.stopping=false;this.recording=false;this.looping=true;this.notes=[];this.loopTime=0;this.loopingSelection=null;this.noteColumns=[];this.markers={};this.markerIterator=[];this.initialMarkerValues={};this.totalMarkers=0;this.markerEpoch=0;this.numNotesPerInstrument=new Map();this.basedon=0;this.settings=songSettings==null?getDefaultSongSettings():songSettings;if(this.settings.volume==null)this.settings.volume=1;this.appendNoteData(noteData);if(settings.offline){var code='var delay,timeout,lastStepTime,playing=!1;self.addEventListener("message",function(e){switch(e.data){case"start":if(!playing){playing=!0;var t=function(){var e;(self.postMessage("tick"),playing)&&(e=null==lastStepTime?delay:(new Date).getTime()-lastStepTime,timeout=setTimeout(t,delay-Math.min(delay/2,Math.max(0,e-delay))));lastStepTime=(new Date).getTime()};null!=timeout&&(clearTimeout(timeout),lastStepTime=null),t()}break;case"stop":playing=!1,null!=timeout&&clearTimeout(timeout);break;default:delay=parseInt(e.data)}},!1);';var blob=new Blob([code],{type:'application/javascript'});this.worker=new Worker(URL.createObjectURL(blob));}else{this.worker=new Worker('/app/sequencer.worker.js?2');}
this.worker.addEventListener('message',function(e){if(song.playing){song.playNextColumn(true);}});updateScale(this.notes);this.updateLoopTime();};Song.prototype.setTimeSig=function(value){this.settings.timeSig=value;this.updateLoopTime();};Song.prototype.getTimeSig=function(){var timeSig=this.settings.timeSig;return timeSig==null?4:timeSig;};Song.prototype.setVolume=function(value){this.settings.volume=value;};Song.prototype.getVolume=function(){return this.settings.volume;};Song.prototype.getInstrumentSettings=function(instId){if(this.settings.instruments==null){this.settings.instruments={};}
if(this.settings.instruments[instId]==undefined){const settings=getDefaultInstrumentSettings();this.settings.instruments[instId]=settings;}
if(this.settings.instruments[instId].pan==undefined){this.settings.instruments[instId].pan=0;}
if(this.settings.instruments[instId].detune==undefined){this.settings.instruments[instId].detune=0;}
if(this.settings.instruments[instId].eq==undefined){this.settings.instruments[instId].eq={enabled:false,low:0,mid:0,high:0};}
return this.settings.instruments[instId];};Song.prototype.appendNoteData=function(data){let maxTime=0;const newNotes=this.makeNotesFromStringOrProto(data);for(const note of newNotes){if(note.volume>0){instMgr.ensureLoaded(note.instrument);}
if(note.intTime>maxTime){maxTime=note.intTime;}
this.addNote(note,true);}
this.updateLoopTime();};Song.prototype.makeNotesFromStringOrProto=function(data){const newNotes=[];if(typeof data=='string'){for(const noteData of data.split(';')){const noteArray=noteData.split(' ');const type=noteArray[1];if(type!=undefined){const time=parseFloat(noteArray[0]);const length=parseFloat(noteArray[2]);const instId=noteArray.length>3?parseInt(noteArray[3]):0;const volume=noteArray.length>4?parseFloat(noteArray[4]):1;newNotes.push(new Note(this,type,time,length,instId,volume));}}}else{for(const noteProto of data){const key=Object.keys(proto.NoteType)[noteProto.getType()];const time=noteProto.getTime();const length=noteProto.getLength();const instId=noteProto.getInstrument();const volume=noteProto.getVolume();if(key!=null&&isNumber(time)&&isNumber(length)&&instMgr.isValidId(instId)&&isNumber(volume)){const type=key.replace('S','#');newNotes.push(new Note(this,type,time,length,instId,volume));}else{console.log('Discarding bad note',noteProto.toObject());}}}
return newNotes;};Song.prototype.makeMarkersFromString=function(data){const newMarkers=[];for(const markerData of data.split(';')){const a=markerData.split(' ');if(a.length>=5){const time=parseFloat(a[0]);const setting=parseInt(a[1]);const instId=parseInt(a[2]);const value=parseFloat(a[3]);const blend=parseInt(a[4]);newMarkers.push(new Marker(this,time,setting,instId,value,blend));}}
return newMarkers;};Song.prototype.addNote=function(note,isBatch=false){note.deleted=false;var noteIndex=piano.indexOf(note.type);if(noteIndex!=-1){this.notes.push(note);this.moveNote(note,undefined,note.instrument,undefined,note.time,undefined,note.type);if(!isBatch)this.updateLoopTime();}};Song.prototype.removeNote=function(note,isBatch=false){note.deleted=true;this.notes.splice(this.notes.indexOf(note),1);delete this.noteColumns[note.intTime][note.id];const count=this.numNotesPerInstrument.get(note.instrument)??1;this.numNotesPerInstrument.set(note.instrument,count-1);if(!isBatch)this.updateLoopTime();};Song.prototype.removeNotes=function(notesToRemove){for(const note of notesToRemove){note.deleted=true;delete this.noteColumns[note.intTime][note.id];if(this.numNotesPerInstrument[note.instrument]){this.numNotesPerInstrument[note.instrument]-=1;}}
this.notes=this.notes.filter(note=>!note.deleted);this.updateLoopTime();};Song.prototype.moveNote=function(note,oldInstrument,newInstrument,oldTime,newTime,oldType,newType){if(note.deleted){return;}
note.time=newTime;note.intTime=Math.floor(note.time);note.fracTime=note.time-note.intTime;note.type=newType;note.instrument=newInstrument;if(oldTime!=undefined){delete this.noteColumns[Math.floor(oldTime)][note.id];}
if(this.noteColumns[note.intTime]==null){this.noteColumns[note.intTime]={};}
this.noteColumns[note.intTime][note.id]=note;if(oldInstrument!=undefined){const oldCount=this.numNotesPerInstrument.get(oldInstrument)??1;this.numNotesPerInstrument.set(oldInstrument,oldCount-1);}
if(note.volume>0){instMgr.ensureLoaded(newInstrument);}
const newCount=this.numNotesPerInstrument.get(newInstrument)??0;this.numNotesPerInstrument.set(newInstrument,newCount+1);return true;};Song.prototype.updateNoteLength=function(note,newLength){note.length=newLength;this.updateLoopTime();};Song.prototype.updateLoopTime=function(){this.loopTime=0;for(var i=0;i<this.notes.length;i++){if(this.notes[i].intTime+this.notes[i].length>this.loopTime){this.loopTime=this.notes[i].intTime+this.notes[i].length;}}
this.loopTime=Math.ceil(this.loopTime/(4*this.getTimeSig()))*4*this.getTimeSig();if(this.loopTime==0){this.loopTime=4*this.getTimeSig();}
if(this.loopTime>=maxCells){updateLength(this.loopTime+4*this.getTimeSig(),4*this.getTimeSig());}};Song.prototype.usesInstrument=instId=>this.numNotesPerInstrument.get(instId)>0;Song.prototype.forEachInstrument=function(fn){for(const[instId,count]of this.numNotesPerInstrument.entries()){if(count>0)fn(instId);}};function Marker(song,time,setting,instId,value,blend){this.song=song;this.time=time;this.setting=setting;this.instrument=kMarkerEditorSettings[setting].isPerInstrument?instId:0;this.value=value;this.blend=blend;}
Marker.prototype.toString=function(startTime){return(this.time-startTime)+' '+this.setting+' '+this.instrument+' '+this.value+' '+(this.blend?1:0);};function findMarkerIndex(a,t){let lo=0;let hi=a.length-1;while(hi>=lo){let mid=Math.floor((lo+hi)/2);if(a[mid].time<=t){lo=mid+1;}else{hi=mid-1;}}
return hi;}
function snapMarkerTime(time){return Math.floor(time);}
Song.prototype.addMarker=function(marker){marker.time=snapMarkerTime(marker.time);this.markerEpoch+=1;let b=this.markers[marker.setting];if(b==null)b=this.markers[marker.setting]={};let a=b[marker.instrument];if(a==null){a=b[marker.instrument]=[];let mi={setting:marker.setting,instrument:marker.instrument,array:a,};this.markerIterator.push(mi);this.markerIterator.sort((m1,m2)=>{if(m1.instrument!=m2.instrument)return m1.instrument-m2.instrument;return m1.setting-m2.setting;});}
let i=findMarkerIndex(a,marker.time);++this.totalMarkers;a.splice(i+1,0,marker);};function findMarkerNear(a,m,i){if(i<0||i>=a.length)return-1;if(a[i]==m)return i;for(let j=i-1;j>=0;--j){if(a[j].time!=m.time)break;if(a[j]==m)return j;}
return-1;}
Song.prototype.removeMarker=function(marker){this.markerEpoch+=1;let b=this.markers[marker.setting];if(b==null)return;let a=b[marker.instrument];if(a==null||a.length==0)return;let i=findMarkerNear(a,marker,findMarkerIndex(a,marker.time));if(i>=0){--this.totalMarkers;a.splice(i,1);}else{console.log('Tried to delete a ghost marker',marker,this.markers);}};Song.prototype.setInitialMarkerValue=function(setting,instId,value){this.markerEpoch+=1;let a=this.initialMarkerValues[setting];if(a==null)a=this.initialMarkerValues[setting]={};a[instId]=value;};Song.prototype.getInitialMarkerValue=function(setting,instId){const initVals=this.initialMarkerValues[setting];const value=initVals!=null?initVals[instId]:null;return value!=null?value:kMarkerEditorSettings[setting].defaultValue;};function lerp(t,t0,v0,t1,v1){if(t1==t0)return v1;return v0+(v1-v0)*(t-t0)/(t1-t0);}
function fillTrackerValue(tracker,initVal){let v0=initVal;let t0=0;if(tracker.prev!=null){v0=tracker.prev.value;t0=tracker.prev.time;}
let newValue=v0;let nextValue=v0;if(tracker.next!=null&&tracker.next.blend){let t1=tracker.next.time;let v1=tracker.next.value;newValue=lerp(tracker.time,t0,v0,t1,v1);nextValue=lerp(tracker.time+1,t0,v0,t1,v1);}
tracker.changed=(tracker.value!=newValue)||(newValue!=nextValue);tracker.value=newValue;tracker.nextValue=nextValue;return tracker;}
Song.prototype.trackMarkerSetting=function(setting,instId,time,tracker=null){const initVal=this.getInitialMarkerValue(setting,instId);let b=this.markers[setting];let a=null;if(b!=null)a=b[instId];if(a==null||a.length==0){if(tracker==null){tracker={time:time,epoch:this.markerEpoch,};}
return fillTrackerValue(tracker,initVal);}
if(tracker!=null&&tracker.index!=null&&tracker.epoch==this.markerEpoch&&time>=tracker.time){tracker.time=time;if(tracker.next==null||time<tracker.next.time){return fillTrackerValue(tracker,initVal);}
tracker.index+=1;tracker.prev=tracker.next;tracker.next=a[tracker.index+1];if(tracker.next==null||time<tracker.next.time){return fillTrackerValue(tracker,initVal);}}
let i=findMarkerIndex(a,time);tracker={index:i,time:time,prev:a[i],next:a[i+1],epoch:this.markerEpoch,};fillTrackerValue(tracker,initVal);tracker.changed=true;return tracker;};Song.prototype.toggleMarkerBlend=function(marker){this.markerEpoch+=1;marker.blend=!marker.blend;};Song.prototype.setMarkerValue=function(marker,value){this.markerEpoch+=1;marker.value=value;};Song.prototype.anyMarkersAtTime=function(time){for(const mi of this.markerIterator){let a=mi.array;if(a.length==0)continue;let i=findMarkerIndex(a,time);if(i>=0&&a[i].time==time){return true;}}
return false;};Song.prototype.anyMarkersAtTimeForSetting=function(setting,instId,time){const b=this.markers[setting];if(b==null)return false;const a=b[instId];if(a==null||a.length==0)return false;const i=findMarkerIndex(a,time);return i>=0&&a[i].time==time;};Song.prototype.getAllMarkersAtTime=function(time){const result=[];for(const mi of this.markerIterator){const a=mi.array;if(a.length==0)continue;const i=findMarkerIndex(a,time);if(i>=0&&a[i].time==time){result.push(a[i]);for(let j=i-1;j>=0;--j){if(a[j].time!=time)break;result.push(a[j]);}}}
return result;};Song.prototype.hasAnyMarkersForSetting=function(setting,instId){const b=this.markers[setting];if(b==null)return false;const a=b[instId];return a!=null&&a.length>0;};noteWidth=25;noteHeight=16;function getButton(event){if('which'in event){return event.which;}else{if('button'in event){var buttons='';if(event.button&1){return 1;}
if(event.button&2){return 2;}
if(event.button&4){return 3;}}}}
function sendPostRequest(path,params,method){method=method||'post';var form=document.createElement('form');form.setAttribute('method',method);form.setAttribute('action',path);form.setAttribute('target','_blank');for(var key in params){if(params.hasOwnProperty(key)){var hiddenField=document.createElement('input');hiddenField.setAttribute('type','hidden');hiddenField.setAttribute('name',key);hiddenField.setAttribute('value',params[key]);form.appendChild(hiddenField);}}
document.body.appendChild(form);form.submit();}
function updateLength(length,timeSig){length=(1+Math.floor(length/(4*timeSig)))*4*timeSig;maxCells=length;updateCanvasWidth();}
function updateCanvasWidth(){document.getElementById('sequencer_inner').style.width=(maxCells*noteWidth)+'px';}
function getFrequency(i){return Math.round(440*Math.pow(2,(i-33)/12));}
function createGridImage(grid,timeSig){var width=noteWidth*4*timeSig;var height=noteHeight*12;var canvas=document.createElement('canvas');canvas.width=Math.round(width);canvas.height=Math.round(height);var g=canvas.getContext('2d');g.lineWidth=1;for(var k=11;k>=0;k--){var y=k*noteHeight;if(scale.indexOf(settings.pianoNotes[(piano.length-k-1)%12])>-1){g.fillStyle='#66666a';}else{g.fillStyle='#45474c';}
g.fillRect(0,Math.floor(y),Math.ceil(width),Math.ceil(noteHeight));g.strokeStyle='rgba(53, 54, 58, 0.5)';octaveLine=k%12==11;if(octaveLine){g.strokeStyle='rgba(53, 54, 58, 1)';}
_drawLine(g,0,Math.round(y+noteHeight)-0.5,width,Math.round(y+noteHeight)-0.5);}
g.strokeStyle='rgba(53, 54, 58, 0.5)';var cellWidth=noteWidth/grid;var count=4*timeSig*grid;for(var i=1;i<count;i++){var beatLine=i%Math.round(4*grid)==0;g.strokeStyle=beatLine?'rgba(53, 54, 58, 1)':'rgba(53, 54, 58, 0.5)'
_drawLine(g,Math.round(i*cellWidth)-0.5,0,Math.round(i*cellWidth)-0.5,noteHeight*12);}
g.strokeStyle='rgba(53, 54, 58, 1)';_drawLine(g,Math.round(width)-0.5,0,Math.round(width)-0.5,height);_drawLine(g,Math.round(width)-1.5,0,Math.round(width)-1.5,height);return canvas;}
function _drawLine(g,x1,y1,x2,y2){g.beginPath();g.moveTo(x1,y1);g.lineTo(x2,y2);g.stroke();}
function saveBlobObject(file,filename){if(window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(file,filename);}else{var a=document.createElement('a');var url=URL.createObjectURL(file);a.href=url;a.download=filename;document.body.appendChild(a);a.click();setTimeout(function(){document.body.removeChild(a);window.URL.revokeObjectURL(url);},0);}}
function saveBlob(filename,data,type){var file=new Blob(data,{type:type});saveBlobObject(file,filename);}
async function asyncXMLHttpRequest(url,type,onProgress=null){return new Promise((resolve,reject)=>{const request=new XMLHttpRequest();request.open('GET',url,true);request.responseType=type;if(onProgress!==null)request.onprogress=onProgress;request.onload=()=>resolve(request.response);request.onerror=reject;request.send();});}
function refreshSelectMenu(selector){var text=$(selector+' option')[$(selector).prop('selectedIndex')]?.innerText;if(text!=null)$(selector+'-button .ui-selectmenu-text').text(text);}
function toHtmlColor(rgb){return rgb.length==4?`rgba(${rgb[1]}, ${rgb[2]}, ${rgb[3]}, ${rgb[0] / 255})`:`rgb(${rgb[0]}, ${rgb[1]}, ${rgb[2]})`;}
function rgbIntToArray(rgb){const b=rgb&0x000000FF;const g=(rgb&0x0000FF00)>>>8;const r=(rgb&0x00FF0000)>>>16;const a=(rgb&0xFF000000)>>>24;if(a==0)return[];return[a,r,g,b];}
function arrayToRgbInt(array){return(array[0]<<24|array[1]<<16|array[2]<<8|array[3])>>>0;}
function escapeHtml(unsafe){return unsafe.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;');}
function getInstrumentName(song,instId){const n=song?.getInstrumentSettings(instId).name??'';return n==''?instMgr.getDefaultName(instId):escapeHtml(n);}
function getInstrumentColor(song,instId){const color=song?.getInstrumentSettings(instId).color??[];return color.length==4?color:instMgr.getColor(instId);}
class ProgressBarElement extends HTMLElement{static classes=Object.freeze({barEmpty:'progress-bar-empty',barFill:'progress-bar-fill',container:'progress-bar-container',title:'progress-bar-title',});_zIndex=100;_fillTransitionMs=200;constructor(){super();this.style.zIndex=this._zIndex.toString();this._container=window.document.createElement('div');this._container.classList.add(ProgressBarElement.classes.container);this._barTitle=window.document.createElement('div');this._barTitle.classList.add(ProgressBarElement.classes.title);this._barEmpty=window.document.createElement('div');this._barEmpty.classList.add(ProgressBarElement.classes.barEmpty);this._barFill=window.document.createElement('div');this._barFill.classList.add(ProgressBarElement.classes.barFill);this._barFill.style.zIndex=(this._zIndex+1).toString();this._barFill.style.transition='width '+this._fillTransitionMs+'ms'+' ease';this._setColor('orange');this._setTitle('Loading...');this._setScale(1);}
connectedCallback(){this._barEmpty.appendChild(this._barFill);this._container.appendChild(this._barTitle);this._container.appendChild(this._barEmpty);this.appendChild(this._container);}
_setColor(colorStr){this._barFill.style.backgroundColor=colorStr;}
_setTitle(text){this._barTitle.innerText=text;}
_setScale(scalar){scalar=Math.abs(isNaN(scalar)?1:(scalar??1));const sqrtScalar=Math.sqrt(scalar);const log2ScalarP1=Math.log2(scalar+1);this.style.width=(210*sqrtScalar).toString()+'px';this._barTitle.style.fontSize=(14*sqrtScalar).toString()+'px';this._barEmpty.style.height=(10*sqrtScalar).toString()+'px';this._barFill.style.height=(10*sqrtScalar).toString()+'px';this._barEmpty.style.borderRadius=(4*log2ScalarP1).toString()+'px';this._barFill.style.borderRadius=(4*log2ScalarP1)+'px';}
_show(){this.style.display='block';}
_hide(){this.style.display='none';this._setPercentage(0);}
_completeHide(){this._setPercentage(100);window.setTimeout(()=>{this.style.display='none';this._setPercentage(0);},this._fillTransitionMs);}
_setPercentage(percentNumber){const percentStr=percentNumber.toString()+'%';this._barFill.style.width=percentNumber>0?'calc('+percentStr+' + 2px)':'0';}}
window.customElements.define('progress-bar',ProgressBarElement);class ProgressBar{static _elementCache=null;static clearElementCache(){ProgressBar._elementCache=null;}
static get isCached(){return ProgressBar._elementCache instanceof ProgressBarElement;}
_notFirstRun=false;_progress=0;constructor(useCache=true){this._usingCache=useCache;this._setupElementCache();}
_setupElementCache(){if(this._usingCache){if(ProgressBar.isCached){this._element=ProgressBar._elementCache;}else{this._element=new ProgressBarElement();ProgressBar._elementCache=this._element;}}else{this._element=new ProgressBarElement();}}
_setupElement(){return new Promise(resolve=>{if(this._notFirstRun)return resolve();this._notFirstRun=true;window.requestAnimationFrame(()=>{this._element._hide();window.document.getElementById('progress_bar_area').appendChild(this._element);resolve();});});}
_drawProgress(){this._element._setPercentage(Math.round(this._progress*100));if(this._progress>=1)this._element._completeHide();}
_waitForDOM(){return new Promise(resolve=>window.addEventListener('DOMContentLoaded',resolve,{once:true}));}
async _ensureDocumentReady(){if(window.document.readyState=='loading'){await this._waitForDOM();}}
start(){return new Promise(async resolve=>{await this._ensureDocumentReady();await this._setupElement();this._progress=0;window.requestAnimationFrame(()=>{this._element._show();this._drawProgress();resolve();});});}
setProgress(progress){return new Promise(resolve=>{this._progress=progress;window.requestAnimationFrame(()=>{this._drawProgress();resolve();});});}
complete(){return new Promise(resolve=>{if(this._progress==1)return resolve();this._progress=1;window.requestAnimationFrame(()=>{this._drawProgress();if(!this._usingCache)this.remove();resolve();});});}
remove(){window.document.getElementById('progress_bar_area').removeChild(this._element);this._element=null;}
setColor(colorStr){return new Promise(resolve=>{window.requestAnimationFrame(()=>{this._element._setColor(colorStr);resolve();});});}
setTitle(text){return new Promise(resolve=>{window.requestAnimationFrame(()=>{this._element._setTitle(text);resolve();});});}
setScale(scalar){return new Promise(resolve=>{window.requestAnimationFrame(()=>{this._element._setScale(scalar);resolve();});});}}
function Selection(){this.notes=[];this.markers=new Set();}
Selection.prototype.hasNotes=function(){return this.notes.length>0;};Selection.prototype.hasMarkers=function(){return this.markers.size>0;};Selection.prototype.isEmpty=function(){return!this.hasNotes()&&!this.hasMarkers();};Selection.prototype.getTimeSpan=function(){let minTime=Infinity;let maxTime=0;for(const note of this.notes){minTime=Math.min(minTime,note.time);maxTime=Math.max(maxTime,note.time+note.length);}
for(const marker of this.markers){minTime=Math.min(minTime,marker.time);maxTime=Math.max(maxTime,marker.time);}
return{min:minTime==Infinity?0:minTime,max:maxTime};};Selection.prototype.isMarkerSelected=function(marker){return this.markers.has(marker);};Selection.prototype.isMarkerTimeSelected=function(time){for(const marker of this.markers){if(marker.time==time)return true;}
return false;};Selection.prototype.clearNotes=function(){for(var i=0;i<this.notes.length;i++){this.notes[i].selected=false;}
this.notes=[];};Selection.prototype.clearMarkers=function(){this.markers=new Set();};Selection.prototype.clear=function(){this.clearNotes();this.clearMarkers();};Selection.prototype.setNotes=function(newNotes){this.clearNotes();for(var i=0;i<newNotes.length;i++){this.selectNote(newNotes[i]);}};Selection.prototype.setMarkers=function(newMarkers){this.markers=newMarkers;};Selection.prototype.selectNote=function(note){if(note.selected){return;}
note.selected=true;this.notes.push(note);};Selection.prototype.selectMarker=function(marker){this.markers.add(marker);};Selection.prototype.deselectNote=function(note){if(!note.selected){return;}
note.selected=false;this.notes.splice(this.notes.indexOf(note),1);};Selection.prototype.deselectMarker=function(marker){this.markers.delete(marker);};Selection.prototype.describe=function(){var msg='';if(selection.notes.length>0){msg+=selection.notes.length+' note'+
(selection.notes.length==1?'':'s');}
if(selection.markers.size>0){if(msg.length>0)msg+=' and';msg+=' '+selection.markers.size+' marker'+
(selection.markers.size==1?'':'s');}
return msg;};function onMidiFile(file){let reader=new FileReader();reader.onloadend=_=>{try{loadMidiData(new Uint8Array(reader.result),file.name);}catch(e){if(e instanceof Midi.MidiException||e instanceof Midi.ParserException){alert(`Failed to parse MIDI file: ${e.message}`);}}};reader.readAsArrayBuffer(file);}
function loadMidiData(data,name){let parser=new Midi.FileParser(data);let midiSidebarTab=sidebar.tab('Import MIDI',`
   <div id="midi_import_content">
     <span id="midi_import_subheading">Choose which instruments to use for each track in the MIDI file.</span>
     <table id="midi_import_table"></table>
     <button id="midi_import_import">Import</button>
  </div>
  `,'400px');sidebar.open(midiSidebarTab,true);let table=document.getElementById('midi_import_table');table.replaceChildren();let midiEvents=[];let tracks={};let trackInstruments={0:0};let trackNoteCount={};let currentTrack=0;trackNoteCount[currentTrack]=0;let chunk;while(chunk=parser.parse()){midiEvents.push(chunk);if(chunk instanceof Midi.Event.NoteOnEvent){if(chunk.param2>0){trackNoteCount[currentTrack]++;}}else if(chunk instanceof Midi.Event.TrackNameEvent){let name=chunk.data;if(name[name.length-1]===0){name=name.slice(0,name.length-1);}
name=new TextDecoder('utf-8').decode(name);tracks[currentTrack]=name;}else if(chunk instanceof Midi.Event.ProgramChangeEvent){if(chunk.channel===9){trackInstruments[currentTrack]=31;}else{trackInstruments[currentTrack]=Midi.instrumentMap[chunk.param1];}}else if(chunk instanceof Midi.Event.EndOfTrackEvent){currentTrack++;trackNoteCount[currentTrack]=0;tracks[currentTrack]='[Untitled Track]';trackInstruments[currentTrack]=-1;}}
let trackElements={};let transposeElements={};for(let track of Object.keys(trackInstruments)){if(trackNoteCount[track]===0)continue;let row=document.createElement('tr');let label=document.createElement('td');label.innerText=`${tracks[track]} (${trackNoteCount[track]} notes)`;let menus=document.createElement('td');let instSelect=document.createElement('select');instSelect.classList.add('instrument');instSelect.name=track;trackElements[track]=instSelect;let noneOption=document.createElement('option');noneOption.value='-1';if(trackInstruments[track]===-1){noneOption.selected=true;}
noneOption.innerText='None (don\'t use this track)';instSelect.appendChild(noneOption);for(let id of settings.instrumentDisplayOrder){let option=document.createElement('option');option.value=id;if(id===(trackInstruments[track]?trackInstruments[track]:43)){option.selected=true;}
option.innerText=settings.instruments[id];instSelect.appendChild(option);}
menus.appendChild(instSelect);menus.appendChild(document.createElement('br'));let transposeSelect=document.createElement('select');transposeSelect.classList.add('transpose');transposeSelect.innerHTML=`
            <option value="-2">-2 octaves</option>
            <option value="-1">-1 octaves</option>
            <option value="0" selected="selected">--</option>
            <option value="1">+1 octaves</option>
            <option value="2">+2 octaves</option>`;transposeElements[track]=transposeSelect;menus.appendChild(transposeSelect);row.appendChild(label);row.appendChild(menus);table.appendChild(row);}
document.getElementById('midi_import_import').onclick=()=>{let finalInstruments={};let finalTranspose={};for(let track of Object.keys(trackElements)){finalInstruments[track]=trackElements[track].value|0;finalTranspose[track]=transposeElements[track].value|0;}
loadMidiEvents(midiEvents,finalInstruments,finalTranspose);setTitle(name.substring(0,name.lastIndexOf('.')));closeMidiImport();};openMidiImport();}
function loadMidiEvents(midiEvents,trackInstruments,trackTranspose){clearSong();resetAllInstrumentSettings();let time=0;let maxTime=-1;let noteArray=[];let timeDivision=0;let currentTrack=0;let currentProgram=0;let startTime={};let noteOnVelocity={};for(let chunk of midiEvents){if(chunk instanceof Midi.Delta){time+=chunk.ticks;}else if(chunk instanceof Midi.Event.SetTempoEvent){setInitialBPM(chunk.bpm);}else if(chunk instanceof Midi.Event.NoteOffEvent||(chunk instanceof Midi.Event.NoteOnEvent&&chunk.param2===0)){if(currentTrack===-1){currentTrack++;}
let noteTime=+(time/(timeDivision/4)).toFixed(2);const noteIndex=chunk.param1+12+12*(trackTranspose[currentTrack]??0);let noteName=midiNoteNames[noteIndex];if(!noteName)continue;noteName=noteName.replace(/[01]/,'2').replace(/[89]|10/,'7');let midiInstrument=-1;if(trackInstruments[currentTrack]!==undefined){midiInstrument=trackInstruments[currentTrack];}else{midiInstrument=Midi.instrumentMap[currentProgram]??-1;}
if(midiInstrument!==-1){noteArray.push(new Note(song,noteName,startTime[chunk.param1],noteTime-startTime[chunk.param1],midiInstrument,noteOnVelocity[chunk.param1]/127));}}else if(chunk instanceof Midi.Event.NoteOnEvent){startTime[chunk.param1]=+(time/(timeDivision/4)).toFixed(2);noteOnVelocity[chunk.param1]=chunk.param2;}else if(chunk instanceof Midi.Event.EndOfTrackEvent){if(time>maxTime)maxTime=time;time=0;currentTrack++;}else if(chunk instanceof Midi.Event.ProgramChangeEvent){currentProgram=chunk.param1;}else if(chunk instanceof Midi.FileHeader){timeDivision=chunk.timeDivision;}}
for(let note of noteArray){song.addNote(note,true);}
song.updateLoopTime();document.getElementById('bpm').value=bpm;}
function exportMidi(){let title=getTitle();let channelId=0;let lastTime=0;function eventTime(time){const diff=time-lastTime;lastTime=time;return new Midi.Delta(Math.round(diff*96));}
function createMidiInstrumentTrack(instId,track){lastTime=0;const baseInstId=instMgr.baseId(instId);const instVolume=song.settings.instruments[instId]?.volume??1;let instDetune=song.settings.instruments[instId]?.detune??0;let notes=[];for(let note of song.notes.filter(n=>n.instrument===instId)){notes.push({type:note.type,time:note.time,length:note.length,volume:Math.max(note.volume*instVolume*50,0)});}
if(notes.length===0)
return;notes.sort((a,b)=>a.time<b.time?-1:1);let events=[];for(let note of notes){events.push([{time:note.time,type:note.type,isOn:true,},note.volume,]);events.push([{time:note.time+note.length,type:note.type,isOn:false,},0,]);}
events.sort((a,b)=>{if(a[0].time===b[0].time){return a[0].isOn?1:-1;}
return a[0].time<b[0].time?-1:1;});let channel;if(instMgr.isDrum(instId)){channel=9;}else{channel=channelId;channelId++;if(channelId===9){channelId++;}}
track.appendEvent(new Midi.Event.TrackNameEvent(getInstrumentName(song,instId)));track.appendEvent(new Midi.Event.ProgramChangeEvent(channel,settings.midiInstrumentMap[baseInstId]-1));let map;if(baseInstId===36){map=Midi.drumKit808Map;}else if(baseInstId===39){map=Midi.drumKit8BitMap;}else if(baseInstId===40){map=Midi.drumKit2013Map;}else if(baseInstId===42){map=Midi.drumKit909Map;}else{map=midiNoteNamesToIndex;}
if(channel===9){instDetune=0;}
for(let event of events){const delta=eventTime(event[0].time);let pitch=map[event[0].type]+Math.round(instDetune/100);if(map===midiNoteNamesToIndex)pitch-=12;const noteEvent=event[0].isOn?new Midi.Event.NoteOnEvent(channel,pitch,event[1]):new Midi.Event.NoteOffEvent(channel,pitch,0);track.appendEvent(noteEvent,delta);}
track.appendEvent(new Midi.Event.EndOfTrackEvent());return track;}
let mpqn=1/(bpm/60)*1_000_000;let file=new Midi.File(384);let first=true;for(let i of new Set(song.notes.map(n=>n.instrument))){let track=new Midi.Track();if(first){track.appendEvent(new Midi.Event.TimeSignatureEvent(getTimeSig(),4));track.appendEvent(new Midi.Event.SetTempoEvent(mpqn));first=false;}
createMidiInstrumentTrack(i,track);file.addTrack(track);}
let data=file.getData();saveBlob(title+'.mid',[new Uint8Array(data)],'audio/midi');}
function openMidiImport(){$('#midi_import_overlay').show();$('#midi_import').show();}
function closeMidiImport(){$('#midi_import_overlay').hide();$('#midi_import').hide();}
const Midi=(function(){const instrumentMap=[41,41,43,25,43,43,17,17,26,34,26,34,34,19,34,33,28,28,28,28,28,15,15,15,1,1,32,49,35,44,44,-1,48,54,54,48,29,48,27,27,46,46,45,45,47,20,18,51,47,47,47,47,47,47,47,46,50,51,51,9,9,9,9,51,24,24,24,24,9,9,9,9,23,23,23,23,23,23,23,13,14,15,52,7,22,52,52,6,52,52,16,47,47,14,7,52
-1,-1,7,7,7,30,7,7,22,33,33,33,19,15,46,24,34,34,21,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];const drumKit8BitMap={'C2':24,'C#2':25,'D2':26,'D#2':27,'E2':28,'F2':29,'F#2':30,'G2':35,'G#2':40,'A2':42,'A#2':38,'B2':38,'C3':52,'C#3':37,'D3':38,'D#3':39,'E3':40,'F3':41,'F#3':42,'G3':43,'G#3':44,'A3':45,'A#3':46,'B3':47,'C4':48,'C#4':49,'D4':50,'D#4':51,'E4':52,'F4':53,'F#4':54,'G4':55,'G#4':56,'A4':57,'A#4':58,'B4':59,'C5':60,'C#5':61,'D5':62,'D#5':63,'E5':64,'F5':65,'F#5':66,'G5':67,'G#5':68,'A5':69,'A#5':70,'B5':71,'C6':72,'C#6':73,'D6':74,'D#6':75,'E6':76,'F6':77,'F#6':78,'G6':79,'G#6':80,'A6':81,'A#6':82,'B6':83,'C7':84,'C#7':85,'D7':86,'D#7':87,'E7':88,'F7':89,'F#7':90,'G7':91,'G#7':92,'A7':93,'A#7':94,'B7':95};const drumKit2013Map={'C2':24,'C#2':25,'D2':26,'D#2':27,'E2':28,'F2':29,'F#2':30,'G2':35,'G#2':36,'A2':40,'A#2':38,'B2':40,'C3':40,'C#3':41,'D3':42,'D#3':42,'E3':46,'F3':41,'F#3':52,'G3':43,'G#3':45,'A3':49,'A#3':47,'B3':59,'C4':57,'C#4':53,'D4':54,'D#4':55,'E4':56,'F4':57,'F#4':59,'G4':53,'G#4':38,'A4':57,'A#4':38,'B4':59,'C5':60,'C#5':61,'D5':62,'D#5':63,'E5':64,'F5':65,'F#5':66,'G5':67,'G#5':68,'A5':69,'A#5':70,'B5':71,'C6':72,'C#6':73,'D6':74,'D#6':75,'E6':76,'F6':77,'F#6':78,'G6':79,'G#6':80,'A6':81,'A#6':82,'B6':83,'C7':84,'C#7':85,'D7':86,'D#7':87,'E7':88,'F7':89,'F#7':90,'G7':91,'G#7':92,'A7':93,'A#7':94,'B7':95};const drumKit808Map={'C2':24,'C#2':25,'D2':26,'D#2':35,'E2':36,'F2':35,'F#2':39,'G2':39,'G#2':38,'A2':38,'A#2':37,'B2':42,'C3':46,'C#3':51,'D3':41,'D#3':43,'E3':48,'F3':50,'F#3':56,'G3':80,'G#3':32,'A3':45,'A#3':46,'B3':47,'C4':48,'C#4':49,'D4':50,'D#4':51,'E4':52,'F4':53,'F#4':54,'G4':55,'G#4':56,'A4':57,'A#4':58,'B4':59,'C5':60,'C#5':61,'D5':62,'D#5':63,'E5':64,'F5':65,'F#5':66,'G5':67,'G#5':68,'A5':69,'A#5':70,'B5':71,'C6':72,'C#6':73,'D6':74,'D#6':75,'E6':76,'F6':77,'F#6':78,'G6':79,'G#6':80,'A6':81,'A#6':82,'B6':83,'C7':84,'C#7':85,'D7':86,'D#7':87,'E7':88,'F7':89,'F#7':90,'G7':91,'G#7':92,'A7':93,'A#7':94,'B7':95};const drumKit909Map={'C2':24,'C#2':25,'D2':26,'D#2':35,'E2':36,'F2':35,'F#2':38,'G2':38,'G#2':38,'A2':41,'A#2':43,'B2':45,'C3':47,'C#3':48,'D3':50,'D#3':37,'E3':39,'F3':42,'F#3':42,'G3':46,'G#3':46,'A3':49,'A#3':59,'B3':47,'C4':48,'C#4':49,'D4':50,'D#4':51,'E4':52,'F4':53,'F#4':54,'G4':55,'G#4':56,'A4':57,'A#4':58,'B4':59,'C5':60,'C#5':61,'D5':62,'D#5':63,'E5':64,'F5':65,'F#5':66,'G5':67,'G#5':68,'A5':69,'A#5':70,'B5':71,'C6':72,'C#6':73,'D6':74,'D#6':75,'E6':76,'F6':77,'F#6':78,'G6':79,'G#6':80,'A6':81,'A#6':82,'B6':83,'C7':84,'C#7':85,'D7':86,'D#7':87,'E7':88,'F7':89,'F#7':90,'G7':91,'G#7':92,'A7':93,'A#7':94,'B7':95};class MidiException extends Error{}
class ParserException extends Error{}
function getDeltaByteSequence(ticks){let byteSequence=[ticks&0x7F];ticks>>=7;while(ticks>0){byteSequence.push((ticks&0x7F)|0x80);ticks>>=7;}
return byteSequence.reverse();}
Array.prototype.extend=function(other){other.forEach(function(v){this.push(v)},this);}
class Timer{constructor(timeDivision){if(timeDivision<0){throw new MidiException('Time division must be greater than zero');}
this.timeDivision=timeDivision;this.triplets=[];}
getTicksForNoteDivision(division){return Math.floor(this.timeDivision/division);}
sixtyFourthNote(){return this.getTicksForNoteDivision(16);}
thirtySecondNote(){return this.getTicksForNoteDivision(8);}
sixteenthNote(){return this.getTicksForNoteDivision(4);}
eighthNote(){return this.getTicksForNoteDivision(2);}
quarterNote(){return this.getTicksForNoteDivision(1);}
halfNote(){return this.getTicksForNoteDivision(0.5);}
wholeNote(){return this.getTicksForNoteDivision(0.25);}
dot(ticks){return Math.floor(ticks*1.5);}
triplet(ticks){let tripletTicks=Math.floor(ticks/3);if(this.triplets[ticks]!==undefined){if(this.triplets[ticks]===tripletTicks*2){tripletTicks=this.resolveTriplet(ticks);}else{this.triplets[ticks]+=tripletTicks;}}else{this.triplets[ticks]=tripletTicks;}
return tripletTicks;}
resolveTriplet(ticks){if(this.triplets[ticks]===null){throw new MidiException('This triplet division has not been registered');}
let resolvedTicks=ticks-this.triplets[ticks];delete this.triplets[ticks];return resolvedTicks;}
staccato(ticks){return Math.floor(ticks*.75);}
unstaccato(ticks){return ticks-this.staccato(ticks);}}
const Event=(function(){class EventType{static NOTE_OFF=0x80;static NOTE_ON=0x90;static NOTE_AFTERTOUCH=0xA0;static CONTROLLER=0xB0;static PROGRAM_CHANGE=0xC0;static CHANNEL_AFTERTOUCH=0xD0;static PITCH_BEND=0xE0;static SYSTEM_EXCLUSIVE=0xF0;static UNDEFINED1=0xF1;static SONG_POSITION_POINTER=0xF2;static SONG_SELECT=0xF3;static UNDEFINED2=0xF4;static UNDEFINED3=0xF5;static TUNE_REQUEST=0xF6;static AUTHORIZATION=0xF7;static TIMING_CLOCK=0xF8;static UNDEFINED4=0xF9;static SEQUENCE_START=0xFA;static SEQUENCE_CONTINUE=0xFB;static SEQUENCE_STOP=0xFC;static UNDEFINED5=0xFD;static ACTIVE_SENSING=0xFE;static META=0xFF;static eventNameMap={0x80:'Note Off',0x90:'Note On',0xA0:'Note Aftertouch',0xB0:'Controller',0xC0:'Program Change',0xD0:'Channel Aftertouch',0xE0:'Pitch Bend',0xF0:'System Exclusive',0xF1:'Undefined',0xF2:'Song Position Pointer',0xF3:'Song Select',0xF4:'Undefined',0xF5:'Undefined',0xF6:'Tune Request',0xF7:'Authorization',0xF8:'Timing Clock',0xF9:'Undefined',0xFA:'Sequence Start',0xFB:'Sequence Continue',0xFC:'Sequence Stop',0xFD:'Undefined',0xFE:'Active Sensing',0xFF:'Meta'};static getEventName(event){if(this.eventNameMap[event]===undefined){throw new TypeError('First argument must be one of the EventType constants');}
return this.eventNameMap[event];}}
class MetaEventType{static SEQUENCE_NUMBER=0x00;static TEXT_EVENT=0x01;static COPYRIGHT_NOTICE=0x02;static TRACK_NAME=0x03;static INSTRUMENT_NAME=0x04;static LYRICS=0x05;static MARKER=0x06;static CUE_POINT=0x07;static DEVICE_NAME=0x09;static END_OF_TRACK=0x2F;static CHANNEL_PREFIX=0x20;static SET_TEMPO=0x51;static SMPTE_OFFSET=0x54;static TIME_SIGNATURE=0x58;static KEY_SIGNATURE=0x59;static SEQUENCER_SPECIFIC=0x7F;static UNKNOWN=-1;static eventNameMap={0x00:'Sequence Number',0x01:'Text Event',0x02:'Copyright Notice',0x03:'Track Name',0x04:'Instrument Name',0x05:'Lyrics',0x06:'Marker',0x07:'Cue Point',0x20:'Channel Prefix',0x2F:'End of Track',0x51:'Set Tempo',0x54:'SMTPE Offset',0x58:'Time Signature',0x59:'Key Signature',0x7F:'Sequencer Specific'};static getEventTypeName(eventType){if(this.eventNameMap[eventType]===undefined){return'Unknown';}
return this.eventNameMap[eventType];}}
class ChannelEvent{type=null;constructor(channel,param1,param2=null,isContinuation=false){this.channel=channel;this.param1=param1;this.param2=param2;this.isContinuation=isContinuation;}
toBinary(){let binary=(this.isContinuation)?[]:[this.type|this.channel];binary.push(this.param1);if(this.param2!=null){binary.push(this.param2);}
return binary;}
getData(){return[this.channel,this.param1,this.param2];}
getLength(){return(this.isContinuation)?2:3;}}
class MetaEvent{constructor(data=null){if(data&&data.length){this.length=data.length;}else{this.length=0;}
if(typeof(data)==='string'){this.data=new TextEncoder().encode(data);}else{this.data=data??[];}}
getLength(){let lengthOfDelta=getDeltaByteSequence(this.length).length;return 1+1+lengthOfDelta+this.length;}
toBinary(){return[this.getType(),this.getSubtype(),...getDeltaByteSequence(this.length),...this.data];}
getData(){return[this.getSubtype(),this.length,this.data];}
getType(){return EventType.META;}
getSubtype(){return MetaEventType.UNKNOWN;}}
class ChannelAftertouchEvent extends ChannelEvent{length=2;type=EventType.CHANNEL_AFTERTOUCH;}
class ChannelPrefixEvent extends MetaEvent{constructor(data){super([data]);}
getSubtype(){return MetaEventType.CHANNEL_PREFIX;}}
class ControllerEvent extends ChannelEvent{type=EventType.CONTROLLER;}
class CopyrightNoticeEvent extends MetaEvent{getSubtype(){return MetaEventType.COPYRIGHT_NOTICE;}}
class CuePointEvent extends MetaEvent{getSubtype(){return MetaEventType.CUE_POINT;}}
class EndOfTrackEvent extends MetaEvent{getSubtype(){return MetaEventType.END_OF_TRACK;}}
class InstrumentNameEvent extends MetaEvent{getSubtype(){return MetaEventType.INSTRUMENT_NAME;}}
class KeySignatureEvent extends MetaEvent{getSubtype(){return MetaEventType.KEY_SIGNATURE;}}
class LyricsEvent extends MetaEvent{getSubtype(){return MetaEventType.LYRICS;}}
class MarkerEvent extends MetaEvent{getSubtype(){return MetaEventType.MARKER;}}
class NoteAftertouchEvent extends ChannelEvent{type=EventType.NOTE_AFTERTOUCH;}
class NoteOffEvent extends ChannelEvent{type=EventType.NOTE_OFF;}
class NoteOnEvent extends ChannelEvent{type=EventType.NOTE_ON;}
class PitchBendEvent extends ChannelEvent{static pitchBendToCents(param1,param2){param1&=0x0FFF;param2=(param2&0x0FFF)<<2;let total=param2|param1;total-=8192;return Math.round(total/81.92);}
type=EventType.PITCH_BEND;}
class ProgramChangeEvent extends ChannelEvent{type=EventType.PROGRAM_CHANGE;getLength(){return 2;}}
class SequenceNumberEvent extends MetaEvent{getSubtype(){return MetaEventType.SEQUENCE_NUMBER;}}
class SequencerSpecificEvent extends MetaEvent{getSubtype(){return MetaEventType.SEQUENCER_SPECIFIC;}}
class SetTempoEvent extends MetaEvent{constructor(mpqn){super([(mpqn>>16)&0xFF,(mpqn>>8)&0xFF,mpqn&0xFF]);mpqn=(this.data[0]<<16)|(this.data[1]<<8)|this.data[2];this.bpm=SetTempoEvent.getBpmFromMpqn(mpqn);}
static getBpmFromMpqn(mpqn){return Math.floor(60000000/mpqn);}
getSubtype(){return MetaEventType.SET_TEMPO;}}
class SmpteOffsetEvent extends MetaEvent{constructor(frameRate,hour,min,second,frame,subframe){super([(frameRate<<5)|hour,min,second,frame,subframe]);}
static getFrameRateDescription(frameRate){switch(frameRate){case 0:return'24fps';case 1:return'25fps';case 2:return'30fps (drop frame)';case 3:return'30fps';default:throw new MidiException('Invalid frame rate');}}
getSubtype(){return MetaEventType.SMPTE_OFFSET;}}
class SystemExclusiveEvent{type=EventType.SYSTEM_EXCLUSIVE;constructor(data){this.length=data.length;this.data=data;}
getLength(){let lengthOfDelta=getDeltaByteSequence(this.length).length;return 1+lengthOfDelta+this.length;}
toBinary(){let delta=getDeltaByteSequence(this.length);return[this.type,...delta,...this.data];}
isDivided(){return!this.isNormal();}
isNormal(){return this.data[this.data.length-1]===0xF7;}}
class TextEvent extends MetaEvent{getSubtype(){return MetaEventType.TEXT_EVENT;}}
class TimeSignatureEvent extends MetaEvent{constructor(numerator,denominator,metronomePulse=24,thirtySecondNotesPerQuarterNote=8){super([numerator,Math.log2(denominator),metronomePulse,thirtySecondNotesPerQuarterNote]);}
static getTimeSignature(numerator,logarithmicDenominator){return numerator+'/'+(logarithmicDenominator**2);}
getSubtype(){return MetaEventType.TIME_SIGNATURE;}}
class TrackNameEvent extends MetaEvent{getSubtype(){return MetaEventType.TRACK_NAME;}}
class UnknownMetaEvent extends MetaEvent{getSubtype(){return MetaEventType.UNKNOWN;}}
return{EventType,MetaEventType,ChannelAftertouchEvent,ChannelPrefixEvent,ControllerEvent,CopyrightNoticeEvent,CuePointEvent,EndOfTrackEvent,InstrumentNameEvent,KeySignatureEvent,LyricsEvent,MarkerEvent,NoteAftertouchEvent,NoteOffEvent,NoteOnEvent,PitchBendEvent,ProgramChangeEvent,SequenceNumberEvent,SequencerSpecificEvent,SetTempoEvent,SmpteOffsetEvent,SystemExclusiveEvent,TextEvent,TimeSignatureEvent,TrackNameEvent,UnknownMetaEvent}})();class Delta{constructor(ticks){this.ticks=ticks;}
getData(){let v=new DataView(new ArrayBuffer(4));v.setInt32(0,this.ticks);return[...new Uint8Array(v.buffer,0,4)];}
toBinary(){return getDeltaByteSequence(this.ticks);};getLength(){return this.toBinary().length;}}
class FileHeader{constructor(midiFormat,numTracks,timeDivision){this.midiFormat=midiFormat;this.numTracks=numTracks;this.timeDivision=timeDivision;}
static length=14;getData(){return[this.midiFormat,this.numTracks,this.timeDivision];}
toBinary(){return[0x4D,0x54,0x68,0x64,0x00,0x00,0x00,0x06,0x00,this.midiFormat,this.numTracks>>8,this.numTracks&0xFF,this.timeDivision>>8,this.timeDivision&0xFF]}}
class TrackHeader{constructor(size){this.size=size;}
static length=8;getSize(){return this.size;}
getData(){return[this.size];}
toBinary(){return[0x4D,0x54,0x72,0x6B,this.size>>24,(this.size>>16)&0xFF,(this.size>>8)&0xFF,this.size&0xFF]}}
const ParseState={FILE_HEADER:0,TRACK_HEADER:1,DELTA:2,EVENT:3,EOF:4};class Parser{constructor(data){this.data=data;this.state=ParseState.EOF;this.data._offset=0;}
setState(state){this.state=state;}
read(count){const data=this.data.slice(this.data._offset,this.data._offset+count);this.data._offset+=count;if(this.data._offset>this.data.length){throw new ParserException(`Offset (${
            this.data._offset}) exceeds buffer length (${this.data.length})!`);}
return data;}
getDelta(){let value=this.read(1)[0];let delta=[];while(value>0x7F){delta.push(value);value=this.read(1)[0];}
if(value!==null){delta.push(value);}
let bytes=delta.reverse();let ticks=0;let shift=0;for(let byte of bytes){ticks|=(byte&0x7F)<<shift;shift+=7;}
return ticks;}}
class FileParser extends Parser{constructor(data,trackParser=null){super(data);this.trackParser=(trackParser===null)?new TrackParser(data):trackParser;this.tracksParsed=0;this.tracksExpected=0;this.setState(ParseState.FILE_HEADER);}
getRawFileHeader(){return this.read(FileHeader.length);}
parseFileHeader(header){let extraBytes=0;if(header.length!==FileHeader.length){extraBytes=FileHeader.length-header.length;if(extraBytes<0){throw new MidiException('MIDI header too small.');}}
let id=header.slice(0,4);let chunkSize=header.slice(4,8);let format=header.slice(8,10);let tracks=header.slice(10,12);let timeDivision=header.slice(12,14);if([...id].toString()!==[0x4D,0x54,0x68,0x64].toString()){throw new MidiException('Invalid file header, expected byte sequence [4D 54 68 64] (MThd)');}
if([...chunkSize].toString()!==[0x00,0x00,0x00,0x06].toString()){throw new MidiException('File header chunk size must be [00 00 00 06]');}
format=(format[0]<<8)|format[1];timeDivision=(timeDivision[0]<<8)|timeDivision[1];tracks=(tracks[0]<<8)|tracks[1];if(format!==0&&format!==1&&format!==2){throw new MidiException('MIDI file format must be 0, 1 or 2 (got '+format+')');}
return new FileHeader(format,tracks,timeDivision);}
parse(){let chunk=null;switch(this.state){case ParseState.FILE_HEADER:chunk=this.parseFileHeader(this.getRawFileHeader());this.tracksExpected=chunk.numTracks;this.setState(ParseState.TRACK_HEADER);break;case ParseState.TRACK_HEADER:case ParseState.EVENT:case ParseState.DELTA:chunk=this.trackParser.parse();let newState=this.trackParser.state;if(newState===ParseState.TRACK_HEADER){this.tracksParsed++;if(this.tracksParsed>=this.tracksExpected){newState=ParseState.EOF;}}
this.setState(newState);break;case ParseState.EOF:break;default:throw new MidiException('Unknown parse state: '+this.state);}
return chunk;}}
class DeltaParser extends Parser{getDeltaChunk(ticks){return new Delta(ticks);}
parse(){return this.getDeltaChunk(this.getDelta());}}
class EventParser extends Parser{constructor(data){super(data);this.continuationEvent=null;}
getChannelEvent(type,channel,param1,param2=null){let eventClass;switch(type){case Event.EventType.NOTE_OFF:eventClass=Event.NoteOffEvent;break;case Event.EventType.NOTE_ON:eventClass=Event.NoteOnEvent;break;case Event.EventType.NOTE_AFTERTOUCH:eventClass=Event.NoteAftertouchEvent;break;case Event.EventType.CONTROLLER:eventClass=Event.ControllerEvent;break;case Event.EventType.PROGRAM_CHANGE:eventClass=Event.ProgramChangeEvent;break;case Event.EventType.CHANNEL_AFTERTOUCH:eventClass=Event.ChannelAftertouchEvent;break;case Event.EventType.PITCH_BEND:eventClass=Event.PitchBendEvent;break;default:throw new MidiException('Invalid channel event');}
return new eventClass(channel,param1,param2);}
getMetaEvent(type,data){switch(type){case Event.MetaEventType.SEQUENCE_NUMBER:return new Event.SequenceNumberEvent(data);case Event.MetaEventType.TEXT_EVENT:return new Event.TextEvent(data);case Event.MetaEventType.COPYRIGHT_NOTICE:return new Event.CopyrightNoticeEvent(data);case Event.MetaEventType.TRACK_NAME:return new Event.TrackNameEvent(data);case Event.MetaEventType.INSTRUMENT_NAME:return new Event.InstrumentNameEvent(data);case Event.MetaEventType.LYRICS:return new Event.LyricsEvent(data);case Event.MetaEventType.MARKER:return new Event.MarkerEvent(data);case Event.MetaEventType.CUE_POINT:return new Event.CuePointEvent(data);case Event.MetaEventType.END_OF_TRACK:return new Event.EndOfTrackEvent();case Event.MetaEventType.CHANNEL_PREFIX:return new Event.ChannelPrefixEvent(data[0]);case Event.MetaEventType.SET_TEMPO:let mpqn=(data[0]<<16)|(data[1]<<8)|data[2];return new Event.SetTempoEvent(mpqn);case Event.MetaEventType.SMPTE_OFFSET:let frameRate=(data[0]>>5)&0xFF;let hour=data[0]&0x1F;let minute=data[1];let second=data[2];let frame=data[3];let subFrame=data[4];return new Event.SmpteOffsetEvent(frameRate,hour,minute,second,frame,subFrame);case Event.MetaEventType.TIME_SIGNATURE:return new Event.TimeSignatureEvent(data[0],2**data[1],data[2],data[3]);case Event.MetaEventType.KEY_SIGNATURE:return new Event.KeySignatureEvent(data);case Event.MetaEventType.SEQUENCER_SPECIFIC:return new Event.SequencerSpecificEvent(data);default:return new Event.UnknownMetaEvent(data);}}
parse(){let eventType=this.read(1)[0];let isContinuation=false;if(eventType<0x80){if(this.continuationEvent===null){throw new MidiException('Invalid event: first byte must be greater than or equal to 0x80');}else{eventType=this.continuationEvent;isContinuation=true;this.data._offset-=1;}}else{this.continuationEvent=eventType;}
if(eventType<0xF0){return this.parseChannelEvent(eventType,isContinuation);}else if(eventType===0xFF){return this.parseMetaEvent();}else if(eventType===0xF0){return this.parseSystemExclusiveEvent();}
throw new MidiException('Unsupported event type: '+eventType);}
parseChannelEvent(eventType,isContinuation){let type=eventType&0xF0;let data=[null,null];if(type===0xC0||type===0xD0){data[0]=this.read(1)[0];}else{data=this.read(2);}
let event=this.getChannelEvent(eventType&0xF0,eventType&0x0F,data[0],data[1]);if(isContinuation){event.isContinuation=true;}
return event;}
parseMetaEvent(){let metaEventType=this.read(1)[0];let length=this.getDelta();let data=this.read(length);return this.getMetaEvent(metaEventType,data);}
parseSystemExclusiveEvent(){let length=this.getDelta();let data=this.read(length);return new Event.SystemExclusiveEvent(data);}}
class TrackParser extends Parser{constructor(data,eventParser=null,deltaParser=null){super(data);this.eventParser=(eventParser===null)?new EventParser(data):eventParser;this.deltaParser=(deltaParser===null)?new DeltaParser(data):deltaParser;this.expectedTrackLength=0;this.parsedTrackLength=0;this.setState(ParseState.TRACK_HEADER);}
getRawTrackHeader(){return this.read(TrackHeader.length);}
parseTrackHeader(header){let id=header.slice(0,4);let size=[...header.slice(4,8)].reverse();if([...id].toString()!==[0x4D,0x54,0x72,0x6B].toString()){throw new MidiException('Invalid track header, expected [4D 54 72 6B] (got '+id+')');}
let shift=0;let trackSize=0;for(let byte of size){trackSize|=(byte<<shift);shift+=8;}
return new TrackHeader(trackSize);}
parse(){let chunk=null;switch(this.state){case ParseState.TRACK_HEADER:chunk=this.parseTrackHeader(this.getRawTrackHeader());this.parsedTrackLength=0;this.expectedTrackLength=chunk.getSize();this.setState(ParseState.DELTA);break;case ParseState.DELTA:chunk=this.deltaParser.parse();this.setState(ParseState.EVENT);this.checkTrackLength(chunk.getLength());break;case ParseState.EVENT:chunk=this.eventParser.parse();this.checkTrackLength(chunk.getLength());if(this.parsedTrackLength===this.expectedTrackLength){this.setState(ParseState.TRACK_HEADER);}else{this.setState(ParseState.DELTA);}
if(chunk instanceof Event.EndOfTrackEvent){this.setState(ParseState.TRACK_HEADER);}
break;default:throw new MidiException('Invalid state: '+this.state);}
return chunk;}
checkTrackLength(length){this.parsedTrackLength+=length;if(this.parsedTrackLength>this.expectedTrackLength){}}}
class Track{constructor(){this.chunks=[];}
appendEvent(event,delta=null){if(delta===null){delta=new Delta(0);}
this.chunks.push(delta,event);return this;}
getData(){let data=[];let size=0;for(let chunk of this.chunks){size+=chunk.getLength();data.extend(chunk.toBinary());}
return this.createTrackHeader(size).toBinary().concat(data);}
createTrackHeader(size){return new TrackHeader(size);}}
class File{constructor(timeDivision,format=null){this.tracks=[];this.timeDivision=timeDivision;this.format=format;}
getData(){const numTracks=this.tracks.length;if(numTracks===0){throw new MidiException('No tracks have been added');}
if(this.format==null){if(numTracks>1){this.format=1;}else{this.format=0;}}
if(this.format==0&&numTracks>1){throw new MidiException('Cannot have multiple tracks in MIDI format 0');}
let data=this.createFileHeader(this.format,numTracks,this.timeDivision).toBinary();for(let track of this.tracks){data.extend(track.getData());}
return data;}
createFileHeader(format,numTracks,timeDivision){return new FileHeader(format,numTracks,timeDivision);}
getTimer(){return new Timer(this.timeDivision);}
addTrack(track){this.tracks.push(track);return this;}}
return{instrumentMap,drumKit8BitMap,drumKit808Map,drumKit909Map,drumKit2013Map,MidiException,ParserException,Event,Delta,FileHeader,TrackHeader,ParseState,FileParser,DeltaParser,EventParser,TrackParser,Track,File}})();function midiTest(){const input=document.createElement('input');input.type='file';input.onchange=e=>{const file=e.target.files[0];const reader=new FileReader();reader.onloadend=_=>{let arr=new Uint8Array(reader.result);console.log(arr);window.midiParser=new Midi.FileParser(arr);};reader.readAsArrayBuffer(file);};input.click();}
var $=jQuery;const instanceId=Math.random()*1048576|0;const wavesurferScale=2;const zoomFactor=1.05;const undoSize=128;const kScrollbarWidth=16;const keyElements=[];const keyTextElements=[];const clipboard={notes:[],markers:[],};const selection=new Selection();const lastNoteVolume=new Map();const sustainedMidiNotes={};const sustainedKeyboardNotes={};const dragMarkers=new Set();const dragMarkerTimes=new Set();const initialInstrumentVolume=new Map();const clickTargets={};const isWebkit=navigator.userAgent.toLowerCase().indexOf('webkit')>-1;const kClickTargetNone=0;const kClickTargetSequencer=1;const kClickTargetKeyboard=2;const kClickTargetMarkerBar=3;const kMidiNoteOff=0x80;const kMidiNoteOn=0x90;const kMidiDrumNoteOff=0x89;const kMidiDrumNoteOn=0x99;const kMidiControlChange=0xB0;const kMidiPitchBend=0xE0;const kScrollSmooth=0;const kScrollFast=1;const kScrollOff=2;const kScrollFollow=3;const kReverbData=[null,{name:'Classic Reverb',shortName:'Reverb',impulse:'classic_reverb.ogg'},{name:'Small Reverb',shortName:'Small',impulse:'small_reverb.ogg'},{name:'Large Reverb',shortName:'Large',impulse:'large_reverb.ogg'},{name:'Gated Reverb',shortName:'Gated',impulse:'gated_reverb.ogg'},{name:'Reverse',shortName:'Reverse',impulse:'reverse.ogg'},{name:'Nova',shortName:'Nova',impulse:'nova.ogg'},{name:'Ripple',shortName:'Ripple',impulse:'ripple.ogg'},{name:'Miasma',shortName:'Miasma',impulse:'miasma.ogg'},{name:'Proton',shortName:'Proton',impulse:'proton.ogg'},{name:'Schema',shortName:'Schema',impulse:'schema.ogg'},{name:'Sylph',shortName:'Sylph',impulse:'sylph.ogg'},{name:'Church Reverb',shortName:'Church',impulse:'church_reverb.ogg'},{name:'Short Reverb',shortName:'Short',impulse:'short_reverb.ogg'},];const kReverbDisplayOrder=[1,2,13,3,12,4,5,6,7,8,9,10,11];const kDistortCurveResolution=512;const kDistortData=[null,{name:'Limit',curve:x=>0.3*Math.tanh(10*x),},{name:'Zest',curve:x=>0.3*((x*10)%1),},{name:'Quasar',curve:x=>0.3*Math.sin(x*15),},{name:'Styx',curve:x=>{const wobble=Math.sqrt(Math.abs(x))*(0.5+0.5*Math.cos(x*30));return 0.4*(x-2*Math.sign(x)*wobble);},},{name:'Lucid',curve:x=>2*x*x,},{name:'Tremor',curve:x=>(Math.exp(2*x)-1)/Math.E,},{name:'Zircon',curve:x=>0.3*Math.sin(30*x*x*x+x),},{name:'Hornet',curve:x=>Math.abs(x)-3*Math.max(0,Math.abs(x)-0.3),},{name:'Shear',curve:x=>{const z=Math.abs(x);return Math.sign(x)*z*z*z*z/(z*z*z+3e-5);},},{name:'SoftLim',curve:x=>{const l=0.1,m=1.5,n=0.2,X=Math.abs(x);return(Math.abs(x)<l)?m*x:(x/X)*(n*Math.tanh(m*(X-l)/n)+l*m);},},];const kDistortDisplayOrder=[1,10,2,3,4,5,6,7,8,9];const kMarkerLFORateOrder=[{label:'Custom',value:0},{label:'1',value:1},{label:'1/2',value:2},{label:'1/3',value:3},{label:'1/4',value:4},{label:'1/6',value:6},{label:'1/8',value:8},{label:'1/12',value:12},{label:'1/16',value:16},{label:'1/32',value:32}];const kMarkerSettingBpm=0;const kMarkerSettingInstrumentVolume=1;const kMarkerSettingInstrumentPanning=2;const kMarkerSettingInstrumentEqHigh=3;const kMarkerSettingInstrumentEqMid=4;const kMarkerSettingInstrumentEqLow=5;const kMarkerSettingInstrumentDelay=6;const kMarkerSettingInstrumentReverb=7;const kMarkerSettingVolume=8;const kMarkerSettingFastGraphics=9;const kMarkerSettingAutoscroll=10;const kMarkerSettingInstrumentDetune=11;const kMarkerSettingInstrumentReverbVolume=12;const kMarkerSettingInstrumentDistortKind=13;const kMarkerSettingInstrumentDistortGain=14;const kMarkerSettingFullReset=15;const kMarkerSettingSynthFilter=16;const kMarkerSettingSynthResonance=17;const kMarkerSettingSynthLFOEnabled=18;const kMarkerSettingSynthLFOIntensity=19;const kMarkerSettingSynthLFORate=20;const kMarkerSettingSynthEnvelope=21;const kMarkerSettingSynthAttack=22;const kMarkerSettingSynthDecay=23;const kMarkerSettingSynthSustain=24;const kMarkerSettingSynthRelease=25;const kMarkerEditorSettingsOrder=[kMarkerSettingVolume,kMarkerSettingBpm,kMarkerSettingInstrumentVolume,kMarkerSettingInstrumentPanning,kMarkerSettingInstrumentEqHigh,kMarkerSettingInstrumentEqMid,kMarkerSettingInstrumentEqLow,kMarkerSettingInstrumentDelay,kMarkerSettingInstrumentReverb,kMarkerSettingInstrumentReverbVolume,kMarkerSettingInstrumentDetune,kMarkerSettingInstrumentDistortKind,kMarkerSettingInstrumentDistortGain,kMarkerSettingFullReset,kMarkerSettingAutoscroll,kMarkerSettingFastGraphics,kMarkerSettingSynthFilter,kMarkerSettingSynthResonance,kMarkerSettingSynthLFOEnabled,kMarkerSettingSynthLFOIntensity,kMarkerSettingSynthLFORate,kMarkerSettingSynthEnvelope,kMarkerSettingSynthAttack,kMarkerSettingSynthDecay,kMarkerSettingSynthSustain,kMarkerSettingSynthRelease];const kMarkerEditorSettings=[{name:'BPM',title:'BPM',isBlendable:true,isSmoothBlendable:false,min:10,max:999,isInt:true,defaultValue:110,getInitialValue:()=>parseInt(initialBpm),setValue:(instId,value)=>song.setBPM(value,true),},{name:'Instrument Volume',title:'Volume',isPerInstrument:true,isBlendable:true,isSmoothBlendable:true,isSlider:true,min:0,max:2,step:0.01,defaultValue:1,getInitialValue:(instId)=>parseFloat(getInitialInstrumentVolume(instId)),setValue:(instId,value)=>audioSystem.setInstrumentVolume(instId,value),blendValue:(instId,value,dt)=>audioSystem.blendInstrumentVolume(instId,value,dt),},{name:'Instrument Panning',title:'Panning',isPerInstrument:true,isBlendable:true,isSmoothBlendable:true,isSlider:true,min:-1,max:1,step:0.01,defaultValue:0,getInitialValue:(instId)=>parseFloat(song.getInstrumentSettings(instId).pan),setValue:(instId,value)=>audioSystem.setPan(instId,value),blendValue:(instId,value,dt)=>audioSystem.blendPan(instId,value,dt),},{name:'Instrument EQ High',title:'EQ High',isPerInstrument:true,isBlendable:true,isSmoothBlendable:true,isSlider:true,withWarning:true,min:-48,max:48,step:1,defaultValue:0,getInitialValue:(instId)=>parseFloat(song.getInstrumentSettings(instId).eq.high),setValue:(instId,value)=>audioSystem.setEqHigh(instId,value),blendValue:(instId,value,dt)=>audioSystem.blendEqHigh(instId,value,dt),},{name:'Instrument EQ Mid',title:'EQ Mid',isPerInstrument:true,isBlendable:true,isSmoothBlendable:true,isSlider:true,withWarning:true,min:-48,max:48,step:1,defaultValue:0,getInitialValue:(instId)=>parseFloat(song.getInstrumentSettings(instId).eq.mid),setValue:(instId,value)=>audioSystem.setEqMid(instId,value),blendValue:(instId,value,dt)=>audioSystem.blendEqMid(instId,value,dt),},{name:'Instrument EQ Low',title:'EQ Low',isPerInstrument:true,isBlendable:true,isSmoothBlendable:true,isSlider:true,withWarning:true,min:-48,max:48,step:1,defaultValue:0,getInitialValue:(instId)=>parseFloat(song.getInstrumentSettings(instId).eq.low),setValue:(instId,value)=>audioSystem.setEqLow(instId,value),blendValue:(instId,value,dt)=>audioSystem.blendEqLow(instId,value,dt),},{name:'Instrument Delay',title:'Delay',isPerInstrument:true,isBool:true,defaultValue:0,getInitialValue:(instId)=>song.getInstrumentSettings(instId).delay,setValue:(instId,value)=>audioSystem.setDelay(instId,value!=0),},{name:'Instrument Effects',title:'Effects',isPerInstrument:true,isEnum:true,defaultValue:0,enumOptions:function(){const options=[{label:'Off',value:0}];for(const i of kReverbDisplayOrder){options.push({label:kReverbData[i].name,value:i});}
return options;}(),getInitialValue:function(instId){const settings=song.getInstrumentSettings(instId);return settings.reverb?settings.reverbType:0;},setValue:(instId,value)=>audioSystem.setReverb(instId,value),},{name:'Sequence Volume',title:'Volume',isBlendable:true,isSmoothBlendable:true,isSlider:true,min:0,max:2,step:0.01,defaultValue:1,getInitialValue:()=>parseFloat(song.getVolume()),setValue:function(instId,value){currentSongVolume=value;updateVolume();},blendValue:(instId,value,dt)=>audioSystem.blendVolume(value,dt),},{name:'Fast Graphics',title:'Fast Graphics',isBool:true,defaultValue:0,getInitialValue:()=>initialFastGraphics,setValue:function(_,value){SequencerView.fastGraphics=value;SequencerView.repaint();},},{name:'Autoscroll',title:'Autoscroll',isEnum:true,defaultValue:kScrollFollow,enumOptions:[{label:'Follow',value:kScrollFollow,},{label:'Smooth',value:kScrollSmooth,},{label:'Fast',value:kScrollFast,},{label:'Off',value:kScrollOff,},],getInitialValue:()=>initialAutoScroll,setValue:function(_,value){SequencerView.autoScroll=autoScroll=value;SequencerView.repaint();},},{name:'Instrument Detune',title:'Detune',isPerInstrument:true,isBlendable:true,isSmoothBlendable:true,isSlider:true,isDetuneSlider:true,min:-1200,max:1200,step:100,defaultValue:0,getInitialValue:(i)=>song.getInstrumentSettings(i).detune,setValue:(instId,value)=>audioSystem.setDetune(instId,value),blendValue:(instId,value,dt)=>audioSystem.blendDetune(instId,value,dt),},{name:'Instrument Reverb Volume',title:'Reverb Volume',isPerInstrument:true,isBlendable:true,isSmoothBlendable:true,isSlider:true,min:0,max:1,step:0.01,defaultValue:1,getInitialValue:(i)=>song.getInstrumentSettings(i).reverbVolume,setValue:(instId,value)=>audioSystem.setReverbVolume(instId,value),blendValue:(instId,value,dt)=>audioSystem.blendReverbVolume(instId,value,dt),},{name:'Instrument Distort',title:'Distort',isPerInstrument:true,isEnum:true,defaultValue:0,enumOptions:function(){const options=[{label:'Off',value:0}];for(let i=0;i<kDistortDisplayOrder.length;++i){const j=kDistortDisplayOrder[i];options.push({label:kDistortData[j].name,value:j});}
return options;}(),getInitialValue:function(instId){const settings=song.getInstrumentSettings(instId);return settings.distort?settings.distortType:0;},setValue:(instId,value)=>audioSystem.setDistortType(instId,value),},{name:'Instrument Distort Volume',title:'Distort Volume',isPerInstrument:true,isBlendable:true,isSmoothBlendable:true,isSlider:true,min:0,max:1,step:0.01,defaultValue:0,getInitialValue:(i)=>song.getInstrumentSettings(i).distortVolume,setValue:(instId,value)=>audioSystem.setDistortGain(instId,value),blendValue:(instId,value,dt)=>audioSystem.blendDistortGain(instId,value,dt),},{name:'Reset Instrument Settings',title:'Reset Settings',isPerInstrument:true,isBool:true,defaultValue:true,getInitialValue:()=>false,setValue:function(instId,value){if(value)song.doFullReset(instId);},},{name:'Synthesizer Filter',title:'Filter',isPerInstrument:true,isBlendable:true,isSmoothBlendable:true,isSlider:true,min:0,max:20000,step:100,defaultValue:20000,getInitialValue:(instId)=>song.settings.instruments[instId].synth.filter,setValue:(instId,value)=>audioSystem.setSynthFilter(instId,value),blendValue:(instId,value,dt)=>audioSystem.blendSynthFilter(instId,value,dt),},{name:'Synthesizer Filter Q',title:'Filter Q',isPerInstrument:true,isBlendable:true,isSmoothBlendable:true,isSlider:true,min:0,max:20,step:1,defaultValue:10,getInitialValue:(instId)=>song.settings.instruments[instId].synth.resonance,setValue:(instId,value)=>audioSystem.setSynthFilterResonance(instId,value),blendValue:(instId,value,dt)=>audioSystem.blendSynthFilterResonance(instId,value,dt),},{name:'Synthesizer LFO',title:'LFO',isPerInstrument:true,isBool:true,defaultValue:0,getInitialValue:(instId)=>song.settings.instruments[instId].synth.lfoEnabled,setValue:(instId,value)=>audioSystem.setLFOEnabled(instId,value!=0),},{name:'Synthesizer LFO Intensity',title:'LFO Intensity',isPerInstrument:true,isBlendable:true,isSmoothBlendable:true,isSlider:true,min:0,max:100,step:1,defaultValue:0,getInitialValue:(instId)=>song.settings.instruments[instId].synth.lfoIntensity,setValue:(instId,value)=>audioSystem.setLFOIntensity(instId,value*kLFOFactors[song.settings.instruments[instId].synth.lfoTarget]),blendValue:(instId,value,dt)=>audioSystem.blendLFOIntensity(instId,value*kLFOFactors[song.settings.instruments[instId].synth.lfoTarget],dt),},{name:'Synthesizer LFO Rate',title:'LFO Rate',isPerInstrument:true,isEnum:true,defaultValue:4,enumOptions:function(){return kMarkerLFORateOrder;}(),getInitialValue:(instId)=>{let synth=song.settings.instruments[instId].synth;if(synth.lfoMode===1)
return-synth.lfoNum;return synth.lfoNum;},setValue:(instId,value)=>{let isFreq=false;if(value<=0){isFreq=true;value=-value;}
audioSystem.setLFORate(instId,value,isFreq);},blendValue:(instId,value,dt)=>{audioSystem.blendLFORateHz(instId,value,dt);}},{name:'Synthesizer Envelope',title:'Envelope',isPerInstrument:true,isBool:true,defaultValue:0,getInitialValue:(instId)=>song.settings.instruments[instId].synth.envelopeEnabled,setValue:(instId,value)=>audioSystem.setADSREnabled(instId,value!=0),},{name:'Synthesizer Attack',title:'Attack',isPerInstrument:true,isBlendable:true,isSmoothBlendable:true,isSlider:true,min:0,max:1,step:0.01,defaultValue:1,getInitialValue:(instId)=>song.settings.instruments[instId].synth.volumeEnvelope.attack,setValue:(instId,value)=>audioSystem.setAttack(instId,value),blendValue:(instId,value,dt)=>audioSystem.blendAttack(instId,value,dt)},{name:'Synthesizer Decay',title:'Decay',isPerInstrument:true,isBlendable:true,isSmoothBlendable:true,isSlider:true,min:0,max:1,step:0.01,defaultValue:1,getInitialValue:(instId)=>song.settings.instruments[instId].synth.volumeEnvelope.decay,setValue:(instId,value)=>audioSystem.setDecay(instId,value),blendValue:(instId,value,dt)=>audioSystem.blendDecay(instId,value,dt)},{name:'Synthesizer Sustain',title:'Sustain',isPerInstrument:true,isBlendable:true,isSmoothBlendable:true,isSlider:true,min:0,max:1,step:0.01,defaultValue:1,getInitialValue:(instId)=>song.settings.instruments[instId].synth.volumeEnvelope.sustain,setValue:(instId,value)=>audioSystem.setSustain(instId,value),blendValue:(instId,value,dt)=>audioSystem.blendSustain(instId,value,dt)},{name:'Synthesizer Release',title:'Release',isPerInstrument:true,isBlendable:true,isSmoothBlendable:true,isSlider:true,min:0,max:1,step:0.01,defaultValue:1,getInitialValue:(instId)=>song.settings.instruments[instId].synth.volumeEnvelope.release,setValue:(instId,value)=>audioSystem.setRelease(instId,value),blendValue:(instId,value,dt)=>audioSystem.blendRelease(instId,value,dt)},];const kSynthID=55;const kDefaultSynthSettings={type:'sine',filter:20000,filterType:0,resonance:10,lfoEnabled:false,lfoNum:4,lfoMode:0,lfoType:'sine',lfoTarget:kLFOVolume,lfoIntensity:0.2,volumeEnvelope:{enabled:false,attack:0,hold:0,decay:0,sustain:1,release:1},filterEnvelope:{enabled:false,attack:0,hold:0,decay:0,sustain:1,release:1}}
let initialized=false;let focused=false;let initialFastGraphics=false;let selectOpen=false;let isFullscreen=false;let dragView=false;let dragDraw=false;let clickedNote=false;let clickedMarker=false;let isTouchScrolling=false;let ctrlClickResizeExistingNote=false;let autoplay=false;let displayMeasureTime=false;let mouseMovedAfterClick=false;let isPlayerMode=false;let isPlaylistMode=false;let quantizeRecordedNotes=false;let keyFilterRecordedNotes=false;let enableMetronome=false;let sustainPedalActive=false;let hasBackup=false;let inMessage=false;let zoomLevelX=1;let zoomLevelY=1;let grid=1;let autoScroll=kScrollFast;let initialAutoScroll=autoScroll;let currentSongVolume=1;let mouseButton=0;let maxCells=0;let dragMinX=0;let dragMaxX=0;let dragMinY=0;let dragMaxY=0;let playTime=0;let playTimeoutId=0;let lastPlayTime=0;let scrollLeft=0;let scrollTop=0;let targetScrollLeft=0;let scrollXTimeoutId=0;let scrollYTimeoutId=0;let timelineStartMeasure=0;let markerEditorTime=0;let dragMarkersOffsetX=0;let scrollIntervalId=0;let scrollAnimationFrame=0;let onLoop=null;let variableBpmTimes=null;let messageTimeoutId=null;let updateSettingsTimeout=null;let dragNotes=[];let resizeNotes=[];let markerEditorMarkers=[];let messageQueue=[];let undo=[];let redo=[];let scale=[];let lastNoteLength=new Map();let markerSettingTrackers=[];let instrument=settings.instrumentDisplayOrder[0];let mode='draw';let initialBpm=110;let copyString='';let lastStepTime;let songClock;let bpm;let song;let mainStylesheet;let sequencer;let sidebar;let mouseX;let mouseY;let touchMoveX;let touchMoveY;let noteClickX;let noteClickY;let playhead;let wavesurferObj;let sequenceDuration;let updateCursorTimer;let gMarkersAtClickTime;let playlistPlayBtn;class SustainedNote{constructor(note,startTimeMs,isKeyHeld){this.note=note;this.startTimeMs=startTimeMs;this.keyHeld=isKeyHeld;}}
class Change{constructor(action,undoAction){this.action=action;this.undoAction=undoAction;}}
function isValidMarkerSetting(markerSetting){return kMarkerEditorSettings[markerSetting]!=null;}
function playNote(instId,name,length,delay,keyHighlight=true,volume=1){if(volume==0||length<=0)return;instMgr.ensureLoaded(instId);const trackNote=song.hasAnyMarkersForSetting(kMarkerSettingInstrumentDetune,instId);const idx=pianoToIndex[name];const noteIndex=settings.numNotes-idx-1;if(noteIndex>=instMgr.getKeyboardMin(instId)&&noteIndex<=instMgr.getKeyboardMax(instId)){if(length!=undefined){audioSystem.play(instId,noteIndex,length*song.sleepTime/1000,delay,volume,trackNote);}else{audioSystem.noteOn(instId,noteIndex,volume,trackNote);}}
if(keyHighlight){delay=delay?delay:0;const key=document.getElementById('key_highlight_'+name);if(key!=null){const f=function(){key.className='instrument'+instId;key.time=playTime;if(length!=undefined){const keyPlayTime=playTime;setTimeout(function(){if(key.time==keyPlayTime)key.className='';},length*song.sleepTime);}};if(delay==0){f();}else{window.setTimeout(f,delay*1000);}}}}
function noteOff(instId,name){const noteIndex=settings.numNotes-pianoToIndex[name]-1;audioSystem.noteOff(instId,noteIndex);document.getElementById(`key_highlight_${settings.piano[noteIndex]}`).className='';}
function isKeyGuideNote(name){if(!scale.length)return true;return scale.indexOf(name.slice(0,-1))!=-1;}
function newRecordedNote(name,volume=1,instId=instrument){let time=currentTimeIndex();if(roundTimeIndexToGrid(time)<0){return null;}else if(time<0){time=0;}
if(quantizeRecordedNotes){time=roundTimeIndexToGrid(time);}
return new Note(song,name,time,1/grid,instId,volume);}
function newRecordedMarker(setting,value){const time=Math.round(currentTimeIndex());if(time%8===0){updateMarkerEditor();}
if(roundTimeIndexToGrid(time)<0){return null;}
if(song.anyMarkersAtTimeForSetting(setting,instrument,time)){return;}
return new Marker(song,time,setting,instrument,value,true);}
function releaseSustainedNote(note,timeMs,startTimeMs){let length=Math.max(timeInMsToTimeIndex(timeMs-startTimeMs),1/(8*grid));if(quantizeRecordedNotes){length=Math.max(roundTimeIndexToGrid(length),1/grid);}
song.updateNoteLength(note,length);SequencerView.repaint(kRepaintNotesMoved);}
function setConfirmExit(val){try{window.top.confirmExit=val;}catch{}
if(val&&hasBackup){clearBackup();document.getElementById('share').style.display='none';}}
function setInitialBPM(v){initialBpm=v;song.setBPM(v);song.setInitialMarkerValue(kMarkerSettingBpm,0,initialBpm);updateVariableBpmTimes();updateWavesurferWidth(true);updateMeasures();syncLFO();setConfirmExit(true);}
Song.prototype.setBPM=function(v,isMarker=false){if(!isNumber(v)){v=110;}
v=Math.max(v,10);bpm=v;const nps=(v*4)/60;this.sleepTime=(1/nps)*1000;this.worker.postMessage(this.sleepTime);audioSystem.setTimePerNote(this.sleepTime);playhead_animate.style.animationDuration=this.sleepTime+'ms';clearScrollAnimation();};Song.prototype.play=function(start,loop=true,loopSelection=false){this.playing=true;this.looping=loop;if(loopSelection){const span=!selection.isEmpty()?selection.getTimeSpan():getMeasureTimeSpan(start);const measureWidth=4*getTimeSig();start=Math.floor(span.min/measureWidth)*measureWidth;this.loopingSelection={start:start,end:Math.ceil(span.max/measureWidth)*measureWidth,};}else{this.loopingSelection=null;}
playTime=start;songClock=audioSystem.time()*1000;this.resetMarkerSettings();refreshAllInstrumentSettings();audioSystem.startAllLFO();if(audioSystem.offline){this.playColumn(start,true,false);}else{song.worker.postMessage('start');}
buttonIcon.className='fas fa-stop';viewModeButtonIcon.className='fas fa-pause';if(isPlaylistMode){startDurationBarTimer(start);playlistPlayBtn.className='fas fa-pause';}
document.getElementById('playbutton').style.display='none';this.playPos=start;setPlayheadPosition(start);playhead.style.display='block';lastStepTime=currentTimeMs();lastPlayTime=start;hideAd();document.onkeydown=null;};Song.prototype.resetMarkerSettings=function(){audioSystem.clearAllScheduledValueChanges();markerSettingTrackers=[];for(const m of this.markerIterator){const instId=m.instrument;const setting=m.setting;const initVal=kMarkerEditorSettings[setting].getInitialValue(instId);this.setInitialMarkerValue(setting,instId,initVal);kMarkerEditorSettings[setting].setValue(instId,initVal,initVal,0);}};Song.prototype.doFullReset=function(instId){audioSystem.clearAllScheduledValueChanges();for(const m of this.markerIterator){const mInstId=m.instrument;if(mInstId!=instId)continue;const setting=m.setting;if(!kMarkerEditorSettings[setting].isPerInstrument)continue;const initVal=kMarkerEditorSettings[setting].getInitialValue(mInstId);const tracker=markerSettingTrackers[setting].get(mInstId);if(!tracker.prev)continue;const lastReset=markerSettingTrackers[kMarkerSettingFullReset].get(mInstId);if(tracker.prev.time<lastReset.prev.time){this.setInitialMarkerValue(setting,mInstId,initVal);kMarkerEditorSettings[setting].setValue(mInstId,initVal,initVal,0);}}};Song.prototype.stop=function(){audioSystem.stopRecording();audioSystem.stopAllLFO();this.playing=false;this.recording=false;this.resetMarkerSettings();if(isMobile){window.clearTimeout(playTimeoutId);}else{this.worker.postMessage('stop');}
clearScrollAnimation();buttonIcon.className='fas fa-play';viewModeButtonIcon.className='fas fa-play';if(isPlaylistMode){stopDurationBarTimer();playlistPlayBtn.className='fas fa-play';}
playhead.style.display='none';recordButton.classList.remove('selected');audioSystem.stopAudioTrack();showAd();};Song.prototype.record=function(){this.recording=true;if(this.playing){this.looping=false;}else{this.play(enableMetronome?-4*getTimeSig():0,false);}};function clearAdTimeouts(){if(hideAdTimeout!=null){clearTimeout(hideAdTimeout);hideAdTimeout=null;}}
var hideAdTimeout=null;function hideAd(){clearAdTimeouts();if(document.getElementById('ad')!=null)
document.getElementById('ad').style.opacity='0';if(document.getElementById('footer_ad')!=null)
document.getElementById('footer_ad').style.opacity='0';hideAdTimeout=setTimeout(function(){if(document.getElementById('ad')!=null)
document.getElementById('ad').style.display='none';if(document.getElementById('footer_ad')!=null)
document.getElementById('footer_ad').style.display='none';},1000);}
function showAd(){clearAdTimeouts();if(document.getElementById('ad')!=null)
document.getElementById('ad').style.display='block';if(document.getElementById('footer_ad')!=null)
document.getElementById('footer_ad').style.display='block';setTimeout(function(){if(document.getElementById('ad')!=null)
document.getElementById('ad').style.opacity='1';if(document.getElementById('footer_ad')!=null)
document.getElementById('footer_ad').style.opacity='1';});}
function clearScrollAnimation(){if(scrollIntervalId!=0){window.clearInterval(scrollIntervalId);scrollIntervalId=0;}
if(scrollAnimationFrame!=0){cancelAnimationFrame(scrollAnimationFrame);scrollAnimationFrame=0;}}
function isScrolledToEnd(){return container.scrollWidth-container.clientWidth-scrollLeft<=0;}
function setScrollDelta(x){setScrollLeft(scrollLeft+x);}
function setScrollLeft(x,forceScroll=false,constantSmoothScroll=false){clearScrollAnimation();x=Math.min(Math.max(x,0),container.scrollWidth-container.clientWidth);if(autoScroll==kScrollFast||forceScroll){scrollLeft=container.scrollLeft=x;SequencerView.repaint();}else if(autoScroll==kScrollSmooth||autoScroll==kScrollFollow){if(autoScroll==kScrollFollow&&constantSmoothScroll&&!isScrolledToEnd()){targetScrollLeft=x;let start=scrollLeft;let startTime=performance.now();let followScrollStepFunction=function(){let elapsed=performance.now()-startTime;let frac=elapsed/song.sleepTime;scrollLeft=container.scrollLeft=start+noteWidth*frac;SequencerView.repaint();scrollAnimationFrame=requestAnimationFrame(followScrollStepFunction);};scrollAnimationFrame=requestAnimationFrame(followScrollStepFunction);return;}
targetScrollLeft=x;scrollIntervalId=window.setInterval(function(){const d=targetScrollLeft-scrollLeft;if(Math.abs(d)<1){scrollLeft=container.scrollLeft=targetScrollLeft;clearScrollAnimation();}else{scrollLeft+=SequencerView.isGL()?(d/8):(d/2);container.scrollLeft=scrollLeft;}
SequencerView.repaint();},SequencerView.isGL()?16:66);}}
function setPlayheadPosition(idx){let x=idx*noteWidth-scrollLeft;if(autoScroll==kScrollFollow&&!isScrolledToEnd()){x=Math.min(x+noteWidth,0);}
playhead.style.transform='translateX('+x+'px)';}
Song.prototype.playColumn=function(idx,first,single){if(idx*noteWidth>scrollLeft+7*clientWidth/8&&autoScroll!=kScrollFollow){setScrollDelta(3*clientWidth/4);}
if(song.looping&&(idx==maxCells||idx>=song.loopTime||(song.loopingSelection!=null&&idx>=song.loopingSelection.end))){if(audioSystem.offline){message('Recording finished, please wait while we encode the file...',5,true);return;}else if(onLoop==null){if(scrollLeft==0)setScrollLeft(0);idx=(song.loopingSelection==null)?0:song.loopingSelection.start;if(idx*noteWidth<scrollLeft){setScrollLeft(idx*noteWidth,false);}
audioSystem.playAudioTrack(song.sleepTime*idx/1000);this.resetMarkerSettings();if(isPlaylistMode)startDurationBarTimer(idx);}else{onLoop();song.stop();}}
setPlayheadPosition(idx);playhead_animate.style.animationName='none';playhead_animate.offsetHeight;playhead_animate.style.animationName=(autoScroll==kScrollFollow&&idx*noteWidth>scrollLeft-noteWidth&&!isScrolledToEnd())?'none':'translate';if(autoScroll==kScrollFollow&&!isScrolledToEnd()){playhead_animate.style.display='none';}else{playhead_animate.style.display='block';}
for(const m of this.markerIterator){updateMarkerSetting(m.setting,m.instrument,idx);}
if((first||idx%(4*getTimeSig())==0)&&idx>=0){audioSystem.playAudioTrack(song.sleepTime*idx/1000);}
if(this.noteColumns[idx]!=undefined){this.playNotes(this.noteColumns[idx]);}
if(enableMetronome&&idx%4==0){audioSystem.playMetronome(idx%(4*getTimeSig())===0);}
for(const m of this.markerIterator){if(kMarkerEditorSettings[m.setting].isSmoothBlendable){blendMarkerSetting(m.setting,m.instrument,this.sleepTime/1000);}}
const nextClock=songClock+song.sleepTime;const now=audioSystem.time()*1000;const sleep=clamp(nextClock-now,0.5*song.sleepTime,1.5*song.sleepTime);if(audioSystem.offline){audioSystem.setTimeout(()=>{playTime=song.playColumn(idx+1,false,false);},sleep);}else if(!single){playTimeoutId=window.setTimeout(function(){if(song.playing){playTime=song.playColumn(idx+1,false,false);}},sleep);}
lastStepTime=currentTimeMs();songClock=nextClock;return idx+1;};Song.prototype.playNotes=function(list){for(const i in list){const note=list[i];playNote(note.instrument,note.type,note.length,song.sleepTime*note.fracTime/1000,!audioSystem.offline,note.volume);}};Song.prototype.playNextColumn=function(isWorker){if(!song.playing)return;playTime=song.playColumn(playTime,false,true);let previousTime=playTime-1;if(autoScroll==kScrollFollow&&previousTime*noteWidth>scrollLeft){let d=previousTime*noteWidth-scrollLeft;if(d<=noteWidth){setScrollLeft(previousTime*noteWidth,true);setScrollLeft(previousTime*noteWidth+noteWidth,false,true);}else{setScrollLeft(previousTime*noteWidth+noteWidth);}}};function activateLoading(){loading=true;}
function onLoadSoundComplete(){loading=false;if(autoplay&&!song.playing){if(window.location.hash!=null&&window.location.hash.startsWith('#t')){song.play(parseInt(window.location.hash.substring(2)));}else{song.play(playTime);}
autoplay=false;}}
function loadReverb(reverbType){audioSystem.getConvolver(reverbType,false);}
function updateBarOverlayLocations(){markerBar.style.top=container.scrollTop+'px';let wavesurferTop=container.scrollTop;if($(markerBar).is(':visible'))wavesurferTop+=markerBar.clientHeight;markerRect.style.top=markerBar.style.top;wavesurfer.style.top=wavesurferTop+'px';}
function updateSynthLFOView(instId){let lfoSVG=document.getElementById('instrument_options_synth_lfopath');let synth=song.settings.instruments[instId].synth;if(synth.lfoMode===0){const numLines=synth.lfoNum;const lineSpacing=64/numLines;const lineContainer=document.getElementById('synth_lfo_graph_lines');$(lineContainer).empty();for(let i=0;i<numLines;i++){const line=document.createElementNS('http://www.w3.org/2000/svg','line');line.setAttribute('x1',lineSpacing*i);line.setAttribute('y1',0);line.setAttribute('x2',lineSpacing*i);line.setAttribute('y2',64);line.setAttribute('stroke','#555');line.setAttribute('stroke-width','.35');lineContainer.appendChild(line);}}
let freq=synth.lfoNum;const period=1/freq;const numPoints=100;const dt=period/numPoints;const points=[];const intensity=synth.lfoIntensity/kLFOFactors[synth.lfoTarget]/100;const waveformType=synth.lfoType;for(let i=0;i<numPoints;i++){const t=i*freq*dt;let y=0;if(waveformType==='sine'){y=Math.sin(2*Math.PI*freq*t)*intensity*32+32;}else if(waveformType==='square'){y=Math.sign(Math.sin(2*Math.PI*freq*t))*intensity*32+32;}else if(waveformType==='triangle'){const phase=(t/period)-Math.floor(t/period+0.5);let amplitude=16*intensity;y=64-
(((phase<0)?(-amplitude+2*amplitude*(phase+1)):(amplitude-2*amplitude*phase))*4+
(1-intensity)*32);}else if(waveformType==='sawtooth'){const phase=(t/period)-Math.floor(t/period+0.5);let amplitude=16*intensity;y=64-
(((phase<0.5)?(-amplitude+4*amplitude*phase):(3*amplitude-4*amplitude*phase))+
amplitude+32);}
points.push(`${t * 64},${y}`);}
lfoSVG.setAttribute('d',`M${points.join(' L')}`);}
function updateSynthADSRView(instId){let adsrSVG=document.getElementById('instrument_options_synth_adsrpath');let pointsSVG=document.getElementById('synth_adsr_graph_points');let linesSVG=document.getElementById('synth_adsr_graph_lines');$(pointsSVG).empty();$(linesSVG).empty();let range=1;let d='';let gx=0;function moveTo(x,y){d+=`M${x} ${y} `;}
function lineTo(x,y){gx+=x;d+=`L${gx} ${y} `;}
let synth=song.settings.instruments[instId].synth;let attack=synth.volumeEnvelope.attack;let decay=synth.volumeEnvelope.decay;let sustain=synth.volumeEnvelope.sustain;let release=synth.volumeEnvelope.release;let interval=162/4;let markedPoints=[]
moveTo(0,72);lineTo(interval*(attack/range),0);markedPoints.push([gx,0]);let x=interval*(decay/range);let y=72-72*(sustain/range);lineTo(x,y);markedPoints.push([gx,y]);lineTo(interval*(release/range),72);markedPoints.push([gx,72]);d+='Z';for(let point of markedPoints){const circle=document.createElementNS('http://www.w3.org/2000/svg','circle');const line=document.createElementNS('http://www.w3.org/2000/svg','line');circle.setAttribute('cx',point[0]);circle.setAttribute('cy',point[1]);circle.setAttribute('r',3);circle.setAttribute('fill','#ffffff');line.setAttribute('x1',point[0]);line.setAttribute('y1',0);line.setAttribute('x2',point[0]);line.setAttribute('y2',72);line.setAttribute('stroke','#777');line.setAttribute('stroke-width','.35');pointsSVG.appendChild(circle);linesSVG.appendChild(line);}
adsrSVG.setAttribute('d',d);}
function createSynth(instId){if(!isSynthPresent(instId)){audioSystem.loadInstrument(instId);song.settings.instruments[instId]=song.settings.instruments[instId]??getDefaultInstrumentSettings();song.settings.instruments[instId].synth=kDefaultSynthSettings;}}
function createSequencerView(){let useWebGL=!isMobile&&settings.user.disable_webgl!=='true';if(useWebGL){const glView=new SequencerViewWebGL();if(glView.isOk()){console.log('Using WebGL renderer.');return glView;}else{console.log('WebGL isn\'t working. Falling back to canvas renderer.');}}
return new SequencerViewCanvas();}
function create(){mainStylesheet=document.getElementById('css_vars').sheet;scrollLeft=0;scrollTop=0;container=document.getElementById('sequencer_main');containerRect=container.getBoundingClientRect();clientWidth=container.clientWidth;timeline=document.getElementById('sequencer_timeline_measures');timelineMarkers=document.getElementById('sequencer_timeline_markers');sequencer=document.getElementById('sequencer_inner');sequencerRect=sequencer.getBoundingClientRect();wavesurfer=document.getElementById('wavesurfer_element');keyboard=document.getElementById('keyboard_element');keyboard_wrapper=document.getElementById('keyboard_wrapper_element');keySelect=document.getElementById('key_select');gridSelect=document.getElementById('grid_select');timeSigSelect=document.getElementById('time_sig_select');scrollSelect=document.getElementById('scroll_select');audioTrackLink=document.getElementById('audio_track_link');audioTrackLoading=document.getElementById('audio_track_loading');audioTrackSelect=document.getElementById('audio_track');audioTrackFile=document.getElementById('audio_track_file');audioTrackRemove=document.getElementById('audio_track_remove');selectionRect=document.getElementById('selection_rect');copyButton=document.getElementById('btn_copy');markerEditor=document.getElementById('marker_editor');markerTypeInput=document.getElementById('marker_type');markerBar=document.getElementById('marker_bar');markerRect=document.getElementById('marker_selection_rect');reverbButton=document.getElementById('instrument_options_advanced_reverb');reverbSelect=document.getElementById('instrument_options_advanced_reverb_select');reverbVolumeSlider=document.getElementById('instrument_options_advanced_reverb_volume');reverbVolumeSliderWrap=document.getElementById('instrument_options_advanced_reverb_volume_wrap');distortButton=document.getElementById('instrument_options_advanced_distort');distortSelect=document.getElementById('instrument_options_advanced_distort_select');distortVolumeSlider=document.getElementById('instrument_options_advanced_distort_volume');distortVolumeSliderWrap=document.getElementById('instrument_options_advanced_distort_volume_wrap');document.getElementById('instrument_options_advanced_title').addEventListener('click',advancedSettingsTitleEditOpen);let titleEdit=document.getElementById('instrument_options_advanced_title_edit');titleEdit.addEventListener('keypress',e=>{if(e.keyCode==13)advancedSettingsTitleEditDone();});titleEdit.addEventListener('blur',e=>{advancedSettingsTitleEditDone();});let synthTypeSelect=document.getElementById('instrument_options_synth_type');SequencerView=createSequencerView();document.getElementById('sequencer_view').appendChild(SequencerView.canvas);window.onresize=function(){containerRect=container.getBoundingClientRect();sequencerRect=sequencer.getBoundingClientRect();clientWidth=container.clientWidth;if(initialized)zoomUpdate();SequencerView.setSize(containerRect.width-kScrollbarWidth,containerRect.height-kScrollbarWidth);};window.onresize();playhead=document.createElement('div');playhead.className='playhead';playhead_animate=document.createElement('div');playhead_animate.className='playhead_animate';playhead_top=document.createElement('div');playhead_top.className='playhead_top';playhead_animate.appendChild(playhead_top);playhead.appendChild(playhead_animate);document.getElementById('playhead_wrapper').appendChild(playhead);setNoteSize();displayKeys();sidebar=new Sidebar('sequencer_sidebar','sidebar_tab_list','sidebar_content');audioSystem.init();if(audioSystem.unsupportedBrowser){message('Audio is not supported in your browser.');}
if(typeof song!='undefined')
createSynth(kSynthID);const instrumentOptionsTabSimple=document.getElementById('instrument_options_tab_simple');const instrumentOptionsTabAdvanced=document.getElementById('instrument_options_tab_advanced');const instrumentOptionsTabSynth=document.getElementById('instrument_options_tab_synth');const instrumentOptionsSimple=document.getElementById('instrument_options_simple');const instrumentOptionsAdvanced=document.getElementById('instrument_options_advanced');const instrumentOptionsSynth=document.getElementById('instrument_options_synth');$(instrumentOptionsTabSimple).on('vmouseup',function(){instrumentOptionsTabSimple.classList.add('selected');instrumentOptionsSimple.style.display='block';instrumentOptionsTabAdvanced.classList.remove('selected');instrumentOptionsAdvanced.style.display='none';instrumentOptionsTabSynth.classList.remove('selected');instrumentOptionsSynth.style.display='none';fillSimpleInstrumentSettings();});$(instrumentOptionsTabAdvanced).on('vmouseup',function(){instrumentOptionsTabAdvanced.classList.add('selected');instrumentOptionsAdvanced.style.display='block';instrumentOptionsTabSimple.classList.remove('selected');instrumentOptionsSimple.style.display='none';instrumentOptionsTabSynth.classList.remove('selected');instrumentOptionsSynth.style.display='none';fillAdvancedInstrumentSettings();});$(instrumentOptionsTabSynth).on('vmouseup',function(){instrumentOptionsTabSynth.classList.add('selected');instrumentOptionsSynth.style.display='block';instrumentOptionsTabSimple.classList.remove('selected');instrumentOptionsSimple.style.display='none';instrumentOptionsTabAdvanced.classList.remove('selected');instrumentOptionsAdvanced.style.display='none';fillSynthInstrumentSettings();});setSynthTabVisibility();$.widget('custom.instrumentmenu',$.ui.selectmenu,{_renderItem:function(ul,item){const li=$('<li>',{class:'instrument-menu-item'});const wrapper=$('<div>',{'class':'instrument-menu-item-wrapper'});wrapper.attr('data-instrument',item.value);$('<div>',{'class':'instrument-menu-item-text','text':item.label}).appendTo(wrapper);let instId=parseInt(item.value);let char=instrumentShortcutChars.has(instId)?instrumentShortcutChars.get(instId):'';let chip=$('<div>',{'class':'instrument-menu-chip instrument'+instId,text:char,title:'Use number keys to switch instruments,Shift+[number] to change shortcuts'});chip.tooltipster({arrow:true,onlyOne:true,position:'right',delay:100,speed:100})
chip.appendTo(wrapper);return li.append(wrapper).appendTo(ul);}});updateUiForInstrumentClones();instrumentShortcuts=new Map();if(settings.user.shortcuts!=null&&settings.user.shortcuts!=''){let shortcutsSetting=JSON.parse(settings.user.shortcuts);for(let code of Object.keys(shortcutsSetting)){instrumentShortcuts.set(parseInt(code),parseInt(shortcutsSetting[code]));}}else{for(let i=49;i<=57;i++){instrumentShortcuts.set(i,instMgr.getDisplayBaseInst(i-49));}
instrumentShortcuts.set(48,instMgr.getDisplayBaseInst(9));instrumentShortcuts.set(189,instMgr.getDisplayBaseInst(10));instrumentShortcuts.set(187,instMgr.getDisplayBaseInst(11));}
instrument=instrumentShortcuts.get(49);const instrumentSelect=document.getElementById('instrument_select');instrumentSelect.value=instrument;$(instrumentSelect).change();refreshSelectMenu('#instrument_select');updateKeys();instrumentShortcutChars=new Map();for(let code of instrumentShortcuts.keys()){instrumentShortcutChars.set(instrumentShortcuts.get(code),getShortcutChar(code));}
instrument=instrumentShortcuts?.get(49)??43;const setSelectOpen=()=>selectOpen=true;$('#mobile_warning_close').on('vmousedown',function(){$('#mobile_warning').remove();});$('.btn_edit').on('vmousedown',function(){enterEditMode();});$('.btn_graphics').on('vmousedown',function(){let graphicsBtn=document.getElementsByClassName('btn_graphics')[0];if(!initialFastGraphics){SequencerView.fastGraphics=true;initialFastGraphics=true;$(graphicsBtn).children().eq(0).removeClass('fa-tachometer-fast');$(graphicsBtn).children().eq(0).addClass('fa-tachometer-slow');}else{SequencerView.fastGraphics=false;initialFastGraphics=false;$(graphicsBtn).children().eq(0).removeClass('fa-tachometer-slow');$(graphicsBtn).children().eq(0).addClass('fa-tachometer-fast');}
SequencerView.repaint();graphicsBtn.classList.toggle('active');});$('#btn_close').on('vmousedown',function(){$('#share').hide();});$('#mode_draw').on('vmousedown',function(){setMode('draw');});$('#mode_edit').on('vmousedown',function(){setMode('edit');});$('#mode_erase').on('vmousedown',function(){setMode('erase');});$('#btn_select_this').on('vmousedown',function(event){if(getButton(event)==primaryButton){selectNotes();}});$('#btn_instrument_options').on('vmousedown',function(){showHideInstrumentOptions();});$('#btn_copy').on('vmousedown',function(){copy(true);});$('#btn_cut').on('vmousedown',function(){cut();});$('#btn_paste').on('vmousedown',function(){paste();});$('#btn_selectall').on('vmousedown',function(){selectAll();});$('.btn_zoomin').on('vmousedown',function(){zoomIn();});$('.btn_zoomout').on('vmousedown',function(){zoomOut();});$('#btn_help').on('vmousedown',function(){showHelp();});$('#btn_full_screen').on('vmousedown',function(){if(!isFullscreen){isFullscreen=true;$('#btn_full_screen').html('<i class="fas fa-compress-wide" title="Full screen">');$('#header').hide();$('#bottom').hide();$('#footer_ad_wrapper').hide();$('#main').css('top','0');onresize();}else{isFullscreen=false;$('#btn_full_screen').html('<i class="fas fa-expand-wide" title="Full screen">');$('#header').show();$('#bottom').show();$('#footer_ad_wrapper').show();$('#main').css('top','122px');onresize();}});$('#savelink').on('vmousedown',function(){save(true);});$('#volume_slider').change(function(){if(!isPlayerMode){setInitialSongVolume(parseFloat($('#volume_slider').val()));}
updateVolume();});for(let i=0;i<settings.scales.length;i++){let option=document.createElement('option');option.innerHTML=settings.scaleNames[i];keySelect.appendChild(option);}
$(keySelect).on('selectmenuselect',function(event,ui){scale=settings.scales[keySelect.selectedIndex];updateKeys();selectOpen=false;updateGridImage();SequencerView.repaint();});$(keySelect).selectmenu({'position':{my:'left top',at:'left bottom',collision:'flip'}});$(keySelect).on('vmousedown',setSelectOpen);$(gridSelect).on('selectmenuselect',function(event,ui){setGrid(parseFloat(gridSelect.value));});$(gridSelect).selectmenu({'position':{my:'left top',at:'left bottom',collision:'flip'}});$(gridSelect).on('vmousedown',setSelectOpen);$(timeSigSelect).on('selectmenuselect',function(event,ui){setTimeSig(parseInt(timeSigSelect.value));});$(timeSigSelect).selectmenu({'position':{my:'left top',at:'left bottom',collision:'flip'}});$(timeSigSelect).on('vmousedown',setSelectOpen);$(scrollSelect).on('selectmenuselect',function(event,ui){SequencerView.autoScroll=autoScroll=initialAutoScroll=scrollSelect.value;song.setInitialMarkerValue(kMarkerSettingAutoscroll,0,scrollSelect.value);clearScrollAnimation();SequencerView.repaint();});$(scrollSelect).selectmenu({'position':{my:'left top',at:'left bottom',collision:'flip'}});$(scrollSelect).on('vmousedown',setSelectOpen);for(const i of kReverbDisplayOrder){let option=document.createElement('option');option.innerText=kReverbData[i].name;option.value=i;reverbSelect.appendChild(option);}
$(reverbSelect).on('selectmenuselect',function(event,ui){selectReverbType(instrument,parseInt(reverbSelect.value));});$(reverbSelect).selectmenu({'position':{my:'right top',at:'right bottom',collision:'flip'}});$(reverbSelect).on('vmousedown',setSelectOpen);reverbSelectButton=document.getElementById('instrument_options_advanced_reverb_select-button');for(let i=0;i<kDistortDisplayOrder.length;++i){const j=kDistortDisplayOrder[i];let option=document.createElement('option');option.innerText=kDistortData[j].name;option.value=j;distortSelect.appendChild(option);}
$(distortSelect).on('selectmenuselect',function(event,ui){selectDistortType(instrument,parseInt(distortSelect.value));});$(distortSelect).selectmenu({'position':{my:'right top',at:'right bottom',collision:'flip'}});$(distortSelect).on('vmousedown',setSelectOpen);distortSelectButton=document.getElementById('instrument_options_advanced_distort_select-button');let lfoSelect=$('#instrument_options_synth_lfo_select');lfoSelect.on('selectmenuselect',function(event,ui){setLFORate(instrument,event.target.value);});lfoSelect.selectmenu({'position':{my:'right top',at:'right bottom',collision:'flip'}});lfoSelect.on('vmousedown',setSelectOpen);$(synthTypeSelect).on('selectmenuselect',function(event,ui){let val=event.target.value;setSynthType(instrument,val,false);updateSynthWaveformView(instrument);});$(synthTypeSelect).selectmenu({'position':{my:'right top',at:'right bottom',collision:'flip'}});$(synthTypeSelect).on('vmousedown',setSelectOpen);let filterTypeSelect=document.getElementById('instrument_options_synth_filter_type');$(filterTypeSelect).on('selectmenuselect',function(event,ui){setSynthFilterType(instrument,event.target.value,false);});$(filterTypeSelect).selectmenu({'position':{my:'right top',at:'right bottom',collision:'flip'}});$(filterTypeSelect).on('vmousedown',setSelectOpen);let lfoTargetSelect=document.getElementById('instrument_options_lfo_target');$(lfoTargetSelect).on('selectmenuselect',function(event,ui){setLFOTarget(instrument,event.target.value|0,false);});$(lfoTargetSelect).selectmenu({'position':{my:'right top',at:'right bottom',collision:'flip'}});$(lfoTargetSelect).on('vmousedown',setSelectOpen);audioTrackFile.addEventListener('change',function(e){const reader=new FileReader();reader.onload=function(e){audioTrackSelect.style.display='none';audioTrackLoading.style.display='block';if(wavesurferObj==null){wavesurferObj=Object.create(WaveSurfer);wavesurferObj.init({audioContext:audioSystem.audioContext,height:32,pixelRatio:1,interact:false,container:wavesurfer,waveColor:'orange',progressColor:'orange',normalize:true});}
audioSystem.loadAudioTrack(e.target.result,function(buffer){window.setTimeout(function(){$('#wavesurfer_element').show();updateBarOverlayLocations();wavesurferObj.loadDecodedBuffer(buffer);updateWavesurferWidth(true);},0);audioTrackLoading.style.display='none';audioTrackLink.style.display='block';});};reader.readAsArrayBuffer(e.target.files[0]);},false);container.onscroll=function(){keyboard.style.top=(-container.scrollTop)+'px';updateBarOverlayLocations();scrollMeasures();setPlayheadPosition(playTime-1);const dx=container.scrollLeft-scrollLeft;const dy=container.scrollTop-scrollTop;scrollLeft=container.scrollLeft;scrollTop=container.scrollTop;sequencerRect=sequencer.getBoundingClientRect();onscroll(dx,dy);};document.getElementById('sequencer_inner').style.width=length*100;document.getElementById('sequencer').addEventListener('dragover',handleDragOver,false);document.getElementById('sequencer').addEventListener('drop',loadOffline,false);$(document).on('vmouseup',onmouseup);$(sequencer).on('vmousedown',mouseDownSequencer);$(document).on('vmousemove',onmousemove);$(sequencer).on('touchstart',ontouchstart);$(sequencer).on('touchend',ontouchend);$(sequencer).on('touchmove',ontouchmove);$('#sequencer_timeline').on('vmousedown',function(event){if(getButton(event)==primaryButton){mouseDownPlay(event,true);}else{openMarkerEditor(event.clientX);}});$('#timeline_option_measures').on('vmousedown',function(){displayMeasureTime=false;updateMeasures();$('#timeline_option_measures').attr('class','timeline_option_active');$('#timeline_option_time').attr('class','timeline_option');});$('#timeline_option_time').on('vmousedown',function(){displayMeasureTime=true;updateMeasures();$('#timeline_option_measures').attr('class','timeline_option');$('#timeline_option_time').attr('class','timeline_option_active');});if(window.location.hash!=null&&window.location.hash.startsWith('#t')){const startTime=window.location.hash.substring(2);setTimeout(function(){setScrollLeft(startTime*noteWidth-container.clientWidth/2,true);});}
container.onwheel=onwheel;container.onkeypress=onkeypress;container.onkeydown=onkeydown;container.onkeyup=onkeyup;$(container).on('vmouseover',function(){if(!selectOpen){container.focus();focused=true;}
document.oncontextmenu=()=>false;});$(container).on('vmouseout',function(){document.oncontextmenu=()=>true;focused=false;});$(document).on('paste','body',function(e){if(focused&&!isPlayerMode){const text=(e.originalEvent||e).clipboardData.getData('text/plain');if(!pasteText(text)){paste();}}});button=document.getElementById('play_small');buttonIcon=document.getElementById('play_small_icon');$(button).on('vmousedown',function(event){if(song.playing){song.stop();}else{song.play(0,!(event.ctrlKey||event.metaKey),event.altKey);}});viewModeButton=document.getElementById('view_mode_play');viewModeButtonIcon=document.getElementById('view_mode_play_icon');$(viewModeButton).on('vmousedown',function(event){if(song.playing){song.stop();}else{song.play(playTime,!(event.ctrlKey||event.metaKey));}});const setupBottomLeftButton=(buttonId,onClick)=>{const button=document.getElementById(buttonId);const tooltip=document.getElementById(buttonId+'_tooltip')
$(button).on('vmouseover',()=>tooltip.style.display='block');$(button).on('vmouseout',()=>tooltip.style.display='none');$(button).on('vmousedown',function(){button.classList.toggle('selected');onClick();});return button;};recordButton=setupBottomLeftButton('record_button',()=>{if(song.recording){song.stop();}else{song.record();}});quantizeButton=setupBottomLeftButton('quantize_button',()=>{quantizeRecordedNotes=!quantizeRecordedNotes;});keyFilterButton=setupBottomLeftButton('key_filter_button',()=>{keyFilterRecordedNotes=!keyFilterRecordedNotes;});metronomeButton=setupBottomLeftButton('metronome_button',()=>{enableMetronome=!enableMetronome;if(enableMetronome&&!audioSystem.metronome)audioSystem.loadMetronome();});for(const setting of kMarkerEditorSettingsOrder){const type=document.createElement('option');type.value=setting;type.innerHTML=kMarkerEditorSettings[setting].name;markerTypeInput.appendChild(type);}
$(markerTypeInput).selectmenu();$(markerTypeInput).on('selectmenuselect',()=>onMarkerEditorTypeChange());setMode(isMobile?'play':'draw');updateKeys();primaryButton=isMobile?0:1;new Clipboard('#btn_copy');dragScroll(document.getElementById('toolbar_container'));createMenus();if(navigator.requestMIDIAccess!=null){navigator.requestMIDIAccess().then(function(access){access.onstatechange=function(){access.inputs.forEach(connectMidiInput);};access.onstatechange();});}
$('.slider').each(function(){this.setAttribute('title',parseFloat(this.value).toFixed(2));}).on('change',function(){this.setAttribute('title',parseFloat(this.value).toFixed(2));});initialized=true;}
function updateInstrumentSelect(){const instrumentSelect=createInstrumentMenu(document.getElementById('instrument_select_wrapper'),'instrument_select');$(instrumentSelect).on('instrumentmenuselect',function(event,ui){onInstrumentSelect(instrumentSelect.value);});$(instrumentSelect).on('instrumentmenufocus',function(event,ui){container.focus();focused=true;});$(instrumentSelect).on('vmousedown',()=>selectOpen=true);}
function updateMarkerInstrumentSelect(){const markerInstrumentSelect=createInstrumentMenu(document.getElementById('marker_instrument_wrapper'),'marker_instrument');}
function updateUiForInstrumentClones(){updateSimpleInstrumentSettings();updateInstrumentSelect();updateMarkerInstrumentSelect();}
function updateSimpleInstrumentSettings(){const instrumentOptionsSimple=document.getElementById('instrument_options_simple');let html='';instMgr.forEachByCategory((category,instId)=>{createCSSRulesForInstrument(instId);const name=getInstrumentName(song,instId);html+=`
<div class="instrument_option">
  <div>
    <div id="instrument_lock_${instId}" class="instrument_lock btn"
        onclick="lockInstrumentButton(${instId}, event)"
        title="Lock this instrument">
      <i class="fas fa-lock-alt"></i>
    </div>
    <span id="instrument_name_${instId}" onclick="selectInstrument(${instId})">
      ${name}
    </span>
    <div class="chip instrument${instId}"></div>
  </div>
  <div class="row">
    <div class="slider_line">
      <input id="instrument_volume_${instId}" class="slider" type="range"
          min="0" max="2" step="0.01"
          oninput="setInitialInstrumentVolume(${instId}, this.value)">
    </div>
    <div id="instrument_delay_${instId}" class="button" title="Delay"
        onclick="selectDelay(${instId})">
      D
    </div>
    <div id="instrument_reverb_${instId}" class="button" title="Reverb"
        onclick="selectReverb(${instId})">
      R
    </div>
  </div>
</div>`;});instrumentOptionsSimple.innerHTML=html;}
function removeAllChildren(n){while(n.hasChildNodes())n.removeChild(n.lastChild);}
function createInstrumentMenu(parent,htmlId){removeAllChildren(parent);const selectElement=document.createElement('select');selectElement.id=htmlId;parent.appendChild(selectElement);let prevCategory=null;let group=null;instMgr.forEachByCategory((category,instId)=>{if(prevCategory!=category){prevCategory=category;group=document.createElement('optgroup');group.label=settings.instrumentCategoryIcons[category]+category;selectElement.appendChild(group);}
const name=getInstrumentName(song,instId);const option=document.createElement('option');option.value=instId;option.innerHTML=name;group.appendChild(option);});$(selectElement).instrumentmenu();return selectElement;}
_instIdToRuleIndex=new Map();function createCSSRulesForInstrument(instId){if(_instIdToRuleIndex.has(instId))return;const instRule=`
.instrument${instId} {
  background-color: ${toHtmlColor(getInstrumentColor(song, instId))};
  color: ${instMgr.isDarkColor(instId) ? '#eee' : '#000'};
  cursor: pointer;
  z-index: 96;
}
`;const idx=mainStylesheet.insertRule(instRule,mainStylesheet.cssRules.length);_instIdToRuleIndex.set(instId,idx);}
function updateInstrumentColor(instId){createCSSRulesForInstrument(instId);const rule=mainStylesheet.cssRules[_instIdToRuleIndex.get(instId)];rule.style.backgroundColor=toHtmlColor(getInstrumentColor(song,instId));}
function linearTodB(volume){return 20*(Math.log10(volume));}
function dBToLinear(volume){return Math.pow(10,volume/20);}
function checkSequenceVolume(){const loudThreshold=15;const eqVolumeWeights={high:0.3,mid:0.5,low:0.2};const volumePerColumn=[];const valueArrayMap=new Map();for(const mi of song.markerIterator){let tracker=null;for(let j=0;j<song.loopTime;j++){let valueArray=valueArrayMap.get(mi.instrument+'_'+mi.setting);tracker=song.trackMarkerSetting(mi.setting,mi.instrument,j,tracker);if(!Array.isArray(valueArray))valueArray=[];valueArray.push(tracker.value);valueArrayMap.set(mi.instrument+'_'+mi.setting,valueArray);}}
for(let i=0;i<song.noteColumns.length;i++){if(song.noteColumns[i]==null){if(volumePerColumn[i]!=null)continue;volumePerColumn[i]=0;continue;}
let column=song.noteColumns[i];for(let noteIndexKey in column){let note=column[parseInt(noteIndexKey)];for(let k=0;k<note.length;k++){let totalNoteVolume=note.volume*instMgr.getVolumeWeight(note.instrument,note.type);const inst=song.settings.instruments[note.instrument]||getDefaultInstrumentSettings();const instrumentVolume=valueArrayMap.get(note.instrument+'_'+kMarkerSettingInstrumentVolume)||[];const markerEqHi=valueArrayMap.get(note.instrument+'_'+kMarkerSettingInstrumentEqHigh)||[];const markerEqMid=valueArrayMap.get(note.instrument+'_'+kMarkerSettingInstrumentEqMid)||[];const markerEqLow=valueArrayMap.get(note.instrument+'_'+kMarkerSettingInstrumentEqLow)||[];if(inst.eq.enabled){totalNoteVolume*=eqVolumeWeights.high*dBToLinear(markerEqHi[i+k]||inst.eq.high);totalNoteVolume*=eqVolumeWeights.mid*dBToLinear(markerEqMid[i+k]||inst.eq.mid);totalNoteVolume*=eqVolumeWeights.low*dBToLinear(markerEqLow[i+k]||inst.eq.low);}
totalNoteVolume*=instrumentVolume[i+k]||inst.volume;volumePerColumn[i+k]=(volumePerColumn[i+k]==undefined?totalNoteVolume:volumePerColumn[i+k]+totalNoteVolume);}}}
for(let i=0;i<song.loopTime;i++){let songVolume=valueArrayMap.get('-1_'+kMarkerSettingVolume)||[];volumePerColumn[i]*=songVolume[i]||song.settings.volume;if(volumePerColumn[i]>=loudThreshold){message('This sequence has sections that may be considered too loud.',3);return;}}}
function pasteText(text){const parts=text.split(':');if(parts.length>=3&&parts[0]==settings.clipboardMagicString&&parseInt(parts[1])!=instanceId){const newNotes=song.makeNotesFromStringOrProto(parts[2]);const newMarkers=parts.length>=4?song.makeMarkersFromString(parts[3]):[];let bpmChanged=false;for(const marker of newMarkers){if(marker.setting==kMarkerSettingBpm)bpmChanged=true;}
pasteImpl(newNotes,newMarkers);return true;}
return false;}
function playOrRecordMidiNote(code,noteIndex,volumeIndex,instId){const name=midiNoteNames[noteIndex];const volume=1.5*volumeIndex/127;if(name!=null&&!(keyFilterRecordedNotes&&!isKeyGuideNote(name))){playNote(instId,name,instMgr.isSustained(instId)?undefined:1,0,true,volume);if(song.recording&&song.playing&&!isPlayerMode){const note=newRecordedNote(name,volume,instId);if(note!=null){const sn=sustainedMidiNotes[noteIndex];if(sn!=null){releaseSustainedNote(sn.note,currentTimeMs(),sn.startTimeMs);}
sustainedMidiNotes[noteIndex]=new SustainedNote(note,currentTimeMs(),true);(function(note){exec(function(){song.addNote(note);SequencerView.repaint(kRepaintNotesMoved);},function(){song.removeNote(note);SequencerView.repaint(kRepaintNotesMoved);});})(note);setConfirmExit(true);}}}}
function stopMidiNote(code,noteIndex,instId){const name=midiNoteNames[noteIndex];if(instMgr.isSustained(instId)){noteOff(instId,name);}
if(song.playing){const sustainNote=sustainedMidiNotes[noteIndex];if(sustainNote!=null){sustainNote.keyHeld=false;if(!sustainPedalActive){releaseSustainedNote(sustainNote.note,currentTimeMs(),sustainNote.startTimeMs);sustainedMidiNotes[noteIndex]=null;}}}}
function recordMarker(marker){(function(marker){exec(function(){song.addMarker(marker);},function(){song.removeMarker(marker);updateMarkerEditor();});})(marker);}
function recordMidiMarker(setting,value){if(song.recording){let marker=newRecordedMarker(setting,value);if(marker){recordMarker(marker);}}}
function handleMidiControlChange(code,data1,data2){if(data1==64){if(data2==127){sustainPedalActive=true;}else if(data2==0){sustainPedalActive=false;for(const i in sustainedMidiNotes){const sustainNote=sustainedMidiNotes[i];if(sustainNote!=null&&!sustainNote.keyHeld){releaseSustainedNote(sustainNote.note,currentTimeMs(),sustainNote.startTimeMs);sustainedMidiNotes[i]=null;}}}}else if(data1==20){setInitialInstrumentVolume(instrument,data2/64);recordMidiMarker(1,data2/64)}else if(data1==21){setPan(instrument,data2/64-1);recordMidiMarker(2,data2/64-1);}else if(data1==22){setReverbVolume(instrument,data2/128);recordMidiMarker(12,data2/128);}else if(data1==23){setDistortVolume(instrument,data2/128);recordMidiMarker(14,data2/128);}else if(data1==48){(data2!==0)?song.play(song.playPos):song.stop();}else if(data1==49){(data2!==0)?song.record():song.stop();}else if(data1==50){enableMetronome=(data2!==0);}else if(data1==51){quantizeRecordedNotes=(data2!==0);}}
function playMidiDrumNote(code,data1,data2){playOrRecordMidiNote(code,instMgr.getMidiDrumNote(instrument,data1),data2,instMgr.isDrum(instrument)?instrument:31);}
function stopMidiDrumNote(code,data1){stopMidiNote(code,instMgr.getMidiDrumNote(instrument,data1),instMgr.isDrum(instrument)?instrument:31);}
function connectMidiInput(input){input.onmidimessage=function(msg){let code=msg.data[0];const data1=msg.data[1];const data2=msg.data[2];if(code==kMidiNoteOn&&data2==0){code=kMidiNoteOff;}
if(code==kMidiDrumNoteOn&&data2==0){code=kMidiDrumNoteOff;}
if(code==kMidiNoteOn){playOrRecordMidiNote(code,data1+12,data2,instrument);}else if(code==kMidiNoteOff){stopMidiNote(code,data1+12,instrument);}else if(code==kMidiControlChange){handleMidiControlChange(code,data1,data2);}else if(code==kMidiDrumNoteOn){playMidiDrumNote(code,data1,data2);}else if(code==kMidiDrumNoteOff){stopMidiDrumNote(code,data1);}else if(code==kMidiPitchBend){let realPitch=(data2-64)/64*100;setDetune(instrument,realPitch);recordMidiMarker(11,realPitch);}};}
function fillAdvancedInstrumentSettings(){const instTitle=document.getElementById('instrument_options_advanced_title');instTitle.innerHTML=getInstrumentName(song,instrument);document.getElementById('instrument_options_advanced_chip').className='instrument'+instrument;const color=toHtmlColor(getInstrumentColor(song,instrument));const colorPattern=/rgb\(([0-9]+), ([0-9]+), ([0-9]+)\)/;Coloris({themeMode:'dark',alpha:false,format:'rgb',wrap:false,onChange:function(color){const result=colorPattern.exec(color);const[a,r,g,b]=[255,result[1],result[2],result[3]];song.getInstrumentSettings(instrument).color=[a,parseInt(r),parseInt(g),parseInt(b)];updateInstrumentColor(instrument);SequencerView.repaint(kRepaintNotesChanged);}});document.getElementById('instrument_options_advanced_color').value=color;document.getElementById('instrument_options_advanced_color').dispatchEvent(new Event('input',{bubbles:true}));document.getElementById('instrument_options_advanced_volume').value=audioSystem.getInstrumentVolume(instrument);updateDelay(instrument);updateReverb(instrument);updateDistort(instrument);updatePan(instrument);updateDetune(instrument);updateEq(instrument);const soloButton=document.getElementById('instrument_options_solo');if(audioSystem.soloingInstrument==instrument){soloButton.classList.add('enabled');}else{soloButton.classList.remove('enabled');}
const muteButton=document.getElementById('instrument_options_mute');if(audioSystem.getMute(instrument)){muteButton.classList.add('enabled');}else{muteButton.classList.remove('enabled');}
const lockBtn=document.getElementById('instrument_options_advanced_lock_btn');if(instMgr.isLocked(instrument)){instTitle.classList.add('instrument_name_locked');lockBtn.classList.add('fa-lock-alt');lockBtn.classList.remove('fa-lock-open-alt');}else{instTitle.classList.remove('instrument_name_locked');lockBtn.classList.remove('fa-lock-alt');lockBtn.classList.add('fa-lock-open-alt');}
const deleteCloneBtn=document.getElementById('instrument_options_delete');if(instMgr.isClone(instrument)){deleteCloneBtn.classList.remove('disabled');}else{deleteCloneBtn.classList.add('disabled');}}
function advancedSettingsTitleEditOpen(){const title=document.getElementById('instrument_options_advanced_title');const edit=document.getElementById('instrument_options_advanced_title_edit');title.classList.add('hidden');edit.classList.remove('hidden');edit.value=title.innerText;edit.focus();}
function advancedSettingsTitleEditDone(){const title=document.getElementById('instrument_options_advanced_title');const edit=document.getElementById('instrument_options_advanced_title_edit');title.classList.remove('hidden');edit.classList.add('hidden');let name=edit.value;if(name=='')name=instMgr.getDefaultName(instrument);title.innerText=name;song.getInstrumentSettings(instrument).name=name;updateUiForInstrumentClones();}
function fillSimpleInstrumentSettings(){instMgr.forEach(instId=>{const vol=document.getElementById('instrument_volume_'+instId);if(vol){vol.value=audioSystem.getInstrumentVolume(instId);}});}
function updateSynth(instId,refresh=true){createSynth(instId);const oldInstrument=instrument;instrument=instId;let synthTitle=$('#instrument_options_synth_title');let name=song.settings.instruments[instId].name;if(name===''){name=instMgr.getDefaultName(instId);}
synthTitle.text(name);updateSynthType(instId,true,refresh);updateSynthFilter(instId);updateSynthFilterQ(instId);updateSynthFilterType(instId,true);updateLFO(instId,false);updateLFOIntensity(instId);updateLFOOsc(instId);updateLFORate(instId);updateLFOTarget(instId,false,true,refresh);updateADSR(instId);updateAttack(instId);updateDecay(instId);updateSustain(instId);updateRelease(instId);updateSynthLFOView(instId);updateSynthADSRView(instId);updateSynthWaveformView(instId);instrument=oldInstrument;}
function fillSynthInstrumentSettings(){updateSynth(instrument,false);}
function setSynthTabVisibility(){let tab=$('#instrument_options_tab_synth');if(instMgr.isCustomSynth(instrument)){tab.css('display','block');}else{tab.css('display','none');if(tab.hasClass('selected')){tab.removeClass('selected');$('#instrument_options_tab_simple').addClass('selected');$('#instrument_options_synth').css('display','none');$('#instrument_options_simple').css('display','block');}}}
function onInstrumentSelect(newInstrument){instrument=parseInt(newInstrument);instMgr.ensureLoaded(instrument,true);updateKeys();const changes=[];for(const note of selection.notes){if(note.instrument!=instrument){changes.push({note:note,oldInstrument:note.instrument,newinstrument:instrument});}}
if(changes.length){message(changes.length+' note'+(changes.length==1?'':'s')+' changed.',3,true);(function(changes){exec(function(){for(let i=0;i<changes.length;i++){const change=changes[i];const note=change.note;song.moveNote(note,change.oldInstrument,change.newinstrument,note.time,note.time,note.type,note.type);}
SequencerView.repaint(kRepaintNotesChanged);updateSelection();},function(){for(let i=0;i<changes.length;i++){const change=changes[i];const note=change.note;song.moveNote(note,change.newinstrument,change.oldInstrument,note.time,note.time,note.type,note.type);}
SequencerView.repaint(kRepaintNotesChanged);updateSelection();});})(changes);setConfirmExit(true);}
selectOpen=false;fillAdvancedInstrumentSettings();setMarkerEditorInstrumentInput(instrument);setSynthTabVisibility();}
function onscroll(dx,dy){updateSelectionRectangle(mouseX,mouseY);updateDragNotes(mouseX,mouseY,mouseX-dx,mouseY-dy);updateResizeNotes(mouseX,mouseY,mouseX-dx,mouseY-dy);SequencerView.repaint();}
function xPosition(x){return x-sequencerRect.left;}
function yPosition(y){return y-sequencerRect.top;}
function clickToNoteX(x){return xPosition(x)/noteWidth;}
function clickToNoteY(y){return yPosition(y)/noteHeight;}
function noteToClickX(x){return x*noteWidth+sequencerRect.left;}
function noteToClickY(y){return y*noteHeight+sequencerRect.top;}
function timeIndex(x){return floorTimeIndexToGrid(x/noteWidth);}
function noteIndex(y){return Math.floor(y/noteHeight);}
function timeIndexRound(x){return roundTimeIndexToGrid(x/noteWidth);}
function noteIndexRound(y){return Math.round(y/noteHeight);}
function floorTimeIndexToGrid(time){return Math.floor(time/(1/grid))/grid;}
function roundTimeIndexToGrid(time){return Math.round(time/(1/grid))/grid;}
function timeInMsToTimeIndex(t){return t/song.sleepTime;}
function currentTimeMs(){return new Date().getTime();}
function currentTimeIndex(){return playTime-1+timeInMsToTimeIndex(currentTimeMs()-lastStepTime);}
function noteFromPoint(x,y,includeLocked){x=x-containerRect.left;y=y-containerRect.top;let note;const start=Math.max(Math.floor((scrollLeft-SequencerView.width)/noteWidth),0);const stop=Math.min(Math.floor(((scrollLeft+SequencerView.width)+1)/noteWidth),song.noteColumns.length);for(let i=start;i<stop;i++){if(song.noteColumns[i]!=null){for(const j in song.noteColumns[i]){const n=song.noteColumns[i][j];if((!instMgr.isLocked(n.instrument)||includeLocked)&&x>n.drawX&&x<n.drawX+n.drawWidth&&y>n.drawY&&y<n.drawY+n.drawHeight){if(note!=null&&note.selected&&!n.selected){continue;}
note=n;}}}}
return note;}
function onNoteClick(event){const note=noteFromPoint(event.clientX,event.clientY,event.shiftKey&&event.ctrlKey);if(note!=null){activeNote=note;const add=event.shiftKey;if(event.ctrlKey&&event.shiftKey){lockInstrument(note.instrument);}else if(event.ctrlKey){selectInstrument(note.instrument);ctrlClickResizeExistingNote=true;resizeSelection(note);setConfirmExit(true);}else{if(note.selected==false){if(add){(function(note){exec(function(){selection.selectNote(note);updateSelection();},function(){selection.deselectNote(note);updateSelection();});})(note);}else{(function(oldNotes,oldMarkers,note){exec(function(){selection.clear();selection.selectNote(note);updateSelection();},function(){selection.setNotes(oldNotes);selection.setMarkers(oldMarkers);updateSelection();});})(selection.notes,selection.markers,note);}}else if(add){(function(note){exec(function(){selection.deselectNote(note);updateSelection();},function(){selection.selectNote(note);updateSelection();});})(note);}
if(SequencerView.isResizeHandle(event.clientX-containerRect.left,event.clientY-containerRect.top,note)){resizeSelection(note);}else{dragSelection(note);}
playNote(note.instrument,note.type,note.length,0,true,note.volume);setConfirmExit(true);}
return clickedNote=true;}else if(!event.shiftKey){selectNone();}
return clickedNote=false;}
function selectNotes(){let currentInstrumentNotes=song.notes.filter((note)=>note.instrument==instrument);if(currentInstrumentNotes.every((note)=>note.selected==true)){for(const note of currentInstrumentNotes){selection.deselectNote(note);}}else{for(const note of currentInstrumentNotes){selection.selectNote(note);}}
updateSelection();SequencerView.repaint(kRepaintNotesChanged)}
function selectMarkers(){let currentInstrumentMarkers=[];for(const markerArray of song.markerIterator){for(const marker of markerArray.array){if(marker.instrument==instrument)
currentInstrumentMarkers.push(marker);}}
if(currentInstrumentMarkers.every((marker)=>selection.isMarkerSelected(marker))){for(const marker of currentInstrumentMarkers){selection.deselectMarker(marker);}}else{for(const marker of currentInstrumentMarkers){selection.selectMarker(marker);}}
updateSelection();}
function getClickTarget(event){const ct=clickTargets[getButton(event)];return(ct==null)?kClickTargetNone:ct;}
function setClickTarget(event,target){clickTargets[getButton(event)]=target;}
function isMultiTouchEvent(event){const originalEvent=event.originalEvent.originalEvent;return originalEvent instanceof TouchEvent&&originalEvent.touches.length>1;}
function mouseDownDraw(event){if(!onNoteClick(event)){x=xPosition(event.clientX);y=yPosition(event.clientY);if(event.ctrlKey){dragDraw=true;}
if(x>0&&y>0&&!instMgr.isLocked(instrument)){type=piano[noteIndex(y)];time=timeIndex(x);if(time<=maxCells&&type!=undefined){const length=settings.user.remember_length=='true'?(lastNoteLength.get(instrument)??1/grid):1/grid;const volume=settings.user.remember_volume=='true'?lastNoteVolume.get(instrument):1;const note=new Note(song,type,time,length,instrument,volume);song.playNotes([note]);instMgr.ensureLoaded(instrument);(function(note){exec(function(){song.addNote(note);SequencerView.repaint(kRepaintNotesMoved);},function(){song.removeNote(note);SequencerView.repaint(kRepaintNotesMoved);});})(note);for(const n of dragNotes)n.dragging=false;clearDrag();resizeNotes=[];dragNotes.push(note);setDragBounds();note.dragging=true;}
setConfirmExit(true);}}}
function mouseDownEdit(event){onNoteClick(event);}
function mouseDownPlay(event,updateHash){x=xPosition(event.clientX);time=Math.floor(timeIndex(x));if(!song.playing){song.play(time,!(event.ctrlKey||event.metaKey),event.altKey);}else{song.stop();}
event.preventDefault();if(updateHash){window.location.hash='t'+time;}}
function mouseDownErase(event){let note=noteFromPoint(event.clientX,event.clientY);if(note!=null&&!isPlayerMode){let selected=note.selected;exec(function(){song.removeNote(note);if(selected)selection.deselectNote(note);SequencerView.repaint(kRepaintNotesMoved);},function(){song.addNote(note);if(selected)selection.selectNote(note);SequencerView.repaint(kRepaintNotesMoved);});setConfirmExit(true);}}
function mouseDownSequencer(event){setClickTarget(event,kClickTargetSequencer);mouseX=event.clientX;mouseY=event.clientY;mouseMovedAfterClick=false;dragDraw=false;ctrlClickResizeExistingNote=false;mouseButton=getButton(event);if(mouseButton==primaryButton){if(event.altKey||isPlayerMode){dragView=true;}else{switch(mode){case'draw':mouseDownDraw(event);break;case'edit':mouseDownEdit(event);break;case'play':mouseDownPlay(event);break;case'erase':mouseDownErase(event);break;}}
setMouseClickXY(event);}else if(mouseButton==2){mouseDownPlay(event);}
if(!dragView&&!ctrlClickResizeExistingNote)onmousemove(event);}
function onmousemove(event){mouseMovedAfterClick=true;if(updateCursorTimer==null){updateCursorTimer=setTimeout(function(){updateCursorTimer=null;},50);const note=noteFromPoint(event.clientX,event.clientY);if(note==null){const custom=settings.user.custom_cursor=='true';const cursorImage=custom?`url(/app/cursor_${mode}.png), default`:'default';sequencer.style.cursor=cursorImage;}else if(SequencerView.isResizeHandle(event.clientX-containerRect.left,event.clientY-containerRect.top,note)){sequencer.style.cursor='ew-resize';}else{sequencer.style.cursor='pointer';}}
if(event.shiftKey){$('.detune_slider').attr('step',1);}else{$('.detune_slider').attr('step',100);}
const ct=getClickTarget(event);if(ct==kClickTargetSequencer){mouseMoveSequencer(event);}else if(ct==kClickTargetMarkerBar){mouseMoveMarkerBar(event);}
mouseX=event.clientX;mouseY=event.clientY;}
function mouseMoveSequencer(event){if(dragView){setScrollLeft(scrollLeft-(event.clientX-mouseX),true);container.scrollTop=(container.scrollTop-(event.clientY-mouseY));}else{if(mouseButton==primaryButton){if(event.clientX>=containerRect.right-1){if(scrollXTimeoutId==0)
scrollXTimeoutId=window.setInterval(function(){if(scrollLeft+container.clientWidth<container.scrollWidth){setScrollLeft(scrollLeft+8,true);onscroll(8,0);}},16);}else if(event.clientX<=containerRect.left){if(scrollXTimeoutId==0)
scrollXTimeoutId=window.setInterval(function(){if(scrollLeft>0){setScrollLeft(scrollLeft-8,true);onscroll(-8,0);}},16);}else if(scrollXTimeoutId!=0){window.clearInterval(scrollXTimeoutId);scrollXTimeoutId=0;}
if(event.clientY>=containerRect.bottom-1){if(scrollYTimeoutId==0)
scrollYTimeoutId=window.setInterval(function(){if(container.scrollTop+container.clientHeight<container.scrollHeight){container.scrollTop+=8;}},16);}else if(event.clientY<=containerRect.top){if(scrollYTimeoutId==0)
scrollYTimeoutId=window.setInterval(function(){if(container.scrollTop>0){container.scrollTop-=8;}},16);}else if(scrollYTimeoutId!=0){window.clearInterval(scrollYTimeoutId);scrollYTimeoutId=0;}}
if((mouseButton==primaryButton&&mode=='erase')||mouseButton==3){mouseDownErase(event);}else{updateSelectionRectangle(event.clientX,event.clientY);}
updateDragNotes(event.clientX,event.clientY,mouseX,mouseY);updateResizeNotes(event.clientX,event.clientY,mouseX,mouseY);time=timeIndex(xPosition(event.clientX));time=Math.floor(time/4);}}
function ontouchstart(event){const count=event.originalEvent.touches.length;if(count==2){isTouchScrolling=true;let x=0;let y=0;for(let i=0;i<count;i++){x+=event.originalEvent.touches[i].clientX;y+=event.originalEvent.touches[i].clientY;}
x/=count;y/=count;touchMoveX=x;touchMoveY=y;event.stopPropagation();}}
function ontouchend(event){}
function ontouchmove(event){const count=event.originalEvent.touches.length;if(count==2&&isTouchScrolling){let x=0;let y=0;for(let i=0;i<count;i++){x+=event.originalEvent.touches[i].clientX;y+=event.originalEvent.touches[i].clientY;}
x/=count;y/=count;setScrollLeft(scrollLeft-(x-touchMoveX),true);container.scrollTop=(container.scrollTop-(y-touchMoveY));touchMoveX=x;touchMoveY=y;}}
function onwheel(event){if(event.ctrlKey||event.metaKey){if(event.deltaY<0){zoomIn(event.clientX-containerRect.x,event.clientY-containerRect.y,event.altKey);}else if(event.deltaY>0){zoomOut(event.clientX-containerRect.x,event.clientY-containerRect.y,event.altKey);}
event.preventDefault();}else if(event.altKey&&selection.hasNotes()&&!isPlayerMode){setNoteVolume(event.deltaY);event.preventDefault();}}
function setNoteVolume(delta,absolute){const changes=[];for(const note of selection.notes){changes.push({note:note,oldVolume:note.volume,newVolume:absolute?delta:Math.min(Math.max(note.volume+(delta>0?-0.1:0.1),0),5),});}
if(changes.length>0){(function(changes){exec(function(){for(const change of changes){change.note.volume=change.newVolume;lastNoteVolume.set(change.note.instrument,change.newVolume);}
SequencerView.repaint(kRepaintNotesChanged);},function(){for(const change of changes){change.note.volume=change.oldVolume;lastNoteVolume.set(change.note.instrument,change.oldVolume);}
SequencerView.repaint(kRepaintNotesChanged);});})(changes);setConfirmExit(true);}}
function onmouseup(event){const ct=getClickTarget(event);if(ct==kClickTargetSequencer){mouseUpSequencer(event);}else if(ct==kClickTargetMarkerBar){mouseUpMarkerBar(event);}
setClickTarget(event,kClickTargetNone);}
function mouseUpSequencer(event){if(isPlayerMode&&!mouseMovedAfterClick){mouseDownPlay(event);}
if(isTouchScrolling){isTouchScrolling=false;return;}
if(dragView){dragView=false;mouseButton=0;return;}
if(scrollXTimeoutId!=0){window.clearInterval(scrollXTimeoutId);scrollXTimeoutId=0;}
if(scrollYTimeoutId!=0){window.clearInterval(scrollYTimeoutId);scrollYTimeoutId=0;}
let xPos=xPosition(event.clientX);let yPos=yPosition(event.clientY);let xClickPos=xPosition(mouseClickX());let yClickPos=yPosition(mouseClickY());if(mode=='edit'&&!clickedNote&&mouseButton==primaryButton){selectionRect.style.display='none';let startX,stopX,startY,stopY;if(xClickPos<xPos){startX=xClickPos/noteWidth;stopX=xPos/noteWidth;}else{stopX=xClickPos/noteWidth;startX=xPos/noteWidth;}
if(yClickPos<yPos){startY=noteIndex(yClickPos);stopY=noteIndex(yPos);}else{stopY=noteIndex(yClickPos);startY=noteIndex(yPos);}
const notesToSelect=[];const newMarkers=event.shiftKey?selection.markers:new Set();let newNotesToSelect=0;for(const note of song.notes){if(note.time+note.length>startX&&note.time<=stopX){const index=pianoToIndex[note.type];if(index>=startY&&index<=stopY&&!instMgr.isLocked(note.instrument)){notesToSelect.push(note);if(!note.selected)newNotesToSelect+=1;continue;}}
if(event.shiftKey&&note.selected){notesToSelect.push(note);}}
if(newNotesToSelect>0){(function(oldNotes,oldMarkers,newNotes,newMarkers){exec(function(){selection.setNotes(newNotes);selection.setMarkers(newMarkers);updateSelection();},function(){selection.setNotes(oldNotes);selection.setMarkers(oldMarkers);updateSelection();});})(selection.notes,selection.markers,notesToSelect,newMarkers);}}
const changes=[];let changed=false;if(resizeNotes.length>0&&mouseMovedAfterClick){const dx=noteDeltaX(event,roundTimeIndexToGrid,resizeNotes[0].time+resizeNotes[0].length);for(const note of resizeNotes){const newLength=Math.max(note.length+dx,1/grid);lastNoteLength.set(note.instrument,newLength);note.offsetWidth=0;if(newLength!=note.length)changed=true;changes.push({note:note,oldLength:note.length,newLength:newLength});}}
if(changed){(function(changes){exec(function(){for(const change of changes){change.note.length=change.newLength;}
song.updateLoopTime();SequencerView.repaint(kRepaintNotesMoved);},function(){for(const change of changes){change.note.length=change.oldLength;}
song.updateLoopTime();SequencerView.repaint(kRepaintNotesMoved);});})(changes);setConfirmExit(true);}else if(changes.length>0){for(const change of changes){change.note.length=change.newLength;}
song.updateLoopTime();SequencerView.repaint(kRepaintNotesMoved);}
if(!dragDraw){applyDrag(event,false);}else{clearDrag();}
resizeNotes=[];mouseButton=0;dragDraw=false;}
function setMouseClickXY(event){noteClickX=clickToNoteX(event.clientX);noteClickY=clickToNoteY(event.clientY);}
function mouseClickX(){return noteToClickX(noteClickX);}
function mouseClickY(){return noteToClickY(noteClickY);}
function noteDeltaX(event,round,offset){const fromX=noteClickX;const toX=clickToNoteX(event.clientX);const result=round(toX-fromX+offset)-offset;return result;}
function noteDeltaY(event){const fromY=Math.floor(noteClickY);const toY=Math.floor(clickToNoteY(event.clientY));return toY-fromY;}
function applyDrag(event,draggingMarker){const draggingNotes=dragNotes.length>0;const isMarkerDrag=draggingMarker||!draggingNotes;const dxFloor=isMarkerDrag?Math.round:roundTimeIndexToGrid;const dx=noteDeltaX(event,dxFloor,dragNotes[0]?.time??0);const changes=[];let sequenceChanged=false;let visualsChanged=false;if(draggingNotes){const dy=noteDeltaY(event);for(const note of dragNotes){note.dragging=false;if(note.offsetX!=0||note.offsetY!=0||dx!=0||dy!=0){visualsChanged=true;}
note.offsetX=0;note.offsetY=0;const newType=piano[pianoToIndex[note.type]+dy]??note.type;let newTime=note.time+dx;if(newTime<0||newTime==null||isNaN(newTime))newTime=note.time;if(newType!=note.type||newTime!=note.time)sequenceChanged=true;changes.push({note:note,oldType:note.type,oldTime:note.time,newType:newType,newTime:newTime,});}}
const markerChanges=[];if(dragMarkers.size>0){for(const marker of dragMarkers){let newTime=marker.time+dx;if(newTime<0||newTime==null||isNaN(newTime)){newTime=marker.time;}
if(newTime!=marker.time)sequenceChanged=true;markerChanges.push({marker:marker,oldTime:marker.time,newTime:newTime,});}}
clearDrag();if(sequenceChanged){(function(changes,markerChanges){exec(function(){for(const change of changes){const note=change.note;song.moveNote(note,note.instrument,note.instrument,change.oldTime,change.newTime,change.oldType,change.newType);}
applyMarkerMoves(markerChanges);if(changes.length>0){song.updateLoopTime();SequencerView.repaint(kRepaintNotesMoved);}},function(){for(const change of changes){const note=change.note;song.moveNote(note,note.instrument,note.instrument,change.newTime,change.oldTime,change.newType,change.oldType);}
undoMarkerMoves(markerChanges);if(changes.length>0){song.updateLoopTime();SequencerView.repaint(kRepaintNotesMoved);}});})(changes,markerChanges);setConfirmExit(true);}else{let anyChange=false;for(const change of changes){const note=change.note;song.moveNote(note,note.instrument,note.instrument,change.oldTime,change.newTime,change.oldType,change.newType);if(note.time!=change.newTime||note.type!=change.newType){anyChange=true;}}
song.updateLoopTime();if(visualsChanged){SequencerView.repaint(kRepaintNotesMoved);}
if(draggingMarker){(function(newMarkers){exec(function(){for(const marker of newMarkers){selection.selectMarker(marker);}
updateSelection();},function(){for(const marker of newMarkers){selection.deselectMarker(marker);}
updateSelection();});})(Array.from(gMarkersAtClickTime));}}
updateMarkers();}
function clearDrag(){dragNotes=[];dragMarkers.clear();dragMarkersOffsetX=0;dragMarkerTimes.clear();}
$(document).ready(function(){hoveringOnOptions=false;$('#instrument_options').mouseenter(function(){hoveringOnOptions=true;});$('#instrument_options').mouseleave(function(){hoveringOnOptions=false;});});function deleteSelection(){if(selection.isEmpty())return;(function(oldNotes,oldMarkers){exec(function(){song.removeNotes(oldNotes);let bpmChanged=false;for(const marker of oldMarkers){song.removeMarker(marker);if(marker.setting==kMarkerSettingBpm)bpmChanged=true;}
selection.clear();updateSelection();if(oldNotes.length>0){SequencerView.repaint(kRepaintNotesMoved);}
onMultiMarkerValueChange(bpmChanged);},function(){for(const note of oldNotes){song.addNote(note,true);}
let bpmChanged=false;for(const marker of oldMarkers){song.addMarker(marker);if(marker.setting==kMarkerSettingBpm)bpmChanged=true;}
selection.setNotes(oldNotes);selection.setMarkers(oldMarkers);updateSelection();if(oldNotes.length>0){song.updateLoopTime();SequencerView.repaint(kRepaintNotesMoved);}
onMultiMarkerValueChange(bpmChanged);});})(selection.notes,selection.markers);setConfirmExit(true);}
function dragSelection(clickedNote,clickedMarkerTime){clearDrag();if(clickedNote!=null)dragNotes.push(clickedNote);for(const note of selection.notes){if(note!=clickedNote)dragNotes.push(note);note.dragging=true;}
dragMarkerTimes.clear();if(clickedMarkerTime!==undefined){dragMarkers.clear();}
for(const marker of selection.markers){dragMarkers.add(marker);dragMarkerTimes.add(marker.time);}
setDragBounds();setConfirmExit(true);}
function setDragBounds(){dragMinX=Infinity;dragMinY=Infinity;dragMaxX=0;dragMaxY=0;for(const note of dragNotes){if(note.intTime<dragMinX)dragMinX=note.intTime;if(note.intTime+note.length>dragMaxX){dragMaxX=note.intTime+note.length;}
const index=pianoToIndex[note.type];if(index<dragMinY)dragMinY=index;if(index>dragMaxY)dragMaxY=index;}}
function resizeSelection(clickedNote){resizeNotes=[clickedNote];for(const note of selection.notes){if(note!=clickedNote)resizeNotes.push(note);}}
function updateSelection(){const minTime=selection.getTimeSpan().min;copyButton.setAttribute('data-clipboard-text',copyString=getCopyString(selection.notes,selection.markers,minTime));updateMarkerEditor();SequencerView.repaint(kRepaintNotesChanged);}
function selectNone(){if(!selection.isEmpty()){(function(oldNotes,oldMarkers){exec(function(){selection.clear();updateSelection();},function(){selection.setNotes(oldNotes);selection.setMarkers(oldMarkers);updateSelection();});})(selection.notes,selection.markers);}}
function selectAll(){if(isPlayerMode)return;if(selection.notes.length==song.notes.length&&selection.markers.size==song.totalMarkers){selectNone();}else{(function(oldNotes,oldMarkers){exec(function(){for(const note of song.notes){if(!instMgr.isLocked(note.instrument)){selection.selectNote(note);}}
for(const mi of song.markerIterator){for(const marker of mi.array){selection.selectMarker(marker);}}
updateSelection();},function(){selection.setNotes(oldNotes);selection.setMarkers(oldMarkers);updateSelection();});})(Array.from(selection.notes),new Set(selection.markers));if(!selection.isEmpty()){message(selection.describe()+' selected.',3,true);}}}
function selectByTimeRange(startTime,endTime,add,intersect){let newNotes=add?Array.from(selection.notes):[];for(const note of(intersect?selection.notes:song.notes)){if(!instMgr.isLocked(note.instrument)){if(note.time>=startTime&&note.time<endTime){newNotes.push(note);}}}
let newMarkers=add?new Set(selection.markers):new Set();function addMatchingMarkers(markers){for(const marker of markers){if(marker.time>=startTime&&marker.time<endTime){newMarkers.add(marker);}}}
if(intersect){addMatchingMarkers(selection.markers);}else{for(const mi of song.markerIterator)addMatchingMarkers(mi.array);}
(function(oldNotes,oldMarkers,newNotes,newMarkers){exec(function(){selection.setNotes(newNotes);selection.setMarkers(newMarkers);updateSelection();},function(){selection.setNotes(oldNotes);selection.setMarkers(oldMarkers);updateSelection();});})(Array.from(selection.notes),new Set(selection.markers),newNotes,newMarkers);if(!selection.isEmpty()){message(selection.describe()+' selected.',3,true);}}
function getMeasureTimeSpan(time){const measureLength=4*getTimeSig();const min=Math.floor(time/measureLength)*measureLength;return{min:min,max:min+measureLength};}
function applyMarkerMoves(markerChanges){if(markerChanges.length>0){selection.clearMarkers();let newEditorTime=null;for(const change of markerChanges){song.removeMarker(change.marker);}
let bpmChanged=false;for(const change of markerChanges){change.marker.time=change.newTime;song.addMarker(change.marker);selection.selectMarker(change.marker);if(change.marker.setting==kMarkerSettingBpm)bpmChanged=true;if(markerEditorTime==change.oldTime)newEditorTime=change.newTime;}
if(newEditorTime!=null&&$(markerEditor).is(':visible')){openMarkerEditorAtTime(newEditorTime);}
onMultiMarkerValueChange(bpmChanged);updateMarkers();setConfirmExit(true);}}
function undoMarkerMoves(markerChanges){if(markerChanges.length>0){selection.clearMarkers();let newEditorTime=null;for(const change of markerChanges){song.removeMarker(change.marker);}
let bpmChanged=false;for(const change of markerChanges){change.marker.time=change.oldTime;song.addMarker(change.marker);selection.selectMarker(change.marker);if(change.marker.setting==kMarkerSettingBpm)bpmChanged=true;if(markerEditorTime==change.newTime)newEditorTime=change.oldTime;}
if(newEditorTime!=null&&$(markerEditor).is(':visible')){openMarkerEditorAtTime(newEditorTime);}
onMultiMarkerValueChange(bpmChanged);updateMarkers();}}
function bumpSelection(deltaTime,deltaNote){if(!selection.isEmpty()){const noteChanges=[];for(const note of selection.notes){const newType=piano[pianoToIndex[note.type]+deltaNote];if(newType==null)return;let newTime=note.time+deltaTime;if(newTime<0){if(newTime<-1e-6)return;newTime=0;}
noteChanges.push({note:note,oldTime:note.time,oldType:note.type,newTime:newTime,newType:newType,});}
const markerChanges=[];if(deltaTime!=0){for(const marker of selection.markers){let newTime=marker.time+deltaTime;if(newTime<0){if(newTime<-1e-6)return;newTime=0;}
markerChanges.push({marker:marker,oldTime:marker.time,newTime:newTime,});}}
(function(noteChanges,markerChanges){exec(function(){for(const change of noteChanges){const note=change.note;song.moveNote(note,note.instrument,note.instrument,change.oldTime,change.newTime,change.oldType,change.newType);}
applyMarkerMoves(markerChanges);if(noteChanges.length>0){song.updateLoopTime();SequencerView.repaint(kRepaintNotesMoved);}},function(){for(const change of noteChanges){const note=change.note;song.moveNote(note,note.instrument,note.instrument,change.newTime,change.oldTime,change.newType,change.oldType);}
undoMarkerMoves(markerChanges);if(noteChanges.length>0){song.updateLoopTime();SequencerView.repaint(kRepaintNotesMoved);}});})(noteChanges,markerChanges);setConfirmExit(true);}}
function legatomizeNotes(){if(!selection.notes.length)
return message('Select some notes to legatomize first.',3,true);const changes=[];let instMap=new Map();for(const n of selection.notes){if(!instMap.has(n.instrument)){instMap.set(n.instrument,[n]);}else{instMap.get(n.instrument).push(n);}}
instMap.forEach(notes=>{let sortedNotes=notes.sort((x,y)=>x.time-y.time);let j=0;for(let i=0;i<sortedNotes.length;i++){const note=sortedNotes[i];const nextNote=sortedNotes[i+1];if(!nextNote)continue;const newLength=nextNote.time-note.time;if(newLength!==0){for(let k=j;k<=i;++k){if(note.length===newLength)continue;changes.push({note:sortedNotes[k],newLength:newLength,oldLength:sortedNotes[k].length});}
j=i+1;}}});if(changes.length<1)return;exec(function(){for(const change of changes){song.updateNoteLength(change.note,change.newLength);}
song.updateLoopTime();SequencerView.repaint(kRepaintNotesMoved);},function(){for(const change of changes){song.updateNoteLength(change.note,change.oldLength);}
song.updateLoopTime();SequencerView.repaint(kRepaintNotesMoved);});setConfirmExit(true);}
function setGrid(value){grid=value;lastNoteLength=new Map();updateGridImage();SequencerView.repaint();}
function setTimeSig(value){song.setTimeSig(parseInt(value));updateGridImage();updateMeasures();setConfirmExit(true);SequencerView.repaint();}
function getTimeSig(){if(typeof song!='undefined'){return song.getTimeSig();}
return 4;}
function setInitialInstrumentVolume(instId,volume){instId=parseInt(instId);initialInstrumentVolume.set(instId,volume);song.setInitialMarkerValue(kMarkerSettingInstrumentVolume,instId,volume);audioSystem.setInstrumentVolume(instId,volume);setConfirmExit(true);}
function onMarkerEditorTypeChange(){$('#marker_instrument_input').css('visibility',kMarkerEditorSettings[markerTypeInput.value].isPerInstrument?'visible':'hidden');refreshSelectMenu('#marker_instrument');}
function getMarkerInstrument(marker){const setting=kMarkerEditorSettings[marker.setting];return setting.isPerInstrument?marker.instrument:-1;}
function drawMarker(parent,t,isMarker,isMarkerEdit,start,offset){const marker=document.createElement('div');marker.className='timeline_marker';parent.appendChild(marker);const pos=(t-start)*noteWidth-offset;marker.style.left=pos+'px';const markerInner=document.createElement('div');markerInner.className='timeline_marker_inner';markerInner.style.width=noteWidth+'px';if(isMarker)markerInner.className+=' marker';if(isMarkerEdit)markerInner.className+=' editor';if(selection.isMarkerTimeSelected(t))markerInner.className+=' selected';marker.appendChild(markerInner);}
function updateMarkers(){if(typeof song=='undefined')return;const count=Math.ceil(containerRect.width/noteWidth)+1;const start=Math.floor(container.scrollLeft/noteWidth);const showMarkerEdit=$(markerEditor).is(':visible');const showMarkerBar=$(markerBar).is(':visible');$(timelineMarkers).empty();$(markerBar).empty();let offset=container.scrollLeft%noteWidth;if(showMarkerBar)offset-=container.scrollLeft;const parent=showMarkerBar?markerBar:timelineMarkers;for(let i=0;i<count;i++){let t=i+start;let isMarker=song.anyMarkersAtTime(t);let isMarkerEdit=showMarkerEdit&&(t==markerEditorTime);if((isMarker||isMarkerEdit)&&!dragMarkerTimes.has(t)){drawMarker(parent,t,isMarker,isMarkerEdit,start,offset);}}
for(const t of dragMarkerTimes){drawMarker(parent,t,true,t==markerEditorTime,start,offset-dragMarkersOffsetX);}}
function updateMarkerEditor(){updateMarkers();if(!$(markerEditor).is(':visible'))return;markerEditorMarkers=song.getAllMarkersAtTime(markerEditorTime);let markersElement=document.getElementById('marker_editor_markers');markersElement.innerHTML='';for(let i=0;i<markerEditorMarkers.length;++i){const m=markerEditorMarkers[i];const s=kMarkerEditorSettings[m.setting];let markerEditorMarker=document.createElement('div');markerEditorMarker.setAttribute('class','marker_editor_marker');let checkbox=document.createElement('input');checkbox.setAttribute('type','checkbox');checkbox.setAttribute('class','marker_editor_selected');checkbox.setAttribute('title','Select this marker');if(selection.isMarkerSelected(m))checkbox.setAttribute('checked','');checkbox.setAttribute('onchange','markerEditorSelectMarker('+i+')');let markerEditorName=document.createElement('div');markerEditorName.setAttribute('class','marker_editor_name');markerEditorName.innerHTML=s.title;let buttonReset=document.createElement('div');buttonReset.setAttribute('class','button');buttonReset.setAttribute('title','Reset');buttonReset.setAttribute('onclick','markerEditorReset('+i+')');buttonReset.innerHTML='<i class="fas fa-rotate-reverse"></i>';let buttonDelete=document.createElement('div');buttonDelete.setAttribute('class','button');buttonDelete.setAttribute('title','Delete');buttonDelete.setAttribute('onclick','markerEditorDelete('+i+')');buttonDelete.innerHTML='<i class="far fa-times"></i>';markerEditorMarker.appendChild(checkbox);if(s.isPerInstrument){instMgr.ensureLoaded(m.instrument);let markerEditorChip=document.createElement('div');markerEditorChip.setAttribute('class','marker_editor_chip instrument'+m.instrument);markerEditorChip.setAttribute('title',getInstrumentName(song,m.instrument));markerEditorMarker.appendChild(markerEditorChip);}
markerEditorMarker.appendChild(markerEditorName);if(s.isSlider){let sliderLine=document.createElement('div');sliderLine.setAttribute('class','slider_line');if(s.withWarning)
sliderLine.setAttribute('class','slider_line with_warning');let sliderCenter=document.createElement('div');sliderCenter.setAttribute('class','slider_center');let sliderInput=document.createElement('input');sliderInput.setAttribute('class','marker_editor_value slider');if(s.isDetuneSlider)
sliderInput.setAttribute('class','marker_editor_value slider detune_slider');sliderInput.setAttribute('type','range');sliderInput.setAttribute('min',''+s.min);sliderInput.setAttribute('max',''+s.max);sliderInput.setAttribute('step',''+s.step);sliderInput.setAttribute('value',''+m.value);sliderInput.setAttribute('onchange','markerEditorSetValue('+i+')');sliderInput.setAttribute('title',''+m.value);sliderInput.addEventListener('change',function(elem){elem.target.setAttribute('title',parseFloat(elem.target.value).toFixed(2));});markerEditorMarker.appendChild(sliderLine);sliderLine.appendChild(sliderCenter);sliderLine.appendChild(sliderInput);}else if(s.isBool){let padding=document.createElement('div');padding.setAttribute('class','padding');let buttonMarkerEditorValue=document.createElement('div');buttonMarkerEditorValue.setAttribute('class','button marker_editor_value');if(m.value!=0){buttonMarkerEditorValue.classList.add('enabled');}
buttonMarkerEditorValue.setAttribute('onclick','markerEditorSetValue('+i+')');markerEditorMarker.appendChild(padding);markerEditorMarker.appendChild(buttonMarkerEditorValue);}else if(s.isEnum){let padding2=document.createElement('div');padding2.setAttribute('class','padding');let boxInput=document.createElement('div');boxInput.setAttribute('class','box_input');let selectMarkerEditorValue=document.createElement('select');selectMarkerEditorValue.setAttribute('class','marker_editor_value');selectMarkerEditorValue.setAttribute('onchange','markerEditorSetValue('+i+')');markerEditorMarker.appendChild(padding2);boxInput.appendChild(selectMarkerEditorValue);if(s.name==='Synthesizer LFO Rate'){if(parseFloat(m.value)<=0){let hzInput=document.createElement('input');hzInput.setAttribute('class','synth_marker_lfo_hz');hzInput.setAttribute('placeholder','Hz');hzInput.style.width='50px';let originalVal=-parseFloat(m.value);originalVal=(isNaN(originalVal)||originalVal<0.1)?1:originalVal
hzInput.setAttribute('value',originalVal);setMarkerValue(m,-originalVal,false);hzInput.addEventListener('keyup',()=>{let val=parseFloat(hzInput.value);if(!isNaN(val)){setMarkerValue(m,-val,false);}});boxInput.appendChild(hzInput);boxInput.style.marginRight='32px';s.isBlendable=true;}else{boxInput.style.marginRight=undefined;s.isBlendable=false;}}
markerEditorMarker.appendChild(boxInput);s.enumOptions.forEach(inputOption=>{let option=document.createElement('option');option.setAttribute('value',''+inputOption.value);option.innerHTML=inputOption.label;if(m.value==inputOption.value)option.setAttribute('selected','');selectMarkerEditorValue.appendChild(option);});}else{let textMarkerEditorValue=document.createElement('input');textMarkerEditorValue.setAttribute('type','text');textMarkerEditorValue.setAttribute('class','marker_editor_value');textMarkerEditorValue.setAttribute('autocomplete','off');textMarkerEditorValue.setAttribute('value',''+m.value);textMarkerEditorValue.setAttribute('onchange','markerEditorSetValue('+i+')');markerEditorMarker.appendChild(textMarkerEditorValue);}
if(s.isBlendable){let markerEditorBlend=document.createElement('div');markerEditorBlend.setAttribute('class','button marker_editor_blend');markerEditorBlend.setAttribute('title','Blend to this marker');markerEditorBlend.setAttribute('onclick','markerEditorToggleBlend('+i+')');if(m.blend)markerEditorBlend.classList.add('selected');markerEditorMarker.appendChild(markerEditorBlend);}
markerEditorMarker.appendChild(buttonReset);markerEditorMarker.appendChild(buttonDelete);markersElement.appendChild(markerEditorMarker);}}
function clickXToMarkerTime(clickX){return snapMarkerTime(clickToNoteX(clickX));}
function openMarkerEditor(clickX){if(!$(markerEditor).is(':visible')){$(markerEditor).css({left:clickX-180});}
openMarkerEditorAtTime(clickXToMarkerTime(clickX));}
function setMarkerEditorInstrumentInput(newInstrument){const markerInstrumentInput=document.getElementById('marker_instrument');markerInstrumentInput.value=newInstrument;$(markerInstrumentInput).change();refreshSelectMenu('#marker_instrument');}
function openMarkerEditorAtTime(time){if(isPlayerMode)return;markerEditorTime=time;$(markerEditor).show();$(markerEditor).draggable();$(markerEditor).draggable('option','height','auto');$(markerBar).show();updateBarOverlayLocations();updateMarkerEditor();updateMarkers();setMarkerEditorInstrumentInput(instrument);}
function mouseDownMarkerBar(event){setClickTarget(event,kClickTargetMarkerBar);setMouseClickXY(event);markerBarDragSelect=false;clickedMarker=false;event.stopPropagation();if(getButton(event)==primaryButton){let add=event.shiftKey;let clickTime=clickXToMarkerTime(event.clientX);let markersAtClickTime=new Set(song.getAllMarkersAtTime(clickTime));gMarkersAtClickTime=markersAtClickTime;if(markersAtClickTime.size>0){clickedMarker=true;openMarkerEditor(event.clientX);let selectedMarkersAtClickTime=[];for(const marker of markersAtClickTime){if(selection.isMarkerSelected(marker)){selectedMarkersAtClickTime.push(marker);}}
if(selectedMarkersAtClickTime.length==0){if(add){(function(markersToSelect){exec(function(){for(const marker of markersToSelect){selection.selectMarker(marker);}
updateSelection();},function(){for(const marker of markersToSelect){selection.deselectMarker(marker);}
updateSelection();});})(markersAtClickTime);}else{(function(oldNotes,oldMarkers,newMarkers){exec(function(){selection.clear();selection.setMarkers(newMarkers);updateSelection();},function(){selection.setNotes(oldNotes);selection.setMarkers(oldMarkers);updateSelection();});})(selection.notes,selection.markers,markersAtClickTime);}}else if(add){(function(markersToDeselect){exec(function(){for(const marker of markersToDeselect){selection.deselectMarker(marker);}
updateSelection();},function(){for(const marker of markersToDeselect){selection.selectMarker(marker);}
updateSelection();});})(selectedMarkersAtClickTime);}
dragSelection(null,clickTime);}else{if(!add)selectNone();$(markerRect).show();markerRect.style.width='0px';}}else{openMarkerEditor(event.clientX);}
event.preventDefault();}
function mouseMoveMarkerBar(event){if(getButton(event)==primaryButton){if(clickedMarker){updateDragNotes(event.clientX,mouseClickY(),mouseX,mouseClickY());}else{markerBarDragSelect=true;const a=snapMarkerTime(noteClickX);const b=clickXToMarkerTime(event.clientX);markerRect.style.left=(noteWidth*Math.min(a,b))+'px';markerRect.style.width=(noteWidth*(1+Math.abs(a-b)))+'px';}}}
function mouseUpMarkerBar(event){$(markerRect).hide();if(getButton(event)==primaryButton){if(markerBarDragSelect){const boxStart=snapMarkerTime(noteClickX);const boxEnd=clickXToMarkerTime(event.clientX);const from=Math.min(boxStart,boxEnd);const to=Math.max(boxStart,boxEnd);let add=event.shiftKey;let newMarkers=add?new Set(selection.markers):new Set();let newNotes=add?selection.notes:[];let changed=!add&&selection.hasNotes();for(let t=from;t<=to;++t){for(const marker of song.getAllMarkersAtTime(t)){if(!newMarkers.has(marker)){changed=true;newMarkers.add(marker);}}}
if(changed){(function(oldMarkers,oldNotes,newMarkers,newNotes){exec(function(){selection.setNotes(newNotes);selection.setMarkers(newMarkers);updateSelection();},function(){selection.setNotes(oldNotes);selection.setMarkers(oldMarkers);updateSelection();});})(selection.markers,selection.notes,newMarkers,newNotes);}}else{openMarkerEditor(event.clientX);applyDrag(event,true);}}}
function markerEditorClose(){$(markerEditor).hide();$(markerBar).hide();updateBarOverlayLocations();updateMarkers();}
function markerEditorAdd(){const setting=parseInt(markerTypeInput.value);let instId=parseInt(document.getElementById('marker_instrument').value);if(!kMarkerEditorSettings[setting].isPerInstrument)instId=0;const initVal=kMarkerEditorSettings[setting].getInitialValue(instId);song.setInitialMarkerValue(setting,instId,initVal);const tracker=song.trackMarkerSetting(setting,instId,markerEditorTime);if(tracker.prev&&tracker.prev.time==markerEditorTime)return;const blend=tracker&&tracker.next?tracker.next.blend:false;let value=tracker?tracker.value:initVal;if(kMarkerEditorSettings[setting].isInt)value=Math.floor(value);addMarker(markerEditorTime,setting,instId,value,blend);}
function markerEditorReset(i){const m=markerEditorMarkers[i];const initVal=kMarkerEditorSettings[m.setting].getInitialValue(m.instrument);setMarkerValue(m,initVal);}
function markerEditorDelete(i){removeMarker(markerEditorMarkers[i]);}
function markerEditorSelectMarker(i){toggleMarkerSelect(markerEditorMarkers[i]);}
function markerEditorSetValue(i){const m=markerEditorMarkers[i];const setting=m.setting;const instId=m.instrument;const s=kMarkerEditorSettings[setting];const input=document.getElementById('marker_editor_markers').getElementsByClassName('marker_editor_value')[i];let value;if(s.isBool){value=input.classList.contains('enabled')?0:1;}else if(s.isEnum){value=input.value;}else{if(s.isInt){value=parseInt(input.value);}else{value=parseFloat(input.value);}
if(isNaN(value)){const initVal=kMarkerEditorSettings[setting].getInitialValue(instId);song.setInitialMarkerValue(setting,instId,initVal);value=song.trackMarkerSetting(setting,instId,m.time).value;if(s.isInt)value=Math.floor(value);}else if(value<s.min){value=s.min;}else if(value>s.max){value=s.max;}
input.value=value;}
setMarkerValue(m,value);}
function markerEditorToggleBlend(i){toggleMarkerBlend(markerEditorMarkers[i]);}
function updateVariableBpmTimes(){variableBpmTimes=[];let tracker=null;let t=0;for(let i=0;;++i){tracker=song.trackMarkerSetting(kMarkerSettingBpm,0,i,tracker);const dt=15000.0/tracker.value;variableBpmTimes.push({t:t,dt:dt});if(tracker.next==null)break;t+=dt;}
if(variableBpmTimes.length==0)variableBpmTimes=null;updateMeasures();}
function onMultiMarkerValueChange(bpmChanged,updateEditor=true){if(updateEditor)updateMarkerEditor();if(bpmChanged)updateVariableBpmTimes();}
function onMarkerValueChange(setting,updateEditor=true){onMultiMarkerValueChange(setting===kMarkerSettingBpm,updateEditor);}
function addMarker(time,setting,instId,value,blend){const change={newMarker:new Marker(song,time,setting,instId,value,blend),};(function(change){exec(function(){song.addMarker(change.newMarker);onMarkerValueChange(change.newMarker.setting);},function(){song.removeMarker(change.newMarker);onMarkerValueChange(change.newMarker.setting);});})(change);setConfirmExit(true);return change.newMarker;}
function removeMarker(marker){const isSelected=selection.isMarkerSelected(marker);(function(marker){exec(function(){song.removeMarker(marker);if(isSelected)selection.deselectMarker(marker);onMarkerValueChange(marker.setting);},function(){song.addMarker(marker);if(isSelected)selection.selectMarker(marker);onMarkerValueChange(marker.setting);});})(marker);setConfirmExit(true);}
function toggleMarkerSelect(marker){if(selection.isMarkerSelected(marker)){(function(marker){exec(function(){selection.deselectMarker(marker);updateMarkerEditor();},function(){selection.selectMarker(marker);updateMarkerEditor();});})(marker);}else{(function(marker){exec(function(){selection.selectMarker(marker);updateMarkerEditor();},function(){selection.deselectMarker(marker);updateMarkerEditor();});})(marker);}}
function toggleMarkerBlend(marker){(function(marker){exec(function(){song.toggleMarkerBlend(marker);onMarkerValueChange(marker.setting);},function(){song.toggleMarkerBlend(marker);onMarkerValueChange(marker.setting);});})(marker);setConfirmExit(true);}
function setMarkerValue(marker,newValue,updateEditor=true){if(marker.value==newValue)return;const change={marker:marker,oldValue:marker.value,newValue:newValue,};(function(change){exec(function(){song.setMarkerValue(change.marker,change.newValue);onMarkerValueChange(change.marker.setting,updateEditor);},function(){song.setMarkerValue(change.marker,change.oldValue);onMarkerValueChange(change.marker.setting,updateEditor);});})(change);setConfirmExit(true);}
function getInitialInstrumentVolume(instId){return initialInstrumentVolume.get(parseInt(instId))??1;}
function updateMarkerSetting(setting,instId,timeIdx){let mst=markerSettingTrackers[setting];if(mst==null)mst=markerSettingTrackers[setting]=new Map();let tracker=song.trackMarkerSetting(setting,instId,timeIdx,mst.get(instId));mst.set(instId,tracker);if(tracker.changed){kMarkerEditorSettings[setting].setValue(instId,tracker.value);}}
function blendMarkerSetting(setting,instId,dt){let mst=markerSettingTrackers[setting];if(mst==null)return;let tracker=mst.get(instId);if(tracker!=null&&tracker.changed&&tracker.value!=tracker.nextValue){kMarkerEditorSettings[setting].blendValue(instId,tracker.nextValue,dt);}}
function openUserSettings(){$('#user_settings').show();$('#user_settings').draggable();}
function updateUserSetting(id,name,value){settings.user[name]=value;if(settings.uid>0){$.get('/app/api/user_settings.php',{'setting_id':id,'value':value});}}
function getCopyString(notes,markers,minTime){let string=settings.clipboardMagicString+':'+instanceId+':';for(const note of notes){string+=note.toString(minTime)+';';}
string+=':';for(const marker of markers){string+=marker.toString(minTime)+';';}
return string;}
function cut(){copy(false);if(selection.isEmpty()){message('Select some notes or markers to cut first.',3,true);}else{message(selection.describe()+' cut.',3,true);}
deleteSelection();updateSelection();}
function cloneNote(note){return new Note(song,note.type,note.time,note.length,note.instrument,note.volume);}
function cloneMarker(marker){return new Marker(marker.song,marker.time,marker.setting,marker.instrument,marker.value,marker.blend);}
function copy(showMessage){clipboard.notes=[];clipboard.markers=[];for(const note of selection.notes){clipboard.notes.push(cloneNote(note));}
for(const marker of selection.markers){clipboard.markers.push(cloneMarker(marker));}
if(showMessage){if(selection.isEmpty()){message('Select some notes or markers to copy first.',3,true);}else{message(selection.describe()+' copied.',3,true);}}}
function paste(pasteAtCursor=false){if((clipboard.notes.length+clipboard.markers.length)>0){let msg='';if(clipboard.notes.length>0){msg+=clipboard.notes.length+' note'+
(clipboard.notes.length==1?'':'s');}
if(clipboard.markers.length>0){if(msg.length>0)msg+=' and';msg+=' '+clipboard.markers.length+' marker'+
(clipboard.markers.length==1?'':'s');}
message(msg+' pasted. Drag them to change their position.',3,true);}else{message('Nothing to paste. Use Ctrl-V if pasting from another sequence.',3,true);return;}
if(pasteAtCursor){let earliestTime=Infinity;for(const note of clipboard.notes){earliestTime=Math.min(earliestTime,note.time);}
for(const marker of clipboard.markers){earliestTime=Math.min(earliestTime,marker.time);}
const mouseTime=Math.max(timeIndex(xPosition(mouseX)),0);const offset=mouseTime-earliestTime;for(const note of clipboard.notes){note.time+=offset;}
for(const marker of clipboard.markers){marker.time+=offset;}}
setConfirmExit(true);pasteImpl(clipboard.notes,clipboard.markers);}
function pasteImpl(newNotes,newMarkers){const oldSelectedNotes=selection.notes;const oldSelectedMarkers=selection.markers;exec(function(){selection.clear();for(const note of newNotes){song.addNote(note,true);selection.selectNote(note);}
let bpmChanged=false;for(const marker of newMarkers){song.addMarker(marker);selection.selectMarker(marker);if(marker.setting==kMarkerSettingBpm)bpmChanged=true;}
updateSelection();onMultiMarkerValueChange(bpmChanged);if(newNotes.length>0){song.updateLoopTime();SequencerView.repaint(kRepaintNotesMoved);}
copy(false);},function(){song.removeNotes(newNotes);let bpmChanged=false;for(const marker of newMarkers){song.removeMarker(marker);if(marker.setting==kMarkerSettingBpm)bpmChanged=true;}
selection.clear();selection.setNotes(oldSelectedNotes);selection.setMarkers(oldSelectedMarkers);updateSelection();onMultiMarkerValueChange(bpmChanged);if(newNotes.length>0){SequencerView.repaint(kRepaintNotesMoved);}});}
function checkKeyModifiers(event,ctrl,alt,shift){return((event.ctrlKey||event.metaKey)==ctrl)&&(event.altKey==alt)&&(event.shiftKey==shift);}
function onkeydown(event){if(event.code==null)return;const code=event.keyCode;if(checkKeyModifiers(event,true,false,false)){if(code==65){selectAll();event.preventDefault();}else if(code==88&&!isPlayerMode){cut();}else if(code==67){copy(true);$('#btn_copy').click();container.focus();}else if(code==90&&!isPlayerMode){undoChange();event.preventDefault();}else if(code==89&&!isPlayerMode){redoChange();event.preventDefault();}else if(code==48){zoomDefault();event.preventDefault();}else if(code==187){zoomIn();event.preventDefault();}else if(code==189){zoomOut();event.preventDefault();}else if(code==83){if(isPlaylistMode){toggleShuffle();}else{save(true);}
event.preventDefault();}else if(code==37){if(isPlaylistMode){previousSequence();}else{bumpSelection(selection.hasNotes()?-1/grid:-1,0);}
event.preventDefault();}else if(code==38){bumpSelection(0,-1);event.preventDefault();}else if(code==39){if(isPlaylistMode){nextSequence();}else{bumpSelection(selection.hasNotes()?1/grid:1,0);}
event.preventDefault();}else if(code==40){bumpSelection(0,1);event.preventDefault();}else if(code==35&&!isPlayerMode){selectByTimeRange(timeIndex(xPosition(mouseX)),Infinity,false,false);event.preventDefault();}else if(code==36&&!isPlayerMode){selectByTimeRange(0,timeIndex(xPosition(mouseX)),false,false);event.preventDefault();}else if(code==76){if(isPlaylistMode){cycleLoop();}else{legatomizeNotes();}
event.preventDefault();}
return;}else if(checkKeyModifiers(event,false,true,false)){if(code>=49&&code<=54&&!isPlayerMode){gridSelect.value=['0.5','1','2','4','0.75','1.5'][code-49];refreshSelectMenu('#grid_select');setGrid(parseFloat(gridSelect.value));}else if((code==187||code==61)&&!isPlayerMode){setNoteVolume(-1);}else if((code==189||code==173)&&!isPlayerMode){setNoteVolume(1);}else if(code==48&&!isPlayerMode){setNoteVolume(1,true);}
event.preventDefault();}else if(checkKeyModifiers(event,true,true,false)){if(code==67){cutNotesAtGrid();event.preventDefault();}else if(code==86){paste(true);event.preventDefault();}else if(code==35){selectByTimeRange(timeIndex(xPosition(mouseX)),Infinity,false,true);event.preventDefault();}else if(code==36){selectByTimeRange(0,timeIndex(xPosition(mouseX)),false,true);event.preventDefault();}
return;}else if(checkKeyModifiers(event,true,false,true)){if(code==90&&!isPlayerMode){redoChange();}else if(code==38&&!isPlayerMode){bumpSelection(0,-12);}else if(code==40&&!isPlayerMode){bumpSelection(0,12);}else if(code==37&&!isPlayerMode){bumpSelection(-4*getTimeSig(),0);}else if(code==39&&!isPlayerMode){bumpSelection(4*getTimeSig(),0);}else if(code==35){selectByTimeRange(timeIndex(xPosition(mouseX)),Infinity,true,false);event.preventDefault();}else if(code==36){selectByTimeRange(0,timeIndex(xPosition(mouseX)),true,false);event.preventDefault();}
return;}else if(checkKeyModifiers(event,false,false,true)){if(instrumentShortcuts.has(code)){const instrumentSelect=document.getElementById('instrument_select');let menuPopupElement=$(instrumentSelect).instrumentmenu('menuWidget')[0];let activeItemId=$(instrumentSelect).instrumentmenu('menuWidget')[0].getAttribute('aria-activedescendant');if(activeItemId==null){return;}
if(instrumentShortcuts.has(code)){let oldShortcut=instrumentShortcuts.get(code);let oldChip=$('[data-instrument="'+oldShortcut+'"] > .instrument-menu-chip')[0];oldChip.innerText='';}
let activeItem=$('#'+activeItemId);let instId=activeItem.attr('data-instrument');instrumentShortcuts.set(code,parseInt(instId));let newChip=$('[data-instrument="'+instId+'"] > .instrument-menu-chip')[0];newChip.innerText=getShortcutChar(code);message('Added shortcut '+getShortcutChar(code)+' for '+
getInstrumentName(song,instId));let shortcutsSetting={};for(let code of instrumentShortcuts.keys()){shortcutsSetting[code]=instrumentShortcuts.get(code);}
let shortcutsJson=JSON.stringify(shortcutsSetting);if(updateSettingsTimeout!=null){clearTimeout(updateSettingsTimeout);updateSettingsTimeout=null;}
updateSettingsTimeout=setTimeout(function(){updateUserSetting(4,'shortcuts',shortcutsJson);},2000);}}else if(checkKeyModifiers(event,false,false,false)){if((code==8||code==46)&&!isPlayerMode){deleteSelection();return false;}else if(instrumentShortcuts.has(code)){selectInstrument(instrumentShortcuts.get(code));}else if(code==32){if(!song.playing){song.play(isPlayerMode?playTime:lastPlayTime);}else{song.stop();}
return false;}else if(code==13){if(!song.playing){song.play(0);}else{song.stop();}}else if(code==9){if(hoveringOnOptions){const instrumentOptionsTabSimple=document.getElementById('instrument_options_tab_simple');const instrumentOptionsTabAdvanced=document.getElementById('instrument_options_tab_advanced');const instrumentOptionsSimple=document.getElementById('instrument_options_simple');const instrumentOptionsAdvanced=document.getElementById('instrument_options_advanced');if(instrumentOptionsTabAdvanced.classList[0]=='selected'){instrumentOptionsTabSimple.classList.add('selected');instrumentOptionsSimple.style.display='block';instrumentOptionsTabAdvanced.classList.remove('selected');instrumentOptionsAdvanced.style.display='none';fillSimpleInstrumentSettings();}else{instrumentOptionsTabAdvanced.classList.add('selected');instrumentOptionsAdvanced.style.display='block';instrumentOptionsTabSimple.classList.remove('selected');instrumentOptionsSimple.style.display='none';fillAdvancedInstrumentSettings();};}else{setMode(mode=='draw'?'edit':'draw');}
event.preventDefault();}else if(code==27){selectNone();}else if(code==36){setScrollLeft(0,true);event.preventDefault();}else if(code==35){setScrollLeft(song.loopTime*noteWidth,true);event.preventDefault();}}
if(event.repeat)return;const note=getKeyboardNote(event.code);if(note==null)return;if(!isPlayerMode){playNote(instrument,note,instMgr.isSustained(instrument)?undefined:1);}
if(isRecordingKeyboard(event)){const recordNote=newRecordedNote(note);if(recordNote!=null){(function(recordNote){exec(function(){song.addNote(recordNote);sustainedKeyboardNotes[audioSystem.manuallyTrackedNoteKey(instrument,recordNote.type)]=new SustainedNote(recordNote,currentTimeMs(),true);SequencerView.repaint(kRepaintNotesMoved);},function(){song.removeNote(recordNote);SequencerView.repaint(kRepaintNotesMoved);});})(recordNote);setConfirmExit(true);}
event.preventDefault();event.stopPropagation();}}
function onkeyup(event){let note=getKeyboardNote(event.code);if(note==null||!instMgr.isSustained(instrument))return;noteOff(instrument,note);if(isRecordingKeyboard(event)){let noteKey=audioSystem.manuallyTrackedNoteKey(instrument,note);let sn=sustainedKeyboardNotes[noteKey];if(sn!=null){releaseSustainedNote(sn.note,currentTimeMs(),sn.startTimeMs);}}}
function isRecordingKeyboard(event){return(checkKeyModifiers(event,false,true,false)||song.recording)&&song.playing&&!isPlayerMode;}
function getKeyboardNote(keyCode){if(keyCode.startsWith('Key')){keyCode=keyCode.substr(3).toLowerCase();}else{const punct=settings.punctuationCodes[keyCode];if(punct!=null)keyCode=punct;}
if(keyCode.length>1)return null;const _scale=scale.length?scale:settings.scales[1];const _scaleId=settings.scales.indexOf(_scale);for(let i=0;i<settings.typingKeyboard.length;++i){const row=settings.typingKeyboard[i];const idx=row.indexOf(keyCode);if(idx!=-1){let n=i+instMgr.getTypingKeyboardOctaveOffset(instrument);if(idx>settings.scaleOctaves[_scaleId]+7){n+=2;}else if(idx>settings.scaleOctaves[_scaleId]){n+=1;}
return _scale[idx]+n;}}
return null;}
function getShortcutChar(code){switch(code){case 189:return'-';case 187:return'=';default:return String.fromCharCode(code);}}
function createKey(t){const div=document.createElement('div');const div_t=document.createElement('div');div_t.innerHTML=t;div_t.className='key_text';const div_h=document.createElement('div');div_h.id='key_highlight_'+t;div.appendChild(div_h);div.appendChild(div_t);keyTextElements.push(div_t);div.className=t.length==3?'key_sharp':'key';$(div).on('vmousedown',function(){setClickTarget(event,kClickTargetKeyboard);const btn=getButton(event);if(btn==1&&!isPlayerMode){if(instMgr.isSustained(instrument)){playNote(instrument,t,undefined);}else{playNote(instrument,t,1);}}});$(div).on('vmouseup',function(){if(getClickTarget(event)==kClickTargetKeyboard){const btn=getButton(event);if(btn==1&&!isPlayerMode&&instMgr.isSustained(instrument)){noteOff(instrument,t);}}});$(div).on('vmouseover',function(){if(getClickTarget(event)==kClickTargetKeyboard&&!isPlayerMode){if(instMgr.isSustained(instrument)){playNote(instrument,t,undefined);}else{playNote(instrument,t,1);}}});$(div).on('vmouseout',function(){if(getClickTarget(event)==kClickTargetKeyboard&&!isPlayerMode&&instMgr.isSustained(instrument)){noteOff(instrument,t);}});return div;}
function displayKeys(){for(const key of piano){const leftElement=createKey(key);keyboard.appendChild(leftElement);keyElements.push(leftElement);}}
function updateKeys(){for(let i=0;i<keyTextElements.length;i++){const j=settings.numNotes-i-1;keyTextElements[i].innerHTML=instMgr.getNoteName(instrument,j);}}
function setNoteSize(){const kRuleKey=0;const rule=mainStylesheet.cssRules[kRuleKey];console.assert(rule.selectorText=='.key, .key_sharp, .key div, .key_sharp div');rule.style.height=noteHeight+'px';rule.style.lineHeight=noteHeight+'px';rule.style.fontSize=(noteHeight*0.625)+'px';sequencer.style.height=(piano.length*noteHeight)+'px';playhead.style.width=noteWidth+'px';updateMeasures();updateGridImage();}
function updateGridImage(){if(!SequencerView.isGL()){const image=createGridImage(grid,getTimeSig());SequencerView.setGrid(image,noteWidth*4*getTimeSig());}}
function zoom(vx,vy){vx=clamp(vx,0.03,15);vy=clamp(vy,0.03,15);oldZoomX=zoomLevelX;oldZoomY=zoomLevelY;zoomLevelX=vx;zoomLevelY=vy;vx=SequencerView.snapZoomLevelX(vx);vy=SequencerView.snapZoomLevelY(vy);noteWidth=25*vx;noteHeight=16*vy;let minNoteHeight=(containerRect.height-kScrollbarWidth)/piano.length;noteHeight=Math.max(minNoteHeight,noteHeight);setNoteSize();updateWavesurferWidth(true);updateCanvasWidth();scrollMeasures();return[zoomLevelX/oldZoomX,zoomLevelY/oldZoomY];}
function zoomAndScroll(x,y,factorX,factorY){if(x==null)x=container.clientWidth/2;if(y==null)y=container.clientHeight/2;const[trueFactorX,trueFactorY]=zoom(zoomLevelX*factorX,zoomLevelY*factorY);const zx=(1-1/trueFactorX)*trueFactorX;const zy=(1-1/trueFactorY)*trueFactorY;setScrollLeft(scrollLeft+(scrollLeft+x)*zx,true);container.scrollTop=container.scrollTop+(container.scrollTop+y)*zy;}
function updateSelectionRectangle(mouseX,mouseY){if(mouseButton==primaryButton&&mode=='edit'&&!clickedNote){selectionRect.style.display='block';const mcx=mouseClickX();const mcy=mouseClickY();selectionRect.style.left=xPosition(Math.min(mcx,mouseX))+'px';selectionRect.style.width=Math.abs(mcx-mouseX)+'px';selectionRect.style.top=yPosition(Math.min(mcy,mouseY))+'px';selectionRect.style.height=Math.abs(mcy-mouseY)+'px';}}
function updateDragNotes(mouseX,mouseY,prevMouseX,prevMouseY){if(mouseX==prevMouseX&&mouseY==prevMouseY)return;const dx=mouseX-mouseClickX();const dy=mouseY-mouseClickY();if(dragNotes.length>0){for(const dragNote of dragNotes){if(dragDraw){dragNote.length=Math.max(timeIndexRound(xPosition(mouseX))-dragNote.time,1/grid);lastNoteLength.set(instrument,dragNote.length);}else{dragNote.offsetX=dx;dragNote.offsetY=dy;}}
SequencerView.repaint(kRepaintNotesMoved);}
if(dragMarkers.size>0){dragMarkersOffsetX=dx;updateMarkers();}}
function updateResizeNotes(mouseX,mouseY,prevMouseX,prevMouseY){if(mouseX==prevMouseX&&mouseY==prevMouseY)return;if(resizeNotes.length>0){const dx=mouseX-mouseClickX();for(const resizeNote of resizeNotes){resizeNote.offsetWidth=dx;}
SequencerView.repaint(kRepaintNotesMoved);}}
function message(text,timeInSeconds=3,force=false){if(force){messageQueue=[];displayCurrentMessage([text,timeInSeconds]);return;}
messageQueue.push([text,timeInSeconds]);if(!inMessage){displayCurrentMessage();inMessage=true;}}
function displayCurrentMessage(forceMsg=null){if(messageTimeoutId!=null||forceMsg!=null){window.clearTimeout(messageTimeoutId);}
const[text,timeInSeconds]=forceMsg===null?messageQueue.shift():forceMsg;const messageWrapper=document.getElementById('message_wrapper');const messageText=document.getElementById('message_text');messageText.innerText=text;messageWrapper.style.display='block';messageTimeoutId=window.setTimeout(function(){messageWrapper.style.display='none';if(messageQueue.length>0){displayCurrentMessage();}else{inMessage=false;}},timeInSeconds*1000);}
function updateWavesurferWidth(redraw){if(audioSystem.audioTrack!=null){const renderWidth=Math.round(audioSystem.audioTrack.duration/(song.sleepTime/1000)*(noteWidth)/wavesurferScale);const displayWidth=Math.round(renderWidth*wavesurferScale);wavesurfer.style.width=Math.round(renderWidth)+'px'
if(redraw){wavesurferObj.drawBuffer();}
else if(renderWidth>32767){message('Waveform is too long to display. Try zooming out or lowering the BPM.',3,true);}
$('#wavesurfer_element canvas').attr('style','position: absolute; z-index: 1337; width: '+displayWidth+'px !important; height: 32px;');wavesurfer.style.width=displayWidth+'px';}}
function updateMeasures(){const measureWidth=Math.round(noteWidth*4*getTimeSig());const count=Math.ceil(containerRect.width/measureWidth)+1;const start=Math.floor(container.scrollLeft/measureWidth);const kRuleMeasure=1;while(timeline.childElementCount>0){timeline.children[0].remove();}
for(let i=0;i<count;i++){const measure=document.createElement('div');measure.className='measure';measure.innerHTML=displayMeasureTime?formatTime((start+i)*4*getTimeSig()):start+i+1;timeline.appendChild(measure);measure.onmouseover=measure.onmousemove=event=>{measure.title=formatTime(clickToNoteX(event.clientX));};}
const rule=mainStylesheet.cssRules[kRuleMeasure];console.assert(rule.selectorText=='.measure');rule.style.minWidth=measureWidth+'px';updateMarkers();}
function scrollMeasures(){const measureWidth=noteWidth*4*getTimeSig();const start=Math.floor(container.scrollLeft/measureWidth);const left=container.scrollLeft%measureWidth;timeline.style.left=(-left)+'px';if(start!=timelineStartMeasure){timelineStartMeasure=start;for(let i=0;i<timeline.children.length;i++){timeline.children[i].innerHTML=displayMeasureTime?formatTime((start+i)*4*getTimeSig()):start+i+1;}}
updateMarkers();}
function noteTimeToMs(noteTime){if(variableBpmTimes==null)return Math.round(noteTime*song.sleepTime);let i=Math.floor(noteTime);if(i<=0)return 0;if(i>=variableBpmTimes.length)i=variableBpmTimes.length-1;const v=variableBpmTimes[i];return Math.round(v.t+(noteTime-i)*v.dt);}
function formatTime(noteTime){const ms=noteTimeToMs(noteTime);const seconds=Math.floor(ms/1000);const minutes=Math.floor(seconds/60);return minutes.toString().padStart(2,'0')+':'+
(seconds-minutes*60).toString().padStart(2,'0')+'.'+
(ms-seconds*1000).toString().padStart(3,'0');}
function getSongLengthInSeconds(){return noteTimeToMs(song.loopTime)/1000;}
function setMode(m){const previous=document.getElementById('mode_'+mode);if(previous!=null){previous.className='btn tooltipstered';}
mode=m;const newMode=document.getElementById('mode_'+mode);if(newMode!=null){newMode.className='active tooltipstered'}}
function zoomIn(x,y,onlyX){zoomAndScroll(x,y,zoomFactor,onlyX?1:zoomFactor);}
function zoomOut(x,y,onlyX){zoomAndScroll(x,y,1/zoomFactor,onlyX?1:1/zoomFactor);}
function zoomDefault(x,y){zoomAndScroll(x,y,1/zoomLevelX,1/zoomLevelY);}
function zoomUpdate(){zoomAndScroll(null,null,1,1);}
function selectInstrument(instId){const instrumentSelect=document.getElementById('instrument_select');instrumentSelect.value=instId;$(instrumentSelect).change();refreshSelectMenu('#instrument_select');onInstrumentSelect(instId);}
function setSimpleInstrumentSettingsLockState(instId,locked){const element=document.getElementById('instrument_name_'+instId);if(element==null)return;element.className=locked?'instrument_name_locked':'instrument_name';}
function lockInstrumentButton(instId,event){if(event&&event.ctrlKey){let allOthersLocked=true;instMgr.forEach(i=>{if(i!=instId&&!instMgr.isLocked(i))allOthersLocked=false;});instMgr.forEach(i=>{setSimpleInstrumentSettingsLockState(i,instMgr.setLocked(i,i!=instId&&!allOthersLocked));});SequencerView.repaint(kRepaintNotesChanged);fillAdvancedInstrumentSettings();}else{lockInstrument(instId);}}
function lockInstrument(instId){setSimpleInstrumentSettingsLockState(instId,instMgr.toggleLocked(instId));SequencerView.repaint(kRepaintNotesChanged);fillAdvancedInstrumentSettings();}
function selectDelay(instId){song.getInstrumentSettings(instId).delay=!song.getInstrumentSettings(instId).delay;updateDelay(instId);}
function updateDelay(instId){const delay=song.getInstrumentSettings(instId).delay;song.setInitialMarkerValue(kMarkerSettingInstrumentDelay,instId,delay?1:0);audioSystem.setDelay(instId,delay);setConfirmExit(true);if(delay){$('#instrument_delay_'+instId).addClass('enabled');document.getElementById('instrument_options_advanced_delay').classList.add('enabled');}else{$('#instrument_delay_'+instId).removeClass('enabled');document.getElementById('instrument_options_advanced_delay').classList.remove('enabled');}}
function selectReverb(instId){song.getInstrumentSettings(instId).reverb=!song.getInstrumentSettings(instId).reverb;updateReverb(instId);}
function selectReverbType(instId,reverbType){song.getInstrumentSettings(instId).reverb=true;song.getInstrumentSettings(instId).reverbType=Math.max(1,reverbType);updateReverb(instId);}
function setReverbVolume(instId,value){song.getInstrumentSettings(instId).reverbVolume=parseFloat(value);updateReverb(instId);}
function updateReverb(instId){const instSettings=song.getInstrumentSettings(instId);const reverb=instSettings.reverb;const reverbType=instSettings.reverbType;const reverbValue=reverb?reverbType:0;const reverbVolume=instSettings.reverbVolume;song.setInitialMarkerValue(kMarkerSettingInstrumentReverb,instId,reverbValue);song.setInitialMarkerValue(kMarkerSettingInstrumentReverbVolume,instId,reverbVolume);audioSystem.setReverb(instId,reverbValue);audioSystem.setReverbVolume(instId,reverbVolume);setConfirmExit(true);reverbButton.innerText=kReverbData[reverbType].shortName;reverbSelect.value=reverbType;reverbVolumeSlider.value=reverbVolume;if(reverb){$('#instrument_reverb_'+instId).addClass('enabled');reverbButton.classList.add('enabled');reverbSelectButton.classList.add('enabled');reverbVolumeSliderWrap.classList.add('enabled');}else{$('#instrument_reverb_'+instId).removeClass('enabled');reverbButton.classList.remove('enabled');reverbSelectButton.classList.remove('enabled');reverbVolumeSliderWrap.classList.remove('enabled');}}
function selectDistort(instId){song.getInstrumentSettings(instId).distort=!song.getInstrumentSettings(instId).distort;updateDistort(instId);}
function selectDistortType(instId,distortType){song.getInstrumentSettings(instId).distort=true;song.getInstrumentSettings(instId).distortType=Math.max(1,distortType);updateDistort(instId);}
function setDistortVolume(instId,value){song.getInstrumentSettings(instId).distortVolume=parseFloat(value);updateDistort(instId);}
function updateDistort(instId){const instSettings=song.getInstrumentSettings(instId);let distort=instSettings.distort;let distortType=instSettings.distortType;let distortKind=distort?distortType:0;let distortVolume=instSettings.distortVolume;audioSystem.setDistort(instId,distortKind,distortVolume);setConfirmExit(true);distortButton.innerText=kDistortData[distortType].name;distortSelect.value=distortType;distortVolumeSlider.value=distortVolume;if(distort){distortButton.classList.add('enabled');distortSelectButton.classList.add('enabled');distortVolumeSliderWrap.classList.add('enabled');}else{distortButton.classList.remove('enabled');distortSelectButton.classList.remove('enabled');distortVolumeSliderWrap.classList.remove('enabled');}}
function setInitialSongVolume(value){song.setVolume(value);song.setInitialMarkerValue(kMarkerSettingVolume,0,value);currentSongVolume=value;updateVolume();setConfirmExit(true);}
function updateVolume(){audioSystem.setVolume(currentSongVolume);audioSystem.setFinalVolume(isPlayerMode?parseFloat($('#volume_slider').val()):1.0);}
function setPan(instId,value){song.getInstrumentSettings(instId).pan=value;song.setInitialMarkerValue(kMarkerSettingInstrumentPanning,instId,value);setConfirmExit(true);updatePan(instId);}
function updatePan(instId){const pan=song.getInstrumentSettings(instId).pan;audioSystem.setPan(instId,pan);document.getElementById('instrument_options_advanced_pan').value=pan;}
function setDetune(instId,value){value=parseFloat(value);song.getInstrumentSettings(instId).detune=value;song.setInitialMarkerValue(kMarkerSettingInstrumentDetune,instId,value);updateDetune(instId);}
function updateDetune(instId){const detune=parseFloat(song.getInstrumentSettings(instId).detune);audioSystem.setDetune(instId,detune);document.getElementById('instrument_options_advanced_detune').value=detune;}
function selectEq(instId){song.getInstrumentSettings(instId).eq.enabled=!song.getInstrumentSettings(instId).eq.enabled;setConfirmExit(true);updateEq(instId);}
function setEqLow(instId,value){song.getInstrumentSettings(instId).eq.low=value;song.setInitialMarkerValue(kMarkerSettingInstrumentEqLow,instId,value);setConfirmExit(true);updateEq(instId);}
function setEqMid(instId,value){song.getInstrumentSettings(instId).eq.mid=value;song.setInitialMarkerValue(kMarkerSettingInstrumentEqMid,instId,value);setConfirmExit(true);updateEq(instId);}
function setEqHigh(instId,value){song.getInstrumentSettings(instId).eq.high=value;song.setInitialMarkerValue(kMarkerSettingInstrumentEqHigh,instId,value);setConfirmExit(true);updateEq(instId);}
function updateEq(instId){const eq=song.getInstrumentSettings(instId).eq;audioSystem.setEq(instId,eq.enabled,eq.low,eq.mid,eq.high);document.getElementById('instrument_options_advanced_eq_low').value=eq.low;document.getElementById('instrument_options_advanced_eq_mid').value=eq.mid;document.getElementById('instrument_options_advanced_eq_high').value=eq.high;if(eq.enabled){document.getElementById('instrument_options_advanced_eq').classList.add('enabled');}else{document.getElementById('instrument_options_advanced_eq').classList.remove('enabled');}}
function setSynthType(instId,value,refresh=true,reload=true){song.settings.instruments[instId].synth.type=value;updateSynthType(instId,refresh,reload);}
function updateSynthType(instId,refresh=true,reload=true){audioSystem.setSynthType(instId,song.settings.instruments[instId].synth.type,reload);if(refresh){$('#instrument_options_synth_type').val(song.settings.instruments[instId].synth.type);$('#instrument_options_synth_type').selectmenu('refresh');}}
function updateSynthWaveformView(instId){let wavePath=document.getElementById('instrument_options_synth_wavepath');let val=song.settings.instruments[instId]?.synth?.type;if(val==='sine'){wavePath.setAttribute('d','m0 32c16-32 32 0 32 0s16 32 32 0');}else if(val==='square'){wavePath.setAttribute('d','m0 32v-16h32v16 16h32v-16');}else if(val==='sawtooth'){wavePath.setAttribute('d','M0,32 32,16V32 48L64,32');}else if(val==='triangle'){wavePath.setAttribute('d','m0 32 16-16 32 32 16-16');}}
function setSynthFilter(instId,value){song.settings.instruments[instId].synth.filter=value|0;updateSynthFilter(instId);}
function updateSynthFilter(instId){audioSystem.setSynthFilter(instId,song.settings.instruments[instId].synth.filter);document.getElementById('instrument_options_synth_filter').value=song.settings.instruments[instId].synth.filter;}
function setSynthFilterType(instId,value,update=true){song.settings.instruments[instId].synth.filterType=value;updateSynthFilterType(instId,update);}
function updateSynthFilterType(instId,refresh=true){audioSystem.setSynthFilterType(instId,song.settings.instruments[instId].synth.filterType);if(refresh){$('#instrument_options_synth_filter_type').val(song.settings.instruments[instId].synth.filterType);$('#instrument_options_synth_filter_type').selectmenu('refresh');}}
function setSynthFilterQ(instId,value){song.settings.instruments[instId].synth.resonance=value;updateSynthFilterQ(instId);}
function updateSynthFilterQ(instId){audioSystem.setSynthFilterResonance(instId,song.settings.instruments[instId].synth.resonance);document.getElementById('instrument_options_synth_filter_q').value=song.settings.instruments[instId].synth.resonance;}
function selectLFO(instId){song.settings.instruments[instId].synth.lfoEnabled=!song.settings.instruments[instId].synth.lfoEnabled;updateLFO(instId);}
function updateLFO(instId,restart=true){audioSystem.setLFOEnabled(instId,song.settings.instruments[instId].synth.lfoEnabled,restart);let lfoButton=$('#instrument_options_synth_lfo_e');let lfoSelect=$('#instrument_options_synth_lfo_select-button');if(song.settings.instruments[instId].synth.lfoEnabled){lfoButton.addClass('enabled');lfoSelect.addClass('enabled');}else{lfoButton.removeClass('enabled');lfoSelect.removeClass('enabled');}}
function setLFOOsc(instId,osc){song.settings.instruments[instId].synth.lfoType=osc;updateLFOOsc(instId);}
function updateLFOOsc(instId){audioSystem.setLFOType(instId,song.settings.instruments[instId].synth.lfoType);$('.lfo_osc_option').removeClass('lfo_osc_selected');$('#lfo_osc_'+song.settings.instruments[instId].synth.lfoType).addClass('lfo_osc_selected');updateSynthLFOView(instId);}
function setLFOIntensity(instId,value){song.settings.instruments[instId].synth.lfoIntensity=value*kLFOFactors[song.settings.instruments[instId].synth.lfoTarget];updateLFOIntensity(instId);}
function updateLFOIntensity(instId,resetValue=false){if(resetValue){audioSystem.setLFOIntensity(instId,0);document.getElementById('instrument_options_synth_lfo_intensity').value='0';}else{document.getElementById('instrument_options_synth_lfo_intensity').value=song.settings.instruments[instId].synth.lfoIntensity/kLFOFactors[song.settings.instruments[instId].synth.lfoTarget];audioSystem.setLFOIntensity(instId,song.settings.instruments[instId].synth.lfoIntensity);}
updateSynthLFOView(instId);}
function setLFORate(instId,value,isFreq){let synth=song.settings.instruments[instId].synth;if(isFreq){synth.lfoMode=1;let val=parseFloat(value);if(!isNaN(val)){synth.lfoNum=val;}}else{let[num,denom]=value.split('/');synth.lfoMode=(num==='CUSTOM')|0;if(synth.lfoMode===0){synth.lfoNum=denom|0;}}
updateLFORate(instId);}
function updateLFORate(instId){let lfoNum=song.settings.instruments[instId].synth.lfoNum;let isFreq=song.settings.instruments[instId].synth.lfoMode===1;$('.synth_lfo_hz').css('display',isFreq?'block':'none');audioSystem.setLFORate(instId,lfoNum,isFreq);$('#instrument_options_synth_lfo_e').text(isFreq?'Custom...':`1/${lfoNum}`);updateSynthLFOView(instId);}
function setLFOTarget(instId,value,refresh=true,remap=true){song.settings.instruments[instId].synth.lfoTarget=value;updateLFOTarget(instId,true,refresh,remap);}
function updateLFOTarget(instId,resetIntensity=true,refresh=true,remap=true){audioSystem.setLFOTarget(instId,song.settings.instruments[instId].synth.lfoTarget,remap);if(refresh){$('#instrument_options_lfo_target').val(song.settings.instruments[instId].synth.lfoTarget);$('#instrument_options_lfo_target').selectmenu('refresh');}
updateLFOIntensity(instId,resetIntensity);}
function selectADSR(instId){song.settings.instruments[instId].synth.volumeEnvelope.enabled=!song.settings.instruments[instId].synth.volumeEnvelope.enabled;updateADSR(instId);}
function updateADSR(instId){audioSystem.setADSREnabled(instId,song.settings.instruments[instId].synth.volumeEnvelope.enabled);let adsrButton=$('#instrument_options_synth_adsr_e');let adsrSliders=$('#instrument_options_synth_adsr');if(song.settings.instruments[instId].synth.volumeEnvelope.enabled){adsrButton.addClass('enabled');adsrSliders.removeClass('adsr_disabled');}else{adsrButton.removeClass('enabled');adsrSliders.addClass('adsr_disabled');}}
function setAttack(instId,value){song.settings.instruments[instId].synth.volumeEnvelope.attack=value;updateAttack(instId);}
function updateAttack(instId){audioSystem.setAttack(instId,song.settings.instruments[instId].synth.volumeEnvelope.attack);document.getElementById('instrument_options_synth_attack').value=song.settings.instruments[instId].synth.volumeEnvelope.attack;updateSynthADSRView(instId);}
function setDecay(instId,value){song.settings.instruments[instId].synth.volumeEnvelope.decay=value;updateDecay(instId);}
function updateDecay(instId){audioSystem.setDecay(instId,song.settings.instruments[instId].synth.volumeEnvelope.decay);document.getElementById('instrument_options_synth_decay').value=song.settings.instruments[instId].synth.volumeEnvelope.decay;updateSynthADSRView(instId);}
function setSustain(instId,value){song.settings.instruments[instId].synth.volumeEnvelope.sustain=value;updateSustain(instId);}
function updateSustain(instId){audioSystem.setSustain(instId,song.settings.instruments[instId].synth.volumeEnvelope.sustain);document.getElementById('instrument_options_synth_sustain').value=song.settings.instruments[instId].synth.volumeEnvelope.sustain;updateSynthADSRView(instId);}
function setRelease(instId,value){song.settings.instruments[instId].synth.volumeEnvelope.release=value;updateRelease(instId);}
function updateRelease(instId){audioSystem.setRelease(instId,song.settings.instruments[instId].synth.volumeEnvelope.release);document.getElementById('instrument_options_synth_release').value=song.settings.instruments[instId].synth.volumeEnvelope.release;updateSynthADSRView(instId);}
function syncLFO(){audioSystem.forEachInstrument((i)=>{let synth=audioSystem.instruments.get(i).synth;if(synth&&synth instanceof AudioSystemSynth){synth.setLFORate(song.settings.instruments[i]?.synth?.lfoNum??4);}})}
function resetSettings(instId){song.settings.instruments[instId]=getDefaultInstrumentSettings();loadInstrumentSettings(instId);if(instMgr.isCustomSynth(instId)){createSynth(instId);}
audioSystem.setSolo(null);if(audioSystem.getMute(instId)){audioSystem.setMute(instId);}
if(instMgr.isLocked(instId)){lockInstrument(instId);}
fillAdvancedInstrumentSettings();if(instMgr.isCustomSynth(instId)&&audioSystem.instruments.get(instId).synth!=null&&audioSystem.instruments.get(instId).synth instanceof AudioSystemSynth&&song.settings.instruments[instId].synth!=null&&instrument==55){fillSynthInstrumentSettings();}
updateUiForInstrumentClones();}
function soloInstrument(instId){audioSystem.setSolo(instId);if(audioSystem.getMute(instId)){audioSystem.setMute(instId);}
fillAdvancedInstrumentSettings();}
function muteInstrument(instId){audioSystem.setMute(instId);audioSystem.setSolo(null);fillAdvancedInstrumentSettings();}
function showHideInstrumentOptions(){$('#instrument_options').toggle();$('#instrument_options').draggable();}
function removeAudioTrack(){audioTrackFile.value=null
audioSystem.removeAudioTrack();hideAudioTrackSelect();$('#wavesurfer_element').hide();updateBarOverlayLocations();}
function showAudioTrackSelect(){audioTrackLink.style.display='none';audioTrackSelect.style.display='block';}
function hideAudioTrackSelect(){audioTrackLink.style.display='block';audioTrackSelect.style.display='none';}
function cutNotesAtGrid(){const changes=[];for(const note of selection.notes){let startIdx=Math.floor(note.time*grid)+1;let endIdx=Math.ceil((note.time+note.length)*grid);if(startIdx<endIdx){const newNotes=[];let prevCut=note.time;for(let j=startIdx;j<=endIdx;++j){const cut=(j<endIdx)?(j/grid):(note.time+note.length);const newNote=cloneNote(note);newNote.time=prevCut;newNote.length=cut-prevCut;newNotes.push(newNote);prevCut=cut;}
changes.push({note:note,newNotes:newNotes});}}
if(changes.length>0){(function(changes){exec(function(){selection.clear();for(const change of changes){song.removeNote(change.note,true);for(const newNote of change.newNotes){song.addNote(newNote,true);selection.selectNote(newNote);}}
updateSelection();song.updateLoopTime();SequencerView.repaint(kRepaintNotesMoved);},function(){selection.clear();for(const change of changes){for(const newNote of change.newNotes){song.removeNote(newNote,true);}
song.addNote(change.note,true);selection.selectNote(change.note);}
updateSelection();song.updateLoopTime();SequencerView.repaint(kRepaintNotesMoved);});})(changes);setConfirmExit(true);}}
function exec(action,undoAction){redo=[];action();if(undo.length==undoSize){undo=undo.splice(1);}
undo.push(new Change(action,undoAction));}
function undoChange(){if(undo.length==0)return;const change=undo.pop();change.undoAction();redo.push(change);}
function redoChange(){if(redo.length==0)return;const change=redo.pop();change.action();undo.push(change);}
function clearChanges(){undo=[];redo=[];}
function getErrorMessage(){return'<span style="color:red">Error saving, check your connection and try again. <a href="javascript:saveOffline();void(0);">Save offline</a></span>';}
function isSynthPresent(instId){return Object.keys(song.settings.instruments[instId]?.synth??{}).length>0;}
function getSongProto(){instMgr.forEach(function(instId){song.getInstrumentSettings(instId).volume=audioSystem.getInstrumentVolume(instId);});for(const ii in song.settings.instruments){const i=parseInt(ii);const setting=song.settings.instruments[i];if(setting.volume==1&&!setting.delay&&!setting.reverb&&setting.pan==0&&setting.detune==0&&!setting.eq.enabled&&!setting.distort&&setting.name==''&&setting.color.length==0&&!isSynthPresent(i)){delete song.settings.instruments[i];}}
if(numSan(song.settings.timeSig,4)==4){delete song.settings.timeSig;}
const sequenceProto=new proto.Sequence();const sequenceSettingsProto=new proto.SequenceSettings();sequenceSettingsProto.setBpm(numSan(initialBpm,110));sequenceSettingsProto.setTimeSignature(song.settings.timeSig);sequenceSettingsProto.setOneMinusVolume(1-numSan(song.getVolume(),1));for(const i in song.settings.instruments){if(!instMgr.isValidId(i)){console.log('Discarding bad instrument setting',i);continue;}
sequenceSettingsProto.getInstrumentsMap().set(i,getInstrumentSettingsProto(i));}
sequenceProto.setSettings(sequenceSettingsProto);for(const note of song.notes){const noteType=Object.keys(proto.NoteType).indexOf(note.type.replace('#','S'));if(noteType!=null&&isNumber(note.time)&&isNumber(note.length)&&instMgr.isValidId(note.instrument)&&isNumber(note.volume)){const noteProto=new proto.Note();noteProto.setType(noteType);noteProto.setTime(note.time);noteProto.setLength(note.length);noteProto.setInstrument(note.instrument);noteProto.setVolume(note.volume);sequenceProto.addNotes(noteProto);}else{console.log('Discarding bad note',note);}}
for(const mi of song.markerIterator){for(const marker of mi.array){if(isNumber(marker.time)&&isNumber(marker.value)&&isValidMarkerSetting(marker.setting)&&(instMgr.isValidId(marker.instrument)||!kMarkerEditorSettings[marker.setting].isPerInstrument)){const markerProto=new proto.Marker();markerProto.setTime(marker.time);markerProto.setSetting(marker.setting);if(kMarkerEditorSettings[marker.setting].isPerInstrument){markerProto.setInstrument(marker.instrument);}
markerProto.setValue(marker.value);markerProto.setBlend(!!marker.blend);sequenceProto.addMarkers(markerProto);}else{console.log('Discarding bad marker',marker);}}}
return sequenceProto;}
function copyInstrumentSettings(i){let instrumentProto=getInstrumentSettingsProto(i);let data=goog.crypt.base64.encodeByteArray(instrumentProto.serializeBinary());copyText(data);}
async function pasteInstrumentSettings(i){try{let instProto=proto.InstrumentSettings.deserializeBinary(await navigator.clipboard.readText());const synthBackup=song.settings.instruments[i]?.synth;song.settings.instruments[i]=parseInstrumentSettingsProto(instProto);loadInstrumentSettings(i);song.settings.instruments[i].synth=synthBackup;fillAdvancedInstrumentSettings();updateUiForInstrumentClones();setConfirmExit(true);}catch(e){console.log(e);message('Copy instrument settings first.');}}
function cloneInstrument(instId){const cloneInstId=instMgr.cloneInstrument(instId);const instSettings=getInstrumentSettingsProto(instId);song.settings.instruments[cloneInstId]=parseInstrumentSettingsProto(instSettings);song.settings.instruments[cloneInstId].name='';song.settings.instruments[cloneInstId].color=[];loadInstrumentSettings(cloneInstId);selectInstrument(cloneInstId);updateUiForInstrumentClones();setConfirmExit(true);}
function deleteClonedInstrument(instId){if(!instMgr.isClone(instId))return;const oldNotes=[];const oldMarkers=[];const oldSettings=getInstrumentSettingsProto(instId);const oldSelectedNotes=selection.notes;const oldSelectedMarkers=selection.markers;for(const n of song.notes){if(n.instrument==instId)oldNotes.push(n);}
let bpmChanged=false;for(const mi of song.markerIterator){if(mi.instrument==instId){if(mi.setting==kMarkerSettingBpm)bpmChanged=true;for(const m of mi.array)oldMarkers.push(m);}}
exec(()=>{instMgr.deleteClone(instId);delete song.settings.instruments[instId];song.removeNotes(oldNotes);for(const marker of oldMarkers)song.removeMarker(marker);selection.clear();selectInstrument(instMgr.baseId(instId));fillAdvancedInstrumentSettings();updateUiForInstrumentClones();updateSelection();if(oldNotes.length>0){SequencerView.repaint(kRepaintNotesMoved);}
onMultiMarkerValueChange(bpmChanged);},()=>{instMgr.undeleteClone(instId);song.settings.instruments[instId]=parseInstrumentSettingsProto(oldSettings);for(const note of oldNotes){song.addNote(note,true);}
for(const marker of oldMarkers)song.addMarker(marker);selection.setNotes(oldSelectedNotes);selection.setMarkers(oldSelectedMarkers);selectInstrument(instId);loadInstrumentSettings(instId);fillAdvancedInstrumentSettings();updateUiForInstrumentClones();updateSelection();if(oldNotes.length>0){song.updateLoopTime();SequencerView.repaint(kRepaintNotesMoved);}
onMultiMarkerValueChange(bpmChanged);});setConfirmExit(true);}
function getSongProtoBlob(){const sequenceProto=getSongProto();try{return sequenceProto.serializeBinary();}catch(e){console.log('Serializing sequence failed',e);console.log(sequenceProto.toObject());message('Failed to save',3,true);return null;}}
function getInstrumentSettingsProto(i){i=parseInt(i);const inst=song.getInstrumentSettings(i);const instrumentProto=new proto.InstrumentSettings();instrumentProto.setName(instMgr.protoName(i,inst.name));instrumentProto.setColor(arrayToRgbInt(inst.color));instrumentProto.setVolume(numSan(getInitialInstrumentVolume(i),1));instrumentProto.setDelay(!!inst.delay);instrumentProto.setReverb(!!inst.reverb);instrumentProto.setReverbType(numSan(inst.reverbType,1));instrumentProto.setOneMinusReverbVolume(1-numSan(inst.reverbVolume,1));instrumentProto.setDistortType(inst.distort?numSan(inst.distortType):0);instrumentProto.setDistortVolume(numSan(inst.distortVolume,1));instrumentProto.setPan(numSan(inst.pan));instrumentProto.setDetune(numSan(inst.detune));if(inst.eq!=null&&inst.eq.enabled){instrumentProto.setEnableEq(true);instrumentProto.setEqLow(numSan(inst.eq.low));instrumentProto.setEqMid(numSan(inst.eq.mid));instrumentProto.setEqHigh(numSan(inst.eq.high));}
if(isSynthPresent(i)){const synth=inst.synth??kDefaultSynthSettings;const synthProto=new proto.Synth();synthProto.setType(proto.SynthType[synth.type.toUpperCase()]);const volEnv=new proto.Envelope();volEnv.setEnabled(synth.volumeEnvelope.enabled);volEnv.setAttack(numSan(synth.volumeEnvelope.attack));volEnv.setDecay(numSan(synth.volumeEnvelope.decay));volEnv.setSustain(numSan(synth.volumeEnvelope.sustain));volEnv.setRelease(numSan(synth.volumeEnvelope.release));synthProto.setVolumeEnvelope(volEnv);const filtEnv=new proto.Envelope();filtEnv.setEnabled(synth.filterEnvelope.enabled);filtEnv.setAttack(numSan(synth.filterEnvelope.attack));filtEnv.setDecay(numSan(synth.filterEnvelope.decay));filtEnv.setSustain(numSan(synth.filterEnvelope.sustain));filtEnv.setRelease(numSan(synth.filterEnvelope.release));synthProto.setFilterEnvelope(filtEnv);synthProto.setFilter(numSan(synth.filter));synthProto.setResonance(numSan(synth.resonance));synthProto.setFilterType(numSan(synth.filterType));synthProto.setLfoEnabled(synth.lfoEnabled);synthProto.setLfoType(proto.LFOType[synth.lfoType.toUpperCase()+'LFO']);synthProto.setLfoFreq(numSan(synth.lfoNum,0));synthProto.setLfoLevel(numSan(synth.lfoIntensity,0));synthProto.setLfoTarget(synth.lfoTarget);synthProto.setLfoMode(synth.lfoMode);instrumentProto.setSynth(synthProto);}
return instrumentProto;}
function getTitle(){const name=document.getElementById('title').value;return(name.trim()=='')?'Untitled':name;}
function setTitle(name){document.getElementById('title').value=name;}
function copyText(text){navigator.clipboard.writeText(text);message('Copied to clipboard',3,true);}
function save(tryUpdate){if(song.notes.length==0)return;const sequenceProto=getSongProtoBlob();if(sequenceProto==null)return;const name=getTitle();document.getElementById('share').style.display='block';document.getElementById('sharelink').innerHTML='Saving...';const fd=new FormData();fd.append('tryUpdate',tryUpdate?1:0);fd.append('instanceId',instanceId);fd.append('songId',song.id);fd.append('title',name);fd.append('basedon',song.basedon);fd.append('duration',getSongLengthInSeconds());const blob=new Blob([sequenceProto],{type:'application/octet-stream'});fd.append('protoData',blob);$.ajax({type:'POST',url:endpoint+='/save.php?',processData:false,contentType:false,data:fd,success:function(r){if(r&&!isNaN(parseInt(r))){const id=parseInt(r);song.id=id;const url=settings.domain+'/'+id;document.getElementById('sharelink').innerHTML='Link to this sequence: <a href="/'+id+'" target="_blank">'+
url+'</a> <a class="toolbar_button" '+'onclick="copyText(\''+url+'\')">Copy URL</a>';}else{document.getElementById('sharelink').innerHTML=getErrorMessage();console.log(r);}
document.getElementById('share').style.display='block';setConfirmExit(false);},error:function(r){document.getElementById('sharelink').innerHTML=getErrorMessage();document.getElementById('share').style.display='block';console.log(r);}});}
function saveOffline(){if(song.notes.length==0)return;const data=getSongProtoBlob();if(data==null)return;const name=getTitle();saveBlob(name+'.sequence',[data],'application/octet-stream');document.getElementById('sharelink').innerHTML='File saved. Drag it onto the sequencer to load it again.';document.getElementById('share').style.display='block';}
function saveAudio(isMp3){song.stop();setScrollLeft(0,true);message('Recording, please wait for the sequence to finish...',5,true);enableOfflineAudioSystem(getSongLengthInSeconds());audioSystem.isMp3=isMp3;audioSystem.prepareRecording();if(!audioSystem.offline){onLoop=function(){setTimeout(function(){audioSystem.stopRecording();onLoop=undefined;},5000);};}
sampleManager.addOnAllLoadedCallback(()=>{setTimeout(()=>{song.play(0);audioSystem.startRecording(()=>{song.stop();setScrollLeft(0,true);enableRealtimeAudioSystem();});},500);});}
function handleDragOver(e){e.stopPropagation();e.preventDefault();e.dataTransfer.dropEffect='copy';}
function loadFileFromInputDialog(){const files=document.getElementById('file_upload_input').files;if(files.length==1)loadFile(files[0]);}
function loadOffline(e){e.stopPropagation();e.preventDefault();if(e.dataTransfer.files.length==1){loadFile(e.dataTransfer.files[0]);}}
function splitFileName(name){const i=name.lastIndexOf('.');if(i<0)return[name,null];return[name.substring(0,i),name.substring(i+1)];}
function loadFile(file){if(confirm('This will replace the current sequence. Are you sure?')){const reader=new FileReader();const nameExt=splitFileName(String(file.name));switch(nameExt[1].toLowerCase()){case'sequence':reader.onload=function(e){loadDataProto(e.target.result);setTitle(nameExt[0]);};reader.readAsArrayBuffer(file);break;case'txt':reader.onload=function(e){loadDataText(e.target.result);setTitle(nameExt[0]);};reader.readAsText(file);break;case'mid':case'midi':onMidiFile(file);break;default:message('Unknown sequence file format.',3,true);}}}
function clearSong(){song.stop();song.playing=false;if(playTimeoutId){window.clearTimeout(playTimeoutId);}
song.removeNotes(song.notes,true);song.updateLoopTime();lastPlayTime=0;selection.clear();clearDrag();setDragBounds();clickedNote=false;clickedMarker=false;scrollLeft=0;targetScrollLeft=0;clearChanges();instMgr.reset();SequencerView.repaint(kRepaintNotesMoved);}
function loadDataProto(data){loadSequenceProto(proto.Sequence.deserializeBinary(data));}
function loadSequenceProto(sequenceProto){const settings={instruments:{}};let bpm=110;if(typeof song!='undefined'){clearSong();}
const sequenceSettingsProto=sequenceProto.getSettings();if(sequenceSettingsProto!=null){bpm=numSan(sequenceSettingsProto.getBpm(),110);settings.timeSig=numSan(sequenceSettingsProto.getTimeSignature());if(settings.timeSig==0){settings.timeSig=4;}
settings.volume=1-numSan(sequenceSettingsProto.getOneMinusVolume());const instrumentsMap=sequenceProto.getSettings().getInstrumentsMap();for(const instId of instrumentsMap.keys()){if(!instMgr.isValidId(instId)){console.log('Discarding bad instrument setting',instId);continue;}
const instProto=instrumentsMap.get(instId);settings.instruments[instId]=parseInstrumentSettingsProto(instProto);}}
if(song)song.worker.terminate();song=new Song(sequenceProto.getNotesList(),settings);document.getElementById('bpm').value=bpm;$('#time_sig_select').val(song.getTimeSig());refreshSelectMenu('#time_sig_select');if(!isPlayerMode){$('#volume_slider').val(song.getVolume());}
if(song.settings.instruments!=null){$.each(song.settings.instruments,loadInstrumentSettings);}
for(const marker of sequenceProto.getMarkersList()){const markerTime=marker.getTime();const markerSetting=marker.getSetting();const markerInstrument=marker.getInstrument();const markerValue=marker.getValue();const markerBlend=marker.getBlend();if(isNumber(markerTime)&&isNumber(markerValue)&&isValidMarkerSetting(markerSetting)&&(instMgr.isValidId(markerInstrument)||!kMarkerEditorSettings[markerSetting].isPerInstrument)){song.addMarker(new Marker(song,markerTime,markerSetting,markerInstrument,markerValue,!!markerBlend));if(markerSetting==kMarkerSettingInstrumentReverb){loadReverb(markerValue);}}else{console.log('Discarding bad marker',marker.toObject());}}
setInitialBPM(bpm);setInitialSongVolume(song.getVolume());updateGridImage();updateMeasures();updateUiForInstrumentClones();setScrollLeft(0,true);checkSequenceVolume();instMgr._forEachClone(55,i=>{if(settings.instruments[i])updateSynth(i);});setConfirmExit(false);if(song.id!=0&&Math.abs(sequenceDuration-getSongLengthInSeconds())>1e-3){$.post('/app/api/update_duration.php',{id:song.id,duration:getSongLengthInSeconds()});}
SequencerView.repaint(kRepaintNotesMoved);}
function parseInstrumentSettingsProto(instProto){const instSettings={};instSettings.name=instProto.getName()??'';instSettings.color=rgbIntToArray(instProto.getColor());instSettings.volume=numSan(instProto.getVolume(),1);instSettings.delay=!!instProto.getDelay();instSettings.reverb=!!instProto.getReverb();instSettings.reverbType=Math.max(1,numSan(instProto.getReverbType(),1));instSettings.reverbVolume=1-numSan(instProto.getOneMinusReverbVolume());const distortType=numSan(instProto.getDistortType(),0);instSettings.distort=distortType!=0;instSettings.distortType=Math.max(1,distortType);instSettings.distortVolume=numSan(instProto.getDistortVolume());instSettings.pan=numSan(instProto.getPan());instSettings.detune=numSan(instProto.getDetune());if(instProto.getEnableEq()){instSettings.eq={enabled:true,low:numSan(instProto.getEqLow()),mid:numSan(instProto.getEqMid()),high:numSan(instProto.getEqHigh()),};}
const synth=instProto.getSynth();if(synth!=undefined){const volEnv=synth.getVolumeEnvelope();const filtEnv=synth.getFilterEnvelope()
instSettings.synth={type:instMgr.getSynthWaveform(synth.getType()),filter:synth.getFilter(),resonance:synth.getResonance(),filterType:synth.getFilterType(),lfoEnabled:synth.getLfoEnabled(),lfoNum:synth.getLfoFreq(),lfoMode:synth.getLfoMode(),lfoType:instMgr.getSynthWaveform(synth.getLfoType()),lfoTarget:synth.getLfoTarget(),lfoIntensity:synth.getLfoLevel(),volumeEnvelope:{enabled:volEnv.getEnabled(),attack:volEnv.getAttack(),hold:volEnv.getHold(),decay:volEnv.getDecay(),sustain:volEnv.getSustain(),release:volEnv.getRelease()},filterEnvelope:{enabled:filtEnv.getEnabled(),attack:filtEnv.getAttack(),hold:filtEnv.getHold(),decay:filtEnv.getDecay(),sustain:filtEnv.getSustain(),release:filtEnv.getRelease()}}}
if(instSettings.reverb)loadReverb(instSettings.reverbType);return instSettings;}
function loadDataText(data){let settings,bpm,notes;if(data[0]=='{'){const parts=data.split('|');settings=JSON.parse(parts[0]);bpm=parts[1];notes=parts[2];}else{const parts=data.split(':');bpm=parts[0];notes=parts[1];}
if(bpm==null||bpm==''){bpm='110';}
if(notes==null){notes='';}
if(typeof song!='undefined'){clearSong();}
song=new Song(notes,settings);document.getElementById('bpm').value=bpm;$('#time_sig_select').val(song.getTimeSig());refreshSelectMenu('#time_sig_select');setInitialBPM(parseInt(bpm));if(song.settings.instruments!=null){$.each(song.settings.instruments,loadInstrumentSettings);}
updateGridImage();updateMeasures();checkSequenceVolume();setConfirmExit(false);SequencerView.repaint(kRepaintNotesMoved);}
function loadInstrumentSettings(instId){const vol=song.settings.instruments[instId].volume;setInitialInstrumentVolume(instId,vol);$('#instrument_volume_'+instId).val(vol);updateDelay(instId);updateReverb(instId);updateDistort(instId);updatePan(instId);updateDetune(instId);updateEq(instId);updateInstrumentColor(instId);if(instMgr.isCustomSynth(instId)){updateSynth(instId);}}
function refreshInstrumentSettings(instId){const instSettings=song.getInstrumentSettings(instId);audioSystem.setDelay(instId,instSettings.delay);audioSystem.setReverb(instId,instSettings.reverb?instSettings.reverbType:0);audioSystem.setReverbVolume(instId,instSettings.reverbVolume);audioSystem.setDistort(instId,instSettings.distort?instSettings.distortType:0,instSettings.distortVolume);audioSystem.setPan(instId,instSettings.pan);audioSystem.setDetune(instId,parseFloat(instSettings.detune));audioSystem.setEq(instId,instSettings.eq.enabled,instSettings.eq.low,instSettings.eq.mid,instSettings.eq.high);audioSystem.updateVolume(instId);}
function refreshAllInstrumentSettings(){audioSystem.forEachInstrument(i=>refreshInstrumentSettings(i));updateVolume();}
function openBackupDatabase(){const db=new Dexie('backup');db.version(1).stores({backup:'id, data'});return db;}
function loadBackup(){const db=openBackupDatabase();db.backup.toArray().then((result)=>{loadDataProto(result[0].data);clearBackup();db.close();});document.getElementById('share').style.display='none';}
function clearBackup(){openBackupDatabase().delete();document.getElementById('share').style.display='none';}
function enterEditMode(){$('#frame_wrapper').removeClass('play_mode');$('#sequencer').removeClass('play_mode');$('#frame_wrapper').addClass('edit_mode');$('#sequencer').addClass('edit_mode');$('#volume_slider').val((typeof song!='undefined')?song.getVolume():1);document.getElementById('playbutton').style.display='none';setMode('draw');isPlayerMode=false;if(isPlaylistMode){document.getElementById('playlist_menu').style.width='0px';document.getElementById('playlist_menu').style.padding='0px';setTimeout(()=>{onresize()},500);onLoop=null;isPlaylistMode=false;}else{onresize();}
setInterval(function(){if(song.notes.length==0||!confirmExit)return;const db=openBackupDatabase();const sequenceData=getSongProto().serializeBinary();db.backup.bulkPut([{id:0,data:sequenceData}]).catch((error)=>console.log(error));},60*1000);if(SequencerView.isGL()){scrollSelect.selectedIndex=2;SequencerView.autoScroll=autoScroll=initialAutoScroll=kScrollFast;SequencerView.repaint();refreshSelectMenu('#scroll_select');}}
function leaveEditMode(){$('#frame_wrapper').removeClass('edit_mode');$('#sequencer').removeClass('edit_mode');$('#frame_wrapper').addClass('play_mode');$('#sequencer').addClass('play_mode');$('#volume_slider').val(1);setMode('play');onresize();isPlayerMode=true;if(SequencerView.isGL()){scrollSelect.selectedIndex=0;SequencerView.autoScroll=autoScroll=initialAutoScroll=kScrollFollow;SequencerView.repaint();refreshSelectMenu('#scroll_select');}
if(!isPlaylistMode){sidebar.open(sidebar.tab('Sequence',document.getElementById('template-info-sidebar')),true,true);autoResizeTextArea(document.getElementById('info-sidebar-description-textarea'));}}
function showTutorialLink(){document.getElementById('sharelink').innerHTML='New here? Check out the <a href="https://onlinesequencer.net/forum/showthread.php?tid=890" target="_blank">tutorial</a>';document.getElementById('share').style.display='block';}
var saveMenu={name:'Save',items:{'Save':{name:'Save a copy',action:()=>save(false)},'save_offline':{name:'Save local file',action:saveOffline},'export_mp3':{name:'Export MP3',action:()=>saveAudio(true)},'export_wav':{name:'Export WAV',action:()=>saveAudio(false)},'export':{name:'Export MIDI',action:exportMidi},}};var toolsMenu={name:'More tools',items:{'upload':{name:'Import MIDI/Sequence File',action:function(){$('#file_upload_input').click();}},'fast_graphics':{name:'Fast graphics',action:function(){initialFastGraphics=!initialFastGraphics;if(!song.playing)SequencerView.fastGraphics=initialFastGraphics;SequencerView.repaint();}},'invert':{name:'Invert',action:function(){var inversePiano={};for(i=0;i<piano.length;i++){inversePiano[piano[i]]=piano[piano.length-1-i]}
for(i=0;i<song.notes.length;i++){var note=song.notes[i];if(instMgr.isDrum(note.instrument)){continue;}
song.moveNote(note,note.instrument,note.instrument,note.time,note.time,note.type,inversePiano[note.type]);}
keySelect.selectedIndex=0;$(keySelect).selectmenu('refresh');SequencerView.repaint(kRepaintNotesMoved);}},'change_key':{name:'Minor â Major',action:function(){if(keySelect.selectedIndex==0){message('Select a key first');}else{var inverseKeyIndex=(keySelect.selectedIndex+11)%24+1;var inverseKey=settings.scales[inverseKeyIndex];for(i=0;i<song.notes.length;i++){var note=song.notes[i];if(instMgr.isDrum(note.instrument)){continue;}
var octave=note.type.substring(note.type.length-1);var noteInverseKeyIndex=scale.indexOf(note.type.substring(0,note.type.length-1));if(noteInverseKeyIndex!=-1){song.moveNote(note,note.instrument,note.instrument,note.time,note.time,note.type,inverseKey[noteInverseKeyIndex]+octave);}}
keySelect.selectedIndex=inverseKeyIndex;$(keySelect).selectmenu('refresh');SequencerView.repaint(kRepaintNotesMoved);}}},'reverse':{name:'Reverse Selection',action:function(){if(!selection.isEmpty()){stretchNotes(-1);message('Selection reversed');}else{message('Select some notes first');}}},'humanize':{name:'Humanize Selection',action:function(){if(!selection.isEmpty()){humanize();message('Selection humanized');}else{message('Select some notes first');}}},'fadein':{name:'Fade In Selection',action:function(){if(!selection.isEmpty()){fadeNotesIn();message('Selection faded in');}else{message('Select some notes first');}}},'fadeout':{name:'Fade Out Selection',action:function(){if(!selection.isEmpty()){fadeNotesOut();message('Selection faded out');}else{message('Select some notes first');}}},'stretchnotes':{name:'Stretch Selection',action:function(){if(!selection.isEmpty()){stretchNotes(null,true);}else{message('Select some notes first');}}}}};var selectMenu={name:'',items:{'selectnotes':{name:'Select/deselect notes',action:selectNotes},'selectmarkers':{name:'Select/deselect markers',action:selectMarkers},}};var activeMenu=null;function createMenus(){createMenuPopup($('#btn_save_options'),$('#btn_save_options'),saveMenu);createMenuPopup($('#btn_more'),$('#btn_more'),toolsMenu);createMenuPopup($('#btn_select_this'),$('#btn_select_this'),selectMenu,true);}
function createMenuPopup(triggerElement,popupParentElement,menu,isRightClick=false){var menuPopupElement=$('<div id="menu_popup_'+(menu.name)+'" class="menu_popup"></div>');$.each(menu.items,function(id){var menuItem=menu.items[id];var menuItemElement=$('<div class="menu_item">'+menuItem.name+'</div>');if(menuItem.shortcut!=null){var isMac=navigator.platform.indexOf('Mac')>-1;var shortcutElement=$('<div class="shortcut">'+(isMac?'â':'Ctrl+')+
menuItem.shortcut+'</div>');menuItemElement.append(shortcutElement);}
menuItemElement.on('vmousedown',function(e){menuItem.action();e.stopPropagation();setActiveMenu(null);});menuItem.element=menuItemElement;menuPopupElement.append(menuItemElement);});triggerElement.on('vmousedown',function(e){if(!isRightClick||getButton(e)==3){if(activeMenu==menu){setActiveMenu(null);}else{setActiveMenu(menu);}
e.stopPropagation();e.preventDefault();}});triggerElement.on('contextmenu',function(e){e.preventDefault();});triggerElement.on('vmouseover',function(){if(activeMenu!=null&&activeMenu!=menu){setActiveMenu(menu);}});popupParentElement.append(menuPopupElement);menu.popup=menuPopupElement;}
function setActiveMenu(menu){if(activeMenu!=null){activeMenu.popup.css('display','none');}
if(menu!=null){menu.popup.css('display','flex');}
activeMenu=menu;}
$(document).on('vmousedown',function(event){if(event.button==0){setActiveMenu(null);}});function stretchNotes(factor,fromUI=false){if(!factor){factor=parseFloat(window.prompt('Please enter the stretch factor','2'));}
if(selection.hasMarkers()&&factor<0){if(fromUI)
message('Negative stretch factors are not supported for markers');else
console.log('Negative stretch factors are not supported for markers');return;}
if(!selection.isEmpty()&&factor!=0){const noteChanges=[];const span=selection.getTimeSpan();const flip=factor<0;factor=Math.abs(factor);for(const note of selection.notes){noteChanges.push({note:note,oldTime:note.time,oldLength:note.length,newTime:span.min+
(flip?span.max-note.time-note.length:note.time-span.min)*factor,newLength:factor*note.length,});}
const markerChanges=[];for(const marker of selection.markers){markerChanges.push({marker:marker,oldTime:marker.time,newTime:span.min+(marker.time-span.min)*factor,});}
(function(noteChanges,markerChanges){exec(function(){for(const change of noteChanges){const note=change.note;song.moveNote(note,note.instrument,note.instrument,change.oldTime,change.newTime,note.type,note.type);note.length=change.newLength;}
applyMarkerMoves(markerChanges);if(noteChanges.length>0){song.updateLoopTime();SequencerView.repaint(kRepaintNotesMoved);if(fromUI)message('Selection stretched');}},function(){for(const change of noteChanges){const note=change.note;song.moveNote(note,note.instrument,note.instrument,change.newTime,change.oldTime,note.type,note.type);note.length=change.oldLength;}
undoMarkerMoves(markerChanges);if(noteChanges.length>0){song.updateLoopTime();SequencerView.repaint(kRepaintNotesMoved);}});})(noteChanges,markerChanges);window.top.confirmExit=true;}}
function fadeNotes(fadeIn=false){const span=selection.getTimeSpan();tweakNotes(note=>{const x=(note.time-span.min)/(span.max-span.min);note.volume*=(fadeIn?x:1-x);});}
function fadeNotesIn(){fadeNotes(true)}
function fadeNotesOut(){fadeNotes(false)}
function truncateNotesAt(time){var changes=[];for(var i=0;i<selection.notes.length;++i){var note=selection.notes[i];var newLength=time-note.time;if(newLength<note.length){if(newLength<0.1*grid)newLength=0;changes.push({note:note,oldLength:note.length,newLength:newLength,});}}
if(changes.length){(function(changes){exec(function(){for(var i=0;i<changes.length;++i){var change=changes[i];var note=change.note;if(change.newLength>0){note.length=change.newLength;}else{song.removeNote(note,true);selection.deselectNote(note);}}
if(changes.length>0){song.updateLoopTime();SequencerView.repaint(kRepaintNotesMoved);}},function(){for(var i=0;i<changes.length;++i){var change=changes[i];var note=change.note;if(change.newLength>0){note.length=change.oldLength;}else{song.addNote(note,true);selection.selectNote(note);}}
if(changes.length>0){song.updateLoopTime();SequencerView.repaint(kRepaintNotesMoved);}});})(changes);window.top.confirmExit=true;}}
function selectNotesIf(predicate,addToSelection=false){var newNotes=addToSelection?Array.from(selection.notes):[];for(var i=0;i<song.notes.length;i++){var note=song.notes[i];if(!instMgr.isLocked(note.instrument)&&predicate(note)){newNotes.push(note);}}
(function(oldNotes,newNotes){exec(function(){selection.setNotes(newNotes);updateSelection();},function(){selection.setNotes(oldNotes);updateSelection();});})(Array.from(selection.notes),newNotes);if(!selection.isEmpty()){message(selection.describe()+' selected.');}}
function selectMarkersIf(predicate,addToSelection=false){const oldMarkers=selection.markers;const newMarkers=addToSelection?new Set(oldMarkers):new Set();for(const mi of song.markerIterator){for(const marker of mi.array){if(predicate(marker)){newMarkers.add(marker);}}}
exec(function(){selection.setMarkers(newMarkers);updateSelection();},function(){selection.setMarkers(oldMarkers);updateSelection();});if(!selection.isEmpty()){message(selection.describe()+' selected.');}}
function convertToDetuneMarkers(startNote='C5'){if(!selection.notes.length)return;const noteChanges=[];const detuneMarkers=[];for(const note of selection.notes){if(instMgr.isDrum(note.instrument))continue;noteChanges.push({note:note,oldType:note.type,newType:startNote,});let detuneValue=(pianoToIndex[startNote]-pianoToIndex[note.type])*100;detuneMarkers.push(new Marker(song,note.time,11,note.instrument,detuneValue,false));}
exec(function(){for(const change of noteChanges){const note=change.note;song.moveNote(note,note.instrument,note.instrument,note.time,note.time,change.oldType,change.newType);}
for(const marker of detuneMarkers){song.addMarker(marker);}
if(noteChanges.length>0){song.updateLoopTime();SequencerView.repaint(kRepaintNotesMoved);}
updateMarkers();},function(){for(const change of noteChanges){const note=change.note;song.moveNote(note,note.instrument,note.instrument,note.time,note.time,change.newType,change.oldType);}
for(const marker of detuneMarkers){song.removeMarker(marker);}
if(noteChanges.length>0){song.updateLoopTime();SequencerView.repaint(kRepaintNotesMoved);}
updateMarkers();});window.top.confirmExit=true;}
function convertToMarimba(){if(!selection.notes.length)return;const marimba=53;const noteChanges=[];const pitches=new Map([['C6',[marimba,0]],['C5',[marimba,1]],['C4',[marimba,2]],]);for(const note of selection.notes){if(instMgr.isDrum(note.instrument))continue;let octave=parseInt(note.type.slice(-1))||5;let octaveOffset=1;let baseNote='C5';if(octave<4){baseNote='C4';octaveOffset=2;}else if(octave>6){baseNote='C6';octaveOffset=0;}
if(!pitches.get(note.type)){let newPitch=instMgr.cloneInstrument(marimba);setDetune(newPitch,(pianoToIndex[baseNote]-pianoToIndex[note.type])*100);pitches.set(note.type,[newPitch,octaveOffset]);switch(octaveOffset){case 0:pitches.set(piano[pianoToIndex[note.type]+12],[newPitch,1]);pitches.set(piano[pianoToIndex[note.type]+24],[newPitch,2]);break;case 1:pitches.set(piano[pianoToIndex[note.type]-12],[newPitch,0]);pitches.set(piano[pianoToIndex[note.type]+12],[newPitch,2]);break;case 2:pitches.set(piano[pianoToIndex[note.type]-12],[newPitch,1]);pitches.set(piano[pianoToIndex[note.type]-24],[newPitch,0]);break;}}
let pitch=pitches.get(note.type);noteChanges.push({note:note,oldType:note.type,newType:piano[pitch[1]],oldInstrument:note.instrument,newInstrument:pitch[0],});}
exec(function(){for(const change of noteChanges){const note=change.note;console.log(change);song.moveNote(note,change.oldInstrument,change.newInstrument,note.time,note.time,change.oldType,change.newType);}
if(noteChanges.length>0){song.updateLoopTime();SequencerView.repaint(kRepaintNotesMoved);}},function(){for(const change of noteChanges){const note=change.note;song.moveNote(note,change.newInstrument,change.oldInstrument,note.time,note.time,change.newType,change.oldType);}
if(noteChanges.length>0){song.updateLoopTime();SequencerView.repaint(kRepaintNotesMoved);}});window.top.confirmExit=true;}
function remixNotes(chunkSize=4,avgChunksPerUnmixedSection=2,avgChunksPerMixedSextion=2,avgMixedSectionsPerUnmixedSection=1){const pStopUnmixed=1/(1+avgChunksPerUnmixedSection)
const pStopMixed=1/(1+avgChunksPerMixedSextion)
const pStopMixedChain=1/(1+avgMixedSectionsPerUnmixedSection)
const timeSpan=selection.getTimeSpan();timeSpan.min=Math.floor(timeSpan.min/chunkSize)*chunkSize;const numChunks=Math.ceil((timeSpan.max-timeSpan.min)/chunkSize);const oldChunks=[];for(let i=0;i<numChunks;++i)oldChunks.push([]);for(const n of selection.notes){oldChunks[Math.floor((n.time-timeSpan.min)/chunkSize)].push(n);}
const newChunks=[];let mixing=false;let mixedChunkId=0;while(newChunks.length<oldChunks.length){if(mixing){if(mixedChunkId>=numChunks||Math.random()<pStopMixed){if(Math.random()<pStopMixedChain){mixing=false;}else{mixedChunkId=Math.floor(Math.random()*numChunks);}
continue;}
newChunks.push(oldChunks[mixedChunkId].map(n=>{const t=n.time+(newChunks.length-mixedChunkId)*chunkSize;return new Note(song,n.type,t,n.length,n.instrument,n.volume);}));++mixedChunkId;}else{if(Math.random()<pStopUnmixed){mixing=true;mixedChunkId=Math.floor(Math.random()*numChunks);continue;}
newChunks.push(null);}}
const newNotes=[];const oldNotes=[];const newSelection=[];const oldSelection=new Array(selection.notes);for(let i=0;i<numChunks;++i){if(newChunks[i]==null){for(const n of oldChunks[i])newSelection.push(n);}else{for(const n of newChunks[i]){newNotes.push(n);newSelection.push(n);}
for(const n of oldChunks[i])oldNotes.push(n);}}
exec(function(){selection.setNotes(newSelection);for(const n of oldNotes)song.removeNote(n,true);for(const n of newNotes){song.addNote(n,true);}
SequencerView.repaint(kRepaintNotesMoved);},function(){selection.setNotes(oldSelection);for(const n of newNotes)song.removeNote(n,true);for(const n of oldNotes){song.addNote(n,true);}
SequencerView.repaint(kRepaintNotesMoved);});window.top.confirmExit=true;}
function tweakNotes(tweakFunction){class NoteParams{constructor(note){this.time=note.time;this.type=note.type;this.instrument=note.instrument;this.length=note.length;this.volume=note.volume;}}
const notes=Array.from(selection.notes);const oldParams=notes.map(n=>new NoteParams(n));notes.map(tweakFunction);const newParams=notes.map(n=>new NoteParams(n));let notesMovedInView=false;let notesMovedInSequence=false;let anyChange=false;for(let i=0;i<notes.length;++i){instMgr.ensureLoaded(newParams[i].instrument);if(oldParams[i].time!=newParams[i].time||oldParams[i].type!=newParams[i].type){notesMovedInView=notesMovedInSequence=anyChange=true;}
if(oldParams[i].instrument!=newParams[i].instrument){notesMovedInSequence=anyChange=true;}
if(oldParams[i].length!=newParams[i].length){notesMovedInView=anyChange=true;}
if(oldParams[i].volume!=newParams[i].volume){anyChange=true;}
notes[i].time=oldParams[i].time;notes[i].type=oldParams[i].type;notes[i].instrument=oldParams[i].instrument;notes[i].length=oldParams[i].length;notes[i].volume=oldParams[i].volume;}
if(!anyChange)return;notes.map(n=>instMgr.ensureLoaded(n.instrument));const update=(fromParams,toParams)=>{for(let i=0;i<notes.length;++i){notes[i].volume=toParams[i].volume;notes[i].length=toParams[i].length;if(notesMovedInSequence){song.moveNote(notes[i],fromParams[i].instrument,toParams[i].instrument,fromParams[i].time,toParams[i].time,fromParams[i].type,toParams[i].type);}}
if(notesMovedInSequence||notesMovedInView){song.updateLoopTime();}
if(notesMovedInView){SequencerView.repaint(kRepaintNotesMoved);}else{SequencerView.repaint(kRepaintNotesChanged);}
window.top.confirmExit=true;};exec(()=>update(oldParams,newParams),()=>update(newParams,oldParams));}
function tweakNotes2(tweakFunction){class NoteParams{constructor(note){this.time=note.time;this.type=note.type;this.instrument=note.instrument;this.length=note.length;this.volume=note.volume;}}
class Edit{constructor(note){this.note=note;this.oldParams=new NoteParams(note);this.newParams=null;this.addedNotes=[];}
tweak(tweakFunction){const newNotes=tweakFunction(this.note);if(newNotes==null)return;for(const n of(Array.isArray(newNotes)?newNotes:[newNotes])){if(n==this.note){this.newParams=new NoteParams(n);}else{this.addedNotes.push(new Note(this.note.song,n.type??this.oldParams.type,n.time??this.oldParams.time,n.length??this.oldParams.length,n.instrument??this.oldParams.instrument,n.volume??this.oldParams.volume,));}}}}
const edits=selection.notes.map(n=>new Edit(n));edits.map(e=>e.tweak(tweakFunction));let notesMovedInView=false;let notesMovedInSequence=false;let anyChange=false;for(const e of edits){if(e.newParams==null||e.addedNotes.length>0){notesMovedInView=notesMovedInSequence=anyChange=true;}else{if(e.oldParams.time!=e.newParams.time||e.oldParams.type!=e.newParams.type){notesMovedInView=notesMovedInSequence=anyChange=true;}
if(e.oldParams.instrument!=e.newParams.instrument){notesMovedInSequence=anyChange=true;}
if(e.oldParams.length!=e.newParams.length){notesMovedInView=anyChange=true;}
if(e.oldParams.volume!=e.newParams.volume){anyChange=true;}}
e.note.time=e.oldParams.time;e.note.type=e.oldParams.type;e.note.instrument=e.oldParams.instrument;e.note.length=e.oldParams.length;e.note.volume=e.oldParams.volume;}
if(!anyChange)return;const after=()=>{if(notesMovedInSequence||notesMovedInView){song.updateLoopTime();}
if(notesMovedInView){SequencerView.repaint(kRepaintNotesMoved);}else{SequencerView.repaint(kRepaintNotesChanged);}
window.top.confirmExit=true;};exec(()=>{for(const e of edits){if(e.newParams==null){song.removeNote(e.note,true);}else{e.note.volume=e.newParams.volume;e.note.length=e.newParams.length;if(notesMovedInSequence){song.moveNote(e.note,e.oldParams.instrument,e.newParams.instrument,e.oldParams.time,e.newParams.time,e.oldParams.type,e.newParams.type);}}
for(const n of e.addedNotes){song.addNote(n,true);}}
after();},()=>{for(const e of edits){if(e.newParams==null){song.addNote(e.note,true);}else{e.note.volume=e.oldParams.volume;e.note.length=e.oldParams.length;if(notesMovedInSequence){song.moveNote(e.note,e.newParams.instrument,e.oldParams.instrument,e.newParams.time,e.oldParams.time,e.newParams.type,e.oldParams.type);}}
for(const n of e.addedNotes){song.removeNote(n,true);}}
after();});}
function humanize(volumeVariation=0.2,timeVariation=0.1){tweakNotes(n=>{n.volume*=1+volumeVariation*(2*Math.random()-1);n.time+=timeVariation*(2*Math.random()-1);if(n.time<0)n.time=0;});}
function resetAllInstrumentSettings(){instMgr.forEach(instId=>{if(instId in song.settings.instruments){resetSettings(parseInt(instId));}});fillAdvancedInstrumentSettings(instrument);window.top.confirmExit=true;}
function removeAllMarkers(){const allMarkers=[];for(const mi of song.markerIterator){for(const marker of mi.array){allMarkers.push(marker);}}
console.log(allMarkers);exec(function(){let bpmChanged=false;for(const marker of allMarkers){song.removeMarker(marker);if(marker.setting==kMarkerSettingBpm)bpmChanged=true;}
onMultiMarkerValueChange(bpmChanged);},function(){let bpmChanged=false;for(const marker of allMarkers){song.addMarker(marker);if(marker.setting==kMarkerSettingBpm)bpmChanged=true;}
onMultiMarkerValueChange(bpmChanged);});window.top.confirmExit=true;}
function arrayToRgbInt(array){return(array[0]<<24|array[1]<<16|array[2]<<8|array[3])>>>0;}
function objectToSequenceProto(obj){const p=new proto.Sequence();const settings=obj.settings||{};const sp=new proto.SequenceSettings();p.setSettings(sp);sp.setBpm(numSan(settings.bpm,110));sp.setTimeSignature(numSan(settings.timeSignature));sp.setOneMinusVolume(numSan(settings.oneMinusVolume));for(const[instId,instSet]of settings.instrumentsMap||[]){if(!isNumber(instId)||instSet==null)continue;const ip=new proto.InstrumentSettings();sp.getInstrumentsMap().set(parseInt(instId),ip);ip.setName(instMgr.protoName(instId,instSet.name));ip.setColor(arrayToRgbInt(instSet.color));ip.setVolume(numSan(instSet.volume,1));ip.setDelay(!!instSet.delay);ip.setReverb(!!instSet.reverb);ip.setReverbType(numSan(instSet.reverbType,1));ip.setOneMinusReverbVolume(numSan(instSet.oneMinusReverbVolume));ip.setDistortType(numSan(instSet.distortType));ip.setDistortVolume(numSan(instSet.distortVolume));ip.setPan(numSan(instSet.pan));ip.setDetune(numSan(instSet.detune));ip.setEnableEq(!!instSet.enableEq);ip.setEqLow(numSan(instSet.eqLow));ip.setEqMid(numSan(instSet.eqMid));ip.setEqHigh(numSan(instSet.eqHigh));}
for(const n of obj.notesList||[]){const np=new proto.Note();p.addNotes(np);np.setType(numSan(n.type));np.setTime(numSan(n.time));np.setLength(numSan(n.length,1));np.setInstrument(numSan(n.instrument));np.setVolume(numSan(n.volume));}
for(const m of obj.markersList||[]){var mp=new proto.Marker();p.addMarkers(mp);mp.setTime(numSan(m.time));mp.setSetting(numSan(m.setting));mp.setInstrument(numSan(m.instrument));mp.setValue(numSan(m.value));mp.setBlend(!!m.blend);}
return p;}
class SequencerViewCanvas{constructor(){this.canvas=document.createElement('canvas');this.fastGraphics=false;this._fastGraphicsWarning=false;this._g=this.canvas.getContext('2d');}
isGL(){return false;}
repaint(){if(this._repaintId!=0)cancelAnimationFrame(this._repaintId);this._repaintId=requestAnimationFrame(()=>this._repaint());}
setSize(width,height){this.width=width;this.height=height;this.canvas.width=width;this.canvas.height=height;this.repaint();}
snapZoomLevelX(v){return v;}
snapZoomLevelY(v){return v;}
setGrid(image,width){this._gridWidth=width;if(piano.length*noteHeight<this.height){this.canvas.height=piano.length*noteHeight;}else if(this.canvas.height<this.height){this.canvas.height=this.height;}
this._gridPattern=this._g.createPattern(image,'repeat');this._g.font=(noteHeight*0.625)+'px "Lucida Sans Unicode", "Lucida Grande", "Lucida", Arial, sans-serif';this.repaint();}
_repaint(){this._repaintId=0;if(this._gridPattern==null)return;const startTime=performance.now();this._g.fillStyle=this._gridPattern;this._g.save();this._g.translate(-scrollLeft%this._gridWidth,-scrollTop);this._g.fillRect(0,0,this.width+this._gridWidth,piano.length*noteHeight);this._g.restore();const start=Math.max(Math.floor(scrollLeft/noteWidth),0);const stop=Math.min(Math.floor(((scrollLeft+this.width)+1)/noteWidth),song.noteColumns.length);for(let i=Math.max(Math.floor((scrollLeft-this.width)/noteWidth),0);i<=stop;i++){const c=song.noteColumns[i];for(const j in c){const note=c[j];const isVisible=Math.floor(scrollLeft+this.width+1)>(note.intTime+note.fracTime)*noteWidth&&(note.intTime+note.fracTime+note.length)*noteWidth>scrollLeft;this._drawNote(note,isVisible);}}
for(const note of dragNotes){if(note.intTime<start||note.intTime>=stop){this._drawNote(note,true);}}
const elapsed=performance.now()-startTime;if(elapsed>50&&!this.fastGraphics&&!this._fastGraphicsWarning){message('Try turning on "Fast graphics" in the Tools menu for faster performance.');this._fastGraphicsWarning=true;}
this._repaintRequested=false;}
_drawNote(note,isVisible){note.drawX=this._sx(note.time);note.drawY=this._sy(pianoToIndex[note.type]);note.drawWidth=noteWidth*note.length;note.drawX2=this._sx(note.time+note.length);note.drawHeight=noteHeight;note.drawY2=this._sy(pianoToIndex[note.type]+1);if(!isVisible)return;const x=note.drawX+note.offsetX;const y=note.drawY+note.offsetY;const color=getInstrumentColor(song,note.instrument);if(instMgr.isLocked(note.instrument)){this._g.fillStyle='rgba('+color[1]+','+color[2]+','+color[3]+', 0.25)';}else{this._g.fillStyle='rgb('+color[1]+','+color[2]+','+color[3]+')';}
const radius=Math.round(Math.max(0,Math.min(note.drawWidth+note.offsetWidth,note.drawHeight)*0.4));if(this.fastGraphics||radius<=1){this._g.beginPath();this._g.rect(x,y,Math.max(0,note.drawX2-x+note.offsetWidth+note.offsetX),note.drawY2-y+note.offsetY);this._g.closePath();}else{this._roundRect(x,y,Math.max(0,note.drawX2-x+note.offsetWidth+note.offsetX),note.drawY2-y+note.offsetY,radius);}
this._g.fill();if(this._hasResizeHandle(note)){this._g.fillStyle='rgba(0, 0, 0, 0.2)';this._g.fillRect(note.drawX+note.offsetX+note.drawWidth+note.offsetWidth-4,note.drawY+note.offsetY+3,2,note.drawHeight-6);}
if(this._hasVolumeSlider(note)){const width=note.drawWidth+note.offsetWidth-8;this._g.fillStyle='rgba(0, 0, 0, 0.2)';this._g.fillRect(note.drawX+note.offsetX+3,y+noteHeight-noteHeight*0.625/2+1,width,2);this._g.fillStyle='rgba(255, 255, 255, 0.6)';this._g.fillRect(note.drawX+note.offsetX+3,y+noteHeight-noteHeight*0.625/2+1,(Math.min(note.volume,2)/2)*width,2);}
if(note.selected){this._g.lineWidth=2;this._g.strokeStyle='#fff';this._g.stroke();}
if(!this.fastGraphics&&note.length>0.75){if(instMgr.isDarkColor(note.instrument)){this._g.fillStyle=instMgr.isLocked(note.instrument)?'rgba(255,255,255,0.25)':'rgba(255,255,255,0.9)';}else{this._g.fillStyle=instMgr.isLocked(note.instrument)?'rgba(0,0,0,0.1)':'rgba(0,0,0,0.45)';}
this._g.fillText(note.type,x+2,y+noteHeight-noteHeight*0.625/2);}}
_sx(timeIndex){return Math.round(noteWidth*timeIndex)-scrollLeft;}
_sy(pianoIndex){return Math.round(noteHeight*pianoIndex)-scrollTop;}
_hasResizeHandle(note){return note.drawWidth>18;}
_hasVolumeSlider(note){return note.drawWidth>18&&note.volume!=1&&!this.fastGraphics;}
isResizeHandle(x,y,note){return this._hasResizeHandle(note)&&x>note.drawX+note.drawWidth-8&&x<note.drawX+note.drawWidth-4+2&&y>note.drawY+3&&y<note.drawY+note.drawHeight-3;}
_roundRect(x,y,width,height,radius){if(this._g.roundRect){this._g.beginPath();this._g.roundRect(x,y,width,height,radius);this._g.closePath();return;}
this._g.beginPath();this._g.moveTo(x+radius,y);this._g.lineTo(x+width-radius,y);this._g.quadraticCurveTo(x+width,y,x+width,y+radius);this._g.lineTo(x+width,y+height-radius);this._g.quadraticCurveTo(x+width,y+height,x+width-radius,y+height);this._g.lineTo(x+radius,y+height);this._g.quadraticCurveTo(x,y+height,x,y+height-radius);this._g.lineTo(x,y+radius);this._g.quadraticCurveTo(x,y,x+radius,y);this._g.closePath();}}
const kRepaintNotesMoved=0x1;const kRepaintNotesChanged=0x2;const kRepaintAfterZoomTimeout=0x4;class SequencerViewWebGL{constructor(){this.width=0;this.height=0;this._repaintId=0;this._repaintFlags=0;this._tileGrid=null;this._fastGraphicsWarning=false;this.fastGraphics=false;this.autoScroll=initialAutoScroll;this._pianoHeightPix=0;this._scrollLeft=0;this._scrollBottom=0;this._scrollTop=0;this._timeStepsPerMeasure=0;this._tileScaleX=0;this._tileScaleY=0;this._pixelScaleX=1;this._pixelScaleY=1;this._pixelStretched=false;this._lastFastGraphics=null;this._lastAutoscroll=null;this._lastWidth=null;this._lastHeight=null;this._lastNoteWidth=null;this._lastNoteHeight=null;this._lastGridSize=null;this._lastTimeSig=null;this._lastScale=null;this._tileNoteWidth=noteWidth;this._tileNoteHeight=noteHeight;this._zoomTimeout=null;this._noteSy=null;this._notePx=null;this._notePy=null;this.canvas=document.createElement('canvas');this.gl=this.canvas.getContext('webgl2',{alpha:false,depth:false,stencil:false,antialias:false,failIfMajorPerformanceCaveat:true,premultipliedAlpha:false,preserveDrawingBuffer:false,});if(this.gl==null)return;this._atlas=newSequencerViewWebGlTileAtlas(this.gl);if(this._atlas==null){this.gl=null;return;}
this.gl.enable(this.gl.SCISSOR_TEST);this.gl.enable(this.gl.BLEND);this.gl.blendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA);this._gridFb=new GLFrameBuffer(this.gl);this._positionBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._positionBuffer);this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,0,1]),this.gl.STATIC_DRAW);throwGLError(this.gl);const makeShader=(vertSrc,fragSrc)=>{const shader=new GLShader(this.gl,vertSrc,fragSrc);const posAttr=shader.getAttrib('pos');this.gl.enableVertexAttribArray(posAttr);this.gl.vertexAttribPointer(posAttr,2,this.gl.FLOAT,false,0,0);throwGLError(this.gl);return shader;};this._shaderRect=makeShader(basicVertSrc,rectFragSrc);this._uRectColor=this._shaderRect.getUniform('color');this._uRectScale=this._shaderRect.getUniform('scale');this._uRectTrans=this._shaderRect.getUniform('trans');this._shaderTextureWrap=makeShader(basicVertSrc,textureWrapFragSrc);this.gl.uniform1i(this._shaderTextureWrap.getUniform('tex'),0);this._uTextureWrapScale=this._shaderTextureWrap.getUniform('scale');this._uTextureWrapTrans=this._shaderTextureWrap.getUniform('trans');this._uTextureWrapFragOffset=this._shaderTextureWrap.getUniform('fragOffset');this._shaderTextureStretchWrap=makeShader(basicVertSrc,textureStretchWrapFragSrc);this.gl.uniform1i(this._shaderTextureStretchWrap.getUniform('tex'),0);this._uTextureStretchWrapScale=this._shaderTextureStretchWrap.getUniform('scale');this._uTextureStretchWrapTrans=this._shaderTextureStretchWrap.getUniform('trans');this._uTextureStretchWrapFragOffset=this._shaderTextureStretchWrap.getUniform('fragOffset');this._uTextureStretchWrapPixelScale=this._shaderTextureStretchWrap.getUniform('pixelScale');this._shaderNoWrapTexture=makeShader(basicVertSrc,textureNoWrapFragSrc);this.gl.uniform1i(this._shaderNoWrapTexture.getUniform('tex'),0);this._uTextureNoWrapScale=this._shaderNoWrapTexture.getUniform('scale');this._uTextureNoWrapTrans=this._shaderNoWrapTexture.getUniform('trans');this._uTextureNoWrapFragOffset=this._shaderNoWrapTexture.getUniform('fragOffset');this._shaderStretchNoWrapTexture=makeShader(basicVertSrc,textureStretchNoWrapFragSrc);this.gl.uniform1i(this._shaderStretchNoWrapTexture.getUniform('tex'),0);this._uTextureStretchNoWrapScale=this._shaderStretchNoWrapTexture.getUniform('scale');this._uTextureStretchNoWrapTrans=this._shaderStretchNoWrapTexture.getUniform('trans');this._uTextureStretchNoWrapFragOffset=this._shaderStretchNoWrapTexture.getUniform('fragOffset');this._uTextureStretchNoWrapPixelScale=this._shaderStretchNoWrapTexture.getUniform('pixelScale');this._uTextureTrans=null;this._uTextureFragOffset=null;this._shaderNote=new SequencerViewWebGLNoteShaderManager(this.gl);this._shaderFastNote=makeShader(noteVertSrc,fastNoteFragSrc);this._uFastNoteColor=this._shaderFastNote.getUniform('color');this._uFastNoteScale=this._shaderFastNote.getUniform('scale');this._uFastNoteTrans=this._shaderFastNote.getUniform('trans');this._uFastNotePad=this._shaderFastNote.getUniform('pad');this._shaderText=makeShader(basicVertSrc,textFragSrc);this.gl.uniform1i(this._shaderText.getUniform('tex'),0);this._uTextScale=this._shaderText.getUniform('scale');this._uTextTrans=this._shaderText.getUniform('trans');this._uTextFragOffset=this._shaderText.getUniform('fragOffset');this._uTextColor=this._shaderText.getUniform('color');this._noteFontCanvas=document.createElement('canvas');this._noteFontCtx=this._noteFontCanvas.getContext('2d',{alpha:false});this._noteFont=new GLTexture(this.gl,1,1,null,false);this._noteFontSize=-1;this._noteFontGlyphPos=[];this._rebuildNoteFont();this._updateEveryFrameState();}
isOk(){return this.gl!=null;}
isGL(){return true;}
repaint(flags=0){this._repaintFlags|=flags;if(this._repaintId==0){this._repaintId=requestAnimationFrame(()=>this._repaint());}}
setSize(width,height){this.width=Math.round(width);this.height=Math.min(Math.round(height),piano.length*noteHeight);this.canvas.width=this.width;this.canvas.height=this.height;this.repaint();}
snapZoomLevelX(v){const factor=kDefaultNoteWidth*this._timeStepsPerMeasure;const measureWidth=factor*v;const snappedMeasureWidth=Math.round(measureWidth);return snappedMeasureWidth/factor;}
snapZoomLevelY(v){const factor=kDefaultNoteHeight*kNotesPerOctave;const octaveHeight=factor*v;const snappedOctaveHeight=Math.round(octaveHeight);return snappedOctaveHeight/factor;}
setGrid(image,width){}
_repaint(){let doRebuildTileGrid=false;let doInvalidateWholeCache=false;let doRepaintGrid=false;let doRebuildNoteFont=false;if(this._repaintFlags&kRepaintNotesMoved){doRebuildTileGrid=true;doInvalidateWholeCache=true;}
if(this._repaintFlags&kRepaintNotesChanged){doInvalidateWholeCache=true;}
if(this._lastFastGraphics!=this.fastGraphics){this._lastFastGraphics=this.fastGraphics;doInvalidateWholeCache=true;}
if(this._lastAutoscroll!=this.autoScroll){this._lastAutoscroll=this.autoScroll;doRepaintGrid=true;}
if(this._lastWidth!=this.width||this._lastHeight!=this.height){this._lastWidth=this.width;this._lastHeight=this.height;doRepaintGrid=true;}
const timeSig=getTimeSig()
if(this._lastGridSize!=grid||this._lastTimeSig!=timeSig||this._lastScale!=scale){this._lastGridSize=grid;this._lastTimeSig=timeSig;this._lastScale=scale;doRepaintGrid=true;}
const zoomOut=Math.max(this._tileNoteWidth/noteWidth,this._tileNoteHeight/noteHeight);if((this._repaintFlags&kRepaintAfterZoomTimeout)||(zoomOut>3)){this._lastNoteWidth=noteWidth;this._lastNoteHeight=noteHeight;doRebuildTileGrid=true;doInvalidateWholeCache=true;doRepaintGrid=true;doRebuildNoteFont=true;}else if(this._lastNoteWidth!=noteWidth||this._lastNoteHeight!=noteHeight){this._lastNoteWidth=noteWidth;this._lastNoteHeight=noteHeight;window.clearTimeout(this._zoomTimeout);this._zoomTimeout=window.setTimeout(()=>{this._zoomTimeout=null;this.repaint(kRepaintAfterZoomTimeout);},200);}
if(doRebuildTileGrid&&doInvalidateWholeCache){if(this._zoomTimeout!=null){window.clearTimeout(this._zoomTimeout);this._zoomTimeout=null;doRepaintGrid=true;doRebuildNoteFont=true;}
this._tileNoteWidth=this._lastNoteWidth=noteWidth;this._tileNoteHeight=this._lastNoteHeight=noteHeight;}
this._updateEveryFrameState();this._updateNoteStates();if(doRebuildTileGrid)this._rebuildTileGrid();const tBefore=performance.now();if(doInvalidateWholeCache)this._atlas.clear();if(doRepaintGrid)this._repaintGrid();if(doRebuildNoteFont)this._rebuildNoteFont();this._repaintAllVisibleTiles();const tAfter=performance.now();this._repaintId=0;this._repaintFlags=0;const elapsed=tAfter-tBefore;if(elapsed>50&&!this.fastGraphics&&!this._fastGraphicsWarning){message('Try turning on "Fast graphics" in the Tools menu '+'for faster performance.');this._fastGraphicsWarning=true;}}
_updateEveryFrameState(){this._scrollLeft=Math.round(scrollLeft);this._scrollTop=Math.round(scrollTop);this._pianoHeightPix=kNotesInPiano*noteHeight;const maxScrollTop=this._pianoHeightPix-this.height;this._scrollBottom=this._scrollTop-maxScrollTop;this._timeStepsPerMeasure=kTimeStepsPerBeat*getTimeSig();this._pixelScaleX=noteWidth/this._tileNoteWidth;this._pixelScaleY=noteHeight/this._tileNoteHeight;this._pixelStretched=Math.abs(this._pixelScaleX-1)>1e-6||Math.abs(this._pixelScaleX-1)>1e-6;this._tileScaleX=this._t2gx(1)-this._t2gx(0);this._tileScaleY=this._t2gy(1)-this._t2gy(0);}
_repaintGrid(){const cellWidth=this._tileNoteWidth/grid;const cellsPerMeasure=this._timeStepsPerMeasure*grid;this._gridFb.resize(this._b2px(1),this._b2py(0)-this._b2py(1));const gridWidth=this._gridFb.tex.resx;const gridHeight=this._gridFb.tex.resy;this._gridFb.bind();this.gl.clearColor(backgroundColor[0],backgroundColor[1],backgroundColor[2],backgroundColor[3]);this.gl.clear(this.gl.COLOR_BUFFER_BIT);this._shaderRect.bind();const draw=(c,sx,sy,tx,ty)=>{this.gl.uniform4f(this._uRectColor,c[0],c[1],c[2],c[3]);this.gl.uniform2f(this._uRectScale,sx,sy);this.gl.uniform2f(this._uRectTrans,tx,ty);this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,4);};const cy=[];for(let i=0;i<12;++i){cy.push((Math.round(i*gridHeight/12)+0.5)/gridHeight);}
cy.push((gridHeight-0.5)/gridHeight);const cx=[];for(let i=0;i<cellsPerMeasure;++i){cx.push((Math.round(i*gridWidth/cellsPerMeasure)+0.5)/gridWidth);}
cx.push((gridWidth-0.5)/gridWidth);for(let i=0;i<12;++i){if(scale.indexOf(settings.pianoNotes[i])!=-1){draw(keyGuideColor,1,cy[i+1]-cy[i],0,cy[i]);}}
if(autoScroll!=kScrollFollow||!isPlayerMode){const px=1/gridWidth;for(let i=0;i<=cellsPerMeasure;++i){const beatLine=i%Math.round(kTimeStepsPerBeat*grid)==0;draw(beatLine?darkLineColor:lineColor,px,1,cx[i],0);}}
const py=1/gridHeight;draw(darkLineColor,1,py,0,cy[0]);for(let i=1;i<12;++i){draw(lineColor,1,py,0,cy[i]);}
this._gridFb.unbind(this.width,this.height);}
_rebuildNoteFont(){if(_isVeryZoomedOut())return;const fontSize=Math.round(noteHeight*kNoteTextHeight);const font=`${fontSize}px "Lucida Sans Unicode", "Lucida Grande", `+'"Lucida", Arial, sans-serif';this._noteFontCtx.font=font;const totalWidth=kNoteTextGlyphs.length*fontSize;this._noteFontCanvas.width=this._noteFontCanvas.style.width=totalWidth;this._noteFontCanvas.height=this._noteFontCanvas.style.height=fontSize;this._noteFontCtx.font=font;this._noteFontCtx.scale(1,-1);this._noteFontCtx.textAlign='center';this._noteFontCtx.textBaseline='middle';this._noteFontCtx.fillStyle='black';this._noteFontCtx.fillRect(0,0,totalWidth,fontSize);this._noteFontCtx.fillStyle='white';const posy=-0.5*fontSize;for(let i=0;i<kNoteTextGlyphs.length;++i){this._noteFontGlyphPos[kNoteTextGlyphs.charCodeAt(i)]=i*fontSize;this._noteFontCtx.fillText(kNoteTextGlyphs[i],(i+0.5)*fontSize+0.5,posy);const glyphWidth=this._noteFontCtx.measureText(kNoteTextGlyphs[i]).width/fontSize;console.assert(glyphWidth<1);kNoteTextGlyphWidth[kNoteTextGlyphs.charCodeAt(i)]=glyphWidth;}
this._noteFont.setImage(this._noteFontCanvas);this._noteFontSize=fontSize;const glyphScale=fontSize/kTileSize;this._shaderText.bind();this.gl.uniform2f(this._uTextScale,glyphScale,glyphScale);}
_repaintAllVisibleTiles(){this._repaintBackground();const ti0=Math.max(Math.floor(this._g2tx(0)),0);const ti1=Math.max(Math.floor(this._g2tx(1))+1,0);const tj0=clamp(Math.floor(this._g2ty(0)),0,this._tileGrid.length);const tj1=clamp(Math.floor(this._g2ty(1))+1,0,this._tileGrid.length);for(let j=tj0;j<tj1;++j){const row=this._tileGrid[j];for(let i=ti0;i<ti1;++i){const tile=row.get(i);if(tile!=null&&!tile.isInAtlas()){this._repaintTile(tile);}}}
this._prepareForTileRendering();for(let j=tj0;j<tj1;++j){const row=this._tileGrid[j];const transY=this._t2gy(j);for(let i=ti0;i<ti1;++i){const tile=row.get(i);if(tile!=null){if(tile.isInAtlas()){this._atlas.use(tile);}else{console.warn('WebGL tile cache thrashing',ti0,ti1,tj0,tj1,this._atlas.maxSlots);this._repaintTile(tile);this._prepareForTileRendering();}
const transX=this._t2gx(i);this.gl.uniform2f(this._uTextureTrans,transX,transY);this.gl.uniform2f(this._uTextureFragOffset,tile.u*this._pixelScaleX-transX*this.width,tile.v*this._pixelScaleY-transY*this.height);this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,4);}}}}
_repaintBackground(){this._gridFb.tex.bind();const btx=Math.round(this._b2sx(0));const bty=Math.round(this._b2sy(0));if(this._pixelStretched){this._shaderTextureStretchWrap.bind();this.gl.uniform2f(this._uTextureStretchWrapScale,1,1);this.gl.uniform2f(this._uTextureStretchWrapTrans,0,0);this.gl.uniform2f(this._uTextureStretchWrapFragOffset,-btx,-bty);this.gl.uniform2f(this._uTextureStretchWrapPixelScale,this._pixelScaleX,this._pixelScaleY);}else{this._shaderTextureWrap.bind();this.gl.uniform2f(this._uTextureWrapScale,1,1);this.gl.uniform2f(this._uTextureWrapTrans,0,0);this.gl.uniform2f(this._uTextureWrapFragOffset,-btx,-bty);}
this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,4);}
_repaintTile(tile){this._atlas.add(tile);this.gl.clearColor(0,0,0,0);this.gl.clear(this.gl.COLOR_BUFFER_BIT);this._noteFont.bind();const glyphOffsetY=(1-kNoteTextHeight)*this._noteSy/2;const glyphScale=this._noteFontSize/kTileSize;const kDebugTileBorder=false;if(kDebugTileBorder){this._shaderRect.bind();const draw=(c,sx,sy,tx,ty)=>{this.gl.uniform4f(this._uRectColor,c[0],c[1],c[2],c[3]);this.gl.uniform2f(this._uRectScale,sx,sy);this.gl.uniform2f(this._uRectTrans,tx,ty);this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,4);};const p=1/kTileSize;draw([1,0,0,1],1,p,0,0.5*p);draw([1,0,1,1],1,p,0,1-0.5*p);draw([0,1,0,1],p,1,0.5*p,0);draw([0,1,1,1],p,1,1-0.5*p,0);}
for(const n of tile.notes){const note=n.note;if(note.length<1e-5&&!note.selected)continue;const instId=note.instrument;const noteAlpha=instMgr.isLocked(instId)?kNoteLockedAlpha:kNoteUnlockedAlpha;const[_,r,g,b]=getInstrumentColor(song,instId);if(this.fastGraphics){if(note.selected){this._shaderFastNote.bind();this.gl.uniform4f(this._uFastNoteColor,r*noteAlpha/255,g*noteAlpha/255,b*noteAlpha/255,noteAlpha);this.gl.uniform2f(this._uFastNoteScale,n.sx,this._noteSy);this.gl.uniform2f(this._uFastNoteTrans,n.tx,n.ty);}else{this._shaderRect.bind();this.gl.uniform4f(this._uRectColor,r*noteAlpha/255,g*noteAlpha/255,b*noteAlpha/255,noteAlpha);this.gl.uniform2f(this._uRectScale,n.sx,this._noteSy);this.gl.uniform2f(this._uRectTrans,n.tx,n.ty);}
this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,4);}else{const noteSizeInfo=_noteSizeInfo(note);const hasText=noteSizeInfo&kNoteHasText;const hasResize=noteSizeInfo&kNoteHasResizeHandle;const hasVolume=noteSizeInfo&kNoteHasVolumeBar;let noteFlags=0;if(note.selected)noteFlags|=kNoteShaderSelected;if(hasResize)noteFlags|=kNoteShaderResizeHandle;if(hasVolume)noteFlags|=kNoteShaderVolumeBar;const shader=this._shaderNote.bind(noteFlags);this.gl.uniform4f(shader.uColor,r*noteAlpha/255,g*noteAlpha/255,b*noteAlpha/255,noteAlpha);this.gl.uniform2f(shader.uScale,n.sx,this._noteSy);this.gl.uniform2f(shader.uTrans,n.tx,n.ty);if(hasVolume){this.gl.uniform1f(shader.uVolume,clamp(note.volume,0,2));}
this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,4);if(hasText){this._shaderText.bind();const isDark=instMgr.isDarkColor(instId);const glyphAlpha=(isDark?kNoteTextDarkAlpha:kNoteTextLightAlpha)*noteAlpha;const glyphClr=isDark?glyphAlpha:0;this.gl.uniform4f(this._uTextColor,glyphClr,glyphClr,glyphClr,glyphAlpha);let gtx=n.tx;const gty=n.ty+glyphOffsetY;for(let i=0;i<note.type.length;++i){const c=note.type.charCodeAt(i);const gtu=this._noteFontGlyphPos[c];if(gtu==null)continue;this.gl.uniform2f(this._uTextTrans,gtx,gty);this.gl.uniform2f(this._uTextFragOffset,gtu-gtx*kTileSize-tile.u,-gty*kTileSize-tile.v);this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,4);gtx+=glyphScale*kNoteTextGlyphWidth[c];}}}}}
_prepareForTileRendering(){this._gridFb.unbind(this.width,this.height);this._atlas.fb.tex.bind();if(this._pixelStretched){this._shaderStretchNoWrapTexture.bind();this.gl.uniform2f(this._uTextureStretchNoWrapScale,this._tileScaleX,this._tileScaleY);this.gl.uniform2f(this._uTextureStretchNoWrapPixelScale,this._pixelScaleX,this._pixelScaleY);this._uTextureTrans=this._uTextureStretchNoWrapTrans;this._uTextureFragOffset=this._uTextureStretchNoWrapFragOffset;}else{this._shaderNoWrapTexture.bind();this.gl.uniform2f(this._uTextureNoWrapScale,this._tileScaleX,this._tileScaleY);this._uTextureTrans=this._uTextureNoWrapTrans;this._uTextureFragOffset=this._uTextureNoWrapFragOffset;}}
_updateNoteStates(){const start=Math.max(Math.floor((this._scrollLeft-this.width)/noteWidth),0);const stop=Math.min(Math.floor(((this._scrollLeft+this.width)+1)/noteWidth),song.noteColumns.length);const sx=timeIndex=>Math.round(noteWidth*timeIndex)-this._scrollLeft;const sy=pianoIndex=>Math.round(noteHeight*pianoIndex)-this._scrollTop;for(let i=start;i<=stop;++i){const column=song.noteColumns[i];for(const j in column){const note=column[j];note.drawX=sx(note.time);note.drawY=sy(pianoToIndex[note.type]);note.drawWidth=noteWidth*note.length;note.drawX2=sx(note.time+note.length);note.drawHeight=noteHeight;note.drawY2=sy(pianoToIndex[note.type]+1);}}}
isResizeHandle(x,y,note){return(_noteSizeInfo(note)&kNoteHasResizeHandle)&&x>note.drawX+note.drawWidth-8&&x<note.drawX+note.drawWidth-4+2&&y>note.drawY+3&&y<note.drawY+note.drawHeight-3;}
_b2nx(bx){return this._timeStepsPerMeasure*bx;}
_b2ny(by){return kNotesPerOctave*by;}
_n2bx(nx){return nx/this._timeStepsPerMeasure;}
_n2by(ny){return ny/kNotesPerOctave;}
_n2px(nx){return this._tileNoteWidth*nx;}
_n2py(ny){return this._tileNoteHeight*(kNotesInPiano-ny);}
_p2nx(px){return px/this._tileNoteWidth;}
_p2ny(py){return kNotesInPiano-(py/this._tileNoteHeight);}
_p2tx(px){return px/kTileSize;}
_p2ty(py){return py/kTileSize;}
_t2px(tx){return tx*kTileSize;}
_t2py(ty){return ty*kTileSize;}
_s2px(sx){return(sx+this._scrollLeft)/this._pixelScaleX;}
_s2py(sy){return(sy-this._scrollBottom)/this._pixelScaleY;}
_p2sx(px){return(px*this._pixelScaleX)-this._scrollLeft;}
_p2sy(py){return(py*this._pixelScaleY)+this._scrollBottom;}
_g2sx(gx){return gx*this.width;}
_g2sy(gy){return gy*this.height;}
_s2gx(sx){return sx/this.width;}
_s2gy(sy){return sy/this.height;}
_g2tx(gx){return this._p2tx(this._s2px(this._g2sx(gx)));}
_g2ty(gy){return this._p2ty(this._s2py(this._g2sy(gy)));}
_t2gx(tx){return this._s2gx(this._p2sx(this._t2px(tx)));}
_t2gy(ty){return this._s2gy(this._p2sy(this._t2py(ty)));}
_b2px(bx){return this._n2px(this._b2nx(bx));}
_b2py(by){return this._n2py(this._b2ny(by));}
_b2sx(bx){return this._p2sx(this._b2px(bx));}
_b2sy(by){return this._p2sy(this._b2py(by));}
_rebuildTileGrid(){const grid=[];const rows=Math.ceil(this._p2ty(this._n2py(0)));for(let j=0;j<rows;++j)grid.push(new Map());const padpx=1+kNoteSelectionBorderPix;this._noteSy=null;this._notePx=null;this._notePy=null;for(const column of song.noteColumns){for(const nid in column){const n=column[nid];const dpx0=n.offsetX+0.5;const dpx1=dpx0+n.offsetWidth;const dpy=0.5-n.offsetY;const px0=this._n2px(n.time)+dpx0;const px1=this._n2px(n.time+n.length)+dpx1;const ny=pianoToIndex[n.type];const py0=this._n2py(ny+1)+dpy;const py1=this._n2py(ny)+dpy;const tx0=this._p2tx(px0);const tx1=this._p2tx(px1);const ty0=this._p2ty(py0);const ty1=this._p2ty(py1);const tx0p=this._p2tx(px0-padpx);const tx1p=this._p2tx(px1+padpx);const ty0p=this._p2ty(py0-padpx);const ty1p=this._p2ty(py1+padpx);const sx=tx1-tx0;if(this._noteSy==null)this._noteSy=ty1-ty0;if(this._notePx==null)this._notePx=tx0-tx0p;if(this._notePy==null)this._notePy=ty0-ty0p;if(sx<=0)continue;const ti0=Math.max(0,Math.floor(tx0p));const ti1=Math.max(0,Math.floor(tx1p)+1);const tj0=clamp(Math.floor(ty0p),0,grid.length);const tj1=clamp(Math.floor(ty1p)+1,0,grid.length);for(let j=tj0;j<tj1;++j){const row=grid[j];for(let i=ti0;i<ti1;++i){if(!row.has(i))row.set(i,new SequencerViewWebGLTile(i,j));const tile=row.get(i);tile.addNote(n,sx,tx0,ty0);}}}}
this._tileGrid=grid;this._shaderFastNote.bind();this.gl.uniform2f(this._uFastNotePad,this._notePx,this._notePy);this._shaderNote.forEach(shader=>{this.gl.uniform2f(shader.uPad,this._notePx,this._notePy);});}}
function _isVeryZoomedOut(){return noteHeight<11;}
const kNoteHasText=0x01;const kNoteHasResizeHandle=0x02;const kNoteHasVolumeBar=0x04;function _noteSizeInfo(note){let result=0;if(!_isVeryZoomedOut()){const totalLength=note.length*noteWidth+note.offsetWidth;const aspectRatio=totalLength/noteHeight;if(aspectRatio>=1.4){result|=kNoteHasText;}
if((result&kNoteHasText)||(totalLength>23)){result|=kNoteHasResizeHandle;}
if(note.volume!=1&&(result&kNoteHasResizeHandle)){result|=kNoteHasVolumeBar;}}
return result;}
const kTileSize=512;const kMinAtlasSize=kTileSize*6;const kMaxAtlasSize=kTileSize*12;const kNoAtlasSlot=-1;class SequencerViewWebGlTileAtlas{constructor(gl,atlasSize){this.rows=Math.floor(Math.min(atlasSize,kMaxAtlasSize)/kTileSize);this.atlasSize=this.rows*kTileSize;this.maxSlots=this.rows*this.rows;this.nextSlot=0;this.headEntry=new SequencerViewWebGLTile();this.fb=new GLFrameBuffer(gl,this.atlasSize,this.atlasSize);this.clear();}
forEachTile(fn){let failsafe=0;for(let t=this.headEntry.next;t!=this.headEntry;){const n=t.next;fn(t);t=n;++failsafe;if(failsafe>this.maxSlots){console.error('The LRU list is corrupted');break;}}}
clear(){this.forEachTile(t=>{t.slot=kNoAtlasSlot;t.next=t.prev=t;});this.nextSlot=0;this.headEntry.next=this.headEntry;this.headEntry.prev=this.headEntry;}
use(tile){console.assert(tile!=this.headEntry);console.assert(tile.slot!=kNoAtlasSlot);const tn=tile.next;const tp=tile.prev;tp.next=tn;tn.prev=tp;const hn=this.headEntry.next;this.headEntry.next=tile;tile.prev=this.headEntry;hn.prev=tile;tile.next=hn;}
add(tile){console.assert(tile!=this.headEntry);console.assert(tile.slot==kNoAtlasSlot);tile.slot=this.nextSlot<this.maxSlots?this.nextSlot++:this._evict();const hn=this.headEntry.next;this.headEntry.next=tile;tile.prev=this.headEntry;hn.prev=tile;tile.next=hn;tile.u=Math.floor(tile.slot/this.rows)*kTileSize;tile.v=(tile.slot%this.rows)*kTileSize;this.fb.bind(tile.u,tile.v,kTileSize,kTileSize);}
_evict(){const oldest=this.headEntry.prev;console.assert(oldest!=this.headEntry);const slot=oldest.slot;console.assert(slot!=kNoAtlasSlot);oldest.slot=kNoAtlasSlot;this.headEntry.prev=oldest.prev;oldest.prev.next=this.headEntry;oldest.prev=oldest.next=oldest;oldest.u=oldest.v=null;return slot;}
tileScale(){return kTileSize/this.atlasSize;}
_validateAllocatedSlots(name){const s=[];console.assert(this.nextSlot<=this.maxSlots,name,1);for(let i=0;i<this.nextSlot;++i)s.push(false);this.forEachTile(t=>{console.assert(t!=this.headEntry,name,2);console.assert(t.slot!=kNoAtlasSlot,name,3);console.assert(t.slot>=0,name,4);console.assert(t.slot<this.nextSlot,name,5);console.assert(!s[t.slot],name,6);s[t.slot]=true;});for(let i=0;i<this.nextSlot;++i){console.assert(s[i],name,7);}}}
function newSequencerViewWebGlTileAtlas(gl){const atlasSize=gl.getParameter(gl.MAX_TEXTURE_SIZE);if(atlasSize<kMinAtlasSize)return null;return new SequencerViewWebGlTileAtlas(gl,atlasSize);}
class SequencerViewWebGLTile{constructor(ti=null,tj=null){this.ti=ti;this.tj=tj;this.notes=[];this.u=null;this.v=null;this.slot=kNoAtlasSlot;this.next=this;this.prev=this;}
addNote(note,sx,tx,ty){this.notes.push(new SequencerViewWebGLTileNote(note,sx,tx-this.ti,ty-this.tj));}
isInAtlas(){return this.slot!=kNoAtlasSlot;}}
class SequencerViewWebGLTileNote{constructor(note,sx,tx,ty){this.note=note;this.sx=sx;this.tx=tx;this.ty=ty;}}
function makeGlColor(r,g,b,a=1){return[r*a/255,g*a/255,b*a/255,a];}
const backgroundColor=makeGlColor(69,71,76);const keyGuideColor=makeGlColor(102,102,106);const lineColor=makeGlColor(53,54,58,0.5);const darkLineColor=makeGlColor(53,54,58);const outsidePianoColor=makeGlColor(53,54,58);const kNumOctaves=6;const kNotesPerOctave=12;const kNotesInPiano=kNumOctaves*kNotesPerOctave;const kTimeStepsPerBeat=4;const kDefaultNoteWidth=25;const kDefaultNoteHeight=16;const basicVertSrc=`#version 300 es
uniform vec2 scale;
uniform vec2 trans;

in vec2 pos;

void main() {
  gl_Position = vec4((scale * pos + trans) * 2.0 - 1.0, 0, 1);
}
`;const rectFragSrc=`#version 300 es
precision mediump float;
uniform vec4 color;
out vec4 outColor;

void main() {
  outColor = color;
}
`;const noteVertSrc=`#version 300 es
in vec2 pos;
uniform vec2 scale;
uniform vec2 trans;
uniform vec2 pad;
out vec2 uv;

void main() {
  vec2 padScale = scale + 2.0 * pad;
  uv = pos * padScale - (padScale - scale) / 2.0;
  gl_Position = vec4((padScale * pos + trans - pad) * 2.0 - 1.0, 0, 1);
}
`;const kNoteCornerRadius=0.35;const kNoteResizeHandleOpacity=0.2;const kNoteResizeHandleWidth=0.12;const kNoteResizeHandleHeight=0.625;const kNoteResizeHandlePosRightPad=0.2;const kNoteVolumeRightPad=0.35;const kNoteVolumeLeftPad=0.15;const kNoteVolumeHeight=0.12;const kNoteVolumePosBottomPad=0.2;const kNoteVolumeBackgroundOpacity=0.2;const kNoteVolumeForegroundOpacity=0.6;const kNoteSelectionBorderPix=2;const kNoteUnlockedAlpha=1;const kNoteLockedAlpha=0.25;const noteFragSrcStart=`#version 300 es
precision highp float;
uniform vec2 scale;
uniform vec2 pad;
uniform vec4 color;
uniform float volume;
in vec2 uv;
out vec4 outColor;

float atest(float sdf) {
  return sdf <= 0.0 ? 1.0 : 0.0;
}

float rect(vec2 uv, vec2 pos, vec2 scale) {
  return length(max(abs(uv - pos) - scale, 0.0));
}

float aa(float sdf, float bias) {
  // Note that this sdf * kTileSize trick only works because our roundRect sdf
  // doesn't scale the uv at all. So the distance per pixel is the same as the
  // uv difference per pixel.
  return clamp(sdf * ${kTileSize}.0 + bias, 0.0, 1.0);
}

float roundRect(vec2 uv, vec2 pos, vec2 scale, float radius) {
  return radius - length(max(abs(uv - pos) - scale + radius, 0.0));
}

void main() {
  vec2 padScale = scale + 2.0 * pad;
  vec2 halfScale = scale / 2.0;

  // Note background.
  float bgAlpha = aa(roundRect(
      uv, halfScale, halfScale,
      ${kNoteCornerRadius} * min(scale.x, scale.y)), 0.5);
`;const noteFragSrcSelected=`
  // Selection border.
  float borderAlpha = aa(roundRect(
      uv, halfScale, padScale / 2.0,
      ${kNoteCornerRadius} * min(padScale.x, padScale.y)), -0.5);

  // Blend background color with selection border.
  outColor = vec4(color.rgb, 1) * bgAlpha +
      color.a * borderAlpha * borderAlpha * (1.0 - bgAlpha);
`;const noteFragSrcUnselected=`
  // Background color.
  outColor = vec4(color.rgb, 1) * bgAlpha;
`;const noteFragSrcDiscard=`
  if (outColor.a <= 0.0) discard;
`;const noteFragSrcResizeHandle=`
  vec2 rhAlpha = scale.y * vec2(
      ${kNoteResizeHandleWidth / 2}, ${kNoteResizeHandleHeight / 2});
  outColor.rgb *= 1.0 - ${kNoteResizeHandleOpacity} * atest(rect(
      uv, scale * mat2(1, -${kNoteResizeHandlePosRightPad}, 0, 0.5), rhAlpha));
`;const noteFragSrcVolumeBar=`
  vec2 vbScale = scale * mat2(
      0.5, -${(kNoteVolumeRightPad + kNoteVolumeLeftPad) / 2},
      0, ${kNoteVolumeHeight / 2});
  outColor.rgb *= 1.0 - ${kNoteVolumeBackgroundOpacity} * atest(rect(
      uv, scale * mat2(
          0.5, ${(kNoteVolumeLeftPad - kNoteVolumeRightPad) / 2},
          0, ${kNoteVolumePosBottomPad}), vbScale));
  vbScale.x *= volume * 0.5;
  float vbAlpha = ${kNoteVolumeForegroundOpacity} * atest(rect(
      uv, vec2(vbScale.x, 0.0) + scale.y * vec2(
          ${kNoteVolumeLeftPad}, ${kNoteVolumePosBottomPad}),
          vbScale));
  outColor = vbAlpha * color.a + (1.0 - vbAlpha) * outColor;
`;const noteFragSrcEnd=`
  outColor.a *= color.a;
}
`;const kNoteShaderSelected=0x1;const kNoteShaderResizeHandle=0x2;const kNoteShaderVolumeBar=0x4;const kNoteShaderMaxFlag=0x8;class SequencerViewWebGLNoteShaderWrapper{constructor(gl,flags){const fragSrc=`${noteFragSrcStart}
${(flags & kNoteShaderSelected) ? noteFragSrcSelected : noteFragSrcUnselected}
${noteFragSrcDiscard}
${(flags & kNoteShaderResizeHandle) ? noteFragSrcResizeHandle : ''}
${(flags & kNoteShaderVolumeBar) ? noteFragSrcVolumeBar : ''}
${noteFragSrcEnd}`;this._shader=new GLShader(gl,noteVertSrc,fragSrc);this.uColor=this._shader.getUniform('color');this.uScale=this._shader.getUniform('scale');this.uTrans=this._shader.getUniform('trans');this.uPad=this._shader.getUniform('pad');this.uVolume=this._shader.getUniform('volume');const posAttr=this._shader.getAttrib('pos');gl.enableVertexAttribArray(posAttr);gl.vertexAttribPointer(posAttr,2,gl.FLOAT,false,0,0);throwGLError(gl);}}
class SequencerViewWebGLNoteShaderManager{constructor(gl){this._shaders=[];for(let f=0;f<kNoteShaderMaxFlag;++f){if((f&kNoteShaderVolumeBar)&&!(f&kNoteShaderResizeHandle)){continue;}
this._shaders[f]=new SequencerViewWebGLNoteShaderWrapper(gl,f);}}
bind(flags){const shader=this._shaders[flags];console.assert(shader!=null);shader._shader.bind();return shader;}
forEach(fn){for(const shader of this._shaders){if(shader!=null){shader._shader.bind();fn(shader);}}}}
const fastNoteFragSrc=`#version 300 es
precision highp float;
uniform vec2 scale;
uniform vec4 color;
in vec2 uv;
out vec4 outColor;

float rect(vec2 uv, vec2 pos, vec2 scale) {
  return length(max(abs(uv - pos) - scale, 0.0));
}

void main() {
  vec2 halfScale = scale / 2.0;
  float dist = rect(uv, halfScale, halfScale);
  outColor = (dist <= 0.0) ? color : vec4(color.a);
}
`;const textureWrapFragSrc=`#version 300 es
precision mediump float;
uniform sampler2D tex;
uniform vec2 fragOffset;
out vec4 outColor;

void main() {
  vec2 uv = mod(gl_FragCoord.xy + fragOffset, vec2(textureSize(tex, 0)));
  outColor = texelFetch(tex, ivec2(uv), 0);
}
`;const textureStretchWrapFragSrc=`#version 300 es
precision mediump float;
uniform sampler2D tex;
uniform vec2 fragOffset;
uniform vec2 pixelScale;
out vec4 outColor;

void main() {
  vec2 uv = mod(
      (gl_FragCoord.xy + fragOffset) / pixelScale, vec2(textureSize(tex, 0)));
  outColor = texture(tex, uv / vec2(textureSize(tex, 0)));
}
`;const textureNoWrapFragSrc=`#version 300 es
precision mediump float;
uniform sampler2D tex;
uniform vec2 fragOffset;
out vec4 outColor;

void main() {
  ivec2 uv = ivec2(gl_FragCoord.xy + fragOffset);
  outColor = texelFetch(tex, uv, 0);
}
`;const textureStretchNoWrapFragSrc=`#version 300 es
precision mediump float;
uniform sampler2D tex;
uniform vec2 fragOffset;
uniform vec2 pixelScale;
out vec4 outColor;

void main() {
  vec2 uv = (gl_FragCoord.xy + fragOffset) / pixelScale;
  outColor = texture(tex, uv / vec2(textureSize(tex, 0)));
}
`;const kNoteTextGlyphs='ABCDEFG234567#';const kNoteTextRefGlyph='D';const kNoteTextHeight=0.625;const kNoteTextDarkAlpha=0.9;const kNoteTextLightAlpha=0.45;const kNoteTextGlyphWidth=[];const textFragSrc=`#version 300 es
precision mediump float;
uniform sampler2D tex;
uniform vec4 color;
uniform vec2 fragOffset;
out vec4 outColor;

void main() {
  ivec2 uv = ivec2(gl_FragCoord.xy + fragOffset);
  vec4 glyphColor = texelFetch(tex, uv, 0);
  glyphColor.a = (glyphColor.r + glyphColor.g + glyphColor.b) / 3.0;
  outColor = glyphColor * color;
}
`;const _debugGL=false;function throwGLError(gl){if(_debugGL){const error=gl.getError();if(error!=gl.NO_ERROR){console.error(`OpenGL error: ${error}`);throw`OpenGL error: ${error}`;}}}
class GLShader{constructor(gl,vertSrc,fragSrc){this.gl=gl;const compile=(type,src)=>{const id=this.gl.createShader(type);this.gl.shaderSource(id,src);this.gl.compileShader(id);throwGLError(this.gl);return id;};this.vid=compile(this.gl.VERTEX_SHADER,vertSrc);this.fid=compile(this.gl.FRAGMENT_SHADER,fragSrc);this.id=this.gl.createProgram();this.gl.attachShader(this.id,this.vid);this.gl.attachShader(this.id,this.fid);this.gl.linkProgram(this.id);throwGLError(this.gl);const validateProgram=()=>{if(this.gl.getShaderParameter(this.vid,this.gl.COMPILE_STATUS)&&this.gl.getShaderParameter(this.fid,this.gl.COMPILE_STATUS)){this.gl.validateProgram(this.id);return this.gl.getProgramParameter(this.id,this.gl.VALIDATE_STATUS);}
return false;};if(!validateProgram()){console.error('=== Shader failed to compile ===',`\n\nVertex shader log:\n${this.gl.getShaderInfoLog(this.vid)}`,`\n\nFragment shader log:\n${this.gl.getShaderInfoLog(this.fid)}`,`\n\nProgram log:\n${this.gl.getProgramInfoLog(this.id)}`);}
this.bind();}
bind(){this.gl.useProgram(this.id);throwGLError(this.gl);}
getUniform(name){const loc=this.gl.getUniformLocation(this.id,name);throwGLError(this.gl);return loc;}
getAttrib(name){const loc=this.gl.getAttribLocation(this.id,name);throwGLError(this.gl);return loc;}}
class GLTexture{constructor(gl,resx=1,resy=1,data=null,smooth=true){this.gl=gl;this.id=this.gl.createTexture();throwGLError(this.gl);this.bind();this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,smooth?this.gl.LINEAR:this.gl.NEAREST);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,smooth?this.gl.LINEAR:this.gl.NEAREST);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT);this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT);throwGLError(this.gl);this.resize(resx,resy,data);}
static fromUrl(gl,url,onload=null){const pixel=new Uint8Array([255,255,255,255]);const tex=new GLTexture(gl,1,1,pixel);const image=new Image();image.onload=()=>{tex.setImage(image);tex.mipmap();if(onload)onload();};image.src=url;return tex;}
resize(resx,resy,data=null){this.resx=resx<1?1:Math.round(resx);this.resy=resy<1?1:Math.round(resy);this.bind();this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.resx,this.resy,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,data);throwGLError(this.gl);}
setImage(image){this.bind();this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,image);this.resx=image.width;this.resy=image.height;throwGLError(this.gl);}
bind(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.id);throwGLError(this.gl);}
mipmap(){this.bind();this.gl.generateMipmap(this.gl.TEXTURE_2D);throwGLError(this.gl);}}
class GLFrameBuffer{constructor(gl,resx=1,resy=1){this.gl=gl;this.tex=new GLTexture(gl,resx,resy,null);this.fb=this.gl.createFramebuffer();throwGLError(this.gl);this.bind();throwGLError(this.gl);this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.tex.id,0);throwGLError(this.gl);}
bind(x=0,y=0,width=0,height=0){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fb);throwGLError(this.gl);this._viewport(x,y,width>0?width:this.tex.resx,height>0?height:this.tex.resy);}
unbind(resx,resy,x=0,y=0){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);throwGLError(this.gl);this._viewport(x,y,resx,resy);}
_viewport(x,y,w,h){this.gl.viewport(x,y,w,h);this.gl.scissor(x,y,w,h);}
resize(resx,resy){this.tex.resize(resx,resy);}
view(){if(GLFrameBuffer_shaderViewFbo==null){GLFrameBuffer_shaderViewFbo=new GLShader(this.gl,'attribute vec2 p;varying vec2 u;void main(){u=p;gl_Position=vec4(p*2.-1.,0,1);}','precision mediump float;uniform sampler2D t;varying vec2 u;void main(){gl_FragColor=texture2D(t,u);}');}
this.unbind(this.tex.resx,this.tex.resy,100,100);GLFrameBuffer_shaderViewFbo.bind();this.gl.activeTexture(this.gl.TEXTURE0);this.tex.bind();throwGLError(this.gl);this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,4);}}
let GLFrameBuffer_shaderViewFbo=null;var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}
return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}
a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).i}},"es6","es3");$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"endsWith");a+="";void 0===c&&(c=b.length);c=Math.max(0,Math.min(c|0,b.length));for(var e=a.length;0<e&&0<c;)
if(b[--c]!=a[--e])return!1;return 0>=e}},"es6","es3");$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var e=b.length,f=a.length;c=Math.max(0,Math.min(c|0,b.length));for(var g=0;g<f&&c<e;)
if(b[c++]!=a[g++])return!1;return g>=f}},"es6","es3");$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var b=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var d="";a;)
if(a&1&&(d+=b),a>>>=1)b+=b;return d}},"es6","es3");var COMPILED=!0,goog=goog||{};goog.global=this||self;goog.isDef=function(a){return void 0!==a};goog.isString=function(a){return"string"==typeof a};goog.isBoolean=function(a){return"boolean"==typeof a};goog.isNumber=function(a){return"number"==typeof a};goog.exportPath_=function(a,b,c){a=a.split(".");c=c||goog.global;a[0]in c||"undefined"==typeof c.execScript||c.execScript("var "+a[0]);for(var d;a.length&&(d=a.shift());)!a.length&&goog.isDef(b)?c[d]=b:c=c[d]&&c[d]!==Object.prototype[d]?c[d]:c[d]={}};goog.define=function(a,b){if(!COMPILED){var c=goog.global.CLOSURE_UNCOMPILED_DEFINES,d=goog.global.CLOSURE_DEFINES;c&&void 0===c.nodeType&&Object.prototype.hasOwnProperty.call(c,a)?b=c[a]:d&&void 0===d.nodeType&&Object.prototype.hasOwnProperty.call(d,a)&&(b=d[a])}
return b};goog.FEATURESET_YEAR=2012;goog.DEBUG=!0;goog.LOCALE="en";goog.TRUSTED_SITE=!0;goog.STRICT_MODE_COMPATIBLE=!1;goog.DISALLOW_TEST_ONLY_CODE=COMPILED&&!goog.DEBUG;goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING=!1;goog.provide=function(a){if(goog.isInModuleLoader_())throw Error("goog.provide cannot be used within a module.");if(!COMPILED&&goog.isProvided_(a))throw Error('Namespace "'+a+'" already declared.');goog.constructNamespace_(a)};goog.constructNamespace_=function(a,b){if(!COMPILED){delete goog.implicitNamespaces_[a];for(var c=a;(c=c.substring(0,c.lastIndexOf(".")))&&!goog.getObjectByName(c);)goog.implicitNamespaces_[c]=!0}
goog.exportPath_(a,b)};goog.getScriptNonce=function(a){if(a&&a!=goog.global)return goog.getScriptNonce_(a.document);null===goog.cspNonce_&&(goog.cspNonce_=goog.getScriptNonce_(goog.global.document));return goog.cspNonce_};goog.NONCE_PATTERN_=/^[\w+/_-]+[=]{0,2}$/;goog.cspNonce_=null;goog.getScriptNonce_=function(a){return(a=a.querySelector&&a.querySelector("script[nonce]"))&&(a=a.nonce||a.getAttribute("nonce"))&&goog.NONCE_PATTERN_.test(a)?a:""};goog.VALID_MODULE_RE_=/^[a-zA-Z_$][a-zA-Z0-9._$]*$/;goog.module=function(a){if(!goog.isString(a)||!a||-1==a.search(goog.VALID_MODULE_RE_))throw Error("Invalid module identifier");if(!goog.isInGoogModuleLoader_())throw Error("Module "+a+" has been loaded incorrectly. Note, modules cannot be loaded as normal scripts. They require some kind of pre-processing step. You're likely trying to load a module via a script tag or as a part of a concatenated bundle without rewriting the module. For more info see: https://github.com/google/closure-library/wiki/goog.module:-an-ES6-module-like-alternative-to-goog.provide.");if(goog.moduleLoaderState_.moduleName)throw Error("goog.module may only be called once per module.");goog.moduleLoaderState_.moduleName=a;if(!COMPILED){if(goog.isProvided_(a))throw Error('Namespace "'+a+'" already declared.');delete goog.implicitNamespaces_[a]}};goog.module.get=function(a){return goog.module.getInternal_(a)};goog.module.getInternal_=function(a){if(!COMPILED){if(a in goog.loadedModules_)return goog.loadedModules_[a].exports;if(!goog.implicitNamespaces_[a])return a=goog.getObjectByName(a),null!=a?a:null}
return null};goog.ModuleType={ES6:"es6",GOOG:"goog"};goog.moduleLoaderState_=null;goog.isInModuleLoader_=function(){return goog.isInGoogModuleLoader_()||goog.isInEs6ModuleLoader_()};goog.isInGoogModuleLoader_=function(){return!!goog.moduleLoaderState_&&goog.moduleLoaderState_.type==goog.ModuleType.GOOG};goog.isInEs6ModuleLoader_=function(){if(goog.moduleLoaderState_&&goog.moduleLoaderState_.type==goog.ModuleType.ES6)return!0;var a=goog.global.$jscomp;return a?"function"!=typeof a.getCurrentModulePath?!1:!!a.getCurrentModulePath():!1};goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInGoogModuleLoader_())throw Error("goog.module.declareLegacyNamespace must be called from within a goog.module");if(!COMPILED&&!goog.moduleLoaderState_.moduleName)throw Error("goog.module must be called prior to goog.module.declareLegacyNamespace.");goog.moduleLoaderState_.declareLegacyNamespace=!0};goog.declareModuleId=function(a){if(!COMPILED){if(!goog.isInEs6ModuleLoader_())throw Error("goog.declareModuleId may only be called from within an ES6 module");if(goog.moduleLoaderState_&&goog.moduleLoaderState_.moduleName)throw Error("goog.declareModuleId may only be called once per module.");if(a in goog.loadedModules_)throw Error('Module with namespace "'+a+'" already exists.');}
if(goog.moduleLoaderState_)goog.moduleLoaderState_.moduleName=a;else{var b=goog.global.$jscomp;if(!b||"function"!=typeof b.getCurrentModulePath)throw Error('Module with namespace "'+
a+'" has been loaded incorrectly.');b=b.require(b.getCurrentModulePath());goog.loadedModules_[a]={exports:b,type:goog.ModuleType.ES6,moduleId:a}}};goog.setTestOnly=function(a){if(goog.DISALLOW_TEST_ONLY_CODE)throw a=a||"",Error("Importing test-only code into non-debug environment"+(a?": "+a:"."));};goog.forwardDeclare=function(a){};COMPILED||(goog.isProvided_=function(a){return a in goog.loadedModules_||!goog.implicitNamespaces_[a]&&goog.isDefAndNotNull(goog.getObjectByName(a))},goog.implicitNamespaces_={"goog.module":!0});goog.getObjectByName=function(a,b){a=a.split(".");b=b||goog.global;for(var c=0;c<a.length;c++)
if(b=b[a[c]],!goog.isDefAndNotNull(b))return null;return b};goog.globalize=function(a,b){b=b||goog.global;for(var c in a)b[c]=a[c]};goog.addDependency=function(a,b,c,d){!COMPILED&&goog.DEPENDENCIES_ENABLED&&goog.debugLoader_.addDependency(a,b,c,d)};goog.ENABLE_DEBUG_LOADER=!0;goog.logToConsole_=function(a){goog.global.console&&goog.global.console.error(a)};goog.require=function(a){if(!COMPILED){goog.ENABLE_DEBUG_LOADER&&goog.debugLoader_.requested(a);if(goog.isProvided_(a)){if(goog.isInModuleLoader_())return goog.module.getInternal_(a)}else if(goog.ENABLE_DEBUG_LOADER){var b=goog.moduleLoaderState_;goog.moduleLoaderState_=null;try{goog.debugLoader_.load_(a)}finally{goog.moduleLoaderState_=b}}
return null}};goog.requireType=function(a){return{}};goog.basePath="";goog.nullFunction=function(){};goog.abstractMethod=function(){throw Error("unimplemented abstract method");};goog.addSingletonGetter=function(a){a.instance_=void 0;a.getInstance=function(){if(a.instance_)return a.instance_;goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=a);return a.instance_=new a}};goog.instantiatedSingletons_=[];goog.LOAD_MODULE_USING_EVAL=!0;goog.SEAL_MODULE_EXPORTS=goog.DEBUG;goog.loadedModules_={};goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER;goog.TRANSPILE="detect";goog.ASSUME_ES_MODULES_TRANSPILED=!1;goog.TRANSPILE_TO_LANGUAGE="";goog.TRANSPILER="transpile.js";goog.hasBadLetScoping=null;goog.useSafari10Workaround=function(){if(null==goog.hasBadLetScoping){try{var a=!eval('"use strict";let x = 1; function f() { return typeof x; };f() == "number";')}catch(b){a=!1}
goog.hasBadLetScoping=a}
return goog.hasBadLetScoping};goog.workaroundSafari10EvalBug=function(a){return"(function(){"+a+"\n;})();\n"};goog.loadModule=function(a){var b=goog.moduleLoaderState_;try{goog.moduleLoaderState_={moduleName:"",declareLegacyNamespace:!1,type:goog.ModuleType.GOOG};if(goog.isFunction(a))var c=a.call(void 0,{});else if(goog.isString(a))goog.useSafari10Workaround()&&(a=goog.workaroundSafari10EvalBug(a)),c=goog.loadModuleFromSource_.call(void 0,a);else throw Error("Invalid module definition");var d=goog.moduleLoaderState_.moduleName;if(goog.isString(d)&&d)goog.moduleLoaderState_.declareLegacyNamespace?goog.constructNamespace_(d,c):goog.SEAL_MODULE_EXPORTS&&Object.seal&&"object"==typeof c&&null!=c&&Object.seal(c),goog.loadedModules_[d]={exports:c,type:goog.ModuleType.GOOG,moduleId:goog.moduleLoaderState_.moduleName};else throw Error('Invalid module name "'+d+'"');}finally{goog.moduleLoaderState_=b}};goog.loadModuleFromSource_=function(a){eval(a);return{}};goog.normalizePath_=function(a){a=a.split("/");for(var b=0;b<a.length;)"."==a[b]?a.splice(b,1):b&&".."==a[b]&&a[b-1]&&".."!=a[b-1]?a.splice(--b,2):b++;return a.join("/")};goog.loadFileSync_=function(a){if(goog.global.CLOSURE_LOAD_FILE_SYNC)return goog.global.CLOSURE_LOAD_FILE_SYNC(a);try{var b=new goog.global.XMLHttpRequest;b.open("get",a,!1);b.send();return 0==b.status||200==b.status?b.responseText:null}catch(c){return null}};goog.transpile_=function(a,b,c){var d=goog.global.$jscomp;d||(goog.global.$jscomp=d={});var e=d.transpile;if(!e){var f=goog.basePath+goog.TRANSPILER,g=goog.loadFileSync_(f);if(g){(function(){(0,eval)(g+"\n//# sourceURL="+f)}).call(goog.global);if(goog.global.$gwtExport&&goog.global.$gwtExport.$jscomp&&!goog.global.$gwtExport.$jscomp.transpile)throw Error('The transpiler did not properly export the "transpile" method. $gwtExport: '+JSON.stringify(goog.global.$gwtExport));goog.global.$jscomp.transpile=goog.global.$gwtExport.$jscomp.transpile;d=goog.global.$jscomp;e=d.transpile}}
e||(e=d.transpile=function(a,b){goog.logToConsole_(b+" requires transpilation but no transpiler was found.");return a});return e(a,b,c)};goog.typeOf=function(a){var b=typeof a;if("object"==b)
if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";else if("function"==b&&"undefined"==typeof a.call)return"object";return b};goog.isNull=function(a){return null===a};goog.isDefAndNotNull=function(a){return null!=a};goog.isArray=function(a){return"array"==goog.typeOf(a)};goog.isArrayLike=function(a){var b=goog.typeOf(a);return"array"==b||"object"==b&&"number"==typeof a.length};goog.isDateLike=function(a){return goog.isObject(a)&&"function"==typeof a.getFullYear};goog.isFunction=function(a){return"function"==goog.typeOf(a)};goog.isObject=function(a){var b=typeof a;return"object"==b&&null!=a||"function"==b};goog.getUid=function(a){return a[goog.UID_PROPERTY_]||(a[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.hasUid=function(a){return!!a[goog.UID_PROPERTY_]};goog.removeUid=function(a){null!==a&&"removeAttribute"in a&&a.removeAttribute(goog.UID_PROPERTY_);try{delete a[goog.UID_PROPERTY_]}catch(b){}};goog.UID_PROPERTY_="closure_uid_"+(1E9*Math.random()>>>0);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;goog.cloneObject=function(a){var b=goog.typeOf(a);if("object"==b||"array"==b){if("function"===typeof a.clone)return a.clone();b="array"==b?[]:{};for(var c in a)b[c]=goog.cloneObject(a[c]);return b}
return a};goog.bindNative_=function(a,b,c){return a.call.apply(a.bind,arguments)};goog.bindJs_=function(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}
return function(){return a.apply(b,arguments)}};goog.bind=function(a,b,c){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bind=goog.bindNative_:goog.bind=goog.bindJs_;return goog.bind.apply(null,arguments)};goog.partial=function(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}};goog.mixin=function(a,b){for(var c in b)a[c]=b[c]};goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date};goog.globalEval=function(a){if(goog.global.execScript)goog.global.execScript(a,"JavaScript");else if(goog.global.eval){if(null==goog.evalWorksForGlobals_){try{goog.global.eval("var _evalTest_ = 1;")}catch(d){}
if("undefined"!=typeof goog.global._evalTest_){try{delete goog.global._evalTest_}catch(d){}
goog.evalWorksForGlobals_=!0}else goog.evalWorksForGlobals_=!1}
if(goog.evalWorksForGlobals_)goog.global.eval(a);else{var b=goog.global.document,c=b.createElement("SCRIPT");c.type="text/javascript";c.defer=!1;c.appendChild(b.createTextNode(a));b.head.appendChild(c);b.head.removeChild(c)}}else throw Error("goog.globalEval not available");};goog.evalWorksForGlobals_=null;goog.getCssName=function(a,b){if("."==String(a).charAt(0))throw Error('className passed in goog.getCssName must not start with ".". You passed: '+a);var c=function(a){return goog.cssNameMapping_[a]||a},d=function(a){a=a.split("-");for(var b=[],d=0;d<a.length;d++)b.push(c(a[d]));return b.join("-")};d=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?c:d:function(a){return a};a=b?a+"-"+d(b):d(a);return goog.global.CLOSURE_CSS_NAME_MAP_FN?goog.global.CLOSURE_CSS_NAME_MAP_FN(a):a};goog.setCssNameMapping=function(a,b){goog.cssNameMapping_=a;goog.cssNameMappingStyle_=b};!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING);goog.getMsg=function(a,b,c){c&&c.html&&(a=a.replace(/</g,"&lt;"));b&&(a=a.replace(/\{\$([^}]+)}/g,function(a,c){return null!=b&&c in b?b[c]:a}));return a};goog.getMsgWithFallback=function(a,b){return a};goog.exportSymbol=function(a,b,c){goog.exportPath_(a,b,c)};goog.exportProperty=function(a,b,c){a[b]=c};goog.inherits=function(a,b){function c(){}
c.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.base=function(a,c,f){for(var d=Array(arguments.length-2),e=2;e<arguments.length;e++)d[e-2]=arguments[e];return b.prototype[c].apply(a,d)}};goog.base=function(a,b,c){var d=arguments.callee.caller;if(goog.STRICT_MODE_COMPATIBLE||goog.DEBUG&&!d)throw Error("arguments.caller not defined.  goog.base() cannot be used with strict mode code. See http://www.ecma-international.org/ecma-262/5.1/#sec-C");if("undefined"!==typeof d.superClass_){for(var e=Array(arguments.length-1),f=1;f<arguments.length;f++)e[f-1]=arguments[f];return d.superClass_.constructor.apply(a,e)}
if("string"!=typeof b&&"symbol"!=typeof b)throw Error("method names provided to goog.base must be a string or a symbol");e=Array(arguments.length-2);for(f=2;f<arguments.length;f++)e[f-2]=arguments[f];f=!1;for(var g=a.constructor.prototype;g;g=Object.getPrototypeOf(g))
if(g[b]===d)f=!0;else if(f)return g[b].apply(a,e);if(a[b]===d)return a.constructor.prototype[b].apply(a,e);throw Error("goog.base called from a method of one name to a method of a different name");};goog.scope=function(a){if(goog.isInModuleLoader_())throw Error("goog.scope is not supported within a module.");a.call(goog.global)};COMPILED||(goog.global.COMPILED=COMPILED);goog.defineClass=function(a,b){var c=b.constructor,d=b.statics;c&&c!=Object.prototype.constructor||(c=function(){throw Error("cannot instantiate an interface (no constructor defined).");});c=goog.defineClass.createSealingConstructor_(c,a);a&&goog.inherits(c,a);delete b.constructor;delete b.statics;goog.defineClass.applyProperties_(c.prototype,b);null!=d&&(d instanceof Function?d(c):goog.defineClass.applyProperties_(c,d));return c};goog.defineClass.SEAL_CLASS_INSTANCES=goog.DEBUG;goog.defineClass.createSealingConstructor_=function(a,b){if(!goog.defineClass.SEAL_CLASS_INSTANCES)return a;var c=!goog.defineClass.isUnsealable_(b),d=function(){var b=a.apply(this,arguments)||this;b[goog.UID_PROPERTY_]=b[goog.UID_PROPERTY_];this.constructor===d&&c&&Object.seal instanceof Function&&Object.seal(b);return b};return d};goog.defineClass.isUnsealable_=function(a){return a&&a.prototype&&a.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]};goog.defineClass.OBJECT_PROTOTYPE_FIELDS_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");goog.defineClass.applyProperties_=function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c]);for(var d=0;d<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;d++)c=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[d],Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])};goog.tagUnsealableClass=function(a){!COMPILED&&goog.defineClass.SEAL_CLASS_INSTANCES&&(a.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]=!0)};goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_="goog_defineClass_legacy_unsealable";!COMPILED&&goog.DEPENDENCIES_ENABLED&&(goog.inHtmlDocument_=function(){var a=goog.global.document;return null!=a&&"write"in a},goog.isDocumentLoading_=function(){var a=goog.global.document;return a.attachEvent?"complete"!=a.readyState:"loading"==a.readyState},goog.findBasePath_=function(){if(goog.isDef(goog.global.CLOSURE_BASE_PATH)&&goog.isString(goog.global.CLOSURE_BASE_PATH))goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_()){var a=goog.global.document,b=a.currentScript;a=b?[b]:a.getElementsByTagName("SCRIPT");for(b=a.length-1;0<=b;--b){var c=a[b].src,d=c.lastIndexOf("?");d=-1==d?c.length:d;if("base.js"==c.substr(d-7,7)){goog.basePath=c.substr(0,d-7);break}}}},goog.findBasePath_(),goog.Transpiler=function(){this.requiresTranspilation_=null;this.transpilationTarget_=goog.TRANSPILE_TO_LANGUAGE},goog.Transpiler.prototype.createRequiresTranspilation_=function(){function a(a,b){e?d[a]=!0:b()?(c=a,d[a]=!1):e=d[a]=!0}
function b(a){try{return!!eval(a)}catch(h){return!1}}
var c="es3",d={es3:!1},e=!1,f=goog.global.navigator&&goog.global.navigator.userAgent?goog.global.navigator.userAgent:"";a("es5",function(){return b("[1,].length==1")});a("es6",function(){return f.match(/Edge\/(\d+)(\.\d)*/i)?!1:b('(()=>{"use strict";class X{constructor(){if(new.target!=String)throw 1;this.x=42}}let q=Reflect.construct(X,[],String);if(q.x!=42||!(q instanceof String))throw 1;for(const a of[2,3]){if(a==2)continue;function f(z={a}){let a=0;return z.a}{function f(){return 0;}}return f()==3}})()')});a("es7",function(){return b("2 ** 2 == 4")});a("es8",function(){return b("async () => 1, true")});a("es9",function(){return b("({...rest} = {}), true")});a("es_next",function(){return!1});return{target:c,map:d}},goog.Transpiler.prototype.needsTranspile=function(a,b){if("always"==goog.TRANSPILE)return!0;if("never"==goog.TRANSPILE)return!1;if(!this.requiresTranspilation_){var c=this.createRequiresTranspilation_();this.requiresTranspilation_=c.map;this.transpilationTarget_=this.transpilationTarget_||c.target}
if(a in this.requiresTranspilation_)return this.requiresTranspilation_[a]?!0:!goog.inHtmlDocument_()||"es6"!=b||"noModule"in goog.global.document.createElement("script")?!1:!0;throw Error("Unknown language mode: "+a);},goog.Transpiler.prototype.transpile=function(a,b){return goog.transpile_(a,b,this.transpilationTarget_)},goog.transpiler_=new goog.Transpiler,goog.protectScriptTag_=function(a){return a.replace(/<\/(SCRIPT)/ig,"\\x3c/$1")},goog.DebugLoader_=function(){this.dependencies_={};this.idToPath_={};this.written_={};this.loadingDeps_=[];this.depsToLoad_=[];this.paused_=!1;this.factory_=new goog.DependencyFactory(goog.transpiler_);this.deferredCallbacks_={};this.deferredQueue_=[]},goog.DebugLoader_.prototype.bootstrap=function(a,b){function c(){d&&(goog.global.setTimeout(d,0),d=null)}
var d=b;if(a.length){b=[];for(var e=0;e<a.length;e++){var f=this.getPathFromDeps_(a[e]);if(!f)throw Error("Unregonized namespace: "+a[e]);b.push(this.dependencies_[f])}
f=goog.require;var g=0;for(e=0;e<a.length;e++)f(a[e]),b[e].onLoad(function(){++g==a.length&&c()})}else c()},goog.DebugLoader_.prototype.loadClosureDeps=function(){this.depsToLoad_.push(this.factory_.createDependency(goog.normalizePath_(goog.basePath+"deps.js"),"deps.js",[],[],{},!1));this.loadDeps_()},goog.DebugLoader_.prototype.requested=function(a,b){(a=this.getPathFromDeps_(a))&&(b||this.areDepsLoaded_(this.dependencies_[a].requires))&&(b=this.deferredCallbacks_[a])&&(delete this.deferredCallbacks_[a],b())},goog.DebugLoader_.prototype.setDependencyFactory=function(a){this.factory_=a},goog.DebugLoader_.prototype.load_=function(a){if(this.getPathFromDeps_(a)){var b=this,c=[],d=function(a){var e=b.getPathFromDeps_(a);if(!e)throw Error("Bad dependency path or symbol: "+a);if(!b.written_[e]){b.written_[e]=!0;a=b.dependencies_[e];for(e=0;e<a.requires.length;e++)goog.isProvided_(a.requires[e])||d(a.requires[e]);c.push(a)}};d(a);a=!!this.depsToLoad_.length;this.depsToLoad_=this.depsToLoad_.concat(c);this.paused_||a||this.loadDeps_()}else throw a="goog.require could not find: "+
a,goog.logToConsole_(a),Error(a);},goog.DebugLoader_.prototype.loadDeps_=function(){for(var a=this,b=this.paused_;this.depsToLoad_.length&&!b;)(function(){var c=!1,d=a.depsToLoad_.shift(),e=!1;a.loading_(d);var f={pause:function(){if(c)throw Error("Cannot call pause after the call to load.");b=!0},resume:function(){c?a.resume_():b=!1},loaded:function(){if(e)throw Error("Double call to loaded.");e=!0;a.loaded_(d)},pending:function(){for(var b=[],c=0;c<a.loadingDeps_.length;c++)b.push(a.loadingDeps_[c]);return b},setModuleState:function(a){goog.moduleLoaderState_={type:a,moduleName:"",declareLegacyNamespace:!1}},registerEs6ModuleExports:function(a,b,c){c&&(goog.loadedModules_[c]={exports:b,type:goog.ModuleType.ES6,moduleId:c||""})},registerGoogModuleExports:function(a,b){goog.loadedModules_[a]={exports:b,type:goog.ModuleType.GOOG,moduleId:a}},clearModuleState:function(){goog.moduleLoaderState_=null},defer:function(b){if(c)throw Error("Cannot register with defer after the call to load.");a.defer_(d,b)},areDepsLoaded:function(){return a.areDepsLoaded_(d.requires)}};try{d.load(f)}finally{c=!0}})();b&&this.pause_()},goog.DebugLoader_.prototype.pause_=function(){this.paused_=!0},goog.DebugLoader_.prototype.resume_=function(){this.paused_&&(this.paused_=!1,this.loadDeps_())},goog.DebugLoader_.prototype.loading_=function(a){this.loadingDeps_.push(a)},goog.DebugLoader_.prototype.loaded_=function(a){for(var b=0;b<this.loadingDeps_.length;b++)
if(this.loadingDeps_[b]==a){this.loadingDeps_.splice(b,1);break}for(b=0;b<this.deferredQueue_.length;b++)
if(this.deferredQueue_[b]==a.path){this.deferredQueue_.splice(b,1);break}if(this.loadingDeps_.length==this.deferredQueue_.length&&!this.depsToLoad_.length)
for(;this.deferredQueue_.length;)this.requested(this.deferredQueue_.shift(),!0);a.loaded()},goog.DebugLoader_.prototype.areDepsLoaded_=function(a){for(var b=0;b<a.length;b++){var c=this.getPathFromDeps_(a[b]);if(!c||!(c in this.deferredCallbacks_||goog.isProvided_(a[b])))return!1}
return!0},goog.DebugLoader_.prototype.getPathFromDeps_=function(a){return a in this.idToPath_?this.idToPath_[a]:a in this.dependencies_?a:null},goog.DebugLoader_.prototype.defer_=function(a,b){this.deferredCallbacks_[a.path]=b;this.deferredQueue_.push(a.path)},goog.LoadController=function(){},goog.LoadController.prototype.pause=function(){},goog.LoadController.prototype.resume=function(){},goog.LoadController.prototype.loaded=function(){},goog.LoadController.prototype.pending=function(){},goog.LoadController.prototype.registerEs6ModuleExports=function(a,b,c){},goog.LoadController.prototype.setModuleState=function(a){},goog.LoadController.prototype.clearModuleState=function(){},goog.LoadController.prototype.defer=function(a){},goog.LoadController.prototype.areDepsLoaded=function(){},goog.Dependency=function(a,b,c,d,e){this.path=a;this.relativePath=b;this.provides=c;this.requires=d;this.loadFlags=e;this.loaded_=!1;this.loadCallbacks_=[]},goog.Dependency.prototype.getPathName=function(){var a=this.path,b=a.indexOf("://");0<=b&&(a=a.substring(b+3),b=a.indexOf("/"),0<=b&&(a=a.substring(b+1)));return a},goog.Dependency.prototype.onLoad=function(a){this.loaded_?a():this.loadCallbacks_.push(a)},goog.Dependency.prototype.loaded=function(){this.loaded_=!0;var a=this.loadCallbacks_;this.loadCallbacks_=[];for(var b=0;b<a.length;b++)a[b]()},goog.Dependency.defer_=!1,goog.Dependency.callbackMap_={},goog.Dependency.registerCallback_=function(a){var b=Math.random().toString(32);goog.Dependency.callbackMap_[b]=a;return b},goog.Dependency.unregisterCallback_=function(a){delete goog.Dependency.callbackMap_[a]},goog.Dependency.callback_=function(a,b){if(a in goog.Dependency.callbackMap_){for(var c=goog.Dependency.callbackMap_[a],d=[],e=1;e<arguments.length;e++)d.push(arguments[e]);c.apply(void 0,d)}else throw Error("Callback key "+a+" does not exist (was base.js loaded more than once?).");},goog.Dependency.prototype.load=function(a){if(goog.global.CLOSURE_IMPORT_SCRIPT)goog.global.CLOSURE_IMPORT_SCRIPT(this.path)?a.loaded():a.pause();else if(goog.inHtmlDocument_()){var b=goog.global.document;if("complete"==b.readyState&&!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING){if(/\bdeps.js$/.test(this.path)){a.loaded();return}
throw Error('Cannot write "'+this.path+'" after document load');}
if(!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING&&goog.isDocumentLoading_()){var c=goog.Dependency.registerCallback_(function(b){goog.DebugLoader_.IS_OLD_IE_&&"complete"!=b.readyState||(goog.Dependency.unregisterCallback_(c),a.loaded())}),d=!goog.DebugLoader_.IS_OLD_IE_&&goog.getScriptNonce()?' nonce="'+goog.getScriptNonce()+'"':"";d='<script src="'+this.path+'" '+(goog.DebugLoader_.IS_OLD_IE_?"onreadystatechange":"onload")+"=\"goog.Dependency.callback_('"+c+'\', this)" type="text/javascript" '+(goog.Dependency.defer_?"defer":"")+d+">\x3c/script>";b.write(goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createHTML(d):d)}else{var e=b.createElement("script");e.defer=goog.Dependency.defer_;e.async=!1;e.type="text/javascript";(d=goog.getScriptNonce())&&e.setAttribute("nonce",d);goog.DebugLoader_.IS_OLD_IE_?(a.pause(),e.onreadystatechange=function(){if("loaded"==e.readyState||"complete"==e.readyState)a.loaded(),a.resume()}):e.onload=function(){e.onload=null;a.loaded()};e.src=goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createScriptURL(this.path):this.path;b.head.appendChild(e)}}else goog.logToConsole_("Cannot use default debug loader outside of HTML documents."),"deps.js"==this.relativePath?(goog.logToConsole_("Consider setting CLOSURE_IMPORT_SCRIPT before loading base.js, or setting CLOSURE_NO_DEPS to true."),a.loaded()):a.pause()},goog.Es6ModuleDependency=function(a,b,c,d,e){goog.Dependency.call(this,a,b,c,d,e)},goog.inherits(goog.Es6ModuleDependency,goog.Dependency),goog.Es6ModuleDependency.prototype.load=function(a){function b(a,b){a=b?'<script type="module" crossorigin>'+b+"\x3c/script>":'<script type="module" crossorigin src="'+a+'">\x3c/script>';d.write(goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createHTML(a):a)}
function c(a,b){var c=d.createElement("script");c.defer=!0;c.async=!1;c.type="module";c.setAttribute("crossorigin",!0);var e=goog.getScriptNonce();e&&c.setAttribute("nonce",e);b?c.textContent=goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createScript(b):b:c.src=goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createScriptURL(a):a;d.head.appendChild(c)}
if(goog.global.CLOSURE_IMPORT_SCRIPT)goog.global.CLOSURE_IMPORT_SCRIPT(this.path)?a.loaded():a.pause();else if(goog.inHtmlDocument_()){var d=goog.global.document,e=this;if(goog.isDocumentLoading_()){var f=b;goog.Dependency.defer_=!0}else f=c;var g=goog.Dependency.registerCallback_(function(){goog.Dependency.unregisterCallback_(g);a.setModuleState(goog.ModuleType.ES6)});f(void 0,'goog.Dependency.callback_("'+g+'")');f(this.path,void 0);var h=goog.Dependency.registerCallback_(function(b){goog.Dependency.unregisterCallback_(h);a.registerEs6ModuleExports(e.path,b,goog.moduleLoaderState_.moduleName)});f(void 0,'import * as m from "'+this.path+'"; goog.Dependency.callback_("'+h+'", m)');var k=goog.Dependency.registerCallback_(function(){goog.Dependency.unregisterCallback_(k);a.clearModuleState();a.loaded()});f(void 0,'goog.Dependency.callback_("'+k+'")')}else goog.logToConsole_("Cannot use default debug loader outside of HTML documents."),a.pause()},goog.TransformedDependency=function(a,b,c,d,e){goog.Dependency.call(this,a,b,c,d,e);this.contents_=null;this.lazyFetch_=!goog.inHtmlDocument_()||!("noModule"in goog.global.document.createElement("script"))},goog.inherits(goog.TransformedDependency,goog.Dependency),goog.TransformedDependency.prototype.load=function(a){function b(){e.contents_=goog.loadFileSync_(e.path);e.contents_&&(e.contents_=e.transform(e.contents_),e.contents_&&(e.contents_+="\n//# sourceURL="+e.path))}
function c(){e.lazyFetch_&&b();if(e.contents_){f&&a.setModuleState(goog.ModuleType.ES6);try{var c=e.contents_;e.contents_=null;goog.globalEval(c);if(f)var d=goog.moduleLoaderState_.moduleName}finally{f&&a.clearModuleState()}
f&&goog.global.$jscomp.require.ensure([e.getPathName()],function(){a.registerEs6ModuleExports(e.path,goog.global.$jscomp.require(e.getPathName()),d)});a.loaded()}}
function d(){var a=goog.global.document,b=goog.Dependency.registerCallback_(function(){goog.Dependency.unregisterCallback_(b);c()}),d='<script type="text/javascript">'+goog.protectScriptTag_('goog.Dependency.callback_("'+b+'");')+"\x3c/script>";a.write(goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createHTML(d):d)}
var e=this;if(goog.global.CLOSURE_IMPORT_SCRIPT)b(),this.contents_&&goog.global.CLOSURE_IMPORT_SCRIPT("",this.contents_)?(this.contents_=null,a.loaded()):a.pause();else{var f=this.loadFlags.module==goog.ModuleType.ES6;this.lazyFetch_||b();var g=1<a.pending().length,h=g&&goog.DebugLoader_.IS_OLD_IE_;g=goog.Dependency.defer_&&(g||goog.isDocumentLoading_());if(h||g)a.defer(function(){c()});else{var k=goog.global.document;h=goog.inHtmlDocument_()&&"ActiveXObject"in goog.global;if(f&&goog.inHtmlDocument_()&&goog.isDocumentLoading_()&&!h){goog.Dependency.defer_=!0;a.pause();var l=k.onreadystatechange;k.onreadystatechange=function(){"interactive"==k.readyState&&(k.onreadystatechange=l,c(),a.resume());goog.isFunction(l)&&l.apply(void 0,arguments)}}else!goog.DebugLoader_.IS_OLD_IE_&&goog.inHtmlDocument_()&&goog.isDocumentLoading_()?d():c()}}},goog.TransformedDependency.prototype.transform=function(a){},goog.TranspiledDependency=function(a,b,c,d,e,f){goog.TransformedDependency.call(this,a,b,c,d,e);this.transpiler=f},goog.inherits(goog.TranspiledDependency,goog.TransformedDependency),goog.TranspiledDependency.prototype.transform=function(a){return this.transpiler.transpile(a,this.getPathName())},goog.PreTranspiledEs6ModuleDependency=function(a,b,c,d,e){goog.TransformedDependency.call(this,a,b,c,d,e)},goog.inherits(goog.PreTranspiledEs6ModuleDependency,goog.TransformedDependency),goog.PreTranspiledEs6ModuleDependency.prototype.transform=function(a){return a},goog.GoogModuleDependency=function(a,b,c,d,e,f,g){goog.TransformedDependency.call(this,a,b,c,d,e);this.needsTranspile_=f;this.transpiler_=g},goog.inherits(goog.GoogModuleDependency,goog.TransformedDependency),goog.GoogModuleDependency.prototype.transform=function(a){this.needsTranspile_&&(a=this.transpiler_.transpile(a,this.getPathName()));return goog.LOAD_MODULE_USING_EVAL&&goog.isDef(goog.global.JSON)?"goog.loadModule("+goog.global.JSON.stringify(a+"\n//# sourceURL="+this.path+"\n")+");":'goog.loadModule(function(exports) {"use strict";'+a+"\n;return exports});\n//# sourceURL="+this.path+"\n"},goog.DebugLoader_.IS_OLD_IE_=!(goog.global.atob||!goog.global.document||!goog.global.document.all),goog.DebugLoader_.prototype.addDependency=function(a,b,c,d){b=b||[];a=a.replace(/\\/g,"/");var e=goog.normalizePath_(goog.basePath+a);d&&"boolean"!==typeof d||(d=d?{module:goog.ModuleType.GOOG}:{});c=this.factory_.createDependency(e,a,b,c,d,goog.transpiler_.needsTranspile(d.lang||"es3",d.module));this.dependencies_[e]=c;for(c=0;c<b.length;c++)this.idToPath_[b[c]]=e;this.idToPath_[a]=e},goog.DependencyFactory=function(a){this.transpiler=a},goog.DependencyFactory.prototype.createDependency=function(a,b,c,d,e,f){return e.module==goog.ModuleType.GOOG?new goog.GoogModuleDependency(a,b,c,d,e,f,this.transpiler):f?new goog.TranspiledDependency(a,b,c,d,e,this.transpiler):e.module==goog.ModuleType.ES6?"never"==goog.TRANSPILE&&goog.ASSUME_ES_MODULES_TRANSPILED?new goog.PreTranspiledEs6ModuleDependency(a,b,c,d,e):new goog.Es6ModuleDependency(a,b,c,d,e):new goog.Dependency(a,b,c,d,e)},goog.debugLoader_=new goog.DebugLoader_,goog.loadClosureDeps=function(){goog.debugLoader_.loadClosureDeps()},goog.setDependencyFactory=function(a){goog.debugLoader_.setDependencyFactory(a)},goog.global.CLOSURE_NO_DEPS||goog.debugLoader_.loadClosureDeps(),goog.bootstrap=function(a,b){goog.debugLoader_.bootstrap(a,b)});goog.TRUSTED_TYPES_POLICY_NAME="";goog.identity_=function(a){return a};goog.createTrustedTypesPolicy=function(a){var b=null;if("undefined"===typeof TrustedTypes||!TrustedTypes.createPolicy)return b;try{b=TrustedTypes.createPolicy(a,{createHTML:goog.identity_,createScript:goog.identity_,createScriptURL:goog.identity_,createURL:goog.identity_})}catch(c){goog.logToConsole_(c.message)}
return b};goog.TRUSTED_TYPES_POLICY_=goog.TRUSTED_TYPES_POLICY_NAME?goog.createTrustedTypesPolicy(goog.TRUSTED_TYPES_POLICY_NAME+"#base"):null;var jspb={BinaryConstants:{},ConstBinaryMessage:function(){},BinaryMessage:function(){}};jspb.BinaryConstants.FieldType={INVALID:-1,DOUBLE:1,FLOAT:2,INT64:3,UINT64:4,INT32:5,FIXED64:6,FIXED32:7,BOOL:8,STRING:9,GROUP:10,MESSAGE:11,BYTES:12,UINT32:13,ENUM:14,SFIXED32:15,SFIXED64:16,SINT32:17,SINT64:18,FHASH64:30,VHASH64:31};jspb.BinaryConstants.WireType={INVALID:-1,VARINT:0,FIXED64:1,DELIMITED:2,START_GROUP:3,END_GROUP:4,FIXED32:5};jspb.BinaryConstants.FieldTypeToWireType=function(a){var b=jspb.BinaryConstants.FieldType,c=jspb.BinaryConstants.WireType;switch(a){case b.INT32:case b.INT64:case b.UINT32:case b.UINT64:case b.SINT32:case b.SINT64:case b.BOOL:case b.ENUM:case b.VHASH64:return c.VARINT;case b.DOUBLE:case b.FIXED64:case b.SFIXED64:case b.FHASH64:return c.FIXED64;case b.STRING:case b.MESSAGE:case b.BYTES:return c.DELIMITED;case b.FLOAT:case b.FIXED32:case b.SFIXED32:return c.FIXED32;default:return c.INVALID}};jspb.BinaryConstants.INVALID_FIELD_NUMBER=-1;jspb.BinaryConstants.FLOAT32_EPS=1.401298464324817E-45;jspb.BinaryConstants.FLOAT32_MIN=1.1754943508222875E-38;jspb.BinaryConstants.FLOAT32_MAX=3.4028234663852886E38;jspb.BinaryConstants.FLOAT64_EPS=4.9E-324;jspb.BinaryConstants.FLOAT64_MIN=2.2250738585072014E-308;jspb.BinaryConstants.FLOAT64_MAX=1.7976931348623157E308;jspb.BinaryConstants.TWO_TO_20=1048576;jspb.BinaryConstants.TWO_TO_23=8388608;jspb.BinaryConstants.TWO_TO_31=2147483648;jspb.BinaryConstants.TWO_TO_32=4294967296;jspb.BinaryConstants.TWO_TO_52=4503599627370496;jspb.BinaryConstants.TWO_TO_63=0x7fffffffffffffff;jspb.BinaryConstants.TWO_TO_64=1.8446744073709552E19;jspb.BinaryConstants.ZERO_HASH="\x00\x00\x00\x00\x00\x00\x00\x00";goog.dom={};goog.dom.NodeType={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12};goog.debug={};goog.debug.Error=function(a){if(Error.captureStackTrace)Error.captureStackTrace(this,goog.debug.Error);else{var b=Error().stack;b&&(this.stack=b)}
a&&(this.message=String(a));this.reportErrorToServer=!0};goog.inherits(goog.debug.Error,Error);goog.debug.Error.prototype.name="CustomError";goog.asserts={};goog.asserts.ENABLE_ASSERTS=goog.DEBUG;goog.asserts.AssertionError=function(a,b){goog.debug.Error.call(this,goog.asserts.subs_(a,b));this.messagePattern=a};goog.inherits(goog.asserts.AssertionError,goog.debug.Error);goog.asserts.AssertionError.prototype.name="AssertionError";goog.asserts.DEFAULT_ERROR_HANDLER=function(a){throw a;};goog.asserts.errorHandler_=goog.asserts.DEFAULT_ERROR_HANDLER;goog.asserts.subs_=function(a,b){a=a.split("%s");for(var c="",d=a.length-1,e=0;e<d;e++)c+=a[e]+(e<b.length?b[e]:"%s");return c+a[d]};goog.asserts.doAssertFailure_=function(a,b,c,d){var e="Assertion failed";if(c){e+=": "+c;var f=d}else a&&(e+=": "+a,f=b);a=new goog.asserts.AssertionError(""+e,f||[]);goog.asserts.errorHandler_(a)};goog.asserts.setErrorHandler=function(a){goog.asserts.ENABLE_ASSERTS&&(goog.asserts.errorHandler_=a)};goog.asserts.assert=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!a&&goog.asserts.doAssertFailure_("",null,b,Array.prototype.slice.call(arguments,2));return a};goog.asserts.assertExists=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&null==a&&goog.asserts.doAssertFailure_("Expected to exist: %s.",[a],b,Array.prototype.slice.call(arguments,2));return a};goog.asserts.fail=function(a,b){goog.asserts.ENABLE_ASSERTS&&goog.asserts.errorHandler_(new goog.asserts.AssertionError("Failure"+(a?": "+a:""),Array.prototype.slice.call(arguments,1)))};goog.asserts.assertNumber=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isNumber(a)&&goog.asserts.doAssertFailure_("Expected number but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};goog.asserts.assertString=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isString(a)&&goog.asserts.doAssertFailure_("Expected string but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};goog.asserts.assertFunction=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isFunction(a)&&goog.asserts.doAssertFailure_("Expected function but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};goog.asserts.assertObject=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isObject(a)&&goog.asserts.doAssertFailure_("Expected object but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};goog.asserts.assertArray=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isArray(a)&&goog.asserts.doAssertFailure_("Expected array but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};goog.asserts.assertBoolean=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isBoolean(a)&&goog.asserts.doAssertFailure_("Expected boolean but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};goog.asserts.assertElement=function(a,b,c){!goog.asserts.ENABLE_ASSERTS||goog.isObject(a)&&a.nodeType==goog.dom.NodeType.ELEMENT||goog.asserts.doAssertFailure_("Expected Element but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};goog.asserts.assertInstanceof=function(a,b,c,d){!goog.asserts.ENABLE_ASSERTS||a instanceof b||goog.asserts.doAssertFailure_("Expected instanceof %s but got %s.",[goog.asserts.getType_(b),goog.asserts.getType_(a)],c,Array.prototype.slice.call(arguments,3));return a};goog.asserts.assertFinite=function(a,b,c){!goog.asserts.ENABLE_ASSERTS||"number"==typeof a&&isFinite(a)||goog.asserts.doAssertFailure_("Expected %s to be a finite number but it is not.",[a],b,Array.prototype.slice.call(arguments,2));return a};goog.asserts.assertObjectPrototypeIsIntact=function(){for(var a in Object.prototype)goog.asserts.fail(a+" should not be enumerable in Object.prototype.")};goog.asserts.getType_=function(a){return a instanceof Function?a.displayName||a.name||"unknown type name":a instanceof Object?a.constructor.displayName||a.constructor.name||Object.prototype.toString.call(a):null===a?"null":typeof a};goog.array={};goog.NATIVE_ARRAY_PROTOTYPES=goog.TRUSTED_SITE;goog.array.ASSUME_NATIVE_FUNCTIONS=2012<goog.FEATURESET_YEAR;goog.array.peek=function(a){return a[a.length-1]};goog.array.last=goog.array.peek;goog.array.indexOf=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.indexOf)?function(a,b,c){goog.asserts.assert(null!=a.length);return Array.prototype.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0>c?Math.max(0,a.length+c):c;if(goog.isString(a))return goog.isString(b)&&1==b.length?a.indexOf(b,c):-1;for(;c<a.length;c++)
if(c in a&&a[c]===b)return c;return-1};goog.array.lastIndexOf=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.lastIndexOf)?function(a,b,c){goog.asserts.assert(null!=a.length);return Array.prototype.lastIndexOf.call(a,b,null==c?a.length-1:c)}:function(a,b,c){c=null==c?a.length-1:c;0>c&&(c=Math.max(0,a.length+c));if(goog.isString(a))return goog.isString(b)&&1==b.length?a.lastIndexOf(b,c):-1;for(;0<=c;c--)
if(c in a&&a[c]===b)return c;return-1};goog.array.forEach=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.forEach)?function(a,b,c){goog.asserts.assert(null!=a.length);Array.prototype.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;f<d;f++)f in e&&b.call(c,e[f],f,a)};goog.array.forEachRight=function(a,b,c){var d=a.length,e=goog.isString(a)?a.split(""):a;for(--d;0<=d;--d)d in e&&b.call(c,e[d],d,a)};goog.array.filter=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.filter)?function(a,b,c){goog.asserts.assert(null!=a.length);return Array.prototype.filter.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=[],f=0,g=goog.isString(a)?a.split(""):a,h=0;h<d;h++)
if(h in g){var k=g[h];b.call(c,k,h,a)&&(e[f++]=k)}return e};goog.array.map=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.map)?function(a,b,c){goog.asserts.assert(null!=a.length);return Array.prototype.map.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=Array(d),f=goog.isString(a)?a.split(""):a,g=0;g<d;g++)g in f&&(e[g]=b.call(c,f[g],g,a));return e};goog.array.reduce=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.reduce)?function(a,b,c,d){goog.asserts.assert(null!=a.length);d&&(b=goog.bind(b,d));return Array.prototype.reduce.call(a,b,c)}:function(a,b,c,d){var e=c;goog.array.forEach(a,function(c,g){e=b.call(d,e,c,g,a)});return e};goog.array.reduceRight=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.reduceRight)?function(a,b,c,d){goog.asserts.assert(null!=a.length);goog.asserts.assert(null!=b);d&&(b=goog.bind(b,d));return Array.prototype.reduceRight.call(a,b,c)}:function(a,b,c,d){var e=c;goog.array.forEachRight(a,function(c,g){e=b.call(d,e,c,g,a)});return e};goog.array.some=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.some)?function(a,b,c){goog.asserts.assert(null!=a.length);return Array.prototype.some.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;f<d;f++)
if(f in e&&b.call(c,e[f],f,a))return!0;return!1};goog.array.every=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||Array.prototype.every)?function(a,b,c){goog.asserts.assert(null!=a.length);return Array.prototype.every.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;f<d;f++)
if(f in e&&!b.call(c,e[f],f,a))return!1;return!0};goog.array.count=function(a,b,c){var d=0;goog.array.forEach(a,function(a,f,g){b.call(c,a,f,g)&&++d},c);return d};goog.array.find=function(a,b,c){b=goog.array.findIndex(a,b,c);return 0>b?null:goog.isString(a)?a.charAt(b):a[b]};goog.array.findIndex=function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;f<d;f++)
if(f in e&&b.call(c,e[f],f,a))return f;return-1};goog.array.findRight=function(a,b,c){b=goog.array.findIndexRight(a,b,c);return 0>b?null:goog.isString(a)?a.charAt(b):a[b]};goog.array.findIndexRight=function(a,b,c){var d=a.length,e=goog.isString(a)?a.split(""):a;for(--d;0<=d;d--)
if(d in e&&b.call(c,e[d],d,a))return d;return-1};goog.array.contains=function(a,b){return 0<=goog.array.indexOf(a,b)};goog.array.isEmpty=function(a){return 0==a.length};goog.array.clear=function(a){if(!goog.isArray(a))
for(var b=a.length-1;0<=b;b--)delete a[b];a.length=0};goog.array.insert=function(a,b){goog.array.contains(a,b)||a.push(b)};goog.array.insertAt=function(a,b,c){goog.array.splice(a,c,0,b)};goog.array.insertArrayAt=function(a,b,c){goog.partial(goog.array.splice,a,c,0).apply(null,b)};goog.array.insertBefore=function(a,b,c){var d;2==arguments.length||0>(d=goog.array.indexOf(a,c))?a.push(b):goog.array.insertAt(a,b,d)};goog.array.remove=function(a,b){b=goog.array.indexOf(a,b);var c;(c=0<=b)&&goog.array.removeAt(a,b);return c};goog.array.removeLast=function(a,b){b=goog.array.lastIndexOf(a,b);return 0<=b?(goog.array.removeAt(a,b),!0):!1};goog.array.removeAt=function(a,b){goog.asserts.assert(null!=a.length);return 1==Array.prototype.splice.call(a,b,1).length};goog.array.removeIf=function(a,b,c){b=goog.array.findIndex(a,b,c);return 0<=b?(goog.array.removeAt(a,b),!0):!1};goog.array.removeAllIf=function(a,b,c){var d=0;goog.array.forEachRight(a,function(e,f){b.call(c,e,f,a)&&goog.array.removeAt(a,f)&&d++});return d};goog.array.concat=function(a){return Array.prototype.concat.apply([],arguments)};goog.array.join=function(a){return Array.prototype.concat.apply([],arguments)};goog.array.toArray=function(a){var b=a.length;if(0<b){for(var c=Array(b),d=0;d<b;d++)c[d]=a[d];return c}
return[]};goog.array.clone=goog.array.toArray;goog.array.extend=function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(goog.isArrayLike(d)){var e=a.length||0,f=d.length||0;a.length=e+f;for(var g=0;g<f;g++)a[e+g]=d[g]}else a.push(d)}};goog.array.splice=function(a,b,c,d){goog.asserts.assert(null!=a.length);return Array.prototype.splice.apply(a,goog.array.slice(arguments,1))};goog.array.slice=function(a,b,c){goog.asserts.assert(null!=a.length);return 2>=arguments.length?Array.prototype.slice.call(a,b):Array.prototype.slice.call(a,b,c)};goog.array.removeDuplicates=function(a,b,c){b=b||a;var d=function(a){return goog.isObject(a)?"o"+goog.getUid(a):(typeof a).charAt(0)+a};c=c||d;d={};for(var e=0,f=0;f<a.length;){var g=a[f++],h=c(g);Object.prototype.hasOwnProperty.call(d,h)||(d[h]=!0,b[e++]=g)}
b.length=e};goog.array.binarySearch=function(a,b,c){return goog.array.binarySearch_(a,c||goog.array.defaultCompare,!1,b)};goog.array.binarySelect=function(a,b,c){return goog.array.binarySearch_(a,b,!0,void 0,c)};goog.array.binarySearch_=function(a,b,c,d,e){for(var f=0,g=a.length,h;f<g;){var k=f+g>>1;var l=c?b.call(e,a[k],k,a):b(d,a[k]);0<l?f=k+1:(g=k,h=!l)}
return h?f:~f};goog.array.sort=function(a,b){a.sort(b||goog.array.defaultCompare)};goog.array.stableSort=function(a,b){for(var c=Array(a.length),d=0;d<a.length;d++)c[d]={index:d,value:a[d]};var e=b||goog.array.defaultCompare;goog.array.sort(c,function(a,b){return e(a.value,b.value)||a.index-b.index});for(d=0;d<a.length;d++)a[d]=c[d].value};goog.array.sortByKey=function(a,b,c){var d=c||goog.array.defaultCompare;goog.array.sort(a,function(a,c){return d(b(a),b(c))})};goog.array.sortObjectsByKey=function(a,b,c){goog.array.sortByKey(a,function(a){return a[b]},c)};goog.array.isSorted=function(a,b,c){b=b||goog.array.defaultCompare;for(var d=1;d<a.length;d++){var e=b(a[d-1],a[d]);if(0<e||0==e&&c)return!1}
return!0};goog.array.equals=function(a,b,c){if(!goog.isArrayLike(a)||!goog.isArrayLike(b)||a.length!=b.length)return!1;var d=a.length;c=c||goog.array.defaultCompareEquality;for(var e=0;e<d;e++)
if(!c(a[e],b[e]))return!1;return!0};goog.array.compare3=function(a,b,c){c=c||goog.array.defaultCompare;for(var d=Math.min(a.length,b.length),e=0;e<d;e++){var f=c(a[e],b[e]);if(0!=f)return f}
return goog.array.defaultCompare(a.length,b.length)};goog.array.defaultCompare=function(a,b){return a>b?1:a<b?-1:0};goog.array.inverseDefaultCompare=function(a,b){return-goog.array.defaultCompare(a,b)};goog.array.defaultCompareEquality=function(a,b){return a===b};goog.array.binaryInsert=function(a,b,c){c=goog.array.binarySearch(a,b,c);return 0>c?(goog.array.insertAt(a,b,-(c+1)),!0):!1};goog.array.binaryRemove=function(a,b,c){b=goog.array.binarySearch(a,b,c);return 0<=b?goog.array.removeAt(a,b):!1};goog.array.bucket=function(a,b,c){for(var d={},e=0;e<a.length;e++){var f=a[e],g=b.call(c,f,e,a);goog.isDef(g)&&(d[g]||(d[g]=[])).push(f)}
return d};goog.array.toObject=function(a,b,c){var d={};goog.array.forEach(a,function(e,f){d[b.call(c,e,f,a)]=e});return d};goog.array.range=function(a,b,c){var d=[],e=0,f=a;c=c||1;void 0!==b&&(e=a,f=b);if(0>c*(f-e))return[];if(0<c)
for(a=e;a<f;a+=c)d.push(a);else
for(a=e;a>f;a+=c)d.push(a);return d};goog.array.repeat=function(a,b){for(var c=[],d=0;d<b;d++)c[d]=a;return c};goog.array.flatten=function(a){for(var b=[],c=0;c<arguments.length;c++){var d=arguments[c];if(goog.isArray(d))
for(var e=0;e<d.length;e+=8192){var f=goog.array.slice(d,e,e+8192);f=goog.array.flatten.apply(null,f);for(var g=0;g<f.length;g++)b.push(f[g])}else b.push(d)}
return b};goog.array.rotate=function(a,b){goog.asserts.assert(null!=a.length);a.length&&(b%=a.length,0<b?Array.prototype.unshift.apply(a,a.splice(-b,b)):0>b&&Array.prototype.push.apply(a,a.splice(0,-b)));return a};goog.array.moveItem=function(a,b,c){goog.asserts.assert(0<=b&&b<a.length);goog.asserts.assert(0<=c&&c<a.length);b=Array.prototype.splice.call(a,b,1);Array.prototype.splice.call(a,c,0,b[0])};goog.array.zip=function(a){if(!arguments.length)return[];for(var b=[],c=arguments[0].length,d=1;d<arguments.length;d++)arguments[d].length<c&&(c=arguments[d].length);for(d=0;d<c;d++){for(var e=[],f=0;f<arguments.length;f++)e.push(arguments[f][d]);b.push(e)}
return b};goog.array.shuffle=function(a,b){b=b||Math.random;for(var c=a.length-1;0<c;c--){var d=Math.floor(b()*(c+1)),e=a[c];a[c]=a[d];a[d]=e}};goog.array.copyByIndex=function(a,b){var c=[];goog.array.forEach(b,function(b){c.push(a[b])});return c};goog.array.concatMap=function(a,b,c){return goog.array.concat.apply([],goog.array.map(a,b,c))};goog.crypt={};goog.crypt.stringToByteArray=function(a){for(var b=[],c=0,d=0;d<a.length;d++){var e=a.charCodeAt(d);255<e&&(b[c++]=e&255,e>>=8);b[c++]=e}
return b};goog.crypt.byteArrayToString=function(a){if(8192>=a.length)return String.fromCharCode.apply(null,a);for(var b="",c=0;c<a.length;c+=8192){var d=goog.array.slice(a,c,c+8192);b+=String.fromCharCode.apply(null,d)}
return b};goog.crypt.byteArrayToHex=function(a,b){return goog.array.map(a,function(a){a=a.toString(16);return 1<a.length?a:"0"+a}).join(b||"")};goog.crypt.hexToByteArray=function(a){goog.asserts.assert(0==a.length%2,"Key string length must be multiple of 2");for(var b=[],c=0;c<a.length;c+=2)b.push(parseInt(a.substring(c,c+2),16));return b};goog.crypt.stringToUtf8ByteArray=function(a){for(var b=[],c=0,d=0;d<a.length;d++){var e=a.charCodeAt(d);128>e?b[c++]=e:(2048>e?b[c++]=e>>6|192:(55296==(e&64512)&&d+1<a.length&&56320==(a.charCodeAt(d+1)&64512)?(e=65536+((e&1023)<<10)+(a.charCodeAt(++d)&1023),b[c++]=e>>18|240,b[c++]=e>>12&63|128):b[c++]=e>>12|224,b[c++]=e>>6&63|128),b[c++]=e&63|128)}
return b};goog.crypt.utf8ByteArrayToString=function(a){for(var b=[],c=0,d=0;c<a.length;){var e=a[c++];if(128>e)b[d++]=String.fromCharCode(e);else if(191<e&&224>e){var f=a[c++];b[d++]=String.fromCharCode((e&31)<<6|f&63)}else if(239<e&&365>e){f=a[c++];var g=a[c++],h=a[c++];e=((e&7)<<18|(f&63)<<12|(g&63)<<6|h&63)-65536;b[d++]=String.fromCharCode(55296+(e>>10));b[d++]=String.fromCharCode(56320+(e&1023))}else f=a[c++],g=a[c++],b[d++]=String.fromCharCode((e&15)<<12|(f&63)<<6|g&63)}
return b.join("")};goog.crypt.xorByteArray=function(a,b){goog.asserts.assert(a.length==b.length,"XOR array lengths must match");for(var c=[],d=0;d<a.length;d++)c.push(a[d]^b[d]);return c};goog.string={};goog.string.internal={};goog.string.internal.startsWith=function(a,b){return 0==a.lastIndexOf(b,0)};goog.string.internal.endsWith=function(a,b){var c=a.length-b.length;return 0<=c&&a.indexOf(b,c)==c};goog.string.internal.caseInsensitiveStartsWith=function(a,b){return 0==goog.string.internal.caseInsensitiveCompare(b,a.substr(0,b.length))};goog.string.internal.caseInsensitiveEndsWith=function(a,b){return 0==goog.string.internal.caseInsensitiveCompare(b,a.substr(a.length-b.length,b.length))};goog.string.internal.caseInsensitiveEquals=function(a,b){return a.toLowerCase()==b.toLowerCase()};goog.string.internal.isEmptyOrWhitespace=function(a){return/^[\s\xa0]*$/.test(a)};goog.string.internal.trim=goog.TRUSTED_SITE&&String.prototype.trim?function(a){return a.trim()}:function(a){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1]};goog.string.internal.caseInsensitiveCompare=function(a,b){a=String(a).toLowerCase();b=String(b).toLowerCase();return a<b?-1:a==b?0:1};goog.string.internal.newLineToBr=function(a,b){return a.replace(/(\r\n|\r|\n)/g,b?"<br />":"<br>")};goog.string.internal.htmlEscape=function(a,b){if(b)a=a.replace(goog.string.internal.AMP_RE_,"&amp;").replace(goog.string.internal.LT_RE_,"&lt;").replace(goog.string.internal.GT_RE_,"&gt;").replace(goog.string.internal.QUOT_RE_,"&quot;").replace(goog.string.internal.SINGLE_QUOTE_RE_,"&#39;").replace(goog.string.internal.NULL_RE_,"&#0;");else{if(!goog.string.internal.ALL_RE_.test(a))return a;-1!=a.indexOf("&")&&(a=a.replace(goog.string.internal.AMP_RE_,"&amp;"));-1!=a.indexOf("<")&&(a=a.replace(goog.string.internal.LT_RE_,"&lt;"));-1!=a.indexOf(">")&&(a=a.replace(goog.string.internal.GT_RE_,"&gt;"));-1!=a.indexOf('"')&&(a=a.replace(goog.string.internal.QUOT_RE_,"&quot;"));-1!=a.indexOf("'")&&(a=a.replace(goog.string.internal.SINGLE_QUOTE_RE_,"&#39;"));-1!=a.indexOf("\x00")&&(a=a.replace(goog.string.internal.NULL_RE_,"&#0;"))}
return a};goog.string.internal.AMP_RE_=/&/g;goog.string.internal.LT_RE_=/</g;goog.string.internal.GT_RE_=/>/g;goog.string.internal.QUOT_RE_=/"/g;goog.string.internal.SINGLE_QUOTE_RE_=/'/g;goog.string.internal.NULL_RE_=/\x00/g;goog.string.internal.ALL_RE_=/[\x00&<>"']/;goog.string.internal.whitespaceEscape=function(a,b){return goog.string.internal.newLineToBr(a.replace(/  /g," &#160;"),b)};goog.string.internal.contains=function(a,b){return-1!=a.indexOf(b)};goog.string.internal.caseInsensitiveContains=function(a,b){return goog.string.internal.contains(a.toLowerCase(),b.toLowerCase())};goog.string.internal.compareVersions=function(a,b){var c=0;a=goog.string.internal.trim(String(a)).split(".");b=goog.string.internal.trim(String(b)).split(".");for(var d=Math.max(a.length,b.length),e=0;0==c&&e<d;e++){var f=a[e]||"",g=b[e]||"";do{f=/(\d*)(\D*)(.*)/.exec(f)||["","","",""];g=/(\d*)(\D*)(.*)/.exec(g)||["","","",""];if(0==f[0].length&&0==g[0].length)break;c=0==f[1].length?0:parseInt(f[1],10);var h=0==g[1].length?0:parseInt(g[1],10);c=goog.string.internal.compareElements_(c,h)||goog.string.internal.compareElements_(0==f[2].length,0==g[2].length)||goog.string.internal.compareElements_(f[2],g[2]);f=f[3];g=g[3]}while(0==c)}
return c};goog.string.internal.compareElements_=function(a,b){return a<b?-1:a>b?1:0};goog.string.TypedString=function(){};goog.string.Const=function(a,b){this.stringConstValueWithSecurityContract__googStringSecurityPrivate_=a===goog.string.Const.GOOG_STRING_CONSTRUCTOR_TOKEN_PRIVATE_&&b||"";this.STRING_CONST_TYPE_MARKER__GOOG_STRING_SECURITY_PRIVATE_=goog.string.Const.TYPE_MARKER_};goog.string.Const.prototype.implementsGoogStringTypedString=!0;goog.string.Const.prototype.getTypedStringValue=function(){return this.stringConstValueWithSecurityContract__googStringSecurityPrivate_};goog.string.Const.prototype.toString=function(){return"Const{"+this.stringConstValueWithSecurityContract__googStringSecurityPrivate_+"}"};goog.string.Const.unwrap=function(a){if(a instanceof goog.string.Const&&a.constructor===goog.string.Const&&a.STRING_CONST_TYPE_MARKER__GOOG_STRING_SECURITY_PRIVATE_===goog.string.Const.TYPE_MARKER_)return a.stringConstValueWithSecurityContract__googStringSecurityPrivate_;goog.asserts.fail("expected object of type Const, got '"+a+"'");return"type_error:Const"};goog.string.Const.from=function(a){return new goog.string.Const(goog.string.Const.GOOG_STRING_CONSTRUCTOR_TOKEN_PRIVATE_,a)};goog.string.Const.TYPE_MARKER_={};goog.string.Const.GOOG_STRING_CONSTRUCTOR_TOKEN_PRIVATE_={};goog.string.Const.EMPTY=goog.string.Const.from("");goog.fs={};goog.fs.url={};goog.fs.url.createObjectUrl=function(a){return goog.fs.url.getUrlObject_().createObjectURL(a)};goog.fs.url.revokeObjectUrl=function(a){goog.fs.url.getUrlObject_().revokeObjectURL(a)};goog.fs.url.getUrlObject_=function(){var a=goog.fs.url.findUrlObject_();if(null!=a)return a;throw Error("This browser doesn't seem to support blob URLs");};goog.fs.url.findUrlObject_=function(){return goog.isDef(goog.global.URL)&&goog.isDef(goog.global.URL.createObjectURL)?goog.global.URL:goog.isDef(goog.global.webkitURL)&&goog.isDef(goog.global.webkitURL.createObjectURL)?goog.global.webkitURL:goog.isDef(goog.global.createObjectURL)?goog.global:null};goog.fs.url.browserSupportsObjectUrls=function(){return null!=goog.fs.url.findUrlObject_()};goog.html={};goog.html.trustedtypes={};goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY=goog.TRUSTED_TYPES_POLICY_NAME?goog.createTrustedTypesPolicy(goog.TRUSTED_TYPES_POLICY_NAME+"#html"):null;goog.i18n={};goog.i18n.bidi={};goog.i18n.bidi.FORCE_RTL=!1;goog.i18n.bidi.IS_RTL=goog.i18n.bidi.FORCE_RTL||("ar"==goog.LOCALE.substring(0,2).toLowerCase()||"fa"==goog.LOCALE.substring(0,2).toLowerCase()||"he"==goog.LOCALE.substring(0,2).toLowerCase()||"iw"==goog.LOCALE.substring(0,2).toLowerCase()||"ps"==goog.LOCALE.substring(0,2).toLowerCase()||"sd"==goog.LOCALE.substring(0,2).toLowerCase()||"ug"==goog.LOCALE.substring(0,2).toLowerCase()||"ur"==goog.LOCALE.substring(0,2).toLowerCase()||"yi"==goog.LOCALE.substring(0,2).toLowerCase())&&(2==goog.LOCALE.length||"-"==goog.LOCALE.substring(2,3)||"_"==goog.LOCALE.substring(2,3))||3<=goog.LOCALE.length&&"ckb"==goog.LOCALE.substring(0,3).toLowerCase()&&(3==goog.LOCALE.length||"-"==goog.LOCALE.substring(3,4)||"_"==goog.LOCALE.substring(3,4))||7<=goog.LOCALE.length&&("-"==goog.LOCALE.substring(2,3)||"_"==goog.LOCALE.substring(2,3))&&("adlm"==goog.LOCALE.substring(3,7).toLowerCase()||"arab"==goog.LOCALE.substring(3,7).toLowerCase()||"hebr"==goog.LOCALE.substring(3,7).toLowerCase()||"nkoo"==goog.LOCALE.substring(3,7).toLowerCase()||"rohg"==goog.LOCALE.substring(3,7).toLowerCase()||"thaa"==goog.LOCALE.substring(3,7).toLowerCase())||8<=goog.LOCALE.length&&("-"==goog.LOCALE.substring(3,4)||"_"==goog.LOCALE.substring(3,4))&&("adlm"==goog.LOCALE.substring(4,8).toLowerCase()||"arab"==goog.LOCALE.substring(4,8).toLowerCase()||"hebr"==goog.LOCALE.substring(4,8).toLowerCase()||"nkoo"==goog.LOCALE.substring(4,8).toLowerCase()||"rohg"==goog.LOCALE.substring(4,8).toLowerCase()||"thaa"==goog.LOCALE.substring(4,8).toLowerCase());goog.i18n.bidi.Format={LRE:"\u202a",RLE:"\u202b",PDF:"\u202c",LRM:"\u200e",RLM:"\u200f"};goog.i18n.bidi.Dir={LTR:1,RTL:-1,NEUTRAL:0};goog.i18n.bidi.RIGHT="right";goog.i18n.bidi.LEFT="left";goog.i18n.bidi.I18N_RIGHT=goog.i18n.bidi.IS_RTL?goog.i18n.bidi.LEFT:goog.i18n.bidi.RIGHT;goog.i18n.bidi.I18N_LEFT=goog.i18n.bidi.IS_RTL?goog.i18n.bidi.RIGHT:goog.i18n.bidi.LEFT;goog.i18n.bidi.toDir=function(a,b){return"number"==typeof a?0<a?goog.i18n.bidi.Dir.LTR:0>a?goog.i18n.bidi.Dir.RTL:b?null:goog.i18n.bidi.Dir.NEUTRAL:null==a?null:a?goog.i18n.bidi.Dir.RTL:goog.i18n.bidi.Dir.LTR};goog.i18n.bidi.ltrChars_="A-Za-z\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u0300-\u0590\u0900-\u1fff\u200e\u2c00-\ud801\ud804-\ud839\ud83c-\udbff\uf900-\ufb1c\ufe00-\ufe6f\ufefd-\uffff";goog.i18n.bidi.rtlChars_="\u0591-\u06ef\u06fa-\u08ff\u200f\ud802-\ud803\ud83a-\ud83b\ufb1d-\ufdff\ufe70-\ufefc";goog.i18n.bidi.htmlSkipReg_=/<[^>]*>|&[^;]+;/g;goog.i18n.bidi.stripHtmlIfNeeded_=function(a,b){return b?a.replace(goog.i18n.bidi.htmlSkipReg_,""):a};goog.i18n.bidi.rtlCharReg_=new RegExp("["+goog.i18n.bidi.rtlChars_+"]");goog.i18n.bidi.ltrCharReg_=new RegExp("["+goog.i18n.bidi.ltrChars_+"]");goog.i18n.bidi.hasAnyRtl=function(a,b){return goog.i18n.bidi.rtlCharReg_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))};goog.i18n.bidi.hasRtlChar=goog.i18n.bidi.hasAnyRtl;goog.i18n.bidi.hasAnyLtr=function(a,b){return goog.i18n.bidi.ltrCharReg_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))};goog.i18n.bidi.ltrRe_=new RegExp("^["+goog.i18n.bidi.ltrChars_+"]");goog.i18n.bidi.rtlRe_=new RegExp("^["+goog.i18n.bidi.rtlChars_+"]");goog.i18n.bidi.isRtlChar=function(a){return goog.i18n.bidi.rtlRe_.test(a)};goog.i18n.bidi.isLtrChar=function(a){return goog.i18n.bidi.ltrRe_.test(a)};goog.i18n.bidi.isNeutralChar=function(a){return!goog.i18n.bidi.isLtrChar(a)&&!goog.i18n.bidi.isRtlChar(a)};goog.i18n.bidi.ltrDirCheckRe_=new RegExp("^[^"+goog.i18n.bidi.rtlChars_+"]*["+goog.i18n.bidi.ltrChars_+"]");goog.i18n.bidi.rtlDirCheckRe_=new RegExp("^[^"+goog.i18n.bidi.ltrChars_+"]*["+goog.i18n.bidi.rtlChars_+"]");goog.i18n.bidi.startsWithRtl=function(a,b){return goog.i18n.bidi.rtlDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))};goog.i18n.bidi.isRtlText=goog.i18n.bidi.startsWithRtl;goog.i18n.bidi.startsWithLtr=function(a,b){return goog.i18n.bidi.ltrDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))};goog.i18n.bidi.isLtrText=goog.i18n.bidi.startsWithLtr;goog.i18n.bidi.isRequiredLtrRe_=/^http:\/\/.*/;goog.i18n.bidi.isNeutralText=function(a,b){a=goog.i18n.bidi.stripHtmlIfNeeded_(a,b);return goog.i18n.bidi.isRequiredLtrRe_.test(a)||!goog.i18n.bidi.hasAnyLtr(a)&&!goog.i18n.bidi.hasAnyRtl(a)};goog.i18n.bidi.ltrExitDirCheckRe_=new RegExp("["+goog.i18n.bidi.ltrChars_+"][^"+goog.i18n.bidi.rtlChars_+"]*$");goog.i18n.bidi.rtlExitDirCheckRe_=new RegExp("["+goog.i18n.bidi.rtlChars_+"][^"+goog.i18n.bidi.ltrChars_+"]*$");goog.i18n.bidi.endsWithLtr=function(a,b){return goog.i18n.bidi.ltrExitDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))};goog.i18n.bidi.isLtrExitText=goog.i18n.bidi.endsWithLtr;goog.i18n.bidi.endsWithRtl=function(a,b){return goog.i18n.bidi.rtlExitDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))};goog.i18n.bidi.isRtlExitText=goog.i18n.bidi.endsWithRtl;goog.i18n.bidi.rtlLocalesRe_=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;goog.i18n.bidi.isRtlLanguage=function(a){return goog.i18n.bidi.rtlLocalesRe_.test(a)};goog.i18n.bidi.bracketGuardTextRe_=/(\(.*?\)+)|(\[.*?\]+)|(\{.*?\}+)|(<.*?>+)/g;goog.i18n.bidi.guardBracketInText=function(a,b){b=(void 0===b?goog.i18n.bidi.hasAnyRtl(a):b)?goog.i18n.bidi.Format.RLM:goog.i18n.bidi.Format.LRM;return a.replace(goog.i18n.bidi.bracketGuardTextRe_,b+"$&"+b)};goog.i18n.bidi.enforceRtlInHtml=function(a){return"<"==a.charAt(0)?a.replace(/<\w+/,"$& dir=rtl"):"\n<span dir=rtl>"+a+"</span>"};goog.i18n.bidi.enforceRtlInText=function(a){return goog.i18n.bidi.Format.RLE+a+goog.i18n.bidi.Format.PDF};goog.i18n.bidi.enforceLtrInHtml=function(a){return"<"==a.charAt(0)?a.replace(/<\w+/,"$& dir=ltr"):"\n<span dir=ltr>"+a+"</span>"};goog.i18n.bidi.enforceLtrInText=function(a){return goog.i18n.bidi.Format.LRE+a+goog.i18n.bidi.Format.PDF};goog.i18n.bidi.dimensionsRe_=/:\s*([.\d][.\w]*)\s+([.\d][.\w]*)\s+([.\d][.\w]*)\s+([.\d][.\w]*)/g;goog.i18n.bidi.leftRe_=/left/gi;goog.i18n.bidi.rightRe_=/right/gi;goog.i18n.bidi.tempRe_=/%%%%/g;goog.i18n.bidi.mirrorCSS=function(a){return a.replace(goog.i18n.bidi.dimensionsRe_,":$1 $4 $3 $2").replace(goog.i18n.bidi.leftRe_,"%%%%").replace(goog.i18n.bidi.rightRe_,goog.i18n.bidi.LEFT).replace(goog.i18n.bidi.tempRe_,goog.i18n.bidi.RIGHT)};goog.i18n.bidi.doubleQuoteSubstituteRe_=/([\u0591-\u05f2])"/g;goog.i18n.bidi.singleQuoteSubstituteRe_=/([\u0591-\u05f2])'/g;goog.i18n.bidi.normalizeHebrewQuote=function(a){return a.replace(goog.i18n.bidi.doubleQuoteSubstituteRe_,"$1\u05f4").replace(goog.i18n.bidi.singleQuoteSubstituteRe_,"$1\u05f3")};goog.i18n.bidi.wordSeparatorRe_=/\s+/;goog.i18n.bidi.hasNumeralsRe_=/[\d\u06f0-\u06f9]/;goog.i18n.bidi.rtlDetectionThreshold_=.4;goog.i18n.bidi.estimateDirection=function(a,b){var c=0,d=0,e=!1;a=goog.i18n.bidi.stripHtmlIfNeeded_(a,b).split(goog.i18n.bidi.wordSeparatorRe_);for(b=0;b<a.length;b++){var f=a[b];goog.i18n.bidi.startsWithRtl(f)?(c++,d++):goog.i18n.bidi.isRequiredLtrRe_.test(f)?e=!0:goog.i18n.bidi.hasAnyLtr(f)?d++:goog.i18n.bidi.hasNumeralsRe_.test(f)&&(e=!0)}
return 0==d?e?goog.i18n.bidi.Dir.LTR:goog.i18n.bidi.Dir.NEUTRAL:c/d>goog.i18n.bidi.rtlDetectionThreshold_?goog.i18n.bidi.Dir.RTL:goog.i18n.bidi.Dir.LTR};goog.i18n.bidi.detectRtlDirectionality=function(a,b){return goog.i18n.bidi.estimateDirection(a,b)==goog.i18n.bidi.Dir.RTL};goog.i18n.bidi.setElementDirAndAlign=function(a,b){a&&(b=goog.i18n.bidi.toDir(b))&&(a.style.textAlign=b==goog.i18n.bidi.Dir.RTL?goog.i18n.bidi.RIGHT:goog.i18n.bidi.LEFT,a.dir=b==goog.i18n.bidi.Dir.RTL?"rtl":"ltr")};goog.i18n.bidi.setElementDirByTextDirectionality=function(a,b){switch(goog.i18n.bidi.estimateDirection(b)){case goog.i18n.bidi.Dir.LTR:a.dir="ltr";break;case goog.i18n.bidi.Dir.RTL:a.dir="rtl";break;default:a.removeAttribute("dir")}};goog.i18n.bidi.DirectionalString=function(){};goog.html.TrustedResourceUrl=function(){this.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_="";this.trustedURL_=null;this.TRUSTED_RESOURCE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.TrustedResourceUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_};goog.html.TrustedResourceUrl.prototype.implementsGoogStringTypedString=!0;goog.html.TrustedResourceUrl.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_.toString()};goog.html.TrustedResourceUrl.prototype.implementsGoogI18nBidiDirectionalString=!0;goog.html.TrustedResourceUrl.prototype.getDirection=function(){return goog.i18n.bidi.Dir.LTR};goog.html.TrustedResourceUrl.prototype.cloneWithParams=function(a,b){var c=goog.html.TrustedResourceUrl.unwrap(this);c=goog.html.TrustedResourceUrl.URL_PARAM_PARSER_.exec(c);var d=c[3]||"";return goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(c[1]+goog.html.TrustedResourceUrl.stringifyParams_("?",c[2]||"",a)+goog.html.TrustedResourceUrl.stringifyParams_("#",d,b))};goog.DEBUG&&(goog.html.TrustedResourceUrl.prototype.toString=function(){return"TrustedResourceUrl{"+this.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_+"}"});goog.html.TrustedResourceUrl.unwrap=function(a){return goog.html.TrustedResourceUrl.unwrapTrustedScriptURL(a).toString()};goog.html.TrustedResourceUrl.unwrapTrustedScriptURL=function(a){if(a instanceof goog.html.TrustedResourceUrl&&a.constructor===goog.html.TrustedResourceUrl&&a.TRUSTED_RESOURCE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.TrustedResourceUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_)return a.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_;goog.asserts.fail("expected object of type TrustedResourceUrl, got '"+a+"' of type "+goog.typeOf(a));return"type_error:TrustedResourceUrl"};goog.html.TrustedResourceUrl.unwrapTrustedURL=function(a){return a.trustedURL_?a.trustedURL_:goog.html.TrustedResourceUrl.unwrap(a)};goog.html.TrustedResourceUrl.format=function(a,b){var c=goog.string.Const.unwrap(a);if(!goog.html.TrustedResourceUrl.BASE_URL_.test(c))throw Error("Invalid TrustedResourceUrl format: "+c);a=c.replace(goog.html.TrustedResourceUrl.FORMAT_MARKER_,function(a,e){if(!Object.prototype.hasOwnProperty.call(b,e))throw Error('Found marker, "'+e+'", in format string, "'+c+'", but no valid label mapping found in args: '+JSON.stringify(b));a=b[e];return a instanceof goog.string.Const?goog.string.Const.unwrap(a):encodeURIComponent(String(a))});return goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(a)};goog.html.TrustedResourceUrl.FORMAT_MARKER_=/%{(\w+)}/g;goog.html.TrustedResourceUrl.BASE_URL_=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^/\\]|[^:/\\%]+\/|[^:/\\%]*[?#]|about:blank#)/i;goog.html.TrustedResourceUrl.URL_PARAM_PARSER_=/^([^?#]*)(\?[^#]*)?(#[\s\S]*)?/;goog.html.TrustedResourceUrl.formatWithParams=function(a,b,c,d){return goog.html.TrustedResourceUrl.format(a,b).cloneWithParams(c,d)};goog.html.TrustedResourceUrl.fromConstant=function(a){return goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(goog.string.Const.unwrap(a))};goog.html.TrustedResourceUrl.fromConstants=function(a){for(var b="",c=0;c<a.length;c++)b+=goog.string.Const.unwrap(a[c]);return goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(b)};goog.html.TrustedResourceUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={};goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse=function(a){var b=new goog.html.TrustedResourceUrl;b.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_=goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY?goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY.createScriptURL(a):a;goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY&&(b.trustedURL_=goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY.createURL(a));return b};goog.html.TrustedResourceUrl.stringifyParams_=function(a,b,c){if(null==c)return b;if(goog.isString(c))return c?a+encodeURIComponent(c):"";for(var d in c){var e=c[d];e=goog.isArray(e)?e:[e];for(var f=0;f<e.length;f++){var g=e[f];null!=g&&(b||(b=a),b+=(b.length>a.length?"&":"")+encodeURIComponent(d)+"="+encodeURIComponent(String(g)))}}
return b};goog.html.SafeUrl=function(){this.privateDoNotAccessOrElseSafeUrlWrappedValue_="";this.SAFE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_};goog.html.SafeUrl.INNOCUOUS_STRING="about:invalid#zClosurez";goog.html.SafeUrl.prototype.implementsGoogStringTypedString=!0;goog.html.SafeUrl.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeUrlWrappedValue_.toString()};goog.html.SafeUrl.prototype.implementsGoogI18nBidiDirectionalString=!0;goog.html.SafeUrl.prototype.getDirection=function(){return goog.i18n.bidi.Dir.LTR};goog.DEBUG&&(goog.html.SafeUrl.prototype.toString=function(){return"SafeUrl{"+this.privateDoNotAccessOrElseSafeUrlWrappedValue_+"}"});goog.html.SafeUrl.unwrap=function(a){return goog.html.SafeUrl.unwrapTrustedURL(a).toString()};goog.html.SafeUrl.unwrapTrustedURL=function(a){if(a instanceof goog.html.SafeUrl&&a.constructor===goog.html.SafeUrl&&a.SAFE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_)return a.privateDoNotAccessOrElseSafeUrlWrappedValue_;goog.asserts.fail("expected object of type SafeUrl, got '"+a+"' of type "+goog.typeOf(a));return"type_error:SafeUrl"};goog.html.SafeUrl.fromConstant=function(a){return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(goog.string.Const.unwrap(a))};goog.html.SAFE_MIME_TYPE_PATTERN_=/^(?:audio\/(?:3gpp2|3gpp|aac|L16|midi|mp3|mp4|mpeg|oga|ogg|opus|x-m4a|x-wav|wav|webm)|image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp|x-icon)|text\/csv|video\/(?:mpeg|mp4|ogg|webm|quicktime))(?:;\w+=(?:\w+|"[\w;=]+"))*$/i;goog.html.SafeUrl.isSafeMimeType=function(a){return goog.html.SAFE_MIME_TYPE_PATTERN_.test(a)};goog.html.SafeUrl.fromBlob=function(a){a=goog.html.SAFE_MIME_TYPE_PATTERN_.test(a.type)?goog.fs.url.createObjectUrl(a):goog.html.SafeUrl.INNOCUOUS_STRING;return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(a)};goog.html.DATA_URL_PATTERN_=/^data:([^,]*);base64,[a-z0-9+\/]+=*$/i;goog.html.SafeUrl.fromDataUrl=function(a){a=a.replace(/(%0A|%0D)/g,"");var b=a.match(goog.html.DATA_URL_PATTERN_);b=b&&goog.html.SAFE_MIME_TYPE_PATTERN_.test(b[1]);return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(b?a:goog.html.SafeUrl.INNOCUOUS_STRING)};goog.html.SafeUrl.fromTelUrl=function(a){goog.string.internal.caseInsensitiveStartsWith(a,"tel:")||(a=goog.html.SafeUrl.INNOCUOUS_STRING);return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(a)};goog.html.SIP_URL_PATTERN_=/^sip[s]?:[+a-z0-9_.!$%&'*\/=^`{|}~-]+@([a-z0-9-]+\.)+[a-z0-9]{2,63}$/i;goog.html.SafeUrl.fromSipUrl=function(a){goog.html.SIP_URL_PATTERN_.test(decodeURIComponent(a))||(a=goog.html.SafeUrl.INNOCUOUS_STRING);return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(a)};goog.html.SafeUrl.fromFacebookMessengerUrl=function(a){goog.string.internal.caseInsensitiveStartsWith(a,"fb-messenger://share")||(a=goog.html.SafeUrl.INNOCUOUS_STRING);return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(a)};goog.html.SafeUrl.fromWhatsAppUrl=function(a){goog.string.internal.caseInsensitiveStartsWith(a,"whatsapp://send")||(a=goog.html.SafeUrl.INNOCUOUS_STRING);return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(a)};goog.html.SafeUrl.fromSmsUrl=function(a){goog.string.internal.caseInsensitiveStartsWith(a,"sms:")&&goog.html.SafeUrl.isSmsUrlBodyValid_(a)||(a=goog.html.SafeUrl.INNOCUOUS_STRING);return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(a)};goog.html.SafeUrl.isSmsUrlBodyValid_=function(a){var b=a.indexOf("#");0<b&&(a=a.substring(0,b));b=a.match(/[?&]body=/gi);if(!b)return!0;if(1<b.length)return!1;a=a.match(/[?&]body=([^&]*)/)[1];if(!a)return!0;try{decodeURIComponent(a)}catch(c){return!1}
return/^(?:[a-z0-9\-_.~]|%[0-9a-f]{2})+$/i.test(a)};goog.html.SafeUrl.fromSshUrl=function(a){goog.string.internal.caseInsensitiveStartsWith(a,"ssh://")||(a=goog.html.SafeUrl.INNOCUOUS_STRING);return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(a)};goog.html.SafeUrl.sanitizeChromeExtensionUrl=function(a,b){return goog.html.SafeUrl.sanitizeExtensionUrl_(/^chrome-extension:\/\/([^\/]+)\//,a,b)};goog.html.SafeUrl.sanitizeFirefoxExtensionUrl=function(a,b){return goog.html.SafeUrl.sanitizeExtensionUrl_(/^moz-extension:\/\/([^\/]+)\//,a,b)};goog.html.SafeUrl.sanitizeEdgeExtensionUrl=function(a,b){return goog.html.SafeUrl.sanitizeExtensionUrl_(/^ms-browser-extension:\/\/([^\/]+)\//,a,b)};goog.html.SafeUrl.sanitizeExtensionUrl_=function(a,b,c){(a=a.exec(b))?(a=a[1],-1==(c instanceof goog.string.Const?[goog.string.Const.unwrap(c)]:c.map(function(a){return goog.string.Const.unwrap(a)})).indexOf(a)&&(b=goog.html.SafeUrl.INNOCUOUS_STRING)):b=goog.html.SafeUrl.INNOCUOUS_STRING;return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(b)};goog.html.SafeUrl.fromTrustedResourceUrl=function(a){return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(goog.html.TrustedResourceUrl.unwrap(a))};goog.html.SAFE_URL_PATTERN_=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;goog.html.SafeUrl.SAFE_URL_PATTERN=goog.html.SAFE_URL_PATTERN_;goog.html.SafeUrl.sanitize=function(a){if(a instanceof goog.html.SafeUrl)return a;a="object"==typeof a&&a.implementsGoogStringTypedString?a.getTypedStringValue():String(a);goog.html.SAFE_URL_PATTERN_.test(a)||(a=goog.html.SafeUrl.INNOCUOUS_STRING);return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(a)};goog.html.SafeUrl.sanitizeAssertUnchanged=function(a,b){if(a instanceof goog.html.SafeUrl)return a;a="object"==typeof a&&a.implementsGoogStringTypedString?a.getTypedStringValue():String(a);if(b&&/^data:/i.test(a)&&(b=goog.html.SafeUrl.fromDataUrl(a),b.getTypedStringValue()==a))return b;goog.asserts.assert(goog.html.SAFE_URL_PATTERN_.test(a),"%s does not match the safe URL pattern",a)||(a=goog.html.SafeUrl.INNOCUOUS_STRING);return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(a)};goog.html.SafeUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={};goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse=function(a){var b=new goog.html.SafeUrl;b.privateDoNotAccessOrElseSafeUrlWrappedValue_=goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY?goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY.createURL(a):a;return b};goog.html.SafeUrl.ABOUT_BLANK=goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse("about:blank");goog.html.SafeStyle=function(){this.privateDoNotAccessOrElseSafeStyleWrappedValue_="";this.SAFE_STYLE_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeStyle.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_};goog.html.SafeStyle.prototype.implementsGoogStringTypedString=!0;goog.html.SafeStyle.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={};goog.html.SafeStyle.fromConstant=function(a){a=goog.string.Const.unwrap(a);if(0===a.length)return goog.html.SafeStyle.EMPTY;goog.asserts.assert(goog.string.internal.endsWith(a,";"),"Last character of style string is not ';': "+a);goog.asserts.assert(goog.string.internal.contains(a,":"),"Style string must contain at least one ':', to specify a \"name: value\" pair: "+a);return goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(a)};goog.html.SafeStyle.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeStyleWrappedValue_};goog.DEBUG&&(goog.html.SafeStyle.prototype.toString=function(){return"SafeStyle{"+this.privateDoNotAccessOrElseSafeStyleWrappedValue_+"}"});goog.html.SafeStyle.unwrap=function(a){if(a instanceof goog.html.SafeStyle&&a.constructor===goog.html.SafeStyle&&a.SAFE_STYLE_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeStyle.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_)return a.privateDoNotAccessOrElseSafeStyleWrappedValue_;goog.asserts.fail("expected object of type SafeStyle, got '"+a+"' of type "+goog.typeOf(a));return"type_error:SafeStyle"};goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse=function(a){return(new goog.html.SafeStyle).initSecurityPrivateDoNotAccessOrElse_(a)};goog.html.SafeStyle.prototype.initSecurityPrivateDoNotAccessOrElse_=function(a){this.privateDoNotAccessOrElseSafeStyleWrappedValue_=a;return this};goog.html.SafeStyle.EMPTY=goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse("");goog.html.SafeStyle.INNOCUOUS_STRING="zClosurez";goog.html.SafeStyle.create=function(a){var b="",c;for(c in a){if(!/^[-_a-zA-Z0-9]+$/.test(c))throw Error("Name allows only [-_a-zA-Z0-9], got: "+c);var d=a[c];null!=d&&(d=goog.isArray(d)?goog.array.map(d,goog.html.SafeStyle.sanitizePropertyValue_).join(" "):goog.html.SafeStyle.sanitizePropertyValue_(d),b+=c+":"+d+";")}
return b?goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(b):goog.html.SafeStyle.EMPTY};goog.html.SafeStyle.sanitizePropertyValue_=function(a){if(a instanceof goog.html.SafeUrl)return'url("'+goog.html.SafeUrl.unwrap(a).replace(/</g,"%3c").replace(/[\\"]/g,"\\$&")+'")';a=a instanceof goog.string.Const?goog.string.Const.unwrap(a):goog.html.SafeStyle.sanitizePropertyValueString_(String(a));if(/[{;}]/.test(a))throw new goog.asserts.AssertionError("Value does not allow [{;}], got: %s.",[a]);return a};goog.html.SafeStyle.sanitizePropertyValueString_=function(a){var b=a.replace(goog.html.SafeStyle.FUNCTIONS_RE_,"$1").replace(goog.html.SafeStyle.FUNCTIONS_RE_,"$1").replace(goog.html.SafeStyle.URL_RE_,"url");if(goog.html.SafeStyle.VALUE_RE_.test(b)){if(goog.html.SafeStyle.COMMENT_RE_.test(a))return goog.asserts.fail("String value disallows comments, got: "+a),goog.html.SafeStyle.INNOCUOUS_STRING;if(!goog.html.SafeStyle.hasBalancedQuotes_(a))return goog.asserts.fail("String value requires balanced quotes, got: "+
a),goog.html.SafeStyle.INNOCUOUS_STRING;if(!goog.html.SafeStyle.hasBalancedSquareBrackets_(a))return goog.asserts.fail("String value requires balanced square brackets and one identifier per pair of brackets, got: "+a),goog.html.SafeStyle.INNOCUOUS_STRING}else return goog.asserts.fail("String value allows only "+goog.html.SafeStyle.VALUE_ALLOWED_CHARS_+" and simple functions, got: "+a),goog.html.SafeStyle.INNOCUOUS_STRING;return goog.html.SafeStyle.sanitizeUrl_(a)};goog.html.SafeStyle.hasBalancedQuotes_=function(a){for(var b=!0,c=!0,d=0;d<a.length;d++){var e=a.charAt(d);"'"==e&&c?b=!b:'"'==e&&b&&(c=!c)}
return b&&c};goog.html.SafeStyle.hasBalancedSquareBrackets_=function(a){for(var b=!0,c=/^[-_a-zA-Z0-9]$/,d=0;d<a.length;d++){var e=a.charAt(d);if("]"==e){if(b)return!1;b=!0}else if("["==e){if(!b)return!1;b=!1}else if(!b&&!c.test(e))return!1}
return b};goog.html.SafeStyle.VALUE_ALLOWED_CHARS_="[-,.\"'%_!# a-zA-Z0-9\\[\\]]";goog.html.SafeStyle.VALUE_RE_=new RegExp("^"+goog.html.SafeStyle.VALUE_ALLOWED_CHARS_+"+$");goog.html.SafeStyle.URL_RE_=/\b(url\([ \t\n]*)('[ -&(-\[\]-~]*'|"[ !#-\[\]-~]*"|[!#-&*-\[\]-~]*)([ \t\n]*\))/g;goog.html.SafeStyle.FUNCTIONS_RE_=/\b(hsl|hsla|rgb|rgba|matrix|calc|minmax|fit-content|repeat|(rotate|scale|translate)(X|Y|Z|3d)?)\([-+*/0-9a-z.%\[\], ]+\)/g;goog.html.SafeStyle.COMMENT_RE_=/\/\*/;goog.html.SafeStyle.sanitizeUrl_=function(a){return a.replace(goog.html.SafeStyle.URL_RE_,function(a,c,d,e){var b="";d=d.replace(/^(['"])(.*)\1$/,function(a,c,d){b=c;return d});a=goog.html.SafeUrl.sanitize(d).getTypedStringValue();return c+b+a+b+e})};goog.html.SafeStyle.concat=function(a){var b="",c=function(a){goog.isArray(a)?goog.array.forEach(a,c):b+=goog.html.SafeStyle.unwrap(a)};goog.array.forEach(arguments,c);return b?goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(b):goog.html.SafeStyle.EMPTY};goog.html.SafeScript=function(){this.privateDoNotAccessOrElseSafeScriptWrappedValue_="";this.SAFE_SCRIPT_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeScript.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_};goog.html.SafeScript.prototype.implementsGoogStringTypedString=!0;goog.html.SafeScript.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={};goog.html.SafeScript.fromConstant=function(a){a=goog.string.Const.unwrap(a);return 0===a.length?goog.html.SafeScript.EMPTY:goog.html.SafeScript.createSafeScriptSecurityPrivateDoNotAccessOrElse(a)};goog.html.SafeScript.fromConstantAndArgs=function(a,b){for(var c=[],d=1;d<arguments.length;d++)c.push(goog.html.SafeScript.stringify_(arguments[d]));return goog.html.SafeScript.createSafeScriptSecurityPrivateDoNotAccessOrElse("("+goog.string.Const.unwrap(a)+")("+c.join(", ")+");")};goog.html.SafeScript.fromJson=function(a){return goog.html.SafeScript.createSafeScriptSecurityPrivateDoNotAccessOrElse(goog.html.SafeScript.stringify_(a))};goog.html.SafeScript.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeScriptWrappedValue_.toString()};goog.DEBUG&&(goog.html.SafeScript.prototype.toString=function(){return"SafeScript{"+this.privateDoNotAccessOrElseSafeScriptWrappedValue_+"}"});goog.html.SafeScript.unwrap=function(a){return goog.html.SafeScript.unwrapTrustedScript(a).toString()};goog.html.SafeScript.unwrapTrustedScript=function(a){if(a instanceof goog.html.SafeScript&&a.constructor===goog.html.SafeScript&&a.SAFE_SCRIPT_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeScript.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_)return a.privateDoNotAccessOrElseSafeScriptWrappedValue_;goog.asserts.fail("expected object of type SafeScript, got '"+a+"' of type "+goog.typeOf(a));return"type_error:SafeScript"};goog.html.SafeScript.stringify_=function(a){return JSON.stringify(a).replace(/</g,"\\x3c")};goog.html.SafeScript.createSafeScriptSecurityPrivateDoNotAccessOrElse=function(a){return(new goog.html.SafeScript).initSecurityPrivateDoNotAccessOrElse_(a)};goog.html.SafeScript.prototype.initSecurityPrivateDoNotAccessOrElse_=function(a){this.privateDoNotAccessOrElseSafeScriptWrappedValue_=goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY?goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY.createScript(a):a;return this};goog.html.SafeScript.EMPTY=goog.html.SafeScript.createSafeScriptSecurityPrivateDoNotAccessOrElse("");goog.object={};goog.object.is=function(a,b){return a===b?0!==a||1/a===1/b:a!==a&&b!==b};goog.object.forEach=function(a,b,c){for(var d in a)b.call(c,a[d],d,a)};goog.object.filter=function(a,b,c){var d={},e;for(e in a)b.call(c,a[e],e,a)&&(d[e]=a[e]);return d};goog.object.map=function(a,b,c){var d={},e;for(e in a)d[e]=b.call(c,a[e],e,a);return d};goog.object.some=function(a,b,c){for(var d in a)
if(b.call(c,a[d],d,a))return!0;return!1};goog.object.every=function(a,b,c){for(var d in a)
if(!b.call(c,a[d],d,a))return!1;return!0};goog.object.getCount=function(a){var b=0,c;for(c in a)b++;return b};goog.object.getAnyKey=function(a){for(var b in a)return b};goog.object.getAnyValue=function(a){for(var b in a)return a[b]};goog.object.contains=function(a,b){return goog.object.containsValue(a,b)};goog.object.getValues=function(a){var b=[],c=0,d;for(d in a)b[c++]=a[d];return b};goog.object.getKeys=function(a){var b=[],c=0,d;for(d in a)b[c++]=d;return b};goog.object.getValueByKeys=function(a,b){var c=goog.isArrayLike(b),d=c?b:arguments;for(c=c?0:1;c<d.length;c++){if(null==a)return;a=a[d[c]]}
return a};goog.object.containsKey=function(a,b){return null!==a&&b in a};goog.object.containsValue=function(a,b){for(var c in a)
if(a[c]==b)return!0;return!1};goog.object.findKey=function(a,b,c){for(var d in a)
if(b.call(c,a[d],d,a))return d};goog.object.findValue=function(a,b,c){return(b=goog.object.findKey(a,b,c))&&a[b]};goog.object.isEmpty=function(a){for(var b in a)return!1;return!0};goog.object.clear=function(a){for(var b in a)delete a[b]};goog.object.remove=function(a,b){var c;(c=b in a)&&delete a[b];return c};goog.object.add=function(a,b,c){if(null!==a&&b in a)throw Error('The object already contains the key "'+b+'"');goog.object.set(a,b,c)};goog.object.get=function(a,b,c){return null!==a&&b in a?a[b]:c};goog.object.set=function(a,b,c){a[b]=c};goog.object.setIfUndefined=function(a,b,c){return b in a?a[b]:a[b]=c};goog.object.setWithReturnValueIfNotSet=function(a,b,c){if(b in a)return a[b];c=c();return a[b]=c};goog.object.equals=function(a,b){for(var c in a)
if(!(c in b)||a[c]!==b[c])return!1;for(var d in b)
if(!(d in a))return!1;return!0};goog.object.clone=function(a){var b={},c;for(c in a)b[c]=a[c];return b};goog.object.unsafeClone=function(a){var b=goog.typeOf(a);if("object"==b||"array"==b){if(goog.isFunction(a.clone))return a.clone();b="array"==b?[]:{};for(var c in a)b[c]=goog.object.unsafeClone(a[c]);return b}
return a};goog.object.transpose=function(a){var b={},c;for(c in a)b[a[c]]=c;return b};goog.object.PROTOTYPE_FIELDS_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");goog.object.extend=function(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<goog.object.PROTOTYPE_FIELDS_.length;f++)c=goog.object.PROTOTYPE_FIELDS_[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};goog.object.create=function(a){var b=arguments.length;if(1==b&&goog.isArray(arguments[0]))return goog.object.create.apply(null,arguments[0]);if(b%2)throw Error("Uneven number of arguments");for(var c={},d=0;d<b;d+=2)c[arguments[d]]=arguments[d+1];return c};goog.object.createSet=function(a){var b=arguments.length;if(1==b&&goog.isArray(arguments[0]))return goog.object.createSet.apply(null,arguments[0]);for(var c={},d=0;d<b;d++)c[arguments[d]]=!0;return c};goog.object.createImmutableView=function(a){var b=a;Object.isFrozen&&!Object.isFrozen(a)&&(b=Object.create(a),Object.freeze(b));return b};goog.object.isImmutableView=function(a){return!!Object.isFrozen&&Object.isFrozen(a)};goog.object.getAllPropertyNames=function(a,b,c){if(!a)return[];if(!Object.getOwnPropertyNames||!Object.getPrototypeOf)return goog.object.getKeys(a);for(var d={};a&&(a!==Object.prototype||b)&&(a!==Function.prototype||c);){for(var e=Object.getOwnPropertyNames(a),f=0;f<e.length;f++)d[e[f]]=!0;a=Object.getPrototypeOf(a)}
return goog.object.getKeys(d)};goog.object.getSuperClass=function(a){return(a=Object.getPrototypeOf(a.prototype))&&a.constructor};goog.html.SafeStyleSheet=function(){this.privateDoNotAccessOrElseSafeStyleSheetWrappedValue_="";this.SAFE_STYLE_SHEET_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeStyleSheet.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_};goog.html.SafeStyleSheet.prototype.implementsGoogStringTypedString=!0;goog.html.SafeStyleSheet.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={};goog.html.SafeStyleSheet.createRule=function(a,b){if(goog.string.internal.contains(a,"<"))throw Error("Selector does not allow '<', got: "+a);var c=a.replace(/('|")((?!\1)[^\r\n\f\\]|\\[\s\S])*\1/g,"");if(!/^[-_a-zA-Z0-9#.:* ,>+~[\]()=^$|]+$/.test(c))throw Error("Selector allows only [-_a-zA-Z0-9#.:* ,>+~[\\]()=^$|] and strings, got: "+a);if(!goog.html.SafeStyleSheet.hasBalancedBrackets_(c))throw Error("() and [] in selector must be balanced, got: "+a);b instanceof goog.html.SafeStyle||(b=goog.html.SafeStyle.create(b));a=a+"{"+goog.html.SafeStyle.unwrap(b).replace(/</g,"\\3C ")+"}";return goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse(a)};goog.html.SafeStyleSheet.hasBalancedBrackets_=function(a){for(var b={"(":")","[":"]"},c=[],d=0;d<a.length;d++){var e=a[d];if(b[e])c.push(b[e]);else if(goog.object.contains(b,e)&&c.pop()!=e)return!1}
return 0==c.length};goog.html.SafeStyleSheet.concat=function(a){var b="",c=function(a){goog.isArray(a)?goog.array.forEach(a,c):b+=goog.html.SafeStyleSheet.unwrap(a)};goog.array.forEach(arguments,c);return goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse(b)};goog.html.SafeStyleSheet.fromConstant=function(a){a=goog.string.Const.unwrap(a);if(0===a.length)return goog.html.SafeStyleSheet.EMPTY;goog.asserts.assert(!goog.string.internal.contains(a,"<"),"Forbidden '<' character in style sheet string: "+a);return goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse(a)};goog.html.SafeStyleSheet.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeStyleSheetWrappedValue_};goog.DEBUG&&(goog.html.SafeStyleSheet.prototype.toString=function(){return"SafeStyleSheet{"+this.privateDoNotAccessOrElseSafeStyleSheetWrappedValue_+"}"});goog.html.SafeStyleSheet.unwrap=function(a){if(a instanceof goog.html.SafeStyleSheet&&a.constructor===goog.html.SafeStyleSheet&&a.SAFE_STYLE_SHEET_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeStyleSheet.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_)return a.privateDoNotAccessOrElseSafeStyleSheetWrappedValue_;goog.asserts.fail("expected object of type SafeStyleSheet, got '"+a+"' of type "+goog.typeOf(a));return"type_error:SafeStyleSheet"};goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse=function(a){return(new goog.html.SafeStyleSheet).initSecurityPrivateDoNotAccessOrElse_(a)};goog.html.SafeStyleSheet.prototype.initSecurityPrivateDoNotAccessOrElse_=function(a){this.privateDoNotAccessOrElseSafeStyleSheetWrappedValue_=a;return this};goog.html.SafeStyleSheet.EMPTY=goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse("");goog.dom.tags={};goog.dom.tags.VOID_TAGS_={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};goog.dom.tags.isVoidTag=function(a){return!0===goog.dom.tags.VOID_TAGS_[a]};goog.dom.HtmlElement=function(){};goog.dom.TagName=function(a){this.tagName_=a};goog.dom.TagName.prototype.toString=function(){return this.tagName_};goog.dom.TagName.A=new goog.dom.TagName("A");goog.dom.TagName.ABBR=new goog.dom.TagName("ABBR");goog.dom.TagName.ACRONYM=new goog.dom.TagName("ACRONYM");goog.dom.TagName.ADDRESS=new goog.dom.TagName("ADDRESS");goog.dom.TagName.APPLET=new goog.dom.TagName("APPLET");goog.dom.TagName.AREA=new goog.dom.TagName("AREA");goog.dom.TagName.ARTICLE=new goog.dom.TagName("ARTICLE");goog.dom.TagName.ASIDE=new goog.dom.TagName("ASIDE");goog.dom.TagName.AUDIO=new goog.dom.TagName("AUDIO");goog.dom.TagName.B=new goog.dom.TagName("B");goog.dom.TagName.BASE=new goog.dom.TagName("BASE");goog.dom.TagName.BASEFONT=new goog.dom.TagName("BASEFONT");goog.dom.TagName.BDI=new goog.dom.TagName("BDI");goog.dom.TagName.BDO=new goog.dom.TagName("BDO");goog.dom.TagName.BIG=new goog.dom.TagName("BIG");goog.dom.TagName.BLOCKQUOTE=new goog.dom.TagName("BLOCKQUOTE");goog.dom.TagName.BODY=new goog.dom.TagName("BODY");goog.dom.TagName.BR=new goog.dom.TagName("BR");goog.dom.TagName.BUTTON=new goog.dom.TagName("BUTTON");goog.dom.TagName.CANVAS=new goog.dom.TagName("CANVAS");goog.dom.TagName.CAPTION=new goog.dom.TagName("CAPTION");goog.dom.TagName.CENTER=new goog.dom.TagName("CENTER");goog.dom.TagName.CITE=new goog.dom.TagName("CITE");goog.dom.TagName.CODE=new goog.dom.TagName("CODE");goog.dom.TagName.COL=new goog.dom.TagName("COL");goog.dom.TagName.COLGROUP=new goog.dom.TagName("COLGROUP");goog.dom.TagName.COMMAND=new goog.dom.TagName("COMMAND");goog.dom.TagName.DATA=new goog.dom.TagName("DATA");goog.dom.TagName.DATALIST=new goog.dom.TagName("DATALIST");goog.dom.TagName.DD=new goog.dom.TagName("DD");goog.dom.TagName.DEL=new goog.dom.TagName("DEL");goog.dom.TagName.DETAILS=new goog.dom.TagName("DETAILS");goog.dom.TagName.DFN=new goog.dom.TagName("DFN");goog.dom.TagName.DIALOG=new goog.dom.TagName("DIALOG");goog.dom.TagName.DIR=new goog.dom.TagName("DIR");goog.dom.TagName.DIV=new goog.dom.TagName("DIV");goog.dom.TagName.DL=new goog.dom.TagName("DL");goog.dom.TagName.DT=new goog.dom.TagName("DT");goog.dom.TagName.EM=new goog.dom.TagName("EM");goog.dom.TagName.EMBED=new goog.dom.TagName("EMBED");goog.dom.TagName.FIELDSET=new goog.dom.TagName("FIELDSET");goog.dom.TagName.FIGCAPTION=new goog.dom.TagName("FIGCAPTION");goog.dom.TagName.FIGURE=new goog.dom.TagName("FIGURE");goog.dom.TagName.FONT=new goog.dom.TagName("FONT");goog.dom.TagName.FOOTER=new goog.dom.TagName("FOOTER");goog.dom.TagName.FORM=new goog.dom.TagName("FORM");goog.dom.TagName.FRAME=new goog.dom.TagName("FRAME");goog.dom.TagName.FRAMESET=new goog.dom.TagName("FRAMESET");goog.dom.TagName.H1=new goog.dom.TagName("H1");goog.dom.TagName.H2=new goog.dom.TagName("H2");goog.dom.TagName.H3=new goog.dom.TagName("H3");goog.dom.TagName.H4=new goog.dom.TagName("H4");goog.dom.TagName.H5=new goog.dom.TagName("H5");goog.dom.TagName.H6=new goog.dom.TagName("H6");goog.dom.TagName.HEAD=new goog.dom.TagName("HEAD");goog.dom.TagName.HEADER=new goog.dom.TagName("HEADER");goog.dom.TagName.HGROUP=new goog.dom.TagName("HGROUP");goog.dom.TagName.HR=new goog.dom.TagName("HR");goog.dom.TagName.HTML=new goog.dom.TagName("HTML");goog.dom.TagName.I=new goog.dom.TagName("I");goog.dom.TagName.IFRAME=new goog.dom.TagName("IFRAME");goog.dom.TagName.IMG=new goog.dom.TagName("IMG");goog.dom.TagName.INPUT=new goog.dom.TagName("INPUT");goog.dom.TagName.INS=new goog.dom.TagName("INS");goog.dom.TagName.ISINDEX=new goog.dom.TagName("ISINDEX");goog.dom.TagName.KBD=new goog.dom.TagName("KBD");goog.dom.TagName.KEYGEN=new goog.dom.TagName("KEYGEN");goog.dom.TagName.LABEL=new goog.dom.TagName("LABEL");goog.dom.TagName.LEGEND=new goog.dom.TagName("LEGEND");goog.dom.TagName.LI=new goog.dom.TagName("LI");goog.dom.TagName.LINK=new goog.dom.TagName("LINK");goog.dom.TagName.MAIN=new goog.dom.TagName("MAIN");goog.dom.TagName.MAP=new goog.dom.TagName("MAP");goog.dom.TagName.MARK=new goog.dom.TagName("MARK");goog.dom.TagName.MATH=new goog.dom.TagName("MATH");goog.dom.TagName.MENU=new goog.dom.TagName("MENU");goog.dom.TagName.MENUITEM=new goog.dom.TagName("MENUITEM");goog.dom.TagName.META=new goog.dom.TagName("META");goog.dom.TagName.METER=new goog.dom.TagName("METER");goog.dom.TagName.NAV=new goog.dom.TagName("NAV");goog.dom.TagName.NOFRAMES=new goog.dom.TagName("NOFRAMES");goog.dom.TagName.NOSCRIPT=new goog.dom.TagName("NOSCRIPT");goog.dom.TagName.OBJECT=new goog.dom.TagName("OBJECT");goog.dom.TagName.OL=new goog.dom.TagName("OL");goog.dom.TagName.OPTGROUP=new goog.dom.TagName("OPTGROUP");goog.dom.TagName.OPTION=new goog.dom.TagName("OPTION");goog.dom.TagName.OUTPUT=new goog.dom.TagName("OUTPUT");goog.dom.TagName.P=new goog.dom.TagName("P");goog.dom.TagName.PARAM=new goog.dom.TagName("PARAM");goog.dom.TagName.PICTURE=new goog.dom.TagName("PICTURE");goog.dom.TagName.PRE=new goog.dom.TagName("PRE");goog.dom.TagName.PROGRESS=new goog.dom.TagName("PROGRESS");goog.dom.TagName.Q=new goog.dom.TagName("Q");goog.dom.TagName.RP=new goog.dom.TagName("RP");goog.dom.TagName.RT=new goog.dom.TagName("RT");goog.dom.TagName.RTC=new goog.dom.TagName("RTC");goog.dom.TagName.RUBY=new goog.dom.TagName("RUBY");goog.dom.TagName.S=new goog.dom.TagName("S");goog.dom.TagName.SAMP=new goog.dom.TagName("SAMP");goog.dom.TagName.SCRIPT=new goog.dom.TagName("SCRIPT");goog.dom.TagName.SECTION=new goog.dom.TagName("SECTION");goog.dom.TagName.SELECT=new goog.dom.TagName("SELECT");goog.dom.TagName.SMALL=new goog.dom.TagName("SMALL");goog.dom.TagName.SOURCE=new goog.dom.TagName("SOURCE");goog.dom.TagName.SPAN=new goog.dom.TagName("SPAN");goog.dom.TagName.STRIKE=new goog.dom.TagName("STRIKE");goog.dom.TagName.STRONG=new goog.dom.TagName("STRONG");goog.dom.TagName.STYLE=new goog.dom.TagName("STYLE");goog.dom.TagName.SUB=new goog.dom.TagName("SUB");goog.dom.TagName.SUMMARY=new goog.dom.TagName("SUMMARY");goog.dom.TagName.SUP=new goog.dom.TagName("SUP");goog.dom.TagName.SVG=new goog.dom.TagName("SVG");goog.dom.TagName.TABLE=new goog.dom.TagName("TABLE");goog.dom.TagName.TBODY=new goog.dom.TagName("TBODY");goog.dom.TagName.TD=new goog.dom.TagName("TD");goog.dom.TagName.TEMPLATE=new goog.dom.TagName("TEMPLATE");goog.dom.TagName.TEXTAREA=new goog.dom.TagName("TEXTAREA");goog.dom.TagName.TFOOT=new goog.dom.TagName("TFOOT");goog.dom.TagName.TH=new goog.dom.TagName("TH");goog.dom.TagName.THEAD=new goog.dom.TagName("THEAD");goog.dom.TagName.TIME=new goog.dom.TagName("TIME");goog.dom.TagName.TITLE=new goog.dom.TagName("TITLE");goog.dom.TagName.TR=new goog.dom.TagName("TR");goog.dom.TagName.TRACK=new goog.dom.TagName("TRACK");goog.dom.TagName.TT=new goog.dom.TagName("TT");goog.dom.TagName.U=new goog.dom.TagName("U");goog.dom.TagName.UL=new goog.dom.TagName("UL");goog.dom.TagName.VAR=new goog.dom.TagName("VAR");goog.dom.TagName.VIDEO=new goog.dom.TagName("VIDEO");goog.dom.TagName.WBR=new goog.dom.TagName("WBR");goog.labs={};goog.labs.userAgent={};goog.labs.userAgent.util={};goog.labs.userAgent.util.getNativeUserAgentString_=function(){var a=goog.labs.userAgent.util.getNavigator_();return a&&(a=a.userAgent)?a:""};goog.labs.userAgent.util.getNavigator_=function(){return goog.global.navigator};goog.labs.userAgent.util.userAgent_=goog.labs.userAgent.util.getNativeUserAgentString_();goog.labs.userAgent.util.setUserAgent=function(a){goog.labs.userAgent.util.userAgent_=a||goog.labs.userAgent.util.getNativeUserAgentString_()};goog.labs.userAgent.util.getUserAgent=function(){return goog.labs.userAgent.util.userAgent_};goog.labs.userAgent.util.matchUserAgent=function(a){var b=goog.labs.userAgent.util.getUserAgent();return goog.string.internal.contains(b,a)};goog.labs.userAgent.util.matchUserAgentIgnoreCase=function(a){var b=goog.labs.userAgent.util.getUserAgent();return goog.string.internal.caseInsensitiveContains(b,a)};goog.labs.userAgent.util.extractVersionTuples=function(a){for(var b=/(\w[\w ]+)\/([^\s]+)\s*(?:\((.*?)\))?/g,c=[],d;d=b.exec(a);)c.push([d[1],d[2],d[3]||void 0]);return c};goog.labs.userAgent.browser={};goog.labs.userAgent.browser.matchOpera_=function(){return goog.labs.userAgent.util.matchUserAgent("Opera")};goog.labs.userAgent.browser.matchIE_=function(){return goog.labs.userAgent.util.matchUserAgent("Trident")||goog.labs.userAgent.util.matchUserAgent("MSIE")};goog.labs.userAgent.browser.matchEdgeHtml_=function(){return goog.labs.userAgent.util.matchUserAgent("Edge")};goog.labs.userAgent.browser.matchEdgeChromium_=function(){return goog.labs.userAgent.util.matchUserAgent("Edg/")};goog.labs.userAgent.browser.matchOperaChromium_=function(){return goog.labs.userAgent.util.matchUserAgent("OPR")};goog.labs.userAgent.browser.matchFirefox_=function(){return goog.labs.userAgent.util.matchUserAgent("Firefox")||goog.labs.userAgent.util.matchUserAgent("FxiOS")};goog.labs.userAgent.browser.matchSafari_=function(){return goog.labs.userAgent.util.matchUserAgent("Safari")&&!(goog.labs.userAgent.browser.matchChrome_()||goog.labs.userAgent.browser.matchCoast_()||goog.labs.userAgent.browser.matchOpera_()||goog.labs.userAgent.browser.matchEdgeHtml_()||goog.labs.userAgent.browser.matchEdgeChromium_()||goog.labs.userAgent.browser.matchOperaChromium_()||goog.labs.userAgent.browser.matchFirefox_()||goog.labs.userAgent.browser.isSilk()||goog.labs.userAgent.util.matchUserAgent("Android"))};goog.labs.userAgent.browser.matchCoast_=function(){return goog.labs.userAgent.util.matchUserAgent("Coast")};goog.labs.userAgent.browser.matchIosWebview_=function(){return(goog.labs.userAgent.util.matchUserAgent("iPad")||goog.labs.userAgent.util.matchUserAgent("iPhone"))&&!goog.labs.userAgent.browser.matchSafari_()&&!goog.labs.userAgent.browser.matchChrome_()&&!goog.labs.userAgent.browser.matchCoast_()&&!goog.labs.userAgent.browser.matchFirefox_()&&goog.labs.userAgent.util.matchUserAgent("AppleWebKit")};goog.labs.userAgent.browser.matchChrome_=function(){return(goog.labs.userAgent.util.matchUserAgent("Chrome")||goog.labs.userAgent.util.matchUserAgent("CriOS"))&&!goog.labs.userAgent.browser.matchEdgeHtml_()};goog.labs.userAgent.browser.matchAndroidBrowser_=function(){return goog.labs.userAgent.util.matchUserAgent("Android")&&!(goog.labs.userAgent.browser.isChrome()||goog.labs.userAgent.browser.isFirefox()||goog.labs.userAgent.browser.isOpera()||goog.labs.userAgent.browser.isSilk())};goog.labs.userAgent.browser.isOpera=goog.labs.userAgent.browser.matchOpera_;goog.labs.userAgent.browser.isIE=goog.labs.userAgent.browser.matchIE_;goog.labs.userAgent.browser.isEdge=goog.labs.userAgent.browser.matchEdgeHtml_;goog.labs.userAgent.browser.isEdgeChromium=goog.labs.userAgent.browser.matchEdgeChromium_;goog.labs.userAgent.browser.isOperaChromium=goog.labs.userAgent.browser.matchOperaChromium_;goog.labs.userAgent.browser.isFirefox=goog.labs.userAgent.browser.matchFirefox_;goog.labs.userAgent.browser.isSafari=goog.labs.userAgent.browser.matchSafari_;goog.labs.userAgent.browser.isCoast=goog.labs.userAgent.browser.matchCoast_;goog.labs.userAgent.browser.isIosWebview=goog.labs.userAgent.browser.matchIosWebview_;goog.labs.userAgent.browser.isChrome=goog.labs.userAgent.browser.matchChrome_;goog.labs.userAgent.browser.isAndroidBrowser=goog.labs.userAgent.browser.matchAndroidBrowser_;goog.labs.userAgent.browser.isSilk=function(){return goog.labs.userAgent.util.matchUserAgent("Silk")};goog.labs.userAgent.browser.getVersion=function(){function a(a){a=goog.array.find(a,d);return c[a]||""}
var b=goog.labs.userAgent.util.getUserAgent();if(goog.labs.userAgent.browser.isIE())return goog.labs.userAgent.browser.getIEVersion_(b);b=goog.labs.userAgent.util.extractVersionTuples(b);var c={};goog.array.forEach(b,function(a){c[a[0]]=a[1]});var d=goog.partial(goog.object.containsKey,c);return goog.labs.userAgent.browser.isOpera()?a(["Version","Opera"]):goog.labs.userAgent.browser.isEdge()?a(["Edge"]):goog.labs.userAgent.browser.isEdgeChromium()?a(["Edg"]):goog.labs.userAgent.browser.isChrome()?a(["Chrome","CriOS"]):(b=b[2])&&b[1]||""};goog.labs.userAgent.browser.isVersionOrHigher=function(a){return 0<=goog.string.internal.compareVersions(goog.labs.userAgent.browser.getVersion(),a)};goog.labs.userAgent.browser.getIEVersion_=function(a){var b=/rv: *([\d\.]*)/.exec(a);if(b&&b[1])return b[1];b="";var c=/MSIE +([\d\.]+)/.exec(a);if(c&&c[1])
if(a=/Trident\/(\d.\d)/.exec(a),"7.0"==c[1])
if(a&&a[1])switch(a[1]){case"4.0":b="8.0";break;case"5.0":b="9.0";break;case"6.0":b="10.0";break;case"7.0":b="11.0"}else b="7.0";else b=c[1];return b};goog.html.SafeHtml=function(){this.privateDoNotAccessOrElseSafeHtmlWrappedValue_="";this.SAFE_HTML_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeHtml.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_;this.dir_=null};goog.html.SafeHtml.prototype.implementsGoogI18nBidiDirectionalString=!0;goog.html.SafeHtml.prototype.getDirection=function(){return this.dir_};goog.html.SafeHtml.prototype.implementsGoogStringTypedString=!0;goog.html.SafeHtml.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeHtmlWrappedValue_.toString()};goog.DEBUG&&(goog.html.SafeHtml.prototype.toString=function(){return"SafeHtml{"+this.privateDoNotAccessOrElseSafeHtmlWrappedValue_+"}"});goog.html.SafeHtml.unwrap=function(a){return goog.html.SafeHtml.unwrapTrustedHTML(a).toString()};goog.html.SafeHtml.unwrapTrustedHTML=function(a){if(a instanceof goog.html.SafeHtml&&a.constructor===goog.html.SafeHtml&&a.SAFE_HTML_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeHtml.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_)return a.privateDoNotAccessOrElseSafeHtmlWrappedValue_;goog.asserts.fail("expected object of type SafeHtml, got '"+a+"' of type "+goog.typeOf(a));return"type_error:SafeHtml"};goog.html.SafeHtml.htmlEscape=function(a){if(a instanceof goog.html.SafeHtml)return a;var b="object"==typeof a,c=null;b&&a.implementsGoogI18nBidiDirectionalString&&(c=a.getDirection());a=b&&a.implementsGoogStringTypedString?a.getTypedStringValue():String(a);return goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(goog.string.internal.htmlEscape(a),c)};goog.html.SafeHtml.htmlEscapePreservingNewlines=function(a){if(a instanceof goog.html.SafeHtml)return a;a=goog.html.SafeHtml.htmlEscape(a);return goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(goog.string.internal.newLineToBr(goog.html.SafeHtml.unwrap(a)),a.getDirection())};goog.html.SafeHtml.htmlEscapePreservingNewlinesAndSpaces=function(a){if(a instanceof goog.html.SafeHtml)return a;a=goog.html.SafeHtml.htmlEscape(a);return goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(goog.string.internal.whitespaceEscape(goog.html.SafeHtml.unwrap(a)),a.getDirection())};goog.html.SafeHtml.from=goog.html.SafeHtml.htmlEscape;goog.html.SafeHtml.VALID_NAMES_IN_TAG_=/^[a-zA-Z0-9-]+$/;goog.html.SafeHtml.URL_ATTRIBUTES_={action:!0,cite:!0,data:!0,formaction:!0,href:!0,manifest:!0,poster:!0,src:!0};goog.html.SafeHtml.NOT_ALLOWED_TAG_NAMES_={APPLET:!0,BASE:!0,EMBED:!0,IFRAME:!0,LINK:!0,MATH:!0,META:!0,OBJECT:!0,SCRIPT:!0,STYLE:!0,SVG:!0,TEMPLATE:!0};goog.html.SafeHtml.create=function(a,b,c){goog.html.SafeHtml.verifyTagName(String(a));return goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse(String(a),b,c)};goog.html.SafeHtml.verifyTagName=function(a){if(!goog.html.SafeHtml.VALID_NAMES_IN_TAG_.test(a))throw Error("Invalid tag name <"+a+">.");if(a.toUpperCase()in goog.html.SafeHtml.NOT_ALLOWED_TAG_NAMES_)throw Error("Tag name <"+a+"> is not allowed for SafeHtml.");};goog.html.SafeHtml.createIframe=function(a,b,c,d){a&&goog.html.TrustedResourceUrl.unwrap(a);var e={};e.src=a||null;e.srcdoc=b&&goog.html.SafeHtml.unwrap(b);a=goog.html.SafeHtml.combineAttributes(e,{sandbox:""},c);return goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse("iframe",a,d)};goog.html.SafeHtml.createSandboxIframe=function(a,b,c,d){if(!goog.html.SafeHtml.canUseSandboxIframe())throw Error("The browser does not support sandboxed iframes.");var e={};e.src=a?goog.html.SafeUrl.unwrap(goog.html.SafeUrl.sanitize(a)):null;e.srcdoc=b||null;e.sandbox="";a=goog.html.SafeHtml.combineAttributes(e,{},c);return goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse("iframe",a,d)};goog.html.SafeHtml.canUseSandboxIframe=function(){return goog.global.HTMLIFrameElement&&"sandbox"in goog.global.HTMLIFrameElement.prototype};goog.html.SafeHtml.createScriptSrc=function(a,b){goog.html.TrustedResourceUrl.unwrap(a);a=goog.html.SafeHtml.combineAttributes({src:a},{},b);return goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse("script",a)};goog.html.SafeHtml.createScript=function(a,b){for(var c in b){var d=c.toLowerCase();if("language"==d||"src"==d||"text"==d||"type"==d)throw Error('Cannot set "'+d+'" attribute');}
c="";a=goog.array.concat(a);for(d=0;d<a.length;d++)c+=goog.html.SafeScript.unwrap(a[d]);a=goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(c,goog.i18n.bidi.Dir.NEUTRAL);return goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse("script",b,a)};goog.html.SafeHtml.createStyle=function(a,b){b=goog.html.SafeHtml.combineAttributes({type:"text/css"},{},b);var c="";a=goog.array.concat(a);for(var d=0;d<a.length;d++)c+=goog.html.SafeStyleSheet.unwrap(a[d]);a=goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(c,goog.i18n.bidi.Dir.NEUTRAL);return goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse("style",b,a)};goog.html.SafeHtml.createMetaRefresh=function(a,b){a=goog.html.SafeUrl.unwrap(goog.html.SafeUrl.sanitize(a));(goog.labs.userAgent.browser.isIE()||goog.labs.userAgent.browser.isEdge())&&goog.string.internal.contains(a,";")&&(a="'"+a.replace(/'/g,"%27")+"'");return goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse("meta",{"http-equiv":"refresh",content:(b||0)+"; url="+a})};goog.html.SafeHtml.getAttrNameAndValue_=function(a,b,c){if(c instanceof goog.string.Const)c=goog.string.Const.unwrap(c);else if("style"==b.toLowerCase())c=goog.html.SafeHtml.getStyleValue_(c);else{if(/^on/i.test(b))throw Error('Attribute "'+b+'" requires goog.string.Const value, "'+c+'" given.');if(b.toLowerCase()in goog.html.SafeHtml.URL_ATTRIBUTES_)
if(c instanceof goog.html.TrustedResourceUrl)c=goog.html.TrustedResourceUrl.unwrap(c);else if(c instanceof goog.html.SafeUrl)c=goog.html.SafeUrl.unwrap(c);else if(goog.isString(c))c=goog.html.SafeUrl.sanitize(c).getTypedStringValue();else throw Error('Attribute "'+b+'" on tag "'+a+'" requires goog.html.SafeUrl, goog.string.Const, or string, value "'+c+'" given.');}
c.implementsGoogStringTypedString&&(c=c.getTypedStringValue());goog.asserts.assert(goog.isString(c)||goog.isNumber(c),"String or number value expected, got "+typeof c+" with value: "+c);return b+'="'+goog.string.internal.htmlEscape(String(c))+'"'};goog.html.SafeHtml.getStyleValue_=function(a){if(!goog.isObject(a))throw Error('The "style" attribute requires goog.html.SafeStyle or map of style properties, '+typeof a+" given: "+a);a instanceof goog.html.SafeStyle||(a=goog.html.SafeStyle.create(a));return goog.html.SafeStyle.unwrap(a)};goog.html.SafeHtml.createWithDir=function(a,b,c,d){b=goog.html.SafeHtml.create(b,c,d);b.dir_=a;return b};goog.html.SafeHtml.join=function(a,b){a=goog.html.SafeHtml.htmlEscape(a);var c=a.getDirection(),d=[],e=function(a){goog.isArray(a)?goog.array.forEach(a,e):(a=goog.html.SafeHtml.htmlEscape(a),d.push(goog.html.SafeHtml.unwrap(a)),a=a.getDirection(),c==goog.i18n.bidi.Dir.NEUTRAL?c=a:a!=goog.i18n.bidi.Dir.NEUTRAL&&c!=a&&(c=null))};goog.array.forEach(b,e);return goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(d.join(goog.html.SafeHtml.unwrap(a)),c)};goog.html.SafeHtml.concat=function(a){return goog.html.SafeHtml.join(goog.html.SafeHtml.EMPTY,Array.prototype.slice.call(arguments))};goog.html.SafeHtml.concatWithDir=function(a,b){var c=goog.html.SafeHtml.concat(goog.array.slice(arguments,1));c.dir_=a;return c};goog.html.SafeHtml.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={};goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse=function(a,b){return(new goog.html.SafeHtml).initSecurityPrivateDoNotAccessOrElse_(a,b)};goog.html.SafeHtml.prototype.initSecurityPrivateDoNotAccessOrElse_=function(a,b){this.privateDoNotAccessOrElseSafeHtmlWrappedValue_=goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY?goog.html.trustedtypes.PRIVATE_DO_NOT_ACCESS_OR_ELSE_POLICY.createHTML(a):a;this.dir_=b;return this};goog.html.SafeHtml.createSafeHtmlTagSecurityPrivateDoNotAccessOrElse=function(a,b,c){var d=null;var e="<"+a+goog.html.SafeHtml.stringifyAttributes(a,b);goog.isDefAndNotNull(c)?goog.isArray(c)||(c=[c]):c=[];goog.dom.tags.isVoidTag(a.toLowerCase())?(goog.asserts.assert(!c.length,"Void tag <"+a+"> does not allow content."),e+=">"):(d=goog.html.SafeHtml.concat(c),e+=">"+goog.html.SafeHtml.unwrap(d)+"</"+a+">",d=d.getDirection());(a=b&&b.dir)&&(d=/^(ltr|rtl|auto)$/i.test(a)?goog.i18n.bidi.Dir.NEUTRAL:null);return goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(e,d)};goog.html.SafeHtml.stringifyAttributes=function(a,b){var c="";if(b)
for(var d in b){if(!goog.html.SafeHtml.VALID_NAMES_IN_TAG_.test(d))throw Error('Invalid attribute name "'+d+'".');var e=b[d];goog.isDefAndNotNull(e)&&(c+=" "+goog.html.SafeHtml.getAttrNameAndValue_(a,d,e))}
return c};goog.html.SafeHtml.combineAttributes=function(a,b,c){var d={},e;for(e in a)goog.asserts.assert(e.toLowerCase()==e,"Must be lower case"),d[e]=a[e];for(e in b)goog.asserts.assert(e.toLowerCase()==e,"Must be lower case"),d[e]=b[e];for(e in c){var f=e.toLowerCase();if(f in a)throw Error('Cannot override "'+f+'" attribute, got "'+e+'" with value "'+c[e]+'"');f in b&&delete d[f];d[e]=c[e]}
return d};goog.html.SafeHtml.DOCTYPE_HTML=goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse("<!DOCTYPE html>",goog.i18n.bidi.Dir.NEUTRAL);goog.html.SafeHtml.EMPTY=goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse("",goog.i18n.bidi.Dir.NEUTRAL);goog.html.SafeHtml.BR=goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse("<br>",goog.i18n.bidi.Dir.NEUTRAL);goog.html.uncheckedconversions={};goog.html.uncheckedconversions.safeHtmlFromStringKnownToSatisfyTypeContract=function(a,b,c){goog.asserts.assertString(goog.string.Const.unwrap(a),"must provide justification");goog.asserts.assert(!goog.string.internal.isEmptyOrWhitespace(goog.string.Const.unwrap(a)),"must provide non-empty justification");return goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(b,c||null)};goog.html.uncheckedconversions.safeScriptFromStringKnownToSatisfyTypeContract=function(a,b){goog.asserts.assertString(goog.string.Const.unwrap(a),"must provide justification");goog.asserts.assert(!goog.string.internal.isEmptyOrWhitespace(goog.string.Const.unwrap(a)),"must provide non-empty justification");return goog.html.SafeScript.createSafeScriptSecurityPrivateDoNotAccessOrElse(b)};goog.html.uncheckedconversions.safeStyleFromStringKnownToSatisfyTypeContract=function(a,b){goog.asserts.assertString(goog.string.Const.unwrap(a),"must provide justification");goog.asserts.assert(!goog.string.internal.isEmptyOrWhitespace(goog.string.Const.unwrap(a)),"must provide non-empty justification");return goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(b)};goog.html.uncheckedconversions.safeStyleSheetFromStringKnownToSatisfyTypeContract=function(a,b){goog.asserts.assertString(goog.string.Const.unwrap(a),"must provide justification");goog.asserts.assert(!goog.string.internal.isEmptyOrWhitespace(goog.string.Const.unwrap(a)),"must provide non-empty justification");return goog.html.SafeStyleSheet.createSafeStyleSheetSecurityPrivateDoNotAccessOrElse(b)};goog.html.uncheckedconversions.safeUrlFromStringKnownToSatisfyTypeContract=function(a,b){goog.asserts.assertString(goog.string.Const.unwrap(a),"must provide justification");goog.asserts.assert(!goog.string.internal.isEmptyOrWhitespace(goog.string.Const.unwrap(a)),"must provide non-empty justification");return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(b)};goog.html.uncheckedconversions.trustedResourceUrlFromStringKnownToSatisfyTypeContract=function(a,b){goog.asserts.assertString(goog.string.Const.unwrap(a),"must provide justification");goog.asserts.assert(!goog.string.internal.isEmptyOrWhitespace(goog.string.Const.unwrap(a)),"must provide non-empty justification");return goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(b)};goog.dom.asserts={};goog.dom.asserts.assertIsLocation=function(a){if(goog.asserts.ENABLE_ASSERTS){var b=goog.dom.asserts.getWindow_(a);b&&(!a||!(a instanceof b.Location)&&a instanceof b.Element)&&goog.asserts.fail("Argument is not a Location (or a non-Element mock); got: %s",goog.dom.asserts.debugStringForType_(a))}
return a};goog.dom.asserts.assertIsElementType_=function(a,b){if(goog.asserts.ENABLE_ASSERTS){var c=goog.dom.asserts.getWindow_(a);c&&"undefined"!=typeof c[b]&&(a&&(a instanceof c[b]||!(a instanceof c.Location||a instanceof c.Element))||goog.asserts.fail("Argument is not a %s (or a non-Element, non-Location mock); got: %s",b,goog.dom.asserts.debugStringForType_(a)))}
return a};goog.dom.asserts.assertIsHTMLAnchorElement=function(a){return goog.dom.asserts.assertIsElementType_(a,"HTMLAnchorElement")};goog.dom.asserts.assertIsHTMLButtonElement=function(a){return goog.dom.asserts.assertIsElementType_(a,"HTMLButtonElement")};goog.dom.asserts.assertIsHTMLLinkElement=function(a){return goog.dom.asserts.assertIsElementType_(a,"HTMLLinkElement")};goog.dom.asserts.assertIsHTMLImageElement=function(a){return goog.dom.asserts.assertIsElementType_(a,"HTMLImageElement")};goog.dom.asserts.assertIsHTMLAudioElement=function(a){return goog.dom.asserts.assertIsElementType_(a,"HTMLAudioElement")};goog.dom.asserts.assertIsHTMLVideoElement=function(a){return goog.dom.asserts.assertIsElementType_(a,"HTMLVideoElement")};goog.dom.asserts.assertIsHTMLInputElement=function(a){return goog.dom.asserts.assertIsElementType_(a,"HTMLInputElement")};goog.dom.asserts.assertIsHTMLTextAreaElement=function(a){return goog.dom.asserts.assertIsElementType_(a,"HTMLTextAreaElement")};goog.dom.asserts.assertIsHTMLCanvasElement=function(a){return goog.dom.asserts.assertIsElementType_(a,"HTMLCanvasElement")};goog.dom.asserts.assertIsHTMLEmbedElement=function(a){return goog.dom.asserts.assertIsElementType_(a,"HTMLEmbedElement")};goog.dom.asserts.assertIsHTMLFormElement=function(a){return goog.dom.asserts.assertIsElementType_(a,"HTMLFormElement")};goog.dom.asserts.assertIsHTMLFrameElement=function(a){return goog.dom.asserts.assertIsElementType_(a,"HTMLFrameElement")};goog.dom.asserts.assertIsHTMLIFrameElement=function(a){return goog.dom.asserts.assertIsElementType_(a,"HTMLIFrameElement")};goog.dom.asserts.assertIsHTMLObjectElement=function(a){return goog.dom.asserts.assertIsElementType_(a,"HTMLObjectElement")};goog.dom.asserts.assertIsHTMLScriptElement=function(a){return goog.dom.asserts.assertIsElementType_(a,"HTMLScriptElement")};goog.dom.asserts.debugStringForType_=function(a){if(goog.isObject(a))try{return a.constructor.displayName||a.constructor.name||Object.prototype.toString.call(a)}catch(b){return"<object could not be stringified>"}else return void 0===a?"undefined":null===a?"null":typeof a};goog.dom.asserts.getWindow_=function(a){try{var b=a&&a.ownerDocument,c=b&&(b.defaultView||b.parentWindow);c=c||goog.global;if(c.Element&&c.Location)return c}catch(d){}
return null};goog.functions={};goog.functions.constant=function(a){return function(){return a}};goog.functions.FALSE=function(){return!1};goog.functions.TRUE=function(){return!0};goog.functions.NULL=function(){return null};goog.functions.identity=function(a,b){return a};goog.functions.error=function(a){return function(){throw Error(a);}};goog.functions.fail=function(a){return function(){throw a;}};goog.functions.lock=function(a,b){b=b||0;return function(){return a.apply(this,Array.prototype.slice.call(arguments,0,b))}};goog.functions.nth=function(a){return function(){return arguments[a]}};goog.functions.partialRight=function(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=Array.prototype.slice.call(arguments);b.push.apply(b,c);return a.apply(this,b)}};goog.functions.withReturnValue=function(a,b){return goog.functions.sequence(a,goog.functions.constant(b))};goog.functions.equalTo=function(a,b){return function(c){return b?a==c:a===c}};goog.functions.compose=function(a,b){var c=arguments,d=c.length;return function(){var a;d&&(a=c[d-1].apply(this,arguments));for(var b=d-2;0<=b;b--)a=c[b].call(this,a);return a}};goog.functions.sequence=function(a){var b=arguments,c=b.length;return function(){for(var a,e=0;e<c;e++)a=b[e].apply(this,arguments);return a}};goog.functions.and=function(a){var b=arguments,c=b.length;return function(){for(var a=0;a<c;a++)
if(!b[a].apply(this,arguments))return!1;return!0}};goog.functions.or=function(a){var b=arguments,c=b.length;return function(){for(var a=0;a<c;a++)
if(b[a].apply(this,arguments))return!0;return!1}};goog.functions.not=function(a){return function(){return!a.apply(this,arguments)}};goog.functions.create=function(a,b){var c=function(){};c.prototype=a.prototype;c=new c;a.apply(c,Array.prototype.slice.call(arguments,1));return c};goog.functions.CACHE_RETURN_VALUE=!0;goog.functions.cacheReturnValue=function(a){var b=!1,c;return function(){if(!goog.functions.CACHE_RETURN_VALUE)return a();b||(c=a(),b=!0);return c}};goog.functions.once=function(a){var b=a;return function(){if(b){var a=b;b=null;a()}}};goog.functions.debounce=function(a,b,c){var d=0;return function(e){goog.global.clearTimeout(d);var f=arguments;d=goog.global.setTimeout(function(){a.apply(c,f)},b)}};goog.functions.throttle=function(a,b,c){var d=0,e=!1,f=[],g=function(){d=0;e&&(e=!1,h())},h=function(){d=goog.global.setTimeout(g,b);a.apply(c,f)};return function(a){f=arguments;d?e=!0:h()}};goog.functions.rateLimit=function(a,b,c){var d=0,e=function(){d=0};return function(f){d||(d=goog.global.setTimeout(e,b),a.apply(c,arguments))}};goog.dom.safe={};goog.dom.safe.InsertAdjacentHtmlPosition={AFTERBEGIN:"afterbegin",AFTEREND:"afterend",BEFOREBEGIN:"beforebegin",BEFOREEND:"beforeend"};goog.dom.safe.insertAdjacentHtml=function(a,b,c){a.insertAdjacentHTML(b,goog.html.SafeHtml.unwrapTrustedHTML(c))};goog.dom.safe.SET_INNER_HTML_DISALLOWED_TAGS_={MATH:!0,SCRIPT:!0,STYLE:!0,SVG:!0,TEMPLATE:!0};goog.dom.safe.isInnerHtmlCleanupRecursive_=goog.functions.cacheReturnValue(function(){if(goog.DEBUG&&"undefined"===typeof document)return!1;var a=document.createElement("div"),b=document.createElement("div");b.appendChild(document.createElement("div"));a.appendChild(b);if(goog.DEBUG&&!a.firstChild)return!1;b=a.firstChild.firstChild;a.innerHTML=goog.html.SafeHtml.unwrapTrustedHTML(goog.html.SafeHtml.EMPTY);return!b.parentElement});goog.dom.safe.unsafeSetInnerHtmlDoNotUseOrElse=function(a,b){if(goog.dom.safe.isInnerHtmlCleanupRecursive_())
for(;a.lastChild;)a.removeChild(a.lastChild);a.innerHTML=goog.html.SafeHtml.unwrapTrustedHTML(b)};goog.dom.safe.setInnerHtml=function(a,b){if(goog.asserts.ENABLE_ASSERTS){var c=a.tagName.toUpperCase();if(goog.dom.safe.SET_INNER_HTML_DISALLOWED_TAGS_[c])throw Error("goog.dom.safe.setInnerHtml cannot be used to set content of "+a.tagName+".");}
goog.dom.safe.unsafeSetInnerHtmlDoNotUseOrElse(a,b)};goog.dom.safe.setOuterHtml=function(a,b){a.outerHTML=goog.html.SafeHtml.unwrapTrustedHTML(b)};goog.dom.safe.setFormElementAction=function(a,b){b=b instanceof goog.html.SafeUrl?b:goog.html.SafeUrl.sanitizeAssertUnchanged(b);goog.dom.asserts.assertIsHTMLFormElement(a).action=goog.html.SafeUrl.unwrapTrustedURL(b)};goog.dom.safe.setButtonFormAction=function(a,b){b=b instanceof goog.html.SafeUrl?b:goog.html.SafeUrl.sanitizeAssertUnchanged(b);goog.dom.asserts.assertIsHTMLButtonElement(a).formAction=goog.html.SafeUrl.unwrapTrustedURL(b)};goog.dom.safe.setInputFormAction=function(a,b){b=b instanceof goog.html.SafeUrl?b:goog.html.SafeUrl.sanitizeAssertUnchanged(b);goog.dom.asserts.assertIsHTMLInputElement(a).formAction=goog.html.SafeUrl.unwrapTrustedURL(b)};goog.dom.safe.setStyle=function(a,b){a.style.cssText=goog.html.SafeStyle.unwrap(b)};goog.dom.safe.documentWrite=function(a,b){a.write(goog.html.SafeHtml.unwrapTrustedHTML(b))};goog.dom.safe.setAnchorHref=function(a,b){goog.dom.asserts.assertIsHTMLAnchorElement(a);b=b instanceof goog.html.SafeUrl?b:goog.html.SafeUrl.sanitizeAssertUnchanged(b);a.href=goog.html.SafeUrl.unwrapTrustedURL(b)};goog.dom.safe.setImageSrc=function(a,b){goog.dom.asserts.assertIsHTMLImageElement(a);if(!(b instanceof goog.html.SafeUrl)){var c=/^data:image\//i.test(b);b=goog.html.SafeUrl.sanitizeAssertUnchanged(b,c)}
a.src=goog.html.SafeUrl.unwrapTrustedURL(b)};goog.dom.safe.setAudioSrc=function(a,b){goog.dom.asserts.assertIsHTMLAudioElement(a);if(!(b instanceof goog.html.SafeUrl)){var c=/^data:audio\//i.test(b);b=goog.html.SafeUrl.sanitizeAssertUnchanged(b,c)}
a.src=goog.html.SafeUrl.unwrapTrustedURL(b)};goog.dom.safe.setVideoSrc=function(a,b){goog.dom.asserts.assertIsHTMLVideoElement(a);if(!(b instanceof goog.html.SafeUrl)){var c=/^data:video\//i.test(b);b=goog.html.SafeUrl.sanitizeAssertUnchanged(b,c)}
a.src=goog.html.SafeUrl.unwrapTrustedURL(b)};goog.dom.safe.setEmbedSrc=function(a,b){goog.dom.asserts.assertIsHTMLEmbedElement(a);a.src=goog.html.TrustedResourceUrl.unwrapTrustedScriptURL(b)};goog.dom.safe.setFrameSrc=function(a,b){goog.dom.asserts.assertIsHTMLFrameElement(a);a.src=goog.html.TrustedResourceUrl.unwrapTrustedURL(b)};goog.dom.safe.setIframeSrc=function(a,b){goog.dom.asserts.assertIsHTMLIFrameElement(a);a.src=goog.html.TrustedResourceUrl.unwrapTrustedURL(b)};goog.dom.safe.setIframeSrcdoc=function(a,b){goog.dom.asserts.assertIsHTMLIFrameElement(a);a.srcdoc=goog.html.SafeHtml.unwrapTrustedHTML(b)};goog.dom.safe.setLinkHrefAndRel=function(a,b,c){goog.dom.asserts.assertIsHTMLLinkElement(a);a.rel=c;goog.string.internal.caseInsensitiveContains(c,"stylesheet")?(goog.asserts.assert(b instanceof goog.html.TrustedResourceUrl,'URL must be TrustedResourceUrl because "rel" contains "stylesheet"'),a.href=goog.html.TrustedResourceUrl.unwrapTrustedURL(b)):a.href=b instanceof goog.html.TrustedResourceUrl?goog.html.TrustedResourceUrl.unwrapTrustedURL(b):b instanceof goog.html.SafeUrl?goog.html.SafeUrl.unwrapTrustedURL(b):goog.html.SafeUrl.unwrapTrustedURL(goog.html.SafeUrl.sanitizeAssertUnchanged(b))};goog.dom.safe.setObjectData=function(a,b){goog.dom.asserts.assertIsHTMLObjectElement(a);a.data=goog.html.TrustedResourceUrl.unwrapTrustedScriptURL(b)};goog.dom.safe.setScriptSrc=function(a,b){goog.dom.asserts.assertIsHTMLScriptElement(a);a.src=goog.html.TrustedResourceUrl.unwrapTrustedScriptURL(b);(b=goog.getScriptNonce())&&a.setAttribute("nonce",b)};goog.dom.safe.setScriptContent=function(a,b){goog.dom.asserts.assertIsHTMLScriptElement(a);a.text=goog.html.SafeScript.unwrapTrustedScript(b);(b=goog.getScriptNonce())&&a.setAttribute("nonce",b)};goog.dom.safe.setLocationHref=function(a,b){goog.dom.asserts.assertIsLocation(a);b=b instanceof goog.html.SafeUrl?b:goog.html.SafeUrl.sanitizeAssertUnchanged(b);a.href=goog.html.SafeUrl.unwrapTrustedURL(b)};goog.dom.safe.assignLocation=function(a,b){goog.dom.asserts.assertIsLocation(a);b=b instanceof goog.html.SafeUrl?b:goog.html.SafeUrl.sanitizeAssertUnchanged(b);a.assign(goog.html.SafeUrl.unwrapTrustedURL(b))};goog.dom.safe.replaceLocation=function(a,b){goog.dom.asserts.assertIsLocation(a);b=b instanceof goog.html.SafeUrl?b:goog.html.SafeUrl.sanitizeAssertUnchanged(b);a.replace(goog.html.SafeUrl.unwrapTrustedURL(b))};goog.dom.safe.openInWindow=function(a,b,c,d,e){a=a instanceof goog.html.SafeUrl?a:goog.html.SafeUrl.sanitizeAssertUnchanged(a);return(b||goog.global).open(goog.html.SafeUrl.unwrapTrustedURL(a),c?goog.string.Const.unwrap(c):"",d,e)};goog.dom.safe.parseFromStringHtml=function(a,b){return goog.dom.safe.parseFromString(a,b,"text/html")};goog.dom.safe.parseFromString=function(a,b,c){return a.parseFromString(goog.html.SafeHtml.unwrapTrustedHTML(b),c)};goog.dom.safe.createImageFromBlob=function(a){if(!/^image\/.*/g.test(a.type))throw Error("goog.dom.safe.createImageFromBlob only accepts MIME type image/.*.");var b=goog.global.URL.createObjectURL(a);a=new goog.global.Image;a.onload=function(){goog.global.URL.revokeObjectURL(b)};goog.dom.safe.setImageSrc(a,goog.html.uncheckedconversions.safeUrlFromStringKnownToSatisfyTypeContract(goog.string.Const.from("Image blob URL."),b));return a};goog.string.DETECT_DOUBLE_ESCAPING=!1;goog.string.FORCE_NON_DOM_HTML_UNESCAPING=!1;goog.string.Unicode={NBSP:"\u00a0"};goog.string.startsWith=goog.string.internal.startsWith;goog.string.endsWith=goog.string.internal.endsWith;goog.string.caseInsensitiveStartsWith=goog.string.internal.caseInsensitiveStartsWith;goog.string.caseInsensitiveEndsWith=goog.string.internal.caseInsensitiveEndsWith;goog.string.caseInsensitiveEquals=goog.string.internal.caseInsensitiveEquals;goog.string.subs=function(a,b){for(var c=a.split("%s"),d="",e=Array.prototype.slice.call(arguments,1);e.length&&1<c.length;)d+=c.shift()+e.shift();return d+c.join("%s")};goog.string.collapseWhitespace=function(a){return a.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"")};goog.string.isEmptyOrWhitespace=goog.string.internal.isEmptyOrWhitespace;goog.string.isEmptyString=function(a){return 0==a.length};goog.string.isEmpty=goog.string.isEmptyOrWhitespace;goog.string.isEmptyOrWhitespaceSafe=function(a){return goog.string.isEmptyOrWhitespace(goog.string.makeSafe(a))};goog.string.isEmptySafe=goog.string.isEmptyOrWhitespaceSafe;goog.string.isBreakingWhitespace=function(a){return!/[^\t\n\r ]/.test(a)};goog.string.isAlpha=function(a){return!/[^a-zA-Z]/.test(a)};goog.string.isNumeric=function(a){return!/[^0-9]/.test(a)};goog.string.isAlphaNumeric=function(a){return!/[^a-zA-Z0-9]/.test(a)};goog.string.isSpace=function(a){return" "==a};goog.string.isUnicodeChar=function(a){return 1==a.length&&" "<=a&&"~">=a||"\u0080"<=a&&"\ufffd">=a};goog.string.stripNewlines=function(a){return a.replace(/(\r\n|\r|\n)+/g," ")};goog.string.canonicalizeNewlines=function(a){return a.replace(/(\r\n|\r|\n)/g,"\n")};goog.string.normalizeWhitespace=function(a){return a.replace(/\xa0|\s/g," ")};goog.string.normalizeSpaces=function(a){return a.replace(/\xa0|[ \t]+/g," ")};goog.string.collapseBreakingSpaces=function(a){return a.replace(/[\t\r\n ]+/g," ").replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,"")};goog.string.trim=goog.string.internal.trim;goog.string.trimLeft=function(a){return a.replace(/^[\s\xa0]+/,"")};goog.string.trimRight=function(a){return a.replace(/[\s\xa0]+$/,"")};goog.string.caseInsensitiveCompare=goog.string.internal.caseInsensitiveCompare;goog.string.numberAwareCompare_=function(a,b,c){if(a==b)return 0;if(!a)return-1;if(!b)return 1;for(var d=a.toLowerCase().match(c),e=b.toLowerCase().match(c),f=Math.min(d.length,e.length),g=0;g<f;g++){c=d[g];var h=e[g];if(c!=h)return a=parseInt(c,10),!isNaN(a)&&(b=parseInt(h,10),!isNaN(b)&&a-b)?a-b:c<h?-1:1}
return d.length!=e.length?d.length-e.length:a<b?-1:1};goog.string.intAwareCompare=function(a,b){return goog.string.numberAwareCompare_(a,b,/\d+|\D+/g)};goog.string.floatAwareCompare=function(a,b){return goog.string.numberAwareCompare_(a,b,/\d+|\.\d+|\D+/g)};goog.string.numerateCompare=goog.string.floatAwareCompare;goog.string.urlEncode=function(a){return encodeURIComponent(String(a))};goog.string.urlDecode=function(a){return decodeURIComponent(a.replace(/\+/g," "))};goog.string.newLineToBr=goog.string.internal.newLineToBr;goog.string.htmlEscape=function(a,b){a=goog.string.internal.htmlEscape(a,b);goog.string.DETECT_DOUBLE_ESCAPING&&(a=a.replace(goog.string.E_RE_,"&#101;"));return a};goog.string.E_RE_=/e/g;goog.string.unescapeEntities=function(a){return goog.string.contains(a,"&")?!goog.string.FORCE_NON_DOM_HTML_UNESCAPING&&"document"in goog.global?goog.string.unescapeEntitiesUsingDom_(a):goog.string.unescapePureXmlEntities_(a):a};goog.string.unescapeEntitiesWithDocument=function(a,b){return goog.string.contains(a,"&")?goog.string.unescapeEntitiesUsingDom_(a,b):a};goog.string.unescapeEntitiesUsingDom_=function(a,b){var c={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"'};var d=b?b.createElement("div"):goog.global.document.createElement("div");return a.replace(goog.string.HTML_ENTITY_PATTERN_,function(a,b){var e=c[a];if(e)return e;"#"==b.charAt(0)&&(b=Number("0"+b.substr(1)),isNaN(b)||(e=String.fromCharCode(b)));e||(goog.dom.safe.setInnerHtml(d,goog.html.uncheckedconversions.safeHtmlFromStringKnownToSatisfyTypeContract(goog.string.Const.from("Single HTML entity."),a+" ")),e=d.firstChild.nodeValue.slice(0,-1));return c[a]=e})};goog.string.unescapePureXmlEntities_=function(a){return a.replace(/&([^;]+);/g,function(a,c){switch(c){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';default:return"#"!=c.charAt(0)||(c=Number("0"+c.substr(1)),isNaN(c))?a:String.fromCharCode(c)}})};goog.string.HTML_ENTITY_PATTERN_=/&([^;\s<&]+);?/g;goog.string.whitespaceEscape=function(a,b){return goog.string.newLineToBr(a.replace(/  /g," &#160;"),b)};goog.string.preserveSpaces=function(a){return a.replace(/(^|[\n ]) /g,"$1"+goog.string.Unicode.NBSP)};goog.string.stripQuotes=function(a,b){for(var c=b.length,d=0;d<c;d++){var e=1==c?b:b.charAt(d);if(a.charAt(0)==e&&a.charAt(a.length-1)==e)return a.substring(1,a.length-1)}
return a};goog.string.truncate=function(a,b,c){c&&(a=goog.string.unescapeEntities(a));a.length>b&&(a=a.substring(0,b-3)+"...");c&&(a=goog.string.htmlEscape(a));return a};goog.string.truncateMiddle=function(a,b,c,d){c&&(a=goog.string.unescapeEntities(a));if(d&&a.length>b){d>b&&(d=b);var e=a.length-d;a=a.substring(0,b-d)+"..."+a.substring(e)}else a.length>b&&(d=Math.floor(b/2),e=a.length-d,a=a.substring(0,d+b%2)+"..."+a.substring(e));c&&(a=goog.string.htmlEscape(a));return a};goog.string.specialEscapeChars_={"\x00":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\x0B":"\\x0B",'"':'\\"',"\\":"\\\\","<":"\\u003C"};goog.string.jsEscapeCache_={"'":"\\'"};goog.string.quote=function(a){a=String(a);for(var b=['"'],c=0;c<a.length;c++){var d=a.charAt(c),e=d.charCodeAt(0);b[c+1]=goog.string.specialEscapeChars_[d]||(31<e&&127>e?d:goog.string.escapeChar(d))}
b.push('"');return b.join("")};goog.string.escapeString=function(a){for(var b=[],c=0;c<a.length;c++)b[c]=goog.string.escapeChar(a.charAt(c));return b.join("")};goog.string.escapeChar=function(a){if(a in goog.string.jsEscapeCache_)return goog.string.jsEscapeCache_[a];if(a in goog.string.specialEscapeChars_)return goog.string.jsEscapeCache_[a]=goog.string.specialEscapeChars_[a];var b=a.charCodeAt(0);if(31<b&&127>b)var c=a;else{if(256>b){if(c="\\x",16>b||256<b)c+="0"}else c="\\u",4096>b&&(c+="0");c+=b.toString(16).toUpperCase()}
return goog.string.jsEscapeCache_[a]=c};goog.string.contains=goog.string.internal.contains;goog.string.caseInsensitiveContains=goog.string.internal.caseInsensitiveContains;goog.string.countOf=function(a,b){return a&&b?a.split(b).length-1:0};goog.string.removeAt=function(a,b,c){var d=a;0<=b&&b<a.length&&0<c&&(d=a.substr(0,b)+a.substr(b+c,a.length-b-c));return d};goog.string.remove=function(a,b){return a.replace(b,"")};goog.string.removeAll=function(a,b){b=new RegExp(goog.string.regExpEscape(b),"g");return a.replace(b,"")};goog.string.replaceAll=function(a,b,c){b=new RegExp(goog.string.regExpEscape(b),"g");return a.replace(b,c.replace(/\$/g,"$$$$"))};goog.string.regExpEscape=function(a){return String(a).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")};goog.string.repeat=String.prototype.repeat?function(a,b){return a.repeat(b)}:function(a,b){return Array(b+1).join(a)};goog.string.padNumber=function(a,b,c){a=goog.isDef(c)?a.toFixed(c):String(a);c=a.indexOf(".");-1==c&&(c=a.length);return goog.string.repeat("0",Math.max(0,b-c))+a};goog.string.makeSafe=function(a){return null==a?"":String(a)};goog.string.buildString=function(a){return Array.prototype.join.call(arguments,"")};goog.string.getRandomString=function(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^goog.now()).toString(36)};goog.string.compareVersions=goog.string.internal.compareVersions;goog.string.hashCode=function(a){for(var b=0,c=0;c<a.length;++c)b=31*b+a.charCodeAt(c)>>>0;return b};goog.string.uniqueStringCounter_=2147483648*Math.random()|0;goog.string.createUniqueString=function(){return"goog_"+goog.string.uniqueStringCounter_++};goog.string.toNumber=function(a){var b=Number(a);return 0==b&&goog.string.isEmptyOrWhitespace(a)?NaN:b};goog.string.isLowerCamelCase=function(a){return/^[a-z]+([A-Z][a-z]*)*$/.test(a)};goog.string.isUpperCamelCase=function(a){return/^([A-Z][a-z]*)+$/.test(a)};goog.string.toCamelCase=function(a){return String(a).replace(/\-([a-z])/g,function(a,c){return c.toUpperCase()})};goog.string.toSelectorCase=function(a){return String(a).replace(/([A-Z])/g,"-$1").toLowerCase()};goog.string.toTitleCase=function(a,b){b=goog.isString(b)?goog.string.regExpEscape(b):"\\s";return a.replace(new RegExp("(^"+(b?"|["+b+"]+":"")+")([a-z])","g"),function(a,b,e){return b+e.toUpperCase()})};goog.string.capitalize=function(a){return String(a.charAt(0)).toUpperCase()+String(a.substr(1)).toLowerCase()};goog.string.parseInt=function(a){isFinite(a)&&(a=String(a));return goog.isString(a)?/^\s*-?0x/i.test(a)?parseInt(a,16):parseInt(a,10):NaN};goog.string.splitLimit=function(a,b,c){a=a.split(b);for(var d=[];0<c&&a.length;)d.push(a.shift()),c--;a.length&&d.push(a.join(b));return d};goog.string.lastComponent=function(a,b){if(b)"string"==typeof b&&(b=[b]);else return a;for(var c=-1,d=0;d<b.length;d++)
if(""!=b[d]){var e=a.lastIndexOf(b[d]);e>c&&(c=e)}return-1==c?a:a.slice(c+1)};goog.string.editDistance=function(a,b){var c=[],d=[];if(a==b)return 0;if(!a.length||!b.length)return Math.max(a.length,b.length);for(var e=0;e<b.length+1;e++)c[e]=e;for(e=0;e<a.length;e++){d[0]=e+1;for(var f=0;f<b.length;f++)d[f+1]=Math.min(d[f]+1,c[f+1]+1,c[f]+Number(a[e]!=b[f]));for(f=0;f<c.length;f++)c[f]=d[f]}
return d[b.length]};goog.labs.userAgent.platform={};goog.labs.userAgent.platform.isAndroid=function(){return goog.labs.userAgent.util.matchUserAgent("Android")};goog.labs.userAgent.platform.isIpod=function(){return goog.labs.userAgent.util.matchUserAgent("iPod")};goog.labs.userAgent.platform.isIphone=function(){return goog.labs.userAgent.util.matchUserAgent("iPhone")&&!goog.labs.userAgent.util.matchUserAgent("iPod")&&!goog.labs.userAgent.util.matchUserAgent("iPad")};goog.labs.userAgent.platform.isIpad=function(){return goog.labs.userAgent.util.matchUserAgent("iPad")};goog.labs.userAgent.platform.isIos=function(){return goog.labs.userAgent.platform.isIphone()||goog.labs.userAgent.platform.isIpad()||goog.labs.userAgent.platform.isIpod()};goog.labs.userAgent.platform.isMacintosh=function(){return goog.labs.userAgent.util.matchUserAgent("Macintosh")};goog.labs.userAgent.platform.isLinux=function(){return goog.labs.userAgent.util.matchUserAgent("Linux")};goog.labs.userAgent.platform.isWindows=function(){return goog.labs.userAgent.util.matchUserAgent("Windows")};goog.labs.userAgent.platform.isChromeOS=function(){return goog.labs.userAgent.util.matchUserAgent("CrOS")};goog.labs.userAgent.platform.isChromecast=function(){return goog.labs.userAgent.util.matchUserAgent("CrKey")};goog.labs.userAgent.platform.isKaiOS=function(){return goog.labs.userAgent.util.matchUserAgentIgnoreCase("KaiOS")};goog.labs.userAgent.platform.isGo2Phone=function(){return goog.labs.userAgent.util.matchUserAgentIgnoreCase("GAFP")};goog.labs.userAgent.platform.getVersion=function(){var a=goog.labs.userAgent.util.getUserAgent(),b="";goog.labs.userAgent.platform.isWindows()?(b=/Windows (?:NT|Phone) ([0-9.]+)/,b=(a=b.exec(a))?a[1]:"0.0"):goog.labs.userAgent.platform.isIos()?(b=/(?:iPhone|iPod|iPad|CPU)\s+OS\s+(\S+)/,b=(a=b.exec(a))&&a[1].replace(/_/g,".")):goog.labs.userAgent.platform.isMacintosh()?(b=/Mac OS X ([0-9_.]+)/,b=(a=b.exec(a))?a[1].replace(/_/g,"."):"10"):goog.labs.userAgent.platform.isKaiOS()?(b=/(?:KaiOS)\/(\S+)/i,b=(a=b.exec(a))&&a[1]):goog.labs.userAgent.platform.isAndroid()?(b=/Android\s+([^\);]+)(\)|;)/,b=(a=b.exec(a))&&a[1]):goog.labs.userAgent.platform.isChromeOS()&&(b=/(?:CrOS\s+(?:i686|x86_64)\s+([0-9.]+))/,b=(a=b.exec(a))&&a[1]);return b||""};goog.labs.userAgent.platform.isVersionOrHigher=function(a){return 0<=goog.string.compareVersions(goog.labs.userAgent.platform.getVersion(),a)};goog.reflect={};goog.reflect.object=function(a,b){return b};goog.reflect.objectProperty=function(a,b){return a};goog.reflect.sinkValue=function(a){goog.reflect.sinkValue[" "](a);return a};goog.reflect.sinkValue[" "]=goog.nullFunction;goog.reflect.canAccessProperty=function(a,b){try{return goog.reflect.sinkValue(a[b]),!0}catch(c){}
return!1};goog.reflect.cache=function(a,b,c,d){d=d?d(b):b;return Object.prototype.hasOwnProperty.call(a,d)?a[d]:a[d]=c(b)};goog.labs.userAgent.engine={};goog.labs.userAgent.engine.isPresto=function(){return goog.labs.userAgent.util.matchUserAgent("Presto")};goog.labs.userAgent.engine.isTrident=function(){return goog.labs.userAgent.util.matchUserAgent("Trident")||goog.labs.userAgent.util.matchUserAgent("MSIE")};goog.labs.userAgent.engine.isEdge=function(){return goog.labs.userAgent.util.matchUserAgent("Edge")};goog.labs.userAgent.engine.isWebKit=function(){return goog.labs.userAgent.util.matchUserAgentIgnoreCase("WebKit")&&!goog.labs.userAgent.engine.isEdge()};goog.labs.userAgent.engine.isGecko=function(){return goog.labs.userAgent.util.matchUserAgent("Gecko")&&!goog.labs.userAgent.engine.isWebKit()&&!goog.labs.userAgent.engine.isTrident()&&!goog.labs.userAgent.engine.isEdge()};goog.labs.userAgent.engine.getVersion=function(){var a=goog.labs.userAgent.util.getUserAgent();if(a){a=goog.labs.userAgent.util.extractVersionTuples(a);var b=goog.labs.userAgent.engine.getEngineTuple_(a);if(b)return"Gecko"==b[0]?goog.labs.userAgent.engine.getVersionForKey_(a,"Firefox"):b[1];a=a[0];var c;if(a&&(c=a[2])&&(c=/Trident\/([^\s;]+)/.exec(c)))return c[1]}
return""};goog.labs.userAgent.engine.getEngineTuple_=function(a){if(!goog.labs.userAgent.engine.isEdge())return a[1];for(var b=0;b<a.length;b++){var c=a[b];if("Edge"==c[0])return c}};goog.labs.userAgent.engine.isVersionOrHigher=function(a){return 0<=goog.string.compareVersions(goog.labs.userAgent.engine.getVersion(),a)};goog.labs.userAgent.engine.getVersionForKey_=function(a,b){return(a=goog.array.find(a,function(a){return b==a[0]}))&&a[1]||""};goog.userAgent={};goog.userAgent.ASSUME_IE=!1;goog.userAgent.ASSUME_EDGE=!1;goog.userAgent.ASSUME_GECKO=!1;goog.userAgent.ASSUME_WEBKIT=!1;goog.userAgent.ASSUME_MOBILE_WEBKIT=!1;goog.userAgent.ASSUME_OPERA=!1;goog.userAgent.ASSUME_ANY_VERSION=!1;goog.userAgent.BROWSER_KNOWN_=goog.userAgent.ASSUME_IE||goog.userAgent.ASSUME_EDGE||goog.userAgent.ASSUME_GECKO||goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_OPERA;goog.userAgent.getUserAgentString=function(){return goog.labs.userAgent.util.getUserAgent()};goog.userAgent.getNavigatorTyped=function(){return goog.global.navigator||null};goog.userAgent.getNavigator=function(){return goog.userAgent.getNavigatorTyped()};goog.userAgent.OPERA=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_OPERA:goog.labs.userAgent.browser.isOpera();goog.userAgent.IE=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_IE:goog.labs.userAgent.browser.isIE();goog.userAgent.EDGE=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_EDGE:goog.labs.userAgent.engine.isEdge();goog.userAgent.EDGE_OR_IE=goog.userAgent.EDGE||goog.userAgent.IE;goog.userAgent.GECKO=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_GECKO:goog.labs.userAgent.engine.isGecko();goog.userAgent.WEBKIT=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_MOBILE_WEBKIT:goog.labs.userAgent.engine.isWebKit();goog.userAgent.isMobile_=function(){return goog.userAgent.WEBKIT&&goog.labs.userAgent.util.matchUserAgent("Mobile")};goog.userAgent.MOBILE=goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.isMobile_();goog.userAgent.SAFARI=goog.userAgent.WEBKIT;goog.userAgent.determinePlatform_=function(){var a=goog.userAgent.getNavigatorTyped();return a&&a.platform||""};goog.userAgent.PLATFORM=goog.userAgent.determinePlatform_();goog.userAgent.ASSUME_MAC=!1;goog.userAgent.ASSUME_WINDOWS=!1;goog.userAgent.ASSUME_LINUX=!1;goog.userAgent.ASSUME_X11=!1;goog.userAgent.ASSUME_ANDROID=!1;goog.userAgent.ASSUME_IPHONE=!1;goog.userAgent.ASSUME_IPAD=!1;goog.userAgent.ASSUME_IPOD=!1;goog.userAgent.ASSUME_KAIOS=!1;goog.userAgent.ASSUME_GO2PHONE=!1;goog.userAgent.PLATFORM_KNOWN_=goog.userAgent.ASSUME_MAC||goog.userAgent.ASSUME_WINDOWS||goog.userAgent.ASSUME_LINUX||goog.userAgent.ASSUME_X11||goog.userAgent.ASSUME_ANDROID||goog.userAgent.ASSUME_IPHONE||goog.userAgent.ASSUME_IPAD||goog.userAgent.ASSUME_IPOD;goog.userAgent.MAC=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_MAC:goog.labs.userAgent.platform.isMacintosh();goog.userAgent.WINDOWS=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_WINDOWS:goog.labs.userAgent.platform.isWindows();goog.userAgent.isLegacyLinux_=function(){return goog.labs.userAgent.platform.isLinux()||goog.labs.userAgent.platform.isChromeOS()};goog.userAgent.LINUX=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_LINUX:goog.userAgent.isLegacyLinux_();goog.userAgent.isX11_=function(){var a=goog.userAgent.getNavigatorTyped();return!!a&&goog.string.contains(a.appVersion||"","X11")};goog.userAgent.X11=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_X11:goog.userAgent.isX11_();goog.userAgent.ANDROID=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_ANDROID:goog.labs.userAgent.platform.isAndroid();goog.userAgent.IPHONE=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPHONE:goog.labs.userAgent.platform.isIphone();goog.userAgent.IPAD=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPAD:goog.labs.userAgent.platform.isIpad();goog.userAgent.IPOD=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPOD:goog.labs.userAgent.platform.isIpod();goog.userAgent.IOS=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPHONE||goog.userAgent.ASSUME_IPAD||goog.userAgent.ASSUME_IPOD:goog.labs.userAgent.platform.isIos();goog.userAgent.KAIOS=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_KAIOS:goog.labs.userAgent.platform.isKaiOS();goog.userAgent.GO2PHONE=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_GO2PHONE:goog.labs.userAgent.platform.isGo2Phone();goog.userAgent.determineVersion_=function(){var a="",b=goog.userAgent.getVersionRegexResult_();b&&(a=b?b[1]:"");return goog.userAgent.IE&&(b=goog.userAgent.getDocumentMode_(),null!=b&&b>parseFloat(a))?String(b):a};goog.userAgent.getVersionRegexResult_=function(){var a=goog.userAgent.getUserAgentString();if(goog.userAgent.GECKO)return/rv:([^\);]+)(\)|;)/.exec(a);if(goog.userAgent.EDGE)return/Edge\/([\d\.]+)/.exec(a);if(goog.userAgent.IE)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(goog.userAgent.WEBKIT)return/WebKit\/(\S+)/.exec(a);if(goog.userAgent.OPERA)return/(?:Version)[ \/]?(\S+)/.exec(a)};goog.userAgent.getDocumentMode_=function(){var a=goog.global.document;return a?a.documentMode:void 0};goog.userAgent.VERSION=goog.userAgent.determineVersion_();goog.userAgent.compare=function(a,b){return goog.string.compareVersions(a,b)};goog.userAgent.isVersionOrHigherCache_={};goog.userAgent.isVersionOrHigher=function(a){return goog.userAgent.ASSUME_ANY_VERSION||goog.reflect.cache(goog.userAgent.isVersionOrHigherCache_,a,function(){return 0<=goog.string.compareVersions(goog.userAgent.VERSION,a)})};goog.userAgent.isVersion=goog.userAgent.isVersionOrHigher;goog.userAgent.isDocumentModeOrHigher=function(a){return Number(goog.userAgent.DOCUMENT_MODE)>=a};goog.userAgent.isDocumentMode=goog.userAgent.isDocumentModeOrHigher;goog.userAgent.DOCUMENT_MODE=function(){if(goog.global.document&&goog.userAgent.IE)return goog.userAgent.getDocumentMode_()}();goog.userAgent.product={};goog.userAgent.product.ASSUME_FIREFOX=!1;goog.userAgent.product.ASSUME_IPHONE=!1;goog.userAgent.product.ASSUME_IPAD=!1;goog.userAgent.product.ASSUME_ANDROID=!1;goog.userAgent.product.ASSUME_CHROME=!1;goog.userAgent.product.ASSUME_SAFARI=!1;goog.userAgent.product.PRODUCT_KNOWN_=goog.userAgent.ASSUME_IE||goog.userAgent.ASSUME_EDGE||goog.userAgent.ASSUME_OPERA||goog.userAgent.product.ASSUME_FIREFOX||goog.userAgent.product.ASSUME_IPHONE||goog.userAgent.product.ASSUME_IPAD||goog.userAgent.product.ASSUME_ANDROID||goog.userAgent.product.ASSUME_CHROME||goog.userAgent.product.ASSUME_SAFARI;goog.userAgent.product.OPERA=goog.userAgent.OPERA;goog.userAgent.product.IE=goog.userAgent.IE;goog.userAgent.product.EDGE=goog.userAgent.EDGE;goog.userAgent.product.FIREFOX=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_FIREFOX:goog.labs.userAgent.browser.isFirefox();goog.userAgent.product.isIphoneOrIpod_=function(){return goog.labs.userAgent.platform.isIphone()||goog.labs.userAgent.platform.isIpod()};goog.userAgent.product.IPHONE=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_IPHONE:goog.userAgent.product.isIphoneOrIpod_();goog.userAgent.product.IPAD=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_IPAD:goog.labs.userAgent.platform.isIpad();goog.userAgent.product.ANDROID=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_ANDROID:goog.labs.userAgent.browser.isAndroidBrowser();goog.userAgent.product.CHROME=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_CHROME:goog.labs.userAgent.browser.isChrome();goog.userAgent.product.isSafariDesktop_=function(){return goog.labs.userAgent.browser.isSafari()&&!goog.labs.userAgent.platform.isIos()};goog.userAgent.product.SAFARI=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_SAFARI:goog.userAgent.product.isSafariDesktop_();goog.crypt.base64={};goog.crypt.base64.DEFAULT_ALPHABET_COMMON_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";goog.crypt.base64.ENCODED_VALS=goog.crypt.base64.DEFAULT_ALPHABET_COMMON_+"+/=";goog.crypt.base64.ENCODED_VALS_WEBSAFE=goog.crypt.base64.DEFAULT_ALPHABET_COMMON_+"-_.";goog.crypt.base64.Alphabet={DEFAULT:0,NO_PADDING:1,WEBSAFE:2,WEBSAFE_DOT_PADDING:3,WEBSAFE_NO_PADDING:4};goog.crypt.base64.paddingChars_="=.";goog.crypt.base64.isPadding_=function(a){return goog.string.contains(goog.crypt.base64.paddingChars_,a)};goog.crypt.base64.byteToCharMaps_={};goog.crypt.base64.charToByteMap_=null;goog.crypt.base64.ASSUME_NATIVE_SUPPORT_=goog.userAgent.GECKO||goog.userAgent.WEBKIT&&!goog.userAgent.product.SAFARI||goog.userAgent.OPERA;goog.crypt.base64.HAS_NATIVE_ENCODE_=goog.crypt.base64.ASSUME_NATIVE_SUPPORT_||"function"==typeof goog.global.btoa;goog.crypt.base64.HAS_NATIVE_DECODE_=goog.crypt.base64.ASSUME_NATIVE_SUPPORT_||!goog.userAgent.product.SAFARI&&!goog.userAgent.IE&&"function"==typeof goog.global.atob;goog.crypt.base64.encodeByteArray=function(a,b){goog.asserts.assert(goog.isArrayLike(a),"encodeByteArray takes an array as a parameter");void 0===b&&(b=goog.crypt.base64.Alphabet.DEFAULT);goog.crypt.base64.init_();b=goog.crypt.base64.byteToCharMaps_[b];for(var c=[],d=0;d<a.length;d+=3){var e=a[d],f=d+1<a.length,g=f?a[d+1]:0,h=d+2<a.length,k=h?a[d+2]:0,l=e>>2;e=(e&3)<<4|g>>4;g=(g&15)<<2|k>>6;k&=63;h||(k=64,f||(g=64));c.push(b[l],b[e],b[g]||"",b[k]||"")}
return c.join("")};goog.crypt.base64.encodeString=function(a,b){return goog.crypt.base64.HAS_NATIVE_ENCODE_&&!b?goog.global.btoa(a):goog.crypt.base64.encodeByteArray(goog.crypt.stringToByteArray(a),b)};goog.crypt.base64.decodeString=function(a,b){if(goog.crypt.base64.HAS_NATIVE_DECODE_&&!b)return goog.global.atob(a);var c="";goog.crypt.base64.decodeStringInternal_(a,function(a){c+=String.fromCharCode(a)});return c};goog.crypt.base64.decodeStringToByteArray=function(a,b){var c=[];goog.crypt.base64.decodeStringInternal_(a,function(a){c.push(a)});return c};goog.crypt.base64.decodeStringToUint8Array=function(a){goog.asserts.assert(!goog.userAgent.IE||goog.userAgent.isVersionOrHigher("10"),"Browser does not support typed arrays");var b=a.length,c=3*b/4;c%3?c=Math.floor(c):goog.crypt.base64.isPadding_(a[b-1])&&(c=goog.crypt.base64.isPadding_(a[b-2])?c-2:c-1);var d=new Uint8Array(c),e=0;goog.crypt.base64.decodeStringInternal_(a,function(a){d[e++]=a});return d.subarray(0,e)};goog.crypt.base64.decodeStringInternal_=function(a,b){function c(b){for(;d<a.length;){var c=a.charAt(d++),e=goog.crypt.base64.charToByteMap_[c];if(null!=e)return e;if(!goog.string.isEmptyOrWhitespace(c))throw Error("Unknown base64 encoding at char: "+c);}
return b}
goog.crypt.base64.init_();for(var d=0;;){var e=c(-1),f=c(0),g=c(64),h=c(64);if(64===h&&-1===e)break;b(e<<2|f>>4);64!=g&&(b(f<<4&240|g>>2),64!=h&&b(g<<6&192|h))}};goog.crypt.base64.init_=function(){if(!goog.crypt.base64.charToByteMap_){goog.crypt.base64.charToByteMap_={};for(var a=goog.crypt.base64.DEFAULT_ALPHABET_COMMON_.split(""),b=["+/=","+/","-_=","-_.","-_"],c=0;5>c;c++){var d=a.concat(b[c].split(""));goog.crypt.base64.byteToCharMaps_[c]=d;for(var e=0;e<d.length;e++){var f=d[e],g=goog.crypt.base64.charToByteMap_[f];void 0===g?goog.crypt.base64.charToByteMap_[f]=e:goog.asserts.assert(g===e)}}}};jspb.utils={};jspb.utils.split64Low=0;jspb.utils.split64High=0;jspb.utils.splitUint64=function(a){var b=a>>>0;a=Math.floor((a-b)/jspb.BinaryConstants.TWO_TO_32)>>>0;jspb.utils.split64Low=b;jspb.utils.split64High=a};jspb.utils.splitInt64=function(a){var b=0>a;a=Math.abs(a);var c=a>>>0;a=Math.floor((a-c)/jspb.BinaryConstants.TWO_TO_32);a>>>=0;b&&(a=~a>>>0,c=(~c>>>0)+1,4294967295<c&&(c=0,a++,4294967295<a&&(a=0)));jspb.utils.split64Low=c;jspb.utils.split64High=a};jspb.utils.splitZigzag64=function(a){var b=0>a;a=2*Math.abs(a);jspb.utils.splitUint64(a);a=jspb.utils.split64Low;var c=jspb.utils.split64High;b&&(0==a?0==c?c=a=4294967295:(c--,a=4294967295):a--);jspb.utils.split64Low=a;jspb.utils.split64High=c};jspb.utils.splitFloat32=function(a){var b=0>a?1:0;a=b?-a:a;if(0===a)0<1/a?(jspb.utils.split64High=0,jspb.utils.split64Low=0):(jspb.utils.split64High=0,jspb.utils.split64Low=2147483648);else if(isNaN(a))jspb.utils.split64High=0,jspb.utils.split64Low=2147483647;else if(a>jspb.BinaryConstants.FLOAT32_MAX)jspb.utils.split64High=0,jspb.utils.split64Low=(b<<31|2139095040)>>>0;else if(a<jspb.BinaryConstants.FLOAT32_MIN)a=Math.round(a/Math.pow(2,-149)),jspb.utils.split64High=0,jspb.utils.split64Low=(b<<31|a)>>>0;else{var c=Math.floor(Math.log(a)/Math.LN2);a*=Math.pow(2,-c);a=Math.round(a*jspb.BinaryConstants.TWO_TO_23);if(a>=0x1000000){++c;}
a=a&0x7FFFFF;jspb.utils.split64High=0;jspb.utils.split64Low=(b<<31|c+127<<23|a)>>>0}};jspb.utils.splitFloat64=function(a){var b=0>a?1:0;a=b?-a:a;if(0===a)jspb.utils.split64High=0<1/a?0:2147483648,jspb.utils.split64Low=0;else if(isNaN(a))jspb.utils.split64High=2147483647,jspb.utils.split64Low=4294967295;else if(a>jspb.BinaryConstants.FLOAT64_MAX)jspb.utils.split64High=(b<<31|2146435072)>>>0,jspb.utils.split64Low=0;else if(a<jspb.BinaryConstants.FLOAT64_MIN){var c=a/Math.pow(2,-1074);a=c/jspb.BinaryConstants.TWO_TO_32;jspb.utils.split64High=(b<<31|a)>>>0;jspb.utils.split64Low=c>>>0}else{c=a;var d=0;if(2<=c)
for(;2<=c&&1023>d;)d++,c/=2;else
for(;1>c&&-1022<d;)c*=2,d--;c=a*Math.pow(2,-d);a=c*jspb.BinaryConstants.TWO_TO_20&1048575;c=c*jspb.BinaryConstants.TWO_TO_52>>>0;jspb.utils.split64High=(b<<31|d+1023<<20|a)>>>0;jspb.utils.split64Low=c}};jspb.utils.splitHash64=function(a){var b=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),e=a.charCodeAt(3),f=a.charCodeAt(4),g=a.charCodeAt(5),h=a.charCodeAt(6);a=a.charCodeAt(7);jspb.utils.split64Low=b+(c<<8)+(d<<16)+(e<<24)>>>0;jspb.utils.split64High=f+(g<<8)+(h<<16)+(a<<24)>>>0};jspb.utils.joinUint64=function(a,b){return b*jspb.BinaryConstants.TWO_TO_32+(a>>>0)};jspb.utils.joinInt64=function(a,b){var c=b&2147483648;c&&(a=~a+1>>>0,b=~b>>>0,0==a&&(b=b+1>>>0));a=jspb.utils.joinUint64(a,b);return c?-a:a};jspb.utils.toZigzag64=function(a,b,c){var d=b>>31;return c(a<<1^d,(b<<1|a>>>31)^d)};jspb.utils.joinZigzag64=function(a,b){return jspb.utils.fromZigzag64(a,b,jspb.utils.joinInt64)};jspb.utils.fromZigzag64=function(a,b,c){var d=-(a&1);return c((a>>>1|b<<31)^d,b>>>1^d)};jspb.utils.joinFloat32=function(a,b){b=2*(a>>31)+1;var c=a>>>23&255;a&=8388607;return 255==c?a?NaN:Infinity*b:0==c?b*Math.pow(2,-149)*a:b*Math.pow(2,c-150)*(a+Math.pow(2,23))};jspb.utils.joinFloat64=function(a,b){var c=2*(b>>31)+1,d=b>>>20&2047;a=jspb.BinaryConstants.TWO_TO_32*(b&1048575)+a;return 2047==d?a?NaN:Infinity*c:0==d?c*Math.pow(2,-1074)*a:c*Math.pow(2,d-1075)*(a+jspb.BinaryConstants.TWO_TO_52)};jspb.utils.joinHash64=function(a,b){return String.fromCharCode(a>>>0&255,a>>>8&255,a>>>16&255,a>>>24&255,b>>>0&255,b>>>8&255,b>>>16&255,b>>>24&255)};jspb.utils.DIGITS="0123456789abcdef".split("");jspb.utils.ZERO_CHAR_CODE_=48;jspb.utils.A_CHAR_CODE_=97;jspb.utils.joinUnsignedDecimalString=function(a,b){function c(a,b){a=a?String(a):"";return b?"0000000".slice(a.length)+a:a}
if(2097151>=b)return""+(jspb.BinaryConstants.TWO_TO_32*b+a);var d=(a>>>24|b<<8)>>>0&16777215;b=b>>16&65535;a=(a&16777215)+6777216*d+6710656*b;d+=8147497*b;b*=2;1E7<=a&&(d+=Math.floor(a/1E7),a%=1E7);1E7<=d&&(b+=Math.floor(d/1E7),d%=1E7);return c(b,0)+c(d,b)+c(a,1)};jspb.utils.joinSignedDecimalString=function(a,b){var c=b&2147483648;c&&(a=~a+1>>>0,b=~b+(0==a?1:0)>>>0);a=jspb.utils.joinUnsignedDecimalString(a,b);return c?"-"+a:a};jspb.utils.hash64ToDecimalString=function(a,b){jspb.utils.splitHash64(a);a=jspb.utils.split64Low;var c=jspb.utils.split64High;return b?jspb.utils.joinSignedDecimalString(a,c):jspb.utils.joinUnsignedDecimalString(a,c)};jspb.utils.hash64ArrayToDecimalStrings=function(a,b){for(var c=Array(a.length),d=0;d<a.length;d++)c[d]=jspb.utils.hash64ToDecimalString(a[d],b);return c};jspb.utils.decimalStringToHash64=function(a){function b(a,b){for(var c=0;8>c&&(1!==a||0<b);c++)b=a*e[c]+b,e[c]=b&255,b>>>=8}
function c(){for(var a=0;8>a;a++)e[a]=~e[a]&255}
goog.asserts.assert(0<a.length);var d=!1;"-"===a[0]&&(d=!0,a=a.slice(1));for(var e=[0,0,0,0,0,0,0,0],f=0;f<a.length;f++)b(10,a.charCodeAt(f)-jspb.utils.ZERO_CHAR_CODE_);d&&(c(),b(1,1));return goog.crypt.byteArrayToString(e)};jspb.utils.splitDecimalString=function(a){jspb.utils.splitHash64(jspb.utils.decimalStringToHash64(a))};jspb.utils.toHexDigit_=function(a){return String.fromCharCode(10>a?jspb.utils.ZERO_CHAR_CODE_+a:jspb.utils.A_CHAR_CODE_-10+a)};jspb.utils.fromHexCharCode_=function(a){return a>=jspb.utils.A_CHAR_CODE_?a-jspb.utils.A_CHAR_CODE_+10:a-jspb.utils.ZERO_CHAR_CODE_};jspb.utils.hash64ToHexString=function(a){var b=Array(18);b[0]="0";b[1]="x";for(var c=0;8>c;c++){var d=a.charCodeAt(7-c);b[2*c+2]=jspb.utils.toHexDigit_(d>>4);b[2*c+3]=jspb.utils.toHexDigit_(d&15)}
return b.join("")};jspb.utils.hexStringToHash64=function(a){a=a.toLowerCase();goog.asserts.assert(18==a.length);goog.asserts.assert("0"==a[0]);goog.asserts.assert("x"==a[1]);for(var b="",c=0;8>c;c++){var d=jspb.utils.fromHexCharCode_(a.charCodeAt(2*c+2)),e=jspb.utils.fromHexCharCode_(a.charCodeAt(2*c+3));b=String.fromCharCode(16*d+e)+b}
return b};jspb.utils.hash64ToNumber=function(a,b){jspb.utils.splitHash64(a);a=jspb.utils.split64Low;var c=jspb.utils.split64High;return b?jspb.utils.joinInt64(a,c):jspb.utils.joinUint64(a,c)};jspb.utils.numberToHash64=function(a){jspb.utils.splitInt64(a);return jspb.utils.joinHash64(jspb.utils.split64Low,jspb.utils.split64High)};jspb.utils.countVarints=function(a,b,c){for(var d=0,e=b;e<c;e++)d+=a[e]>>7;return c-b-d};jspb.utils.countVarintFields=function(a,b,c,d){var e=0;d=8*d+jspb.BinaryConstants.WireType.VARINT;if(128>d)
for(;b<c&&a[b++]==d;)
for(e++;;){var f=a[b++];if(0==(f&128))break}else
for(;b<c;){for(f=d;128<f;){if(a[b]!=(f&127|128))return e;b++;f>>=7}
if(a[b++]!=f)break;for(e++;f=a[b++],0!=(f&128););}
return e};jspb.utils.countFixedFields_=function(a,b,c,d,e){var f=0;if(128>d)
for(;b<c&&a[b++]==d;)f++,b+=e;else
for(;b<c;){for(var g=d;128<g;){if(a[b++]!=(g&127|128))return f;g>>=7}
if(a[b++]!=g)break;f++;b+=e}
return f};jspb.utils.countFixed32Fields=function(a,b,c,d){return jspb.utils.countFixedFields_(a,b,c,8*d+jspb.BinaryConstants.WireType.FIXED32,4)};jspb.utils.countFixed64Fields=function(a,b,c,d){return jspb.utils.countFixedFields_(a,b,c,8*d+jspb.BinaryConstants.WireType.FIXED64,8)};jspb.utils.countDelimitedFields=function(a,b,c,d){var e=0;for(d=8*d+jspb.BinaryConstants.WireType.DELIMITED;b<c;){for(var f=d;128<f;){if(a[b++]!=(f&127|128))return e;f>>=7}
if(a[b++]!=f)break;e++;for(var g=0,h=1;f=a[b++],g+=(f&127)*h,h*=128,0!=(f&128););b+=g}
return e};jspb.utils.debugBytesToTextFormat=function(a){var b='"';if(a){a=jspb.utils.byteSourceToUint8Array(a);for(var c=0;c<a.length;c++)b+="\\x",16>a[c]&&(b+="0"),b+=a[c].toString(16)}
return b+'"'};jspb.utils.debugScalarToTextFormat=function(a){return"string"===typeof a?goog.string.quote(a):a.toString()};jspb.utils.stringToByteArray=function(a){for(var b=new Uint8Array(a.length),c=0;c<a.length;c++){var d=a.charCodeAt(c);if(255<d)throw Error("Conversion error: string contains codepoint outside of byte range");b[c]=d}
return b};jspb.utils.byteSourceToUint8Array=function(a){if(a.constructor===Uint8Array)return a;if(a.constructor===ArrayBuffer||"undefined"!=typeof Buffer&&a.constructor===Buffer||a.constructor===Array)return new Uint8Array(a);if(a.constructor===String)return goog.crypt.base64.decodeStringToUint8Array(a);goog.asserts.fail("Type not convertible to Uint8Array.");return new Uint8Array(0)};jspb.BinaryDecoder=function(a,b,c){this.bytes_=null;this.cursor_=this.end_=this.start_=0;this.error_=!1;a&&this.setBlock(a,b,c)};jspb.BinaryDecoder.instanceCache_=[];jspb.BinaryDecoder.alloc=function(a,b,c){if(jspb.BinaryDecoder.instanceCache_.length){var d=jspb.BinaryDecoder.instanceCache_.pop();a&&d.setBlock(a,b,c);return d}
return new jspb.BinaryDecoder(a,b,c)};jspb.BinaryDecoder.prototype.free=function(){this.clear();100>jspb.BinaryDecoder.instanceCache_.length&&jspb.BinaryDecoder.instanceCache_.push(this)};jspb.BinaryDecoder.prototype.clone=function(){return jspb.BinaryDecoder.alloc(this.bytes_,this.start_,this.end_-this.start_)};jspb.BinaryDecoder.prototype.clear=function(){this.bytes_=null;this.cursor_=this.end_=this.start_=0;this.error_=!1};jspb.BinaryDecoder.prototype.getBuffer=function(){return this.bytes_};jspb.BinaryDecoder.prototype.setBlock=function(a,b,c){this.bytes_=jspb.utils.byteSourceToUint8Array(a);this.start_=void 0!==b?b:0;this.end_=void 0!==c?this.start_+c:this.bytes_.length;this.cursor_=this.start_};jspb.BinaryDecoder.prototype.getEnd=function(){return this.end_};jspb.BinaryDecoder.prototype.setEnd=function(a){this.end_=a};jspb.BinaryDecoder.prototype.reset=function(){this.cursor_=this.start_};jspb.BinaryDecoder.prototype.getCursor=function(){return this.cursor_};jspb.BinaryDecoder.prototype.setCursor=function(a){this.cursor_=a};jspb.BinaryDecoder.prototype.advance=function(a){this.cursor_+=a;goog.asserts.assert(this.cursor_<=this.end_)};jspb.BinaryDecoder.prototype.atEnd=function(){return this.cursor_==this.end_};jspb.BinaryDecoder.prototype.pastEnd=function(){return this.cursor_>this.end_};jspb.BinaryDecoder.prototype.getError=function(){return this.error_||0>this.cursor_||this.cursor_>this.end_};jspb.BinaryDecoder.prototype.readSplitVarint64=function(a){for(var b=128,c=0,d=0,e=0;4>e&&128<=b;e++)b=this.bytes_[this.cursor_++],c|=(b&127)<<7*e;128<=b&&(b=this.bytes_[this.cursor_++],c|=(b&127)<<28,d|=(b&127)>>4);if(128<=b)
for(e=0;5>e&&128<=b;e++)b=this.bytes_[this.cursor_++],d|=(b&127)<<7*e+3;if(128>b)return a(c>>>0,d>>>0);goog.asserts.fail("Failed to read varint, encoding is invalid.");this.error_=!0};jspb.BinaryDecoder.prototype.readSplitZigzagVarint64=function(a){return this.readSplitVarint64(function(b,c){return jspb.utils.fromZigzag64(b,c,a)})};jspb.BinaryDecoder.prototype.readSplitFixed64=function(a){var b=this.bytes_,c=this.cursor_;this.cursor_+=8;for(var d=0,e=0,f=c+7;f>=c;f--)d=d<<8|b[f],e=e<<8|b[f+4];return a(d,e)};jspb.BinaryDecoder.prototype.skipVarint=function(){for(;this.bytes_[this.cursor_]&128;)this.cursor_++;this.cursor_++};jspb.BinaryDecoder.prototype.unskipVarint=function(a){for(;128<a;)this.cursor_--,a>>>=7;this.cursor_--};jspb.BinaryDecoder.prototype.readUnsignedVarint32=function(){var a=this.bytes_;var b=a[this.cursor_+0];var c=b&127;if(128>b)return this.cursor_+=1,goog.asserts.assert(this.cursor_<=this.end_),c;b=a[this.cursor_+1];c|=(b&127)<<7;if(128>b)return this.cursor_+=2,goog.asserts.assert(this.cursor_<=this.end_),c;b=a[this.cursor_+2];c|=(b&127)<<14;if(128>b)return this.cursor_+=3,goog.asserts.assert(this.cursor_<=this.end_),c;b=a[this.cursor_+3];c|=(b&127)<<21;if(128>b)return this.cursor_+=4,goog.asserts.assert(this.cursor_<=this.end_),c;b=a[this.cursor_+4];c|=(b&15)<<28;if(128>b)return this.cursor_+=5,goog.asserts.assert(this.cursor_<=this.end_),c>>>0;this.cursor_+=5;128<=a[this.cursor_++]&&128<=a[this.cursor_++]&&128<=a[this.cursor_++]&&128<=a[this.cursor_++]&&128<=a[this.cursor_++]&&goog.asserts.assert(!1);goog.asserts.assert(this.cursor_<=this.end_);return c};jspb.BinaryDecoder.prototype.readSignedVarint32=jspb.BinaryDecoder.prototype.readUnsignedVarint32;jspb.BinaryDecoder.prototype.readUnsignedVarint32String=function(){return this.readUnsignedVarint32().toString()};jspb.BinaryDecoder.prototype.readSignedVarint32String=function(){return this.readSignedVarint32().toString()};jspb.BinaryDecoder.prototype.readZigzagVarint32=function(){var a=this.readUnsignedVarint32();return a>>>1^-(a&1)};jspb.BinaryDecoder.prototype.readUnsignedVarint64=function(){return this.readSplitVarint64(jspb.utils.joinUint64)};jspb.BinaryDecoder.prototype.readUnsignedVarint64String=function(){return this.readSplitVarint64(jspb.utils.joinUnsignedDecimalString)};jspb.BinaryDecoder.prototype.readSignedVarint64=function(){return this.readSplitVarint64(jspb.utils.joinInt64)};jspb.BinaryDecoder.prototype.readSignedVarint64String=function(){return this.readSplitVarint64(jspb.utils.joinSignedDecimalString)};jspb.BinaryDecoder.prototype.readZigzagVarint64=function(){return this.readSplitVarint64(jspb.utils.joinZigzag64)};jspb.BinaryDecoder.prototype.readZigzagVarintHash64=function(){return this.readSplitZigzagVarint64(jspb.utils.joinHash64)};jspb.BinaryDecoder.prototype.readZigzagVarint64String=function(){return this.readSplitZigzagVarint64(jspb.utils.joinSignedDecimalString)};jspb.BinaryDecoder.prototype.readUint8=function(){var a=this.bytes_[this.cursor_+0];this.cursor_+=1;goog.asserts.assert(this.cursor_<=this.end_);return a};jspb.BinaryDecoder.prototype.readUint16=function(){var a=this.bytes_[this.cursor_+0],b=this.bytes_[this.cursor_+1];this.cursor_+=2;goog.asserts.assert(this.cursor_<=this.end_);return a<<0|b<<8};jspb.BinaryDecoder.prototype.readUint32=function(){var a=this.bytes_[this.cursor_+0],b=this.bytes_[this.cursor_+1],c=this.bytes_[this.cursor_+2],d=this.bytes_[this.cursor_+3];this.cursor_+=4;goog.asserts.assert(this.cursor_<=this.end_);return(a<<0|b<<8|c<<16|d<<24)>>>0};jspb.BinaryDecoder.prototype.readUint64=function(){var a=this.readUint32(),b=this.readUint32();return jspb.utils.joinUint64(a,b)};jspb.BinaryDecoder.prototype.readUint64String=function(){var a=this.readUint32(),b=this.readUint32();return jspb.utils.joinUnsignedDecimalString(a,b)};jspb.BinaryDecoder.prototype.readInt8=function(){var a=this.bytes_[this.cursor_+0];this.cursor_+=1;goog.asserts.assert(this.cursor_<=this.end_);return a<<24>>24};jspb.BinaryDecoder.prototype.readInt16=function(){var a=this.bytes_[this.cursor_+0],b=this.bytes_[this.cursor_+1];this.cursor_+=2;goog.asserts.assert(this.cursor_<=this.end_);return(a<<0|b<<8)<<16>>16};jspb.BinaryDecoder.prototype.readInt32=function(){var a=this.bytes_[this.cursor_+0],b=this.bytes_[this.cursor_+1],c=this.bytes_[this.cursor_+2],d=this.bytes_[this.cursor_+3];this.cursor_+=4;goog.asserts.assert(this.cursor_<=this.end_);return a<<0|b<<8|c<<16|d<<24};jspb.BinaryDecoder.prototype.readInt64=function(){var a=this.readUint32(),b=this.readUint32();return jspb.utils.joinInt64(a,b)};jspb.BinaryDecoder.prototype.readInt64String=function(){var a=this.readUint32(),b=this.readUint32();return jspb.utils.joinSignedDecimalString(a,b)};jspb.BinaryDecoder.prototype.readFloat=function(){var a=this.readUint32();return jspb.utils.joinFloat32(a,0)};jspb.BinaryDecoder.prototype.readDouble=function(){var a=this.readUint32(),b=this.readUint32();return jspb.utils.joinFloat64(a,b)};jspb.BinaryDecoder.prototype.readBool=function(){return!!this.bytes_[this.cursor_++]};jspb.BinaryDecoder.prototype.readEnum=function(){return this.readSignedVarint32()};jspb.BinaryDecoder.prototype.readString=function(a){var b=this.bytes_,c=this.cursor_;a=c+a;for(var d=[],e="";c<a;){var f=b[c++];if(128>f)d.push(f);else if(192>f)continue;else if(224>f){var g=b[c++];d.push((f&31)<<6|g&63)}else if(240>f){g=b[c++];var h=b[c++];d.push((f&15)<<12|(g&63)<<6|h&63)}else if(248>f){g=b[c++];h=b[c++];var k=b[c++];f=(f&7)<<18|(g&63)<<12|(h&63)<<6|k&63;f-=65536;d.push((f>>10&1023)+55296,(f&1023)+56320)}
8192<=d.length&&(e+=String.fromCharCode.apply(null,d),d.length=0)}
e+=goog.crypt.byteArrayToString(d);this.cursor_=c;return e};jspb.BinaryDecoder.prototype.readStringWithLength=function(){var a=this.readUnsignedVarint32();return this.readString(a)};jspb.BinaryDecoder.prototype.readBytes=function(a){if(0>a||this.cursor_+a>this.bytes_.length)return this.error_=!0,goog.asserts.fail("Invalid byte length!"),new Uint8Array(0);var b=this.bytes_.subarray(this.cursor_,this.cursor_+a);this.cursor_+=a;goog.asserts.assert(this.cursor_<=this.end_);return b};jspb.BinaryDecoder.prototype.readVarintHash64=function(){return this.readSplitVarint64(jspb.utils.joinHash64)};jspb.BinaryDecoder.prototype.readFixedHash64=function(){var a=this.bytes_,b=this.cursor_,c=a[b+0],d=a[b+1],e=a[b+2],f=a[b+3],g=a[b+4],h=a[b+5],k=a[b+6];a=a[b+7];this.cursor_+=8;return String.fromCharCode(c,d,e,f,g,h,k,a)};jspb.BinaryReader=function(a,b,c){this.decoder_=jspb.BinaryDecoder.alloc(a,b,c);this.fieldCursor_=this.decoder_.getCursor();this.nextField_=jspb.BinaryConstants.INVALID_FIELD_NUMBER;this.nextWireType_=jspb.BinaryConstants.WireType.INVALID;this.error_=!1;this.readCallbacks_=null};jspb.BinaryReader.instanceCache_=[];jspb.BinaryReader.alloc=function(a,b,c){if(jspb.BinaryReader.instanceCache_.length){var d=jspb.BinaryReader.instanceCache_.pop();a&&d.decoder_.setBlock(a,b,c);return d}
return new jspb.BinaryReader(a,b,c)};jspb.BinaryReader.prototype.alloc=jspb.BinaryReader.alloc;jspb.BinaryReader.prototype.free=function(){this.decoder_.clear();this.nextField_=jspb.BinaryConstants.INVALID_FIELD_NUMBER;this.nextWireType_=jspb.BinaryConstants.WireType.INVALID;this.error_=!1;this.readCallbacks_=null;100>jspb.BinaryReader.instanceCache_.length&&jspb.BinaryReader.instanceCache_.push(this)};jspb.BinaryReader.prototype.getFieldCursor=function(){return this.fieldCursor_};jspb.BinaryReader.prototype.getCursor=function(){return this.decoder_.getCursor()};jspb.BinaryReader.prototype.getBuffer=function(){return this.decoder_.getBuffer()};jspb.BinaryReader.prototype.getFieldNumber=function(){return this.nextField_};jspb.BinaryReader.prototype.getWireType=function(){return this.nextWireType_};jspb.BinaryReader.prototype.isEndGroup=function(){return this.nextWireType_==jspb.BinaryConstants.WireType.END_GROUP};jspb.BinaryReader.prototype.getError=function(){return this.error_||this.decoder_.getError()};jspb.BinaryReader.prototype.setBlock=function(a,b,c){this.decoder_.setBlock(a,b,c);this.nextField_=jspb.BinaryConstants.INVALID_FIELD_NUMBER;this.nextWireType_=jspb.BinaryConstants.WireType.INVALID};jspb.BinaryReader.prototype.reset=function(){this.decoder_.reset();this.nextField_=jspb.BinaryConstants.INVALID_FIELD_NUMBER;this.nextWireType_=jspb.BinaryConstants.WireType.INVALID};jspb.BinaryReader.prototype.advance=function(a){this.decoder_.advance(a)};jspb.BinaryReader.prototype.nextField=function(){if(this.decoder_.atEnd())return!1;if(this.getError())return goog.asserts.fail("Decoder hit an error"),!1;this.fieldCursor_=this.decoder_.getCursor();var a=this.decoder_.readUnsignedVarint32(),b=a>>>3;a&=7;if(a!=jspb.BinaryConstants.WireType.VARINT&&a!=jspb.BinaryConstants.WireType.FIXED32&&a!=jspb.BinaryConstants.WireType.FIXED64&&a!=jspb.BinaryConstants.WireType.DELIMITED&&a!=jspb.BinaryConstants.WireType.START_GROUP&&a!=jspb.BinaryConstants.WireType.END_GROUP)return goog.asserts.fail("Invalid wire type: %s (at position %s)",a,this.fieldCursor_),this.error_=!0,!1;this.nextField_=b;this.nextWireType_=a;return!0};jspb.BinaryReader.prototype.unskipHeader=function(){this.decoder_.unskipVarint(this.nextField_<<3|this.nextWireType_)};jspb.BinaryReader.prototype.skipMatchingFields=function(){var a=this.nextField_;for(this.unskipHeader();this.nextField()&&this.getFieldNumber()==a;)this.skipField();this.decoder_.atEnd()||this.unskipHeader()};jspb.BinaryReader.prototype.skipVarintField=function(){this.nextWireType_!=jspb.BinaryConstants.WireType.VARINT?(goog.asserts.fail("Invalid wire type for skipVarintField"),this.skipField()):this.decoder_.skipVarint()};jspb.BinaryReader.prototype.skipDelimitedField=function(){if(this.nextWireType_!=jspb.BinaryConstants.WireType.DELIMITED)goog.asserts.fail("Invalid wire type for skipDelimitedField"),this.skipField();else{var a=this.decoder_.readUnsignedVarint32();this.decoder_.advance(a)}};jspb.BinaryReader.prototype.skipFixed32Field=function(){this.nextWireType_!=jspb.BinaryConstants.WireType.FIXED32?(goog.asserts.fail("Invalid wire type for skipFixed32Field"),this.skipField()):this.decoder_.advance(4)};jspb.BinaryReader.prototype.skipFixed64Field=function(){this.nextWireType_!=jspb.BinaryConstants.WireType.FIXED64?(goog.asserts.fail("Invalid wire type for skipFixed64Field"),this.skipField()):this.decoder_.advance(8)};jspb.BinaryReader.prototype.skipGroup=function(){var a=this.nextField_;do{if(!this.nextField()){goog.asserts.fail("Unmatched start-group tag: stream EOF");this.error_=!0;break}
if(this.nextWireType_==jspb.BinaryConstants.WireType.END_GROUP){this.nextField_!=a&&(goog.asserts.fail("Unmatched end-group tag"),this.error_=!0);break}
this.skipField()}while(1)};jspb.BinaryReader.prototype.skipField=function(){switch(this.nextWireType_){case jspb.BinaryConstants.WireType.VARINT:this.skipVarintField();break;case jspb.BinaryConstants.WireType.FIXED64:this.skipFixed64Field();break;case jspb.BinaryConstants.WireType.DELIMITED:this.skipDelimitedField();break;case jspb.BinaryConstants.WireType.FIXED32:this.skipFixed32Field();break;case jspb.BinaryConstants.WireType.START_GROUP:this.skipGroup();break;default:goog.asserts.fail("Invalid wire encoding for field.")}};jspb.BinaryReader.prototype.registerReadCallback=function(a,b){null===this.readCallbacks_&&(this.readCallbacks_={});goog.asserts.assert(!this.readCallbacks_[a]);this.readCallbacks_[a]=b};jspb.BinaryReader.prototype.runReadCallback=function(a){goog.asserts.assert(null!==this.readCallbacks_);a=this.readCallbacks_[a];goog.asserts.assert(a);return a(this)};jspb.BinaryReader.prototype.readAny=function(a){this.nextWireType_=jspb.BinaryConstants.FieldTypeToWireType(a);var b=jspb.BinaryConstants.FieldType;switch(a){case b.DOUBLE:return this.readDouble();case b.FLOAT:return this.readFloat();case b.INT64:return this.readInt64();case b.UINT64:return this.readUint64();case b.INT32:return this.readInt32();case b.FIXED64:return this.readFixed64();case b.FIXED32:return this.readFixed32();case b.BOOL:return this.readBool();case b.STRING:return this.readString();case b.GROUP:goog.asserts.fail("Group field type not supported in readAny()");case b.MESSAGE:goog.asserts.fail("Message field type not supported in readAny()");case b.BYTES:return this.readBytes();case b.UINT32:return this.readUint32();case b.ENUM:return this.readEnum();case b.SFIXED32:return this.readSfixed32();case b.SFIXED64:return this.readSfixed64();case b.SINT32:return this.readSint32();case b.SINT64:return this.readSint64();case b.FHASH64:return this.readFixedHash64();case b.VHASH64:return this.readVarintHash64();default:goog.asserts.fail("Invalid field type in readAny()")}
return 0};jspb.BinaryReader.prototype.readMessage=function(a,b){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.DELIMITED);var c=this.decoder_.getEnd(),d=this.decoder_.readUnsignedVarint32();d=this.decoder_.getCursor()+d;this.decoder_.setEnd(d);b(a,this);this.decoder_.setCursor(d);this.decoder_.setEnd(c)};jspb.BinaryReader.prototype.readGroup=function(a,b,c){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.START_GROUP);goog.asserts.assert(this.nextField_==a);c(b,this);this.error_||this.nextWireType_==jspb.BinaryConstants.WireType.END_GROUP||(goog.asserts.fail("Group submessage did not end with an END_GROUP tag"),this.error_=!0)};jspb.BinaryReader.prototype.getFieldDecoder=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.DELIMITED);var a=this.decoder_.readUnsignedVarint32(),b=this.decoder_.getCursor(),c=b+a;a=jspb.BinaryDecoder.alloc(this.decoder_.getBuffer(),b,a);this.decoder_.setCursor(c);return a};jspb.BinaryReader.prototype.readInt32=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT);return this.decoder_.readSignedVarint32()};jspb.BinaryReader.prototype.readInt32String=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT);return this.decoder_.readSignedVarint32String()};jspb.BinaryReader.prototype.readInt64=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT);return this.decoder_.readSignedVarint64()};jspb.BinaryReader.prototype.readInt64String=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT);return this.decoder_.readSignedVarint64String()};jspb.BinaryReader.prototype.readUint32=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT);return this.decoder_.readUnsignedVarint32()};jspb.BinaryReader.prototype.readUint32String=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT);return this.decoder_.readUnsignedVarint32String()};jspb.BinaryReader.prototype.readUint64=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT);return this.decoder_.readUnsignedVarint64()};jspb.BinaryReader.prototype.readUint64String=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT);return this.decoder_.readUnsignedVarint64String()};jspb.BinaryReader.prototype.readSint32=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT);return this.decoder_.readZigzagVarint32()};jspb.BinaryReader.prototype.readSint64=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT);return this.decoder_.readZigzagVarint64()};jspb.BinaryReader.prototype.readSint64String=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT);return this.decoder_.readZigzagVarint64String()};jspb.BinaryReader.prototype.readFixed32=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED32);return this.decoder_.readUint32()};jspb.BinaryReader.prototype.readFixed64=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED64);return this.decoder_.readUint64()};jspb.BinaryReader.prototype.readFixed64String=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED64);return this.decoder_.readUint64String()};jspb.BinaryReader.prototype.readSfixed32=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED32);return this.decoder_.readInt32()};jspb.BinaryReader.prototype.readSfixed32String=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED32);return this.decoder_.readInt32().toString()};jspb.BinaryReader.prototype.readSfixed64=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED64);return this.decoder_.readInt64()};jspb.BinaryReader.prototype.readSfixed64String=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED64);return this.decoder_.readInt64String()};jspb.BinaryReader.prototype.readFloat=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED32);return this.decoder_.readFloat()};jspb.BinaryReader.prototype.readDouble=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED64);return this.decoder_.readDouble()};jspb.BinaryReader.prototype.readBool=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT);return!!this.decoder_.readUnsignedVarint32()};jspb.BinaryReader.prototype.readEnum=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT);return this.decoder_.readSignedVarint64()};jspb.BinaryReader.prototype.readString=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.DELIMITED);var a=this.decoder_.readUnsignedVarint32();return this.decoder_.readString(a)};jspb.BinaryReader.prototype.readBytes=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.DELIMITED);var a=this.decoder_.readUnsignedVarint32();return this.decoder_.readBytes(a)};jspb.BinaryReader.prototype.readVarintHash64=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT);return this.decoder_.readVarintHash64()};jspb.BinaryReader.prototype.readSintHash64=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT);return this.decoder_.readZigzagVarintHash64()};jspb.BinaryReader.prototype.readSplitVarint64=function(a){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT);return this.decoder_.readSplitVarint64(a)};jspb.BinaryReader.prototype.readSplitZigzagVarint64=function(a){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.VARINT);return this.decoder_.readSplitVarint64(function(b,c){return jspb.utils.fromZigzag64(b,c,a)})};jspb.BinaryReader.prototype.readFixedHash64=function(){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED64);return this.decoder_.readFixedHash64()};jspb.BinaryReader.prototype.readSplitFixed64=function(a){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.FIXED64);return this.decoder_.readSplitFixed64(a)};jspb.BinaryReader.prototype.readPackedField_=function(a){goog.asserts.assert(this.nextWireType_==jspb.BinaryConstants.WireType.DELIMITED);var b=this.decoder_.readUnsignedVarint32();b=this.decoder_.getCursor()+b;for(var c=[];this.decoder_.getCursor()<b;)c.push(a.call(this.decoder_));return c};jspb.BinaryReader.prototype.readPackedInt32=function(){return this.readPackedField_(this.decoder_.readSignedVarint32)};jspb.BinaryReader.prototype.readPackedInt32String=function(){return this.readPackedField_(this.decoder_.readSignedVarint32String)};jspb.BinaryReader.prototype.readPackedInt64=function(){return this.readPackedField_(this.decoder_.readSignedVarint64)};jspb.BinaryReader.prototype.readPackedInt64String=function(){return this.readPackedField_(this.decoder_.readSignedVarint64String)};jspb.BinaryReader.prototype.readPackedUint32=function(){return this.readPackedField_(this.decoder_.readUnsignedVarint32)};jspb.BinaryReader.prototype.readPackedUint32String=function(){return this.readPackedField_(this.decoder_.readUnsignedVarint32String)};jspb.BinaryReader.prototype.readPackedUint64=function(){return this.readPackedField_(this.decoder_.readUnsignedVarint64)};jspb.BinaryReader.prototype.readPackedUint64String=function(){return this.readPackedField_(this.decoder_.readUnsignedVarint64String)};jspb.BinaryReader.prototype.readPackedSint32=function(){return this.readPackedField_(this.decoder_.readZigzagVarint32)};jspb.BinaryReader.prototype.readPackedSint64=function(){return this.readPackedField_(this.decoder_.readZigzagVarint64)};jspb.BinaryReader.prototype.readPackedSint64String=function(){return this.readPackedField_(this.decoder_.readZigzagVarint64String)};jspb.BinaryReader.prototype.readPackedFixed32=function(){return this.readPackedField_(this.decoder_.readUint32)};jspb.BinaryReader.prototype.readPackedFixed64=function(){return this.readPackedField_(this.decoder_.readUint64)};jspb.BinaryReader.prototype.readPackedFixed64String=function(){return this.readPackedField_(this.decoder_.readUint64String)};jspb.BinaryReader.prototype.readPackedSfixed32=function(){return this.readPackedField_(this.decoder_.readInt32)};jspb.BinaryReader.prototype.readPackedSfixed64=function(){return this.readPackedField_(this.decoder_.readInt64)};jspb.BinaryReader.prototype.readPackedSfixed64String=function(){return this.readPackedField_(this.decoder_.readInt64String)};jspb.BinaryReader.prototype.readPackedFloat=function(){return this.readPackedField_(this.decoder_.readFloat)};jspb.BinaryReader.prototype.readPackedDouble=function(){return this.readPackedField_(this.decoder_.readDouble)};jspb.BinaryReader.prototype.readPackedBool=function(){return this.readPackedField_(this.decoder_.readBool)};jspb.BinaryReader.prototype.readPackedEnum=function(){return this.readPackedField_(this.decoder_.readEnum)};jspb.BinaryReader.prototype.readPackedVarintHash64=function(){return this.readPackedField_(this.decoder_.readVarintHash64)};jspb.BinaryReader.prototype.readPackedFixedHash64=function(){return this.readPackedField_(this.decoder_.readFixedHash64)};jspb.Map=function(a,b){this.arr_=a;this.valueCtor_=b;this.map_={};this.arrClean=!0;0<this.arr_.length&&this.loadFromArray_()};jspb.Map.prototype.loadFromArray_=function(){for(var a=0;a<this.arr_.length;a++){var b=this.arr_[a],c=b[0];this.map_[c.toString()]=new jspb.Map.Entry_(c,b[1])}
this.arrClean=!0};jspb.Map.prototype.toArray=function(){if(this.arrClean){if(this.valueCtor_){var a=this.map_,b;for(b in a)
if(Object.prototype.hasOwnProperty.call(a,b)){var c=a[b].valueWrapper;c&&c.toArray()}}}else{this.arr_.length=0;a=this.stringKeys_();a.sort();for(b=0;b<a.length;b++){var d=this.map_[a[b]];(c=d.valueWrapper)&&c.toArray();this.arr_.push([d.key,d.value])}
this.arrClean=!0}
return this.arr_};jspb.Map.prototype.toObject=function(a,b){for(var c=this.toArray(),d=[],e=0;e<c.length;e++){var f=this.map_[c[e][0].toString()];this.wrapEntry_(f);var g=f.valueWrapper;g?(goog.asserts.assert(b),d.push([f.key,b(a,g)])):d.push([f.key,f.value])}
return d};jspb.Map.fromObject=function(a,b,c){b=new jspb.Map([],b);for(var d=0;d<a.length;d++){var e=a[d][0],f=c(a[d][1]);b.set(e,f)}
return b};jspb.Map.ArrayIteratorIterable_=function(a){this.idx_=0;this.arr_=a};jspb.Map.ArrayIteratorIterable_.prototype.next=function(){return this.idx_<this.arr_.length?{done:!1,value:this.arr_[this.idx_++]}:{done:!0,value:void 0}};"undefined"!=typeof Symbol&&(jspb.Map.ArrayIteratorIterable_.prototype[Symbol.iterator]=function(){return this});jspb.Map.prototype.getLength=function(){return this.stringKeys_().length};jspb.Map.prototype.clear=function(){this.map_={};this.arrClean=!1};jspb.Map.prototype.del=function(a){a=a.toString();var b=this.map_.hasOwnProperty(a);delete this.map_[a];this.arrClean=!1;return b};jspb.Map.prototype.getEntryList=function(){var a=[],b=this.stringKeys_();b.sort();for(var c=0;c<b.length;c++){var d=this.map_[b[c]];a.push([d.key,d.value])}
return a};jspb.Map.prototype.entries=function(){var a=[],b=this.stringKeys_();b.sort();for(var c=0;c<b.length;c++){var d=this.map_[b[c]];a.push([d.key,this.wrapEntry_(d)])}
return new jspb.Map.ArrayIteratorIterable_(a)};jspb.Map.prototype.keys=function(){var a=[],b=this.stringKeys_();b.sort();for(var c=0;c<b.length;c++)a.push(this.map_[b[c]].key);return new jspb.Map.ArrayIteratorIterable_(a)};jspb.Map.prototype.values=function(){var a=[],b=this.stringKeys_();b.sort();for(var c=0;c<b.length;c++)a.push(this.wrapEntry_(this.map_[b[c]]));return new jspb.Map.ArrayIteratorIterable_(a)};jspb.Map.prototype.forEach=function(a,b){var c=this.stringKeys_();c.sort();for(var d=0;d<c.length;d++){var e=this.map_[c[d]];a.call(b,this.wrapEntry_(e),e.key,this)}};jspb.Map.prototype.set=function(a,b){var c=new jspb.Map.Entry_(a);this.valueCtor_?(c.valueWrapper=b,c.value=b.toArray()):c.value=b;this.map_[a.toString()]=c;this.arrClean=!1;return this};jspb.Map.prototype.wrapEntry_=function(a){return this.valueCtor_?(a.valueWrapper||(a.valueWrapper=new this.valueCtor_(a.value)),a.valueWrapper):a.value};jspb.Map.prototype.get=function(a){if(a=this.map_[a.toString()])return this.wrapEntry_(a)};jspb.Map.prototype.has=function(a){return a.toString()in this.map_};jspb.Map.prototype.serializeBinary=function(a,b,c,d,e){var f=this.stringKeys_();f.sort();for(var g=0;g<f.length;g++){var h=this.map_[f[g]];b.beginSubMessage(a);c.call(b,1,h.key);this.valueCtor_?d.call(b,2,this.wrapEntry_(h),e):d.call(b,2,h.value);b.endSubMessage()}};jspb.Map.deserializeBinary=function(a,b,c,d,e,f,g){for(;b.nextField()&&!b.isEndGroup();){var h=b.getFieldNumber();1==h?f=c.call(b):2==h&&(a.valueCtor_?(goog.asserts.assert(e),g||(g=new a.valueCtor_),d.call(b,g,e)):g=d.call(b))}
goog.asserts.assert(void 0!=f);goog.asserts.assert(void 0!=g);a.set(f,g)};jspb.Map.prototype.stringKeys_=function(){var a=this.map_,b=[],c;for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b};jspb.Map.Entry_=function(a,b){this.key=a;this.value=b;this.valueWrapper=void 0};jspb.ExtensionFieldInfo=function(a,b,c,d,e){this.fieldIndex=a;this.fieldName=b;this.ctor=c;this.toObjectFn=d;this.isRepeated=e};jspb.ExtensionFieldBinaryInfo=function(a,b,c,d,e,f){this.fieldInfo=a;this.binaryReaderFn=b;this.binaryWriterFn=c;this.binaryMessageSerializeFn=d;this.binaryMessageDeserializeFn=e;this.isPacked=f};jspb.ExtensionFieldInfo.prototype.isMessageType=function(){return!!this.ctor};jspb.Message=function(){};jspb.Message.GENERATE_TO_OBJECT=!0;jspb.Message.GENERATE_FROM_OBJECT=!goog.DISALLOW_TEST_ONLY_CODE;jspb.Message.GENERATE_TO_STRING=!0;jspb.Message.ASSUME_LOCAL_ARRAYS=!1;jspb.Message.SERIALIZE_EMPTY_TRAILING_FIELDS=!0;jspb.Message.SUPPORTS_UINT8ARRAY_="function"==typeof Uint8Array;jspb.Message.prototype.getJsPbMessageId=function(){return this.messageId_};jspb.Message.getIndex_=function(a,b){return b+a.arrayIndexOffset_};jspb.Message.hiddenES6Property_=function(){};jspb.Message.getFieldNumber_=function(a,b){return b-a.arrayIndexOffset_};jspb.Message.initialize=function(a,b,c,d,e,f){a.wrappers_=null;b||(b=c?[c]:[]);a.messageId_=c?String(c):void 0;a.arrayIndexOffset_=0===c?-1:0;a.array=b;jspb.Message.initPivotAndExtensionObject_(a,d);a.convertedPrimitiveFields_={};jspb.Message.SERIALIZE_EMPTY_TRAILING_FIELDS||(a.repeatedFields=e);if(e)
for(b=0;b<e.length;b++)c=e[b],c<a.pivot_?(c=jspb.Message.getIndex_(a,c),a.array[c]=a.array[c]||jspb.Message.EMPTY_LIST_SENTINEL_):(jspb.Message.maybeInitEmptyExtensionObject_(a),a.extensionObject_[c]=a.extensionObject_[c]||jspb.Message.EMPTY_LIST_SENTINEL_);if(f&&f.length)
for(b=0;b<f.length;b++)jspb.Message.computeOneofCase(a,f[b])};jspb.Message.EMPTY_LIST_SENTINEL_=goog.DEBUG&&Object.freeze?Object.freeze([]):[];jspb.Message.isArray_=function(a){return jspb.Message.ASSUME_LOCAL_ARRAYS?a instanceof Array:goog.isArray(a)};jspb.Message.isExtensionObject_=function(a){return null!==a&&"object"==typeof a&&!jspb.Message.isArray_(a)&&!(jspb.Message.SUPPORTS_UINT8ARRAY_&&a instanceof Uint8Array)};jspb.Message.initPivotAndExtensionObject_=function(a,b){var c=a.array.length,d=-1;if(c&&(d=c-1,c=a.array[d],jspb.Message.isExtensionObject_(c))){a.pivot_=jspb.Message.getFieldNumber_(a,d);a.extensionObject_=c;return}-1<b?(a.pivot_=Math.max(b,jspb.Message.getFieldNumber_(a,d+1)),a.extensionObject_=null):a.pivot_=Number.MAX_VALUE};jspb.Message.maybeInitEmptyExtensionObject_=function(a){var b=jspb.Message.getIndex_(a,a.pivot_);a.array[b]||(a.extensionObject_=a.array[b]={})};jspb.Message.toObjectList=function(a,b,c){for(var d=[],e=0;e<a.length;e++)d[e]=b.call(a[e],c,a[e]);return d};jspb.Message.toObjectExtension=function(a,b,c,d,e){for(var f in c){var g=c[f],h=d.call(a,g);if(null!=h){for(var k in g.fieldName)
if(g.fieldName.hasOwnProperty(k))break;b[k]=g.toObjectFn?g.isRepeated?jspb.Message.toObjectList(h,g.toObjectFn,e):g.toObjectFn(e,h):h}}};jspb.Message.serializeBinaryExtensions=function(a,b,c,d){for(var e in c){var f=c[e],g=f.fieldInfo;if(!f.binaryWriterFn)throw Error("Message extension present that was generated without binary serialization support");var h=d.call(a,g);if(null!=h)
if(g.isMessageType())
if(f.binaryMessageSerializeFn)f.binaryWriterFn.call(b,g.fieldIndex,h,f.binaryMessageSerializeFn);else throw Error("Message extension present holding submessage without binary support enabled, and message is being serialized to binary format");else f.binaryWriterFn.call(b,g.fieldIndex,h)}};jspb.Message.readBinaryExtension=function(a,b,c,d,e){var f=c[b.getFieldNumber()];if(f){c=f.fieldInfo;if(!f.binaryReaderFn)throw Error("Deserializing extension whose generated code does not support binary format");if(c.isMessageType()){var g=new c.ctor;f.binaryReaderFn.call(b,g,f.binaryMessageDeserializeFn)}else g=f.binaryReaderFn.call(b);c.isRepeated&&!f.isPacked?(b=d.call(a,c))?b.push(g):e.call(a,c,[g]):e.call(a,c,g)}else b.skipField()};jspb.Message.getField=function(a,b){if(b<a.pivot_){b=jspb.Message.getIndex_(a,b);var c=a.array[b];return c===jspb.Message.EMPTY_LIST_SENTINEL_?a.array[b]=[]:c}
if(a.extensionObject_)return c=a.extensionObject_[b],c===jspb.Message.EMPTY_LIST_SENTINEL_?a.extensionObject_[b]=[]:c};jspb.Message.getRepeatedField=function(a,b){return jspb.Message.getField(a,b)};jspb.Message.getOptionalFloatingPointField=function(a,b){a=jspb.Message.getField(a,b);return null==a?a:+a};jspb.Message.getBooleanField=function(a,b){a=jspb.Message.getField(a,b);return null==a?a:!!a};jspb.Message.getRepeatedFloatingPointField=function(a,b){var c=jspb.Message.getRepeatedField(a,b);a.convertedPrimitiveFields_||(a.convertedPrimitiveFields_={});if(!a.convertedPrimitiveFields_[b]){for(var d=0;d<c.length;d++)c[d]=+c[d];a.convertedPrimitiveFields_[b]=!0}
return c};jspb.Message.getRepeatedBooleanField=function(a,b){var c=jspb.Message.getRepeatedField(a,b);a.convertedPrimitiveFields_||(a.convertedPrimitiveFields_={});if(!a.convertedPrimitiveFields_[b]){for(var d=0;d<c.length;d++)c[d]=!!c[d];a.convertedPrimitiveFields_[b]=!0}
return c};jspb.Message.bytesAsB64=function(a){if(null==a||"string"===typeof a)return a;if(jspb.Message.SUPPORTS_UINT8ARRAY_&&a instanceof Uint8Array)return goog.crypt.base64.encodeByteArray(a);goog.asserts.fail("Cannot coerce to b64 string: "+goog.typeOf(a));return null};jspb.Message.bytesAsU8=function(a){if(null==a||a instanceof Uint8Array)return a;if("string"===typeof a)return goog.crypt.base64.decodeStringToUint8Array(a);goog.asserts.fail("Cannot coerce to Uint8Array: "+goog.typeOf(a));return null};jspb.Message.bytesListAsB64=function(a){jspb.Message.assertConsistentTypes_(a);return a.length&&"string"!==typeof a[0]?goog.array.map(a,jspb.Message.bytesAsB64):a};jspb.Message.bytesListAsU8=function(a){jspb.Message.assertConsistentTypes_(a);return!a.length||a[0]instanceof Uint8Array?a:goog.array.map(a,jspb.Message.bytesAsU8)};jspb.Message.assertConsistentTypes_=function(a){if(goog.DEBUG&&a&&1<a.length){var b=goog.typeOf(a[0]);goog.array.forEach(a,function(a){goog.typeOf(a)!=b&&goog.asserts.fail("Inconsistent type in JSPB repeated field array. Got "+goog.typeOf(a)+" expected "+b)})}};jspb.Message.getFieldWithDefault=function(a,b,c){a=jspb.Message.getField(a,b);return null==a?c:a};jspb.Message.getBooleanFieldWithDefault=function(a,b,c){a=jspb.Message.getBooleanField(a,b);return null==a?c:a};jspb.Message.getFloatingPointFieldWithDefault=function(a,b,c){a=jspb.Message.getOptionalFloatingPointField(a,b);return null==a?c:a};jspb.Message.getFieldProto3=jspb.Message.getFieldWithDefault;jspb.Message.getMapField=function(a,b,c,d){a.wrappers_||(a.wrappers_={});if(b in a.wrappers_)return a.wrappers_[b];var e=jspb.Message.getField(a,b);if(!e){if(c)return;e=[];jspb.Message.setField(a,b,e)}
return a.wrappers_[b]=new jspb.Map(e,d)};jspb.Message.setField=function(a,b,c){goog.asserts.assertInstanceof(a,jspb.Message);b<a.pivot_?a.array[jspb.Message.getIndex_(a,b)]=c:(jspb.Message.maybeInitEmptyExtensionObject_(a),a.extensionObject_[b]=c);return a};jspb.Message.setProto3IntField=function(a,b,c){return jspb.Message.setFieldIgnoringDefault_(a,b,c,0)};jspb.Message.setProto3FloatField=function(a,b,c){return jspb.Message.setFieldIgnoringDefault_(a,b,c,0)};jspb.Message.setProto3BooleanField=function(a,b,c){return jspb.Message.setFieldIgnoringDefault_(a,b,c,!1)};jspb.Message.setProto3StringField=function(a,b,c){return jspb.Message.setFieldIgnoringDefault_(a,b,c,"")};jspb.Message.setProto3BytesField=function(a,b,c){return jspb.Message.setFieldIgnoringDefault_(a,b,c,"")};jspb.Message.setProto3EnumField=function(a,b,c){return jspb.Message.setFieldIgnoringDefault_(a,b,c,0)};jspb.Message.setProto3StringIntField=function(a,b,c){return jspb.Message.setFieldIgnoringDefault_(a,b,c,"0")};jspb.Message.setFieldIgnoringDefault_=function(a,b,c,d){goog.asserts.assertInstanceof(a,jspb.Message);c!==d?jspb.Message.setField(a,b,c):b<a.pivot_?a.array[jspb.Message.getIndex_(a,b)]=null:(jspb.Message.maybeInitEmptyExtensionObject_(a),delete a.extensionObject_[b]);return a};jspb.Message.addToRepeatedField=function(a,b,c,d){goog.asserts.assertInstanceof(a,jspb.Message);b=jspb.Message.getRepeatedField(a,b);void 0!=d?b.splice(d,0,c):b.push(c);return a};jspb.Message.setOneofField=function(a,b,c,d){goog.asserts.assertInstanceof(a,jspb.Message);(c=jspb.Message.computeOneofCase(a,c))&&c!==b&&void 0!==d&&(a.wrappers_&&c in a.wrappers_&&(a.wrappers_[c]=void 0),jspb.Message.setField(a,c,void 0));return jspb.Message.setField(a,b,d)};jspb.Message.computeOneofCase=function(a,b){for(var c,d,e=0;e<b.length;e++){var f=b[e],g=jspb.Message.getField(a,f);null!=g&&(c=f,d=g,jspb.Message.setField(a,f,void 0))}
return c?(jspb.Message.setField(a,c,d),c):0};jspb.Message.getWrapperField=function(a,b,c,d){a.wrappers_||(a.wrappers_={});if(!a.wrappers_[c]){var e=jspb.Message.getField(a,c);if(d||e)a.wrappers_[c]=new b(e)}
return a.wrappers_[c]};jspb.Message.getRepeatedWrapperField=function(a,b,c){jspb.Message.wrapRepeatedField_(a,b,c);b=a.wrappers_[c];b==jspb.Message.EMPTY_LIST_SENTINEL_&&(b=a.wrappers_[c]=[]);return b};jspb.Message.wrapRepeatedField_=function(a,b,c){a.wrappers_||(a.wrappers_={});if(!a.wrappers_[c]){for(var d=jspb.Message.getRepeatedField(a,c),e=[],f=0;f<d.length;f++)e[f]=new b(d[f]);a.wrappers_[c]=e}};jspb.Message.setWrapperField=function(a,b,c){goog.asserts.assertInstanceof(a,jspb.Message);a.wrappers_||(a.wrappers_={});var d=c?c.toArray():c;a.wrappers_[b]=c;return jspb.Message.setField(a,b,d)};jspb.Message.setOneofWrapperField=function(a,b,c,d){goog.asserts.assertInstanceof(a,jspb.Message);a.wrappers_||(a.wrappers_={});var e=d?d.toArray():d;a.wrappers_[b]=d;return jspb.Message.setOneofField(a,b,c,e)};jspb.Message.setRepeatedWrapperField=function(a,b,c){goog.asserts.assertInstanceof(a,jspb.Message);a.wrappers_||(a.wrappers_={});c=c||[];for(var d=[],e=0;e<c.length;e++)d[e]=c[e].toArray();a.wrappers_[b]=c;return jspb.Message.setField(a,b,d)};jspb.Message.addToRepeatedWrapperField=function(a,b,c,d,e){jspb.Message.wrapRepeatedField_(a,d,b);var f=a.wrappers_[b];f||(f=a.wrappers_[b]=[]);c=c?c:new d;a=jspb.Message.getRepeatedField(a,b);void 0!=e?(f.splice(e,0,c),a.splice(e,0,c.toArray())):(f.push(c),a.push(c.toArray()));return c};jspb.Message.toMap=function(a,b,c,d){for(var e={},f=0;f<a.length;f++)e[b.call(a[f])]=c?c.call(a[f],d,a[f]):a[f];return e};jspb.Message.prototype.syncMapFields_=function(){if(this.wrappers_)
for(var a in this.wrappers_){var b=this.wrappers_[a];if(goog.isArray(b))
for(var c=0;c<b.length;c++)b[c]&&b[c].toArray();else b&&b.toArray()}};jspb.Message.prototype.toArray=function(){this.syncMapFields_();return this.array};jspb.Message.GENERATE_TO_STRING&&(jspb.Message.prototype.toString=function(){this.syncMapFields_();return this.array.toString()});jspb.Message.prototype.getExtension=function(a){if(this.extensionObject_){this.wrappers_||(this.wrappers_={});var b=a.fieldIndex;if(a.isRepeated){if(a.isMessageType())return this.wrappers_[b]||(this.wrappers_[b]=goog.array.map(this.extensionObject_[b]||[],function(b){return new a.ctor(b)})),this.wrappers_[b]}else if(a.isMessageType())return!this.wrappers_[b]&&this.extensionObject_[b]&&(this.wrappers_[b]=new a.ctor(this.extensionObject_[b])),this.wrappers_[b];return this.extensionObject_[b]}};jspb.Message.prototype.setExtension=function(a,b){this.wrappers_||(this.wrappers_={});jspb.Message.maybeInitEmptyExtensionObject_(this);var c=a.fieldIndex;a.isRepeated?(b=b||[],a.isMessageType()?(this.wrappers_[c]=b,this.extensionObject_[c]=goog.array.map(b,function(a){return a.toArray()})):this.extensionObject_[c]=b):a.isMessageType()?(this.wrappers_[c]=b,this.extensionObject_[c]=b?b.toArray():b):this.extensionObject_[c]=b;return this};jspb.Message.difference=function(a,b){if(!(a instanceof b.constructor))throw Error("Messages have different types.");var c=a.toArray();b=b.toArray();var d=[],e=0,f=c.length>b.length?c.length:b.length;a.getJsPbMessageId()&&(d[0]=a.getJsPbMessageId(),e=1);for(;e<f;e++)jspb.Message.compareFields(c[e],b[e])||(d[e]=b[e]);return new a.constructor(d)};jspb.Message.equals=function(a,b){return a==b||!(!a||!b)&&a instanceof b.constructor&&jspb.Message.compareFields(a.toArray(),b.toArray())};jspb.Message.compareExtensions=function(a,b){a=a||{};b=b||{};var c={},d;for(d in a)c[d]=0;for(d in b)c[d]=0;for(d in c)
if(!jspb.Message.compareFields(a[d],b[d]))return!1;return!0};jspb.Message.compareFields=function(a,b){if(a==b)return!0;if(!goog.isObject(a)||!goog.isObject(b))return"number"===typeof a&&isNaN(a)||"number"===typeof b&&isNaN(b)?String(a)==String(b):!1;if(a.constructor!=b.constructor)return!1;if(jspb.Message.SUPPORTS_UINT8ARRAY_&&a.constructor===Uint8Array){if(a.length!=b.length)return!1;for(var c=0;c<a.length;c++)
if(a[c]!=b[c])return!1;return!0}
if(a.constructor===Array){var d=void 0,e=void 0,f=Math.max(a.length,b.length);for(c=0;c<f;c++){var g=a[c],h=b[c];g&&g.constructor==Object&&(goog.asserts.assert(void 0===d),goog.asserts.assert(c===a.length-1),d=g,g=void 0);h&&h.constructor==Object&&(goog.asserts.assert(void 0===e),goog.asserts.assert(c===b.length-1),e=h,h=void 0);if(!jspb.Message.compareFields(g,h))return!1}
return d||e?(d=d||{},e=e||{},jspb.Message.compareExtensions(d,e)):!0}
if(a.constructor===Object)return jspb.Message.compareExtensions(a,b);throw Error("Invalid type in JSPB array");};jspb.Message.prototype.cloneMessage=function(){return jspb.Message.cloneMessage(this)};jspb.Message.prototype.clone=function(){return jspb.Message.cloneMessage(this)};jspb.Message.clone=function(a){return jspb.Message.cloneMessage(a)};jspb.Message.cloneMessage=function(a){return new a.constructor(jspb.Message.clone_(a.toArray()))};jspb.Message.copyInto=function(a,b){goog.asserts.assertInstanceof(a,jspb.Message);goog.asserts.assertInstanceof(b,jspb.Message);goog.asserts.assert(a.constructor==b.constructor,"Copy source and target message should have the same type.");a=jspb.Message.clone(a);for(var c=b.toArray(),d=a.toArray(),e=c.length=0;e<d.length;e++)c[e]=d[e];b.wrappers_=a.wrappers_;b.extensionObject_=a.extensionObject_};jspb.Message.clone_=function(a){if(goog.isArray(a)){for(var b=Array(a.length),c=0;c<a.length;c++){var d=a[c];null!=d&&(b[c]="object"==typeof d?jspb.Message.clone_(goog.asserts.assert(d)):d)}
return b}
if(jspb.Message.SUPPORTS_UINT8ARRAY_&&a instanceof Uint8Array)return new Uint8Array(a);b={};for(c in a)d=a[c],null!=d&&(b[c]="object"==typeof d?jspb.Message.clone_(goog.asserts.assert(d)):d);return b};jspb.Message.registerMessageType=function(a,b){b.messageId=a};jspb.Message.messageSetExtensions={};jspb.Message.messageSetExtensionsBinary={};jspb.arith={};jspb.arith.UInt64=function(a,b){this.lo=a;this.hi=b};jspb.arith.UInt64.prototype.cmp=function(a){return this.hi<a.hi||this.hi==a.hi&&this.lo<a.lo?-1:this.hi==a.hi&&this.lo==a.lo?0:1};jspb.arith.UInt64.prototype.rightShift=function(){return new jspb.arith.UInt64((this.lo>>>1|(this.hi&1)<<31)>>>0,this.hi>>>1>>>0)};jspb.arith.UInt64.prototype.leftShift=function(){return new jspb.arith.UInt64(this.lo<<1>>>0,(this.hi<<1|this.lo>>>31)>>>0)};jspb.arith.UInt64.prototype.msb=function(){return!!(this.hi&2147483648)};jspb.arith.UInt64.prototype.lsb=function(){return!!(this.lo&1)};jspb.arith.UInt64.prototype.zero=function(){return 0==this.lo&&0==this.hi};jspb.arith.UInt64.prototype.add=function(a){return new jspb.arith.UInt64((this.lo+a.lo&4294967295)>>>0>>>0,((this.hi+a.hi&4294967295)>>>0)+(4294967296<=this.lo+a.lo?1:0)>>>0)};jspb.arith.UInt64.prototype.sub=function(a){return new jspb.arith.UInt64((this.lo-a.lo&4294967295)>>>0>>>0,((this.hi-a.hi&4294967295)>>>0)-(0>this.lo-a.lo?1:0)>>>0)};jspb.arith.UInt64.mul32x32=function(a,b){var c=a&65535;a>>>=16;var d=b&65535,e=b>>>16;b=c*d+65536*(c*e&65535)+65536*(a*d&65535);for(c=a*e+(c*e>>>16)+(a*d>>>16);4294967296<=b;)b-=4294967296,c+=1;return new jspb.arith.UInt64(b>>>0,c>>>0)};jspb.arith.UInt64.prototype.mul=function(a){var b=jspb.arith.UInt64.mul32x32(this.lo,a);a=jspb.arith.UInt64.mul32x32(this.hi,a);a.hi=a.lo;a.lo=0;return b.add(a)};jspb.arith.UInt64.prototype.div=function(a){if(0==a)return[];var b=new jspb.arith.UInt64(0,0),c=new jspb.arith.UInt64(this.lo,this.hi);a=new jspb.arith.UInt64(a,0);for(var d=new jspb.arith.UInt64(1,0);!a.msb();)a=a.leftShift(),d=d.leftShift();for(;!d.zero();)0>=a.cmp(c)&&(b=b.add(d),c=c.sub(a)),a=a.rightShift(),d=d.rightShift();return[b,c]};jspb.arith.UInt64.prototype.toString=function(){for(var a="",b=this;!b.zero();){b=b.div(10);var c=b[0];a=b[1].lo+a;b=c}""==a&&(a="0");return a};jspb.arith.UInt64.fromString=function(a){for(var b=new jspb.arith.UInt64(0,0),c=new jspb.arith.UInt64(0,0),d=0;d<a.length;d++){if("0">a[d]||"9"<a[d])return null;var e=parseInt(a[d],10);c.lo=e;b=b.mul(10).add(c)}
return b};jspb.arith.UInt64.prototype.clone=function(){return new jspb.arith.UInt64(this.lo,this.hi)};jspb.arith.Int64=function(a,b){this.lo=a;this.hi=b};jspb.arith.Int64.prototype.add=function(a){return new jspb.arith.Int64((this.lo+a.lo&4294967295)>>>0>>>0,((this.hi+a.hi&4294967295)>>>0)+(4294967296<=this.lo+a.lo?1:0)>>>0)};jspb.arith.Int64.prototype.sub=function(a){return new jspb.arith.Int64((this.lo-a.lo&4294967295)>>>0>>>0,((this.hi-a.hi&4294967295)>>>0)-(0>this.lo-a.lo?1:0)>>>0)};jspb.arith.Int64.prototype.clone=function(){return new jspb.arith.Int64(this.lo,this.hi)};jspb.arith.Int64.prototype.toString=function(){var a=0!=(this.hi&2147483648),b=new jspb.arith.UInt64(this.lo,this.hi);a&&(b=(new jspb.arith.UInt64(0,0)).sub(b));return(a?"-":"")+b.toString()};jspb.arith.Int64.fromString=function(a){var b=0<a.length&&"-"==a[0];b&&(a=a.substring(1));a=jspb.arith.UInt64.fromString(a);if(null===a)return null;b&&(a=(new jspb.arith.UInt64(0,0)).sub(a));return new jspb.arith.Int64(a.lo,a.hi)};jspb.BinaryEncoder=function(){this.buffer_=[]};jspb.BinaryEncoder.prototype.length=function(){return this.buffer_.length};jspb.BinaryEncoder.prototype.end=function(){var a=this.buffer_;this.buffer_=[];return a};jspb.BinaryEncoder.prototype.writeSplitVarint64=function(a,b){goog.asserts.assert(a==Math.floor(a));goog.asserts.assert(b==Math.floor(b));goog.asserts.assert(0<=a&&a<jspb.BinaryConstants.TWO_TO_32);for(goog.asserts.assert(0<=b&&b<jspb.BinaryConstants.TWO_TO_32);0<b||127<a;)this.buffer_.push(a&127|128),a=(a>>>7|b<<25)>>>0,b>>>=7;this.buffer_.push(a)};jspb.BinaryEncoder.prototype.writeSplitFixed64=function(a,b){goog.asserts.assert(a==Math.floor(a));goog.asserts.assert(b==Math.floor(b));goog.asserts.assert(0<=a&&a<jspb.BinaryConstants.TWO_TO_32);goog.asserts.assert(0<=b&&b<jspb.BinaryConstants.TWO_TO_32);this.writeUint32(a);this.writeUint32(b)};jspb.BinaryEncoder.prototype.writeUnsignedVarint32=function(a){goog.asserts.assert(a==Math.floor(a));for(goog.asserts.assert(0<=a&&a<jspb.BinaryConstants.TWO_TO_32);127<a;)this.buffer_.push(a&127|128),a>>>=7;this.buffer_.push(a)};jspb.BinaryEncoder.prototype.writeSignedVarint32=function(a){goog.asserts.assert(a==Math.floor(a));goog.asserts.assert(a>=-jspb.BinaryConstants.TWO_TO_31&&a<jspb.BinaryConstants.TWO_TO_31);if(0<=a)this.writeUnsignedVarint32(a);else{for(var b=0;9>b;b++)this.buffer_.push(a&127|128),a>>=7;this.buffer_.push(1)}};jspb.BinaryEncoder.prototype.writeUnsignedVarint64=function(a){goog.asserts.assert(a==Math.floor(a));goog.asserts.assert(0<=a&&a<jspb.BinaryConstants.TWO_TO_64);jspb.utils.splitInt64(a);this.writeSplitVarint64(jspb.utils.split64Low,jspb.utils.split64High)};jspb.BinaryEncoder.prototype.writeSignedVarint64=function(a){goog.asserts.assert(a==Math.floor(a));goog.asserts.assert(a>=-jspb.BinaryConstants.TWO_TO_63&&a<jspb.BinaryConstants.TWO_TO_63);jspb.utils.splitInt64(a);this.writeSplitVarint64(jspb.utils.split64Low,jspb.utils.split64High)};jspb.BinaryEncoder.prototype.writeZigzagVarint32=function(a){goog.asserts.assert(a==Math.floor(a));goog.asserts.assert(a>=-jspb.BinaryConstants.TWO_TO_31&&a<jspb.BinaryConstants.TWO_TO_31);this.writeUnsignedVarint32((a<<1^a>>31)>>>0)};jspb.BinaryEncoder.prototype.writeZigzagVarint64=function(a){goog.asserts.assert(a==Math.floor(a));goog.asserts.assert(a>=-jspb.BinaryConstants.TWO_TO_63&&a<jspb.BinaryConstants.TWO_TO_63);jspb.utils.splitZigzag64(a);this.writeSplitVarint64(jspb.utils.split64Low,jspb.utils.split64High)};jspb.BinaryEncoder.prototype.writeZigzagVarint64String=function(a){this.writeZigzagVarintHash64(jspb.utils.decimalStringToHash64(a))};jspb.BinaryEncoder.prototype.writeZigzagVarintHash64=function(a){var b=this;jspb.utils.splitHash64(a);jspb.utils.toZigzag64(jspb.utils.split64Low,jspb.utils.split64High,function(a,d){b.writeSplitVarint64(a>>>0,d>>>0)})};jspb.BinaryEncoder.prototype.writeUint8=function(a){goog.asserts.assert(a==Math.floor(a));goog.asserts.assert(0<=a&&256>a);this.buffer_.push(a>>>0&255)};jspb.BinaryEncoder.prototype.writeUint16=function(a){goog.asserts.assert(a==Math.floor(a));goog.asserts.assert(0<=a&&65536>a);this.buffer_.push(a>>>0&255);this.buffer_.push(a>>>8&255)};jspb.BinaryEncoder.prototype.writeUint32=function(a){goog.asserts.assert(a==Math.floor(a));goog.asserts.assert(0<=a&&a<jspb.BinaryConstants.TWO_TO_32);this.buffer_.push(a>>>0&255);this.buffer_.push(a>>>8&255);this.buffer_.push(a>>>16&255);this.buffer_.push(a>>>24&255)};jspb.BinaryEncoder.prototype.writeUint64=function(a){goog.asserts.assert(a==Math.floor(a));goog.asserts.assert(0<=a&&a<jspb.BinaryConstants.TWO_TO_64);jspb.utils.splitUint64(a);this.writeUint32(jspb.utils.split64Low);this.writeUint32(jspb.utils.split64High)};jspb.BinaryEncoder.prototype.writeInt8=function(a){goog.asserts.assert(a==Math.floor(a));goog.asserts.assert(-128<=a&&128>a);this.buffer_.push(a>>>0&255)};jspb.BinaryEncoder.prototype.writeInt16=function(a){goog.asserts.assert(a==Math.floor(a));goog.asserts.assert(-32768<=a&&32768>a);this.buffer_.push(a>>>0&255);this.buffer_.push(a>>>8&255)};jspb.BinaryEncoder.prototype.writeInt32=function(a){goog.asserts.assert(a==Math.floor(a));goog.asserts.assert(a>=-jspb.BinaryConstants.TWO_TO_31&&a<jspb.BinaryConstants.TWO_TO_31);this.buffer_.push(a>>>0&255);this.buffer_.push(a>>>8&255);this.buffer_.push(a>>>16&255);this.buffer_.push(a>>>24&255)};jspb.BinaryEncoder.prototype.writeInt64=function(a){goog.asserts.assert(a==Math.floor(a));goog.asserts.assert(a>=-jspb.BinaryConstants.TWO_TO_63&&a<jspb.BinaryConstants.TWO_TO_63);jspb.utils.splitInt64(a);this.writeSplitFixed64(jspb.utils.split64Low,jspb.utils.split64High)};jspb.BinaryEncoder.prototype.writeInt64String=function(a){goog.asserts.assert(a==Math.floor(a));goog.asserts.assert(+a>=-jspb.BinaryConstants.TWO_TO_63&&+a<jspb.BinaryConstants.TWO_TO_63);jspb.utils.splitHash64(jspb.utils.decimalStringToHash64(a));this.writeSplitFixed64(jspb.utils.split64Low,jspb.utils.split64High)};jspb.BinaryEncoder.prototype.writeFloat=function(a){goog.asserts.assert(Infinity===a||-Infinity===a||isNaN(a)||a>=-jspb.BinaryConstants.FLOAT32_MAX&&a<=jspb.BinaryConstants.FLOAT32_MAX);jspb.utils.splitFloat32(a);this.writeUint32(jspb.utils.split64Low)};jspb.BinaryEncoder.prototype.writeDouble=function(a){goog.asserts.assert(Infinity===a||-Infinity===a||isNaN(a)||a>=-jspb.BinaryConstants.FLOAT64_MAX&&a<=jspb.BinaryConstants.FLOAT64_MAX);jspb.utils.splitFloat64(a);this.writeUint32(jspb.utils.split64Low);this.writeUint32(jspb.utils.split64High)};jspb.BinaryEncoder.prototype.writeBool=function(a){goog.asserts.assert("boolean"===typeof a||"number"===typeof a);this.buffer_.push(a?1:0)};jspb.BinaryEncoder.prototype.writeEnum=function(a){goog.asserts.assert(a==Math.floor(a));goog.asserts.assert(a>=-jspb.BinaryConstants.TWO_TO_31&&a<jspb.BinaryConstants.TWO_TO_31);this.writeSignedVarint32(a)};jspb.BinaryEncoder.prototype.writeBytes=function(a){this.buffer_.push.apply(this.buffer_,a)};jspb.BinaryEncoder.prototype.writeVarintHash64=function(a){jspb.utils.splitHash64(a);this.writeSplitVarint64(jspb.utils.split64Low,jspb.utils.split64High)};jspb.BinaryEncoder.prototype.writeFixedHash64=function(a){jspb.utils.splitHash64(a);this.writeUint32(jspb.utils.split64Low);this.writeUint32(jspb.utils.split64High)};jspb.BinaryEncoder.prototype.writeString=function(a){for(var b=this.buffer_.length,c=0;c<a.length;c++){var d=a.charCodeAt(c);if(128>d)this.buffer_.push(d);else if(2048>d)this.buffer_.push(d>>6|192),this.buffer_.push(d&63|128);else if(65536>d)
if(55296<=d&&56319>=d&&c+1<a.length){var e=a.charCodeAt(c+1);56320<=e&&57343>=e&&(d=1024*(d-55296)+e-56320+65536,this.buffer_.push(d>>18|240),this.buffer_.push(d>>12&63|128),this.buffer_.push(d>>6&63|128),this.buffer_.push(d&63|128),c++)}else this.buffer_.push(d>>12|224),this.buffer_.push(d>>6&63|128),this.buffer_.push(d&63|128)}
return this.buffer_.length-b};jspb.BinaryWriter=function(){this.blocks_=[];this.totalLength_=0;this.encoder_=new jspb.BinaryEncoder;this.bookmarks_=[]};jspb.BinaryWriter.prototype.appendUint8Array_=function(a){var b=this.encoder_.end();this.blocks_.push(b);this.blocks_.push(a);this.totalLength_+=b.length+a.length};jspb.BinaryWriter.prototype.beginDelimited_=function(a){this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.DELIMITED);a=this.encoder_.end();this.blocks_.push(a);this.totalLength_+=a.length;a.push(this.totalLength_);return a};jspb.BinaryWriter.prototype.endDelimited_=function(a){var b=a.pop();b=this.totalLength_+this.encoder_.length()-b;for(goog.asserts.assert(0<=b);127<b;)a.push(b&127|128),b>>>=7,this.totalLength_++;a.push(b);this.totalLength_++};jspb.BinaryWriter.prototype.writeSerializedMessage=function(a,b,c){this.appendUint8Array_(a.subarray(b,c))};jspb.BinaryWriter.prototype.maybeWriteSerializedMessage=function(a,b,c){null!=a&&null!=b&&null!=c&&this.writeSerializedMessage(a,b,c)};jspb.BinaryWriter.prototype.reset=function(){this.blocks_=[];this.encoder_.end();this.totalLength_=0;this.bookmarks_=[]};jspb.BinaryWriter.prototype.getResultBuffer=function(){goog.asserts.assert(0==this.bookmarks_.length);for(var a=new Uint8Array(this.totalLength_+this.encoder_.length()),b=this.blocks_,c=b.length,d=0,e=0;e<c;e++){var f=b[e];a.set(f,d);d+=f.length}
b=this.encoder_.end();a.set(b,d);d+=b.length;goog.asserts.assert(d==a.length);this.blocks_=[a];return a};jspb.BinaryWriter.prototype.getResultBase64String=function(a){return goog.crypt.base64.encodeByteArray(this.getResultBuffer(),a)};jspb.BinaryWriter.prototype.beginSubMessage=function(a){this.bookmarks_.push(this.beginDelimited_(a))};jspb.BinaryWriter.prototype.endSubMessage=function(){goog.asserts.assert(0<=this.bookmarks_.length);this.endDelimited_(this.bookmarks_.pop())};jspb.BinaryWriter.prototype.writeFieldHeader_=function(a,b){goog.asserts.assert(1<=a&&a==Math.floor(a));this.encoder_.writeUnsignedVarint32(8*a+b)};jspb.BinaryWriter.prototype.writeAny=function(a,b,c){var d=jspb.BinaryConstants.FieldType;switch(a){case d.DOUBLE:this.writeDouble(b,c);break;case d.FLOAT:this.writeFloat(b,c);break;case d.INT64:this.writeInt64(b,c);break;case d.UINT64:this.writeUint64(b,c);break;case d.INT32:this.writeInt32(b,c);break;case d.FIXED64:this.writeFixed64(b,c);break;case d.FIXED32:this.writeFixed32(b,c);break;case d.BOOL:this.writeBool(b,c);break;case d.STRING:this.writeString(b,c);break;case d.GROUP:goog.asserts.fail("Group field type not supported in writeAny()");break;case d.MESSAGE:goog.asserts.fail("Message field type not supported in writeAny()");break;case d.BYTES:this.writeBytes(b,c);break;case d.UINT32:this.writeUint32(b,c);break;case d.ENUM:this.writeEnum(b,c);break;case d.SFIXED32:this.writeSfixed32(b,c);break;case d.SFIXED64:this.writeSfixed64(b,c);break;case d.SINT32:this.writeSint32(b,c);break;case d.SINT64:this.writeSint64(b,c);break;case d.FHASH64:this.writeFixedHash64(b,c);break;case d.VHASH64:this.writeVarintHash64(b,c);break;default:goog.asserts.fail("Invalid field type in writeAny()")}};jspb.BinaryWriter.prototype.writeUnsignedVarint32_=function(a,b){null!=b&&(this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeUnsignedVarint32(b))};jspb.BinaryWriter.prototype.writeSignedVarint32_=function(a,b){null!=b&&(this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeSignedVarint32(b))};jspb.BinaryWriter.prototype.writeUnsignedVarint64_=function(a,b){null!=b&&(this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeUnsignedVarint64(b))};jspb.BinaryWriter.prototype.writeSignedVarint64_=function(a,b){null!=b&&(this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeSignedVarint64(b))};jspb.BinaryWriter.prototype.writeZigzagVarint32_=function(a,b){null!=b&&(this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeZigzagVarint32(b))};jspb.BinaryWriter.prototype.writeZigzagVarint64_=function(a,b){null!=b&&(this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeZigzagVarint64(b))};jspb.BinaryWriter.prototype.writeZigzagVarint64String_=function(a,b){null!=b&&(this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeZigzagVarint64String(b))};jspb.BinaryWriter.prototype.writeZigzagVarintHash64_=function(a,b){null!=b&&(this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeZigzagVarintHash64(b))};jspb.BinaryWriter.prototype.writeInt32=function(a,b){null!=b&&(goog.asserts.assert(b>=-jspb.BinaryConstants.TWO_TO_31&&b<jspb.BinaryConstants.TWO_TO_31),this.writeSignedVarint32_(a,b))};jspb.BinaryWriter.prototype.writeInt32String=function(a,b){null!=b&&(b=parseInt(b,10),goog.asserts.assert(b>=-jspb.BinaryConstants.TWO_TO_31&&b<jspb.BinaryConstants.TWO_TO_31),this.writeSignedVarint32_(a,b))};jspb.BinaryWriter.prototype.writeInt64=function(a,b){null!=b&&(goog.asserts.assert(b>=-jspb.BinaryConstants.TWO_TO_63&&b<jspb.BinaryConstants.TWO_TO_63),this.writeSignedVarint64_(a,b))};jspb.BinaryWriter.prototype.writeInt64String=function(a,b){null!=b&&(b=jspb.arith.Int64.fromString(b),this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeSplitVarint64(b.lo,b.hi))};jspb.BinaryWriter.prototype.writeUint32=function(a,b){null!=b&&(goog.asserts.assert(0<=b&&b<jspb.BinaryConstants.TWO_TO_32),this.writeUnsignedVarint32_(a,b))};jspb.BinaryWriter.prototype.writeUint32String=function(a,b){null!=b&&(b=parseInt(b,10),goog.asserts.assert(0<=b&&b<jspb.BinaryConstants.TWO_TO_32),this.writeUnsignedVarint32_(a,b))};jspb.BinaryWriter.prototype.writeUint64=function(a,b){null!=b&&(goog.asserts.assert(0<=b&&b<jspb.BinaryConstants.TWO_TO_64),this.writeUnsignedVarint64_(a,b))};jspb.BinaryWriter.prototype.writeUint64String=function(a,b){null!=b&&(b=jspb.arith.UInt64.fromString(b),this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeSplitVarint64(b.lo,b.hi))};jspb.BinaryWriter.prototype.writeSint32=function(a,b){null!=b&&(goog.asserts.assert(b>=-jspb.BinaryConstants.TWO_TO_31&&b<jspb.BinaryConstants.TWO_TO_31),this.writeZigzagVarint32_(a,b))};jspb.BinaryWriter.prototype.writeSint64=function(a,b){null!=b&&(goog.asserts.assert(b>=-jspb.BinaryConstants.TWO_TO_63&&b<jspb.BinaryConstants.TWO_TO_63),this.writeZigzagVarint64_(a,b))};jspb.BinaryWriter.prototype.writeSintHash64=function(a,b){null!=b&&this.writeZigzagVarintHash64_(a,b)};jspb.BinaryWriter.prototype.writeSint64String=function(a,b){null!=b&&this.writeZigzagVarint64String_(a,b)};jspb.BinaryWriter.prototype.writeFixed32=function(a,b){null!=b&&(goog.asserts.assert(0<=b&&b<jspb.BinaryConstants.TWO_TO_32),this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.FIXED32),this.encoder_.writeUint32(b))};jspb.BinaryWriter.prototype.writeFixed64=function(a,b){null!=b&&(goog.asserts.assert(0<=b&&b<jspb.BinaryConstants.TWO_TO_64),this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.FIXED64),this.encoder_.writeUint64(b))};jspb.BinaryWriter.prototype.writeFixed64String=function(a,b){null!=b&&(b=jspb.arith.UInt64.fromString(b),this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.FIXED64),this.encoder_.writeSplitFixed64(b.lo,b.hi))};jspb.BinaryWriter.prototype.writeSfixed32=function(a,b){null!=b&&(goog.asserts.assert(b>=-jspb.BinaryConstants.TWO_TO_31&&b<jspb.BinaryConstants.TWO_TO_31),this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.FIXED32),this.encoder_.writeInt32(b))};jspb.BinaryWriter.prototype.writeSfixed64=function(a,b){null!=b&&(goog.asserts.assert(b>=-jspb.BinaryConstants.TWO_TO_63&&b<jspb.BinaryConstants.TWO_TO_63),this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.FIXED64),this.encoder_.writeInt64(b))};jspb.BinaryWriter.prototype.writeSfixed64String=function(a,b){null!=b&&(b=jspb.arith.Int64.fromString(b),this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.FIXED64),this.encoder_.writeSplitFixed64(b.lo,b.hi))};jspb.BinaryWriter.prototype.writeFloat=function(a,b){null!=b&&(this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.FIXED32),this.encoder_.writeFloat(b))};jspb.BinaryWriter.prototype.writeDouble=function(a,b){null!=b&&(this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.FIXED64),this.encoder_.writeDouble(b))};jspb.BinaryWriter.prototype.writeBool=function(a,b){null!=b&&(goog.asserts.assert("boolean"===typeof b||"number"===typeof b),this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeBool(b))};jspb.BinaryWriter.prototype.writeEnum=function(a,b){null!=b&&(goog.asserts.assert(b>=-jspb.BinaryConstants.TWO_TO_31&&b<jspb.BinaryConstants.TWO_TO_31),this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeSignedVarint32(b))};jspb.BinaryWriter.prototype.writeString=function(a,b){null!=b&&(a=this.beginDelimited_(a),this.encoder_.writeString(b),this.endDelimited_(a))};jspb.BinaryWriter.prototype.writeBytes=function(a,b){null!=b&&(b=jspb.utils.byteSourceToUint8Array(b),this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(b.length),this.appendUint8Array_(b))};jspb.BinaryWriter.prototype.writeMessage=function(a,b,c){null!=b&&(a=this.beginDelimited_(a),c(b,this),this.endDelimited_(a))};jspb.BinaryWriter.prototype.writeMessageSet=function(a,b,c){null!=b&&(this.writeFieldHeader_(1,jspb.BinaryConstants.WireType.START_GROUP),this.writeFieldHeader_(2,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeSignedVarint32(a),a=this.beginDelimited_(3),c(b,this),this.endDelimited_(a),this.writeFieldHeader_(1,jspb.BinaryConstants.WireType.END_GROUP))};jspb.BinaryWriter.prototype.writeGroup=function(a,b,c){null!=b&&(this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.START_GROUP),c(b,this),this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.END_GROUP))};jspb.BinaryWriter.prototype.writeFixedHash64=function(a,b){null!=b&&(goog.asserts.assert(8==b.length),this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.FIXED64),this.encoder_.writeFixedHash64(b))};jspb.BinaryWriter.prototype.writeVarintHash64=function(a,b){null!=b&&(goog.asserts.assert(8==b.length),this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.VARINT),this.encoder_.writeVarintHash64(b))};jspb.BinaryWriter.prototype.writeSplitFixed64=function(a,b,c){this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.FIXED64);this.encoder_.writeSplitFixed64(b,c)};jspb.BinaryWriter.prototype.writeSplitVarint64=function(a,b,c){this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.VARINT);this.encoder_.writeSplitVarint64(b,c)};jspb.BinaryWriter.prototype.writeSplitZigzagVarint64=function(a,b,c){this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.VARINT);var d=this.encoder_;jspb.utils.toZigzag64(b,c,function(a,b){d.writeSplitVarint64(a>>>0,b>>>0)})};jspb.BinaryWriter.prototype.writeRepeatedInt32=function(a,b){if(null!=b)
for(var c=0;c<b.length;c++)this.writeSignedVarint32_(a,b[c])};jspb.BinaryWriter.prototype.writeRepeatedInt32String=function(a,b){if(null!=b)
for(var c=0;c<b.length;c++)this.writeInt32String(a,b[c])};jspb.BinaryWriter.prototype.writeRepeatedInt64=function(a,b){if(null!=b)
for(var c=0;c<b.length;c++)this.writeSignedVarint64_(a,b[c])};jspb.BinaryWriter.prototype.writeRepeatedSplitFixed64=function(a,b,c,d){if(null!=b)
for(var e=0;e<b.length;e++)this.writeSplitFixed64(a,c(b[e]),d(b[e]))};jspb.BinaryWriter.prototype.writeRepeatedSplitVarint64=function(a,b,c,d){if(null!=b)
for(var e=0;e<b.length;e++)this.writeSplitVarint64(a,c(b[e]),d(b[e]))};jspb.BinaryWriter.prototype.writeRepeatedSplitZigzagVarint64=function(a,b,c,d){if(null!=b)
for(var e=0;e<b.length;e++)this.writeSplitZigzagVarint64(a,c(b[e]),d(b[e]))};jspb.BinaryWriter.prototype.writeRepeatedInt64String=function(a,b){if(null!=b)
for(var c=0;c<b.length;c++)this.writeInt64String(a,b[c])};jspb.BinaryWriter.prototype.writeRepeatedUint32=function(a,b){if(null!=b)
for(var c=0;c<b.length;c++)this.writeUnsignedVarint32_(a,b[c])};jspb.BinaryWriter.prototype.writeRepeatedUint32String=function(a,b){if(null!=b)
for(var c=0;c<b.length;c++)this.writeUint32String(a,b[c])};jspb.BinaryWriter.prototype.writeRepeatedUint64=function(a,b){if(null!=b)
for(var c=0;c<b.length;c++)this.writeUnsignedVarint64_(a,b[c])};jspb.BinaryWriter.prototype.writeRepeatedUint64String=function(a,b){if(null!=b)
for(var c=0;c<b.length;c++)this.writeUint64String(a,b[c])};jspb.BinaryWriter.prototype.writeRepeatedSint32=function(a,b){if(null!=b)
for(var c=0;c<b.length;c++)this.writeZigzagVarint32_(a,b[c])};jspb.BinaryWriter.prototype.writeRepeatedSint64=function(a,b){if(null!=b)
for(var c=0;c<b.length;c++)this.writeZigzagVarint64_(a,b[c])};jspb.BinaryWriter.prototype.writeRepeatedSint64String=function(a,b){if(null!=b)
for(var c=0;c<b.length;c++)this.writeZigzagVarint64String_(a,b[c])};jspb.BinaryWriter.prototype.writeRepeatedSintHash64=function(a,b){if(null!=b)
for(var c=0;c<b.length;c++)this.writeZigzagVarintHash64_(a,b[c])};jspb.BinaryWriter.prototype.writeRepeatedFixed32=function(a,b){if(null!=b)
for(var c=0;c<b.length;c++)this.writeFixed32(a,b[c])};jspb.BinaryWriter.prototype.writeRepeatedFixed64=function(a,b){if(null!=b)
for(var c=0;c<b.length;c++)this.writeFixed64(a,b[c])};jspb.BinaryWriter.prototype.writeRepeatedFixed64String=function(a,b){if(null!=b)
for(var c=0;c<b.length;c++)this.writeFixed64String(a,b[c])};jspb.BinaryWriter.prototype.writeRepeatedSfixed32=function(a,b){if(null!=b)
for(var c=0;c<b.length;c++)this.writeSfixed32(a,b[c])};jspb.BinaryWriter.prototype.writeRepeatedSfixed64=function(a,b){if(null!=b)
for(var c=0;c<b.length;c++)this.writeSfixed64(a,b[c])};jspb.BinaryWriter.prototype.writeRepeatedSfixed64String=function(a,b){if(null!=b)
for(var c=0;c<b.length;c++)this.writeSfixed64String(a,b[c])};jspb.BinaryWriter.prototype.writeRepeatedFloat=function(a,b){if(null!=b)
for(var c=0;c<b.length;c++)this.writeFloat(a,b[c])};jspb.BinaryWriter.prototype.writeRepeatedDouble=function(a,b){if(null!=b)
for(var c=0;c<b.length;c++)this.writeDouble(a,b[c])};jspb.BinaryWriter.prototype.writeRepeatedBool=function(a,b){if(null!=b)
for(var c=0;c<b.length;c++)this.writeBool(a,b[c])};jspb.BinaryWriter.prototype.writeRepeatedEnum=function(a,b){if(null!=b)
for(var c=0;c<b.length;c++)this.writeEnum(a,b[c])};jspb.BinaryWriter.prototype.writeRepeatedString=function(a,b){if(null!=b)
for(var c=0;c<b.length;c++)this.writeString(a,b[c])};jspb.BinaryWriter.prototype.writeRepeatedBytes=function(a,b){if(null!=b)
for(var c=0;c<b.length;c++)this.writeBytes(a,b[c])};jspb.BinaryWriter.prototype.writeRepeatedMessage=function(a,b,c){if(null!=b)
for(var d=0;d<b.length;d++){var e=this.beginDelimited_(a);c(b[d],this);this.endDelimited_(e)}};jspb.BinaryWriter.prototype.writeRepeatedGroup=function(a,b,c){if(null!=b)
for(var d=0;d<b.length;d++)this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.START_GROUP),c(b[d],this),this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.END_GROUP)};jspb.BinaryWriter.prototype.writeRepeatedFixedHash64=function(a,b){if(null!=b)
for(var c=0;c<b.length;c++)this.writeFixedHash64(a,b[c])};jspb.BinaryWriter.prototype.writeRepeatedVarintHash64=function(a,b){if(null!=b)
for(var c=0;c<b.length;c++)this.writeVarintHash64(a,b[c])};jspb.BinaryWriter.prototype.writePackedInt32=function(a,b){if(null!=b&&b.length){a=this.beginDelimited_(a);for(var c=0;c<b.length;c++)this.encoder_.writeSignedVarint32(b[c]);this.endDelimited_(a)}};jspb.BinaryWriter.prototype.writePackedInt32String=function(a,b){if(null!=b&&b.length){a=this.beginDelimited_(a);for(var c=0;c<b.length;c++)this.encoder_.writeSignedVarint32(parseInt(b[c],10));this.endDelimited_(a)}};jspb.BinaryWriter.prototype.writePackedInt64=function(a,b){if(null!=b&&b.length){a=this.beginDelimited_(a);for(var c=0;c<b.length;c++)this.encoder_.writeSignedVarint64(b[c]);this.endDelimited_(a)}};jspb.BinaryWriter.prototype.writePackedSplitFixed64=function(a,b,c,d){if(null!=b){a=this.beginDelimited_(a);for(var e=0;e<b.length;e++)this.encoder_.writeSplitFixed64(c(b[e]),d(b[e]));this.endDelimited_(a)}};jspb.BinaryWriter.prototype.writePackedSplitVarint64=function(a,b,c,d){if(null!=b){a=this.beginDelimited_(a);for(var e=0;e<b.length;e++)this.encoder_.writeSplitVarint64(c(b[e]),d(b[e]));this.endDelimited_(a)}};jspb.BinaryWriter.prototype.writePackedSplitZigzagVarint64=function(a,b,c,d){if(null!=b){a=this.beginDelimited_(a);for(var e=this.encoder_,f=0;f<b.length;f++)jspb.utils.toZigzag64(c(b[f]),d(b[f]),function(a,b){e.writeSplitVarint64(a>>>0,b>>>0)});this.endDelimited_(a)}};jspb.BinaryWriter.prototype.writePackedInt64String=function(a,b){if(null!=b&&b.length){a=this.beginDelimited_(a);for(var c=0;c<b.length;c++){var d=jspb.arith.Int64.fromString(b[c]);this.encoder_.writeSplitVarint64(d.lo,d.hi)}
this.endDelimited_(a)}};jspb.BinaryWriter.prototype.writePackedUint32=function(a,b){if(null!=b&&b.length){a=this.beginDelimited_(a);for(var c=0;c<b.length;c++)this.encoder_.writeUnsignedVarint32(b[c]);this.endDelimited_(a)}};jspb.BinaryWriter.prototype.writePackedUint32String=function(a,b){if(null!=b&&b.length){a=this.beginDelimited_(a);for(var c=0;c<b.length;c++)this.encoder_.writeUnsignedVarint32(parseInt(b[c],10));this.endDelimited_(a)}};jspb.BinaryWriter.prototype.writePackedUint64=function(a,b){if(null!=b&&b.length){a=this.beginDelimited_(a);for(var c=0;c<b.length;c++)this.encoder_.writeUnsignedVarint64(b[c]);this.endDelimited_(a)}};jspb.BinaryWriter.prototype.writePackedUint64String=function(a,b){if(null!=b&&b.length){a=this.beginDelimited_(a);for(var c=0;c<b.length;c++){var d=jspb.arith.UInt64.fromString(b[c]);this.encoder_.writeSplitVarint64(d.lo,d.hi)}
this.endDelimited_(a)}};jspb.BinaryWriter.prototype.writePackedSint32=function(a,b){if(null!=b&&b.length){a=this.beginDelimited_(a);for(var c=0;c<b.length;c++)this.encoder_.writeZigzagVarint32(b[c]);this.endDelimited_(a)}};jspb.BinaryWriter.prototype.writePackedSint64=function(a,b){if(null!=b&&b.length){a=this.beginDelimited_(a);for(var c=0;c<b.length;c++)this.encoder_.writeZigzagVarint64(b[c]);this.endDelimited_(a)}};jspb.BinaryWriter.prototype.writePackedSint64String=function(a,b){if(null!=b&&b.length){a=this.beginDelimited_(a);for(var c=0;c<b.length;c++)this.encoder_.writeZigzagVarintHash64(jspb.utils.decimalStringToHash64(b[c]));this.endDelimited_(a)}};jspb.BinaryWriter.prototype.writePackedSintHash64=function(a,b){if(null!=b&&b.length){a=this.beginDelimited_(a);for(var c=0;c<b.length;c++)this.encoder_.writeZigzagVarintHash64(b[c]);this.endDelimited_(a)}};jspb.BinaryWriter.prototype.writePackedFixed32=function(a,b){if(null!=b&&b.length)
for(this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(4*b.length),a=0;a<b.length;a++)this.encoder_.writeUint32(b[a])};jspb.BinaryWriter.prototype.writePackedFixed64=function(a,b){if(null!=b&&b.length)
for(this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(8*b.length),a=0;a<b.length;a++)this.encoder_.writeUint64(b[a])};jspb.BinaryWriter.prototype.writePackedFixed64String=function(a,b){if(null!=b&&b.length)
for(this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(8*b.length),a=0;a<b.length;a++){var c=jspb.arith.UInt64.fromString(b[a]);this.encoder_.writeSplitFixed64(c.lo,c.hi)}};jspb.BinaryWriter.prototype.writePackedSfixed32=function(a,b){if(null!=b&&b.length)
for(this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(4*b.length),a=0;a<b.length;a++)this.encoder_.writeInt32(b[a])};jspb.BinaryWriter.prototype.writePackedSfixed64=function(a,b){if(null!=b&&b.length)
for(this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(8*b.length),a=0;a<b.length;a++)this.encoder_.writeInt64(b[a])};jspb.BinaryWriter.prototype.writePackedSfixed64String=function(a,b){if(null!=b&&b.length)
for(this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(8*b.length),a=0;a<b.length;a++)this.encoder_.writeInt64String(b[a])};jspb.BinaryWriter.prototype.writePackedFloat=function(a,b){if(null!=b&&b.length)
for(this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(4*b.length),a=0;a<b.length;a++)this.encoder_.writeFloat(b[a])};jspb.BinaryWriter.prototype.writePackedDouble=function(a,b){if(null!=b&&b.length)
for(this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(8*b.length),a=0;a<b.length;a++)this.encoder_.writeDouble(b[a])};jspb.BinaryWriter.prototype.writePackedBool=function(a,b){if(null!=b&&b.length)
for(this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(b.length),a=0;a<b.length;a++)this.encoder_.writeBool(b[a])};jspb.BinaryWriter.prototype.writePackedEnum=function(a,b){if(null!=b&&b.length){a=this.beginDelimited_(a);for(var c=0;c<b.length;c++)this.encoder_.writeEnum(b[c]);this.endDelimited_(a)}};jspb.BinaryWriter.prototype.writePackedFixedHash64=function(a,b){if(null!=b&&b.length)
for(this.writeFieldHeader_(a,jspb.BinaryConstants.WireType.DELIMITED),this.encoder_.writeUnsignedVarint32(8*b.length),a=0;a<b.length;a++)this.encoder_.writeFixedHash64(b[a])};jspb.BinaryWriter.prototype.writePackedVarintHash64=function(a,b){if(null!=b&&b.length){a=this.beginDelimited_(a);for(var c=0;c<b.length;c++)this.encoder_.writeVarintHash64(b[c]);this.endDelimited_(a)}};jspb.Export={};exports.Map=jspb.Map;exports.Message=jspb.Message;exports.BinaryReader=jspb.BinaryReader;exports.BinaryWriter=jspb.BinaryWriter;exports.ExtensionFieldInfo=jspb.ExtensionFieldInfo;exports.ExtensionFieldBinaryInfo=jspb.ExtensionFieldBinaryInfo;exports.exportSymbol=goog.exportSymbol;exports.inherits=goog.inherits;exports.object={extend:goog.object.extend};exports.typeOf=goog.typeOf;goog.provide('proto.Envelope');goog.require('jspb.BinaryReader');goog.require('jspb.BinaryWriter');goog.require('jspb.Message');proto.Envelope=function(opt_data){jspb.Message.initialize(this,opt_data,0,-1,null,null);};goog.inherits(proto.Envelope,jspb.Message);if(goog.DEBUG&&!COMPILED){proto.Envelope.displayName='proto.Envelope';}
if(jspb.Message.GENERATE_TO_OBJECT){proto.Envelope.prototype.toObject=function(opt_includeInstance){return proto.Envelope.toObject(opt_includeInstance,this);};proto.Envelope.toObject=function(includeInstance,msg){var f,obj={enabled:jspb.Message.getBooleanFieldWithDefault(msg,1,false),attack:jspb.Message.getFloatingPointFieldWithDefault(msg,2,0.0),hold:jspb.Message.getFloatingPointFieldWithDefault(msg,3,0.0),decay:jspb.Message.getFloatingPointFieldWithDefault(msg,4,0.0),sustain:jspb.Message.getFloatingPointFieldWithDefault(msg,5,0.0),release:jspb.Message.getFloatingPointFieldWithDefault(msg,6,0.0)};if(includeInstance){obj.$jspbMessageInstance=msg;}
return obj;};}
proto.Envelope.deserializeBinary=function(bytes){var reader=new jspb.BinaryReader(bytes);var msg=new proto.Envelope;return proto.Envelope.deserializeBinaryFromReader(msg,reader);};proto.Envelope.deserializeBinaryFromReader=function(msg,reader){while(reader.nextField()){if(reader.isEndGroup()){break;}
var field=reader.getFieldNumber();switch(field){case 1:var value=(reader.readBool());msg.setEnabled(value);break;case 2:var value=(reader.readFloat());msg.setAttack(value);break;case 3:var value=(reader.readFloat());msg.setHold(value);break;case 4:var value=(reader.readFloat());msg.setDecay(value);break;case 5:var value=(reader.readFloat());msg.setSustain(value);break;case 6:var value=(reader.readFloat());msg.setRelease(value);break;default:reader.skipField();break;}}
return msg;};proto.Envelope.prototype.serializeBinary=function(){var writer=new jspb.BinaryWriter();proto.Envelope.serializeBinaryToWriter(this,writer);return writer.getResultBuffer();};proto.Envelope.serializeBinaryToWriter=function(message,writer){var f=undefined;f=message.getEnabled();if(f){writer.writeBool(1,f);}
f=message.getAttack();if(f!==0.0){writer.writeFloat(2,f);}
f=message.getHold();if(f!==0.0){writer.writeFloat(3,f);}
f=message.getDecay();if(f!==0.0){writer.writeFloat(4,f);}
f=message.getSustain();if(f!==0.0){writer.writeFloat(5,f);}
f=message.getRelease();if(f!==0.0){writer.writeFloat(6,f);}};proto.Envelope.prototype.getEnabled=function(){return(jspb.Message.getBooleanFieldWithDefault(this,1,false));};proto.Envelope.prototype.setEnabled=function(value){return jspb.Message.setProto3BooleanField(this,1,value);};proto.Envelope.prototype.getAttack=function(){return(jspb.Message.getFloatingPointFieldWithDefault(this,2,0.0));};proto.Envelope.prototype.setAttack=function(value){return jspb.Message.setProto3FloatField(this,2,value);};proto.Envelope.prototype.getHold=function(){return(jspb.Message.getFloatingPointFieldWithDefault(this,3,0.0));};proto.Envelope.prototype.setHold=function(value){return jspb.Message.setProto3FloatField(this,3,value);};proto.Envelope.prototype.getDecay=function(){return(jspb.Message.getFloatingPointFieldWithDefault(this,4,0.0));};proto.Envelope.prototype.setDecay=function(value){return jspb.Message.setProto3FloatField(this,4,value);};proto.Envelope.prototype.getSustain=function(){return(jspb.Message.getFloatingPointFieldWithDefault(this,5,0.0));};proto.Envelope.prototype.setSustain=function(value){return jspb.Message.setProto3FloatField(this,5,value);};proto.Envelope.prototype.getRelease=function(){return(jspb.Message.getFloatingPointFieldWithDefault(this,6,0.0));};proto.Envelope.prototype.setRelease=function(value){return jspb.Message.setProto3FloatField(this,6,value);};goog.provide('proto.InstrumentSettings');goog.require('jspb.BinaryReader');goog.require('jspb.BinaryWriter');goog.require('jspb.Message');goog.require('proto.Synth');proto.InstrumentSettings=function(opt_data){jspb.Message.initialize(this,opt_data,0,-1,null,null);};goog.inherits(proto.InstrumentSettings,jspb.Message);if(goog.DEBUG&&!COMPILED){proto.InstrumentSettings.displayName='proto.InstrumentSettings';}
if(jspb.Message.GENERATE_TO_OBJECT){proto.InstrumentSettings.prototype.toObject=function(opt_includeInstance){return proto.InstrumentSettings.toObject(opt_includeInstance,this);};proto.InstrumentSettings.toObject=function(includeInstance,msg){var f,obj={volume:jspb.Message.getFloatingPointFieldWithDefault(msg,1,0.0),delay:jspb.Message.getBooleanFieldWithDefault(msg,2,false),reverb:jspb.Message.getBooleanFieldWithDefault(msg,3,false),reverbType:jspb.Message.getFieldWithDefault(msg,10,0),oneMinusReverbVolume:jspb.Message.getFloatingPointFieldWithDefault(msg,11,0.0),pan:jspb.Message.getFloatingPointFieldWithDefault(msg,4,0.0),enableEq:jspb.Message.getBooleanFieldWithDefault(msg,5,false),eqLow:jspb.Message.getFloatingPointFieldWithDefault(msg,6,0.0),eqMid:jspb.Message.getFloatingPointFieldWithDefault(msg,7,0.0),eqHigh:jspb.Message.getFloatingPointFieldWithDefault(msg,8,0.0),detune:jspb.Message.getFloatingPointFieldWithDefault(msg,9,0.0),distortType:jspb.Message.getFieldWithDefault(msg,12,0),distortVolume:jspb.Message.getFloatingPointFieldWithDefault(msg,13,0.0),name:jspb.Message.getFieldWithDefault(msg,15,""),fadeTime:jspb.Message.getFloatingPointFieldWithDefault(msg,16,0.0),color:jspb.Message.getFieldWithDefault(msg,17,0),synth:(f=msg.getSynth())&&proto.Synth.toObject(includeInstance,f)};if(includeInstance){obj.$jspbMessageInstance=msg;}
return obj;};}
proto.InstrumentSettings.deserializeBinary=function(bytes){var reader=new jspb.BinaryReader(bytes);var msg=new proto.InstrumentSettings;return proto.InstrumentSettings.deserializeBinaryFromReader(msg,reader);};proto.InstrumentSettings.deserializeBinaryFromReader=function(msg,reader){while(reader.nextField()){if(reader.isEndGroup()){break;}
var field=reader.getFieldNumber();switch(field){case 1:var value=(reader.readFloat());msg.setVolume(value);break;case 2:var value=(reader.readBool());msg.setDelay(value);break;case 3:var value=(reader.readBool());msg.setReverb(value);break;case 10:var value=(reader.readInt32());msg.setReverbType(value);break;case 11:var value=(reader.readFloat());msg.setOneMinusReverbVolume(value);break;case 4:var value=(reader.readFloat());msg.setPan(value);break;case 5:var value=(reader.readBool());msg.setEnableEq(value);break;case 6:var value=(reader.readFloat());msg.setEqLow(value);break;case 7:var value=(reader.readFloat());msg.setEqMid(value);break;case 8:var value=(reader.readFloat());msg.setEqHigh(value);break;case 9:var value=(reader.readFloat());msg.setDetune(value);break;case 12:var value=(reader.readInt32());msg.setDistortType(value);break;case 13:var value=(reader.readFloat());msg.setDistortVolume(value);break;case 15:var value=(reader.readString());msg.setName(value);break;case 16:var value=(reader.readFloat());msg.setFadeTime(value);break;case 17:var value=(reader.readUint32());msg.setColor(value);break;case 14:var value=new proto.Synth;reader.readMessage(value,proto.Synth.deserializeBinaryFromReader);msg.setSynth(value);break;default:reader.skipField();break;}}
return msg;};proto.InstrumentSettings.prototype.serializeBinary=function(){var writer=new jspb.BinaryWriter();proto.InstrumentSettings.serializeBinaryToWriter(this,writer);return writer.getResultBuffer();};proto.InstrumentSettings.serializeBinaryToWriter=function(message,writer){var f=undefined;f=message.getVolume();if(f!==0.0){writer.writeFloat(1,f);}
f=message.getDelay();if(f){writer.writeBool(2,f);}
f=message.getReverb();if(f){writer.writeBool(3,f);}
f=message.getReverbType();if(f!==0){writer.writeInt32(10,f);}
f=message.getOneMinusReverbVolume();if(f!==0.0){writer.writeFloat(11,f);}
f=message.getPan();if(f!==0.0){writer.writeFloat(4,f);}
f=message.getEnableEq();if(f){writer.writeBool(5,f);}
f=message.getEqLow();if(f!==0.0){writer.writeFloat(6,f);}
f=message.getEqMid();if(f!==0.0){writer.writeFloat(7,f);}
f=message.getEqHigh();if(f!==0.0){writer.writeFloat(8,f);}
f=message.getDetune();if(f!==0.0){writer.writeFloat(9,f);}
f=message.getDistortType();if(f!==0){writer.writeInt32(12,f);}
f=message.getDistortVolume();if(f!==0.0){writer.writeFloat(13,f);}
f=message.getName();if(f.length>0){writer.writeString(15,f);}
f=message.getFadeTime();if(f!==0.0){writer.writeFloat(16,f);}
f=message.getColor();if(f!==0){writer.writeUint32(17,f);}
f=message.getSynth();if(f!=null){writer.writeMessage(14,f,proto.Synth.serializeBinaryToWriter);}};proto.InstrumentSettings.prototype.getVolume=function(){return(jspb.Message.getFloatingPointFieldWithDefault(this,1,0.0));};proto.InstrumentSettings.prototype.setVolume=function(value){return jspb.Message.setProto3FloatField(this,1,value);};proto.InstrumentSettings.prototype.getDelay=function(){return(jspb.Message.getBooleanFieldWithDefault(this,2,false));};proto.InstrumentSettings.prototype.setDelay=function(value){return jspb.Message.setProto3BooleanField(this,2,value);};proto.InstrumentSettings.prototype.getReverb=function(){return(jspb.Message.getBooleanFieldWithDefault(this,3,false));};proto.InstrumentSettings.prototype.setReverb=function(value){return jspb.Message.setProto3BooleanField(this,3,value);};proto.InstrumentSettings.prototype.getReverbType=function(){return(jspb.Message.getFieldWithDefault(this,10,0));};proto.InstrumentSettings.prototype.setReverbType=function(value){return jspb.Message.setProto3IntField(this,10,value);};proto.InstrumentSettings.prototype.getOneMinusReverbVolume=function(){return(jspb.Message.getFloatingPointFieldWithDefault(this,11,0.0));};proto.InstrumentSettings.prototype.setOneMinusReverbVolume=function(value){return jspb.Message.setProto3FloatField(this,11,value);};proto.InstrumentSettings.prototype.getPan=function(){return(jspb.Message.getFloatingPointFieldWithDefault(this,4,0.0));};proto.InstrumentSettings.prototype.setPan=function(value){return jspb.Message.setProto3FloatField(this,4,value);};proto.InstrumentSettings.prototype.getEnableEq=function(){return(jspb.Message.getBooleanFieldWithDefault(this,5,false));};proto.InstrumentSettings.prototype.setEnableEq=function(value){return jspb.Message.setProto3BooleanField(this,5,value);};proto.InstrumentSettings.prototype.getEqLow=function(){return(jspb.Message.getFloatingPointFieldWithDefault(this,6,0.0));};proto.InstrumentSettings.prototype.setEqLow=function(value){return jspb.Message.setProto3FloatField(this,6,value);};proto.InstrumentSettings.prototype.getEqMid=function(){return(jspb.Message.getFloatingPointFieldWithDefault(this,7,0.0));};proto.InstrumentSettings.prototype.setEqMid=function(value){return jspb.Message.setProto3FloatField(this,7,value);};proto.InstrumentSettings.prototype.getEqHigh=function(){return(jspb.Message.getFloatingPointFieldWithDefault(this,8,0.0));};proto.InstrumentSettings.prototype.setEqHigh=function(value){return jspb.Message.setProto3FloatField(this,8,value);};proto.InstrumentSettings.prototype.getDetune=function(){return(jspb.Message.getFloatingPointFieldWithDefault(this,9,0.0));};proto.InstrumentSettings.prototype.setDetune=function(value){return jspb.Message.setProto3FloatField(this,9,value);};proto.InstrumentSettings.prototype.getDistortType=function(){return(jspb.Message.getFieldWithDefault(this,12,0));};proto.InstrumentSettings.prototype.setDistortType=function(value){return jspb.Message.setProto3IntField(this,12,value);};proto.InstrumentSettings.prototype.getDistortVolume=function(){return(jspb.Message.getFloatingPointFieldWithDefault(this,13,0.0));};proto.InstrumentSettings.prototype.setDistortVolume=function(value){return jspb.Message.setProto3FloatField(this,13,value);};proto.InstrumentSettings.prototype.getName=function(){return(jspb.Message.getFieldWithDefault(this,15,""));};proto.InstrumentSettings.prototype.setName=function(value){return jspb.Message.setProto3StringField(this,15,value);};proto.InstrumentSettings.prototype.getFadeTime=function(){return(jspb.Message.getFloatingPointFieldWithDefault(this,16,0.0));};proto.InstrumentSettings.prototype.setFadeTime=function(value){return jspb.Message.setProto3FloatField(this,16,value);};proto.InstrumentSettings.prototype.getColor=function(){return(jspb.Message.getFieldWithDefault(this,17,0));};proto.InstrumentSettings.prototype.setColor=function(value){return jspb.Message.setProto3IntField(this,17,value);};proto.InstrumentSettings.prototype.getSynth=function(){return(jspb.Message.getWrapperField(this,proto.Synth,14));};proto.InstrumentSettings.prototype.setSynth=function(value){return jspb.Message.setWrapperField(this,14,value);};proto.InstrumentSettings.prototype.clearSynth=function(){return this.setSynth(undefined);};proto.InstrumentSettings.prototype.hasSynth=function(){return jspb.Message.getField(this,14)!=null;};goog.provide('proto.LFOMode');proto.LFOMode={NUMERATOR:0,FREQUENCY:1};goog.provide('proto.LFOTarget');proto.LFOTarget={VOLUME:0,PITCH:1,FILTER:2};goog.provide('proto.LFOType');proto.LFOType={SINELFO:0,SQUARELFO:1,SAWTOOTHLFO:2,TRIANGLELFO:3};goog.provide('proto.Marker');goog.require('jspb.BinaryReader');goog.require('jspb.BinaryWriter');goog.require('jspb.Message');proto.Marker=function(opt_data){jspb.Message.initialize(this,opt_data,0,-1,null,null);};goog.inherits(proto.Marker,jspb.Message);if(goog.DEBUG&&!COMPILED){proto.Marker.displayName='proto.Marker';}
if(jspb.Message.GENERATE_TO_OBJECT){proto.Marker.prototype.toObject=function(opt_includeInstance){return proto.Marker.toObject(opt_includeInstance,this);};proto.Marker.toObject=function(includeInstance,msg){var f,obj={time:jspb.Message.getFloatingPointFieldWithDefault(msg,1,0.0),setting:jspb.Message.getFieldWithDefault(msg,2,0),instrument:jspb.Message.getFieldWithDefault(msg,3,0),value:jspb.Message.getFloatingPointFieldWithDefault(msg,4,0.0),blend:jspb.Message.getBooleanFieldWithDefault(msg,5,false)};if(includeInstance){obj.$jspbMessageInstance=msg;}
return obj;};}
proto.Marker.deserializeBinary=function(bytes){var reader=new jspb.BinaryReader(bytes);var msg=new proto.Marker;return proto.Marker.deserializeBinaryFromReader(msg,reader);};proto.Marker.deserializeBinaryFromReader=function(msg,reader){while(reader.nextField()){if(reader.isEndGroup()){break;}
var field=reader.getFieldNumber();switch(field){case 1:var value=(reader.readFloat());msg.setTime(value);break;case 2:var value=(reader.readInt32());msg.setSetting(value);break;case 3:var value=(reader.readInt32());msg.setInstrument(value);break;case 4:var value=(reader.readFloat());msg.setValue(value);break;case 5:var value=(reader.readBool());msg.setBlend(value);break;default:reader.skipField();break;}}
return msg;};proto.Marker.prototype.serializeBinary=function(){var writer=new jspb.BinaryWriter();proto.Marker.serializeBinaryToWriter(this,writer);return writer.getResultBuffer();};proto.Marker.serializeBinaryToWriter=function(message,writer){var f=undefined;f=message.getTime();if(f!==0.0){writer.writeFloat(1,f);}
f=message.getSetting();if(f!==0){writer.writeInt32(2,f);}
f=message.getInstrument();if(f!==0){writer.writeInt32(3,f);}
f=message.getValue();if(f!==0.0){writer.writeFloat(4,f);}
f=message.getBlend();if(f){writer.writeBool(5,f);}};proto.Marker.prototype.getTime=function(){return(jspb.Message.getFloatingPointFieldWithDefault(this,1,0.0));};proto.Marker.prototype.setTime=function(value){return jspb.Message.setProto3FloatField(this,1,value);};proto.Marker.prototype.getSetting=function(){return(jspb.Message.getFieldWithDefault(this,2,0));};proto.Marker.prototype.setSetting=function(value){return jspb.Message.setProto3IntField(this,2,value);};proto.Marker.prototype.getInstrument=function(){return(jspb.Message.getFieldWithDefault(this,3,0));};proto.Marker.prototype.setInstrument=function(value){return jspb.Message.setProto3IntField(this,3,value);};proto.Marker.prototype.getValue=function(){return(jspb.Message.getFloatingPointFieldWithDefault(this,4,0.0));};proto.Marker.prototype.setValue=function(value){return jspb.Message.setProto3FloatField(this,4,value);};proto.Marker.prototype.getBlend=function(){return(jspb.Message.getBooleanFieldWithDefault(this,5,false));};proto.Marker.prototype.setBlend=function(value){return jspb.Message.setProto3BooleanField(this,5,value);};goog.provide('proto.Note');goog.require('jspb.BinaryReader');goog.require('jspb.BinaryWriter');goog.require('jspb.Message');goog.forwardDeclare('proto.NoteType');proto.Note=function(opt_data){jspb.Message.initialize(this,opt_data,0,-1,null,null);};goog.inherits(proto.Note,jspb.Message);if(goog.DEBUG&&!COMPILED){proto.Note.displayName='proto.Note';}
if(jspb.Message.GENERATE_TO_OBJECT){proto.Note.prototype.toObject=function(opt_includeInstance){return proto.Note.toObject(opt_includeInstance,this);};proto.Note.toObject=function(includeInstance,msg){var f,obj={type:jspb.Message.getFieldWithDefault(msg,1,0),time:jspb.Message.getFloatingPointFieldWithDefault(msg,2,0.0),length:jspb.Message.getFloatingPointFieldWithDefault(msg,3,0.0),instrument:jspb.Message.getFieldWithDefault(msg,4,0),volume:jspb.Message.getFloatingPointFieldWithDefault(msg,5,0.0)};if(includeInstance){obj.$jspbMessageInstance=msg;}
return obj;};}
proto.Note.deserializeBinary=function(bytes){var reader=new jspb.BinaryReader(bytes);var msg=new proto.Note;return proto.Note.deserializeBinaryFromReader(msg,reader);};proto.Note.deserializeBinaryFromReader=function(msg,reader){while(reader.nextField()){if(reader.isEndGroup()){break;}
var field=reader.getFieldNumber();switch(field){case 1:var value=(reader.readEnum());msg.setType(value);break;case 2:var value=(reader.readFloat());msg.setTime(value);break;case 3:var value=(reader.readFloat());msg.setLength(value);break;case 4:var value=(reader.readInt32());msg.setInstrument(value);break;case 5:var value=(reader.readFloat());msg.setVolume(value);break;default:reader.skipField();break;}}
return msg;};proto.Note.prototype.serializeBinary=function(){var writer=new jspb.BinaryWriter();proto.Note.serializeBinaryToWriter(this,writer);return writer.getResultBuffer();};proto.Note.serializeBinaryToWriter=function(message,writer){var f=undefined;f=message.getType();if(f!==0.0){writer.writeEnum(1,f);}
f=message.getTime();if(f!==0.0){writer.writeFloat(2,f);}
f=message.getLength();if(f!==0.0){writer.writeFloat(3,f);}
f=message.getInstrument();if(f!==0){writer.writeInt32(4,f);}
f=message.getVolume();if(f!==0.0){writer.writeFloat(5,f);}};proto.Note.prototype.getType=function(){return(jspb.Message.getFieldWithDefault(this,1,0));};proto.Note.prototype.setType=function(value){return jspb.Message.setProto3EnumField(this,1,value);};proto.Note.prototype.getTime=function(){return(jspb.Message.getFloatingPointFieldWithDefault(this,2,0.0));};proto.Note.prototype.setTime=function(value){return jspb.Message.setProto3FloatField(this,2,value);};proto.Note.prototype.getLength=function(){return(jspb.Message.getFloatingPointFieldWithDefault(this,3,0.0));};proto.Note.prototype.setLength=function(value){return jspb.Message.setProto3FloatField(this,3,value);};proto.Note.prototype.getInstrument=function(){return(jspb.Message.getFieldWithDefault(this,4,0));};proto.Note.prototype.setInstrument=function(value){return jspb.Message.setProto3IntField(this,4,value);};proto.Note.prototype.getVolume=function(){return(jspb.Message.getFloatingPointFieldWithDefault(this,5,0.0));};proto.Note.prototype.setVolume=function(value){return jspb.Message.setProto3FloatField(this,5,value);};goog.provide('proto.NoteType');proto.NoteType={C0:0,CS0:1,D0:2,DS0:3,E0:4,F0:5,FS0:6,G0:7,GS0:8,A0:9,AS0:10,B0:11,C1:12,CS1:13,D1:14,DS1:15,E1:16,F1:17,FS1:18,G1:19,GS1:20,A1:21,AS1:22,B1:23,C2:24,CS2:25,D2:26,DS2:27,E2:28,F2:29,FS2:30,G2:31,GS2:32,A2:33,AS2:34,B2:35,C3:36,CS3:37,D3:38,DS3:39,E3:40,F3:41,FS3:42,G3:43,GS3:44,A3:45,AS3:46,B3:47,C4:48,CS4:49,D4:50,DS4:51,E4:52,F4:53,FS4:54,G4:55,GS4:56,A4:57,AS4:58,B4:59,C5:60,CS5:61,D5:62,DS5:63,E5:64,F5:65,FS5:66,G5:67,GS5:68,A5:69,AS5:70,B5:71,C6:72,CS6:73,D6:74,DS6:75,E6:76,F6:77,FS6:78,G6:79,GS6:80,A6:81,AS6:82,B6:83,C7:84,CS7:85,D7:86,DS7:87,E7:88,F7:89,FS7:90,G7:91,GS7:92,A7:93,AS7:94,B7:95,C8:96,CS8:97,D8:98,DS8:99,E8:100,F8:101,FS8:102,G8:103,GS8:104,A8:105,AS8:106,B8:107};goog.provide('proto.Sequence');goog.require('jspb.BinaryReader');goog.require('jspb.BinaryWriter');goog.require('jspb.Message');goog.require('proto.Marker');goog.require('proto.Note');goog.require('proto.SequenceSettings');proto.Sequence=function(opt_data){jspb.Message.initialize(this,opt_data,0,-1,proto.Sequence.repeatedFields_,null);};goog.inherits(proto.Sequence,jspb.Message);if(goog.DEBUG&&!COMPILED){proto.Sequence.displayName='proto.Sequence';}
proto.Sequence.repeatedFields_=[2,3];if(jspb.Message.GENERATE_TO_OBJECT){proto.Sequence.prototype.toObject=function(opt_includeInstance){return proto.Sequence.toObject(opt_includeInstance,this);};proto.Sequence.toObject=function(includeInstance,msg){var f,obj={settings:(f=msg.getSettings())&&proto.SequenceSettings.toObject(includeInstance,f),notesList:jspb.Message.toObjectList(msg.getNotesList(),proto.Note.toObject,includeInstance),markersList:jspb.Message.toObjectList(msg.getMarkersList(),proto.Marker.toObject,includeInstance)};if(includeInstance){obj.$jspbMessageInstance=msg;}
return obj;};}
proto.Sequence.deserializeBinary=function(bytes){var reader=new jspb.BinaryReader(bytes);var msg=new proto.Sequence;return proto.Sequence.deserializeBinaryFromReader(msg,reader);};proto.Sequence.deserializeBinaryFromReader=function(msg,reader){while(reader.nextField()){if(reader.isEndGroup()){break;}
var field=reader.getFieldNumber();switch(field){case 1:var value=new proto.SequenceSettings;reader.readMessage(value,proto.SequenceSettings.deserializeBinaryFromReader);msg.setSettings(value);break;case 2:var value=new proto.Note;reader.readMessage(value,proto.Note.deserializeBinaryFromReader);msg.addNotes(value);break;case 3:var value=new proto.Marker;reader.readMessage(value,proto.Marker.deserializeBinaryFromReader);msg.addMarkers(value);break;default:reader.skipField();break;}}
return msg;};proto.Sequence.prototype.serializeBinary=function(){var writer=new jspb.BinaryWriter();proto.Sequence.serializeBinaryToWriter(this,writer);return writer.getResultBuffer();};proto.Sequence.serializeBinaryToWriter=function(message,writer){var f=undefined;f=message.getSettings();if(f!=null){writer.writeMessage(1,f,proto.SequenceSettings.serializeBinaryToWriter);}
f=message.getNotesList();if(f.length>0){writer.writeRepeatedMessage(2,f,proto.Note.serializeBinaryToWriter);}
f=message.getMarkersList();if(f.length>0){writer.writeRepeatedMessage(3,f,proto.Marker.serializeBinaryToWriter);}};proto.Sequence.prototype.getSettings=function(){return(jspb.Message.getWrapperField(this,proto.SequenceSettings,1));};proto.Sequence.prototype.setSettings=function(value){return jspb.Message.setWrapperField(this,1,value);};proto.Sequence.prototype.clearSettings=function(){return this.setSettings(undefined);};proto.Sequence.prototype.hasSettings=function(){return jspb.Message.getField(this,1)!=null;};proto.Sequence.prototype.getNotesList=function(){return(jspb.Message.getRepeatedWrapperField(this,proto.Note,2));};proto.Sequence.prototype.setNotesList=function(value){return jspb.Message.setRepeatedWrapperField(this,2,value);};proto.Sequence.prototype.addNotes=function(opt_value,opt_index){return jspb.Message.addToRepeatedWrapperField(this,2,opt_value,proto.Note,opt_index);};proto.Sequence.prototype.clearNotesList=function(){return this.setNotesList([]);};proto.Sequence.prototype.getMarkersList=function(){return(jspb.Message.getRepeatedWrapperField(this,proto.Marker,3));};proto.Sequence.prototype.setMarkersList=function(value){return jspb.Message.setRepeatedWrapperField(this,3,value);};proto.Sequence.prototype.addMarkers=function(opt_value,opt_index){return jspb.Message.addToRepeatedWrapperField(this,3,opt_value,proto.Marker,opt_index);};proto.Sequence.prototype.clearMarkersList=function(){return this.setMarkersList([]);};goog.provide('proto.SequenceSettings');goog.require('jspb.BinaryReader');goog.require('jspb.BinaryWriter');goog.require('jspb.Map');goog.require('jspb.Message');goog.require('proto.InstrumentSettings');proto.SequenceSettings=function(opt_data){jspb.Message.initialize(this,opt_data,0,-1,null,null);};goog.inherits(proto.SequenceSettings,jspb.Message);if(goog.DEBUG&&!COMPILED){proto.SequenceSettings.displayName='proto.SequenceSettings';}
if(jspb.Message.GENERATE_TO_OBJECT){proto.SequenceSettings.prototype.toObject=function(opt_includeInstance){return proto.SequenceSettings.toObject(opt_includeInstance,this);};proto.SequenceSettings.toObject=function(includeInstance,msg){var f,obj={bpm:jspb.Message.getFieldWithDefault(msg,1,0),timeSignature:jspb.Message.getFieldWithDefault(msg,2,0),instrumentsMap:(f=msg.getInstrumentsMap())?f.toObject(includeInstance,proto.InstrumentSettings.toObject):[],oneMinusVolume:jspb.Message.getFloatingPointFieldWithDefault(msg,4,0.0)};if(includeInstance){obj.$jspbMessageInstance=msg;}
return obj;};}
proto.SequenceSettings.deserializeBinary=function(bytes){var reader=new jspb.BinaryReader(bytes);var msg=new proto.SequenceSettings;return proto.SequenceSettings.deserializeBinaryFromReader(msg,reader);};proto.SequenceSettings.deserializeBinaryFromReader=function(msg,reader){while(reader.nextField()){if(reader.isEndGroup()){break;}
var field=reader.getFieldNumber();switch(field){case 1:var value=(reader.readInt32());msg.setBpm(value);break;case 2:var value=(reader.readInt32());msg.setTimeSignature(value);break;case 3:var value=msg.getInstrumentsMap();reader.readMessage(value,function(message,reader){jspb.Map.deserializeBinary(message,reader,jspb.BinaryReader.prototype.readInt32,jspb.BinaryReader.prototype.readMessage,proto.InstrumentSettings.deserializeBinaryFromReader,0,new proto.InstrumentSettings());});break;case 4:var value=(reader.readFloat());msg.setOneMinusVolume(value);break;default:reader.skipField();break;}}
return msg;};proto.SequenceSettings.prototype.serializeBinary=function(){var writer=new jspb.BinaryWriter();proto.SequenceSettings.serializeBinaryToWriter(this,writer);return writer.getResultBuffer();};proto.SequenceSettings.serializeBinaryToWriter=function(message,writer){var f=undefined;f=message.getBpm();if(f!==0){writer.writeInt32(1,f);}
f=message.getTimeSignature();if(f!==0){writer.writeInt32(2,f);}
f=message.getInstrumentsMap(true);if(f&&f.getLength()>0){f.serializeBinary(3,writer,jspb.BinaryWriter.prototype.writeInt32,jspb.BinaryWriter.prototype.writeMessage,proto.InstrumentSettings.serializeBinaryToWriter);}
f=message.getOneMinusVolume();if(f!==0.0){writer.writeFloat(4,f);}};proto.SequenceSettings.prototype.getBpm=function(){return(jspb.Message.getFieldWithDefault(this,1,0));};proto.SequenceSettings.prototype.setBpm=function(value){return jspb.Message.setProto3IntField(this,1,value);};proto.SequenceSettings.prototype.getTimeSignature=function(){return(jspb.Message.getFieldWithDefault(this,2,0));};proto.SequenceSettings.prototype.setTimeSignature=function(value){return jspb.Message.setProto3IntField(this,2,value);};proto.SequenceSettings.prototype.getInstrumentsMap=function(opt_noLazyCreate){return(jspb.Message.getMapField(this,3,opt_noLazyCreate,proto.InstrumentSettings));};proto.SequenceSettings.prototype.clearInstrumentsMap=function(){this.getInstrumentsMap().clear();return this;};proto.SequenceSettings.prototype.getOneMinusVolume=function(){return(jspb.Message.getFloatingPointFieldWithDefault(this,4,0.0));};proto.SequenceSettings.prototype.setOneMinusVolume=function(value){return jspb.Message.setProto3FloatField(this,4,value);};goog.provide('proto.Synth');goog.require('jspb.BinaryReader');goog.require('jspb.BinaryWriter');goog.require('jspb.Message');goog.require('proto.Envelope');goog.forwardDeclare('proto.LFOMode');goog.forwardDeclare('proto.LFOTarget');goog.forwardDeclare('proto.LFOType');goog.forwardDeclare('proto.SynthType');proto.Synth=function(opt_data){jspb.Message.initialize(this,opt_data,0,-1,null,null);};goog.inherits(proto.Synth,jspb.Message);if(goog.DEBUG&&!COMPILED){proto.Synth.displayName='proto.Synth';}
if(jspb.Message.GENERATE_TO_OBJECT){proto.Synth.prototype.toObject=function(opt_includeInstance){return proto.Synth.toObject(opt_includeInstance,this);};proto.Synth.toObject=function(includeInstance,msg){var f,obj={type:jspb.Message.getFieldWithDefault(msg,1,0),volumeEnvelope:(f=msg.getVolumeEnvelope())&&proto.Envelope.toObject(includeInstance,f),filterEnvelope:(f=msg.getFilterEnvelope())&&proto.Envelope.toObject(includeInstance,f),filter:jspb.Message.getFloatingPointFieldWithDefault(msg,4,0.0),resonance:jspb.Message.getFloatingPointFieldWithDefault(msg,5,0.0),filterType:jspb.Message.getFieldWithDefault(msg,6,0),lfoEnabled:jspb.Message.getBooleanFieldWithDefault(msg,7,false),lfoType:jspb.Message.getFieldWithDefault(msg,8,0),lfoFreq:jspb.Message.getFloatingPointFieldWithDefault(msg,9,0.0),lfoLevel:jspb.Message.getFloatingPointFieldWithDefault(msg,10,0.0),lfoTarget:jspb.Message.getFieldWithDefault(msg,11,0),lfoMode:jspb.Message.getFieldWithDefault(msg,12,0)};if(includeInstance){obj.$jspbMessageInstance=msg;}
return obj;};}
proto.Synth.deserializeBinary=function(bytes){var reader=new jspb.BinaryReader(bytes);var msg=new proto.Synth;return proto.Synth.deserializeBinaryFromReader(msg,reader);};proto.Synth.deserializeBinaryFromReader=function(msg,reader){while(reader.nextField()){if(reader.isEndGroup()){break;}
var field=reader.getFieldNumber();switch(field){case 1:var value=(reader.readEnum());msg.setType(value);break;case 2:var value=new proto.Envelope;reader.readMessage(value,proto.Envelope.deserializeBinaryFromReader);msg.setVolumeEnvelope(value);break;case 3:var value=new proto.Envelope;reader.readMessage(value,proto.Envelope.deserializeBinaryFromReader);msg.setFilterEnvelope(value);break;case 4:var value=(reader.readFloat());msg.setFilter(value);break;case 5:var value=(reader.readFloat());msg.setResonance(value);break;case 6:var value=(reader.readInt32());msg.setFilterType(value);break;case 7:var value=(reader.readBool());msg.setLfoEnabled(value);break;case 8:var value=(reader.readEnum());msg.setLfoType(value);break;case 9:var value=(reader.readFloat());msg.setLfoFreq(value);break;case 10:var value=(reader.readFloat());msg.setLfoLevel(value);break;case 11:var value=(reader.readEnum());msg.setLfoTarget(value);break;case 12:var value=(reader.readEnum());msg.setLfoMode(value);break;default:reader.skipField();break;}}
return msg;};proto.Synth.prototype.serializeBinary=function(){var writer=new jspb.BinaryWriter();proto.Synth.serializeBinaryToWriter(this,writer);return writer.getResultBuffer();};proto.Synth.serializeBinaryToWriter=function(message,writer){var f=undefined;f=message.getType();if(f!==0.0){writer.writeEnum(1,f);}
f=message.getVolumeEnvelope();if(f!=null){writer.writeMessage(2,f,proto.Envelope.serializeBinaryToWriter);}
f=message.getFilterEnvelope();if(f!=null){writer.writeMessage(3,f,proto.Envelope.serializeBinaryToWriter);}
f=message.getFilter();if(f!==0.0){writer.writeFloat(4,f);}
f=message.getResonance();if(f!==0.0){writer.writeFloat(5,f);}
f=message.getFilterType();if(f!==0){writer.writeInt32(6,f);}
f=message.getLfoEnabled();if(f){writer.writeBool(7,f);}
f=message.getLfoType();if(f!==0.0){writer.writeEnum(8,f);}
f=message.getLfoFreq();if(f!==0.0){writer.writeFloat(9,f);}
f=message.getLfoLevel();if(f!==0.0){writer.writeFloat(10,f);}
f=message.getLfoTarget();if(f!==0.0){writer.writeEnum(11,f);}
f=message.getLfoMode();if(f!==0.0){writer.writeEnum(12,f);}};proto.Synth.prototype.getType=function(){return(jspb.Message.getFieldWithDefault(this,1,0));};proto.Synth.prototype.setType=function(value){return jspb.Message.setProto3EnumField(this,1,value);};proto.Synth.prototype.getVolumeEnvelope=function(){return(jspb.Message.getWrapperField(this,proto.Envelope,2));};proto.Synth.prototype.setVolumeEnvelope=function(value){return jspb.Message.setWrapperField(this,2,value);};proto.Synth.prototype.clearVolumeEnvelope=function(){return this.setVolumeEnvelope(undefined);};proto.Synth.prototype.hasVolumeEnvelope=function(){return jspb.Message.getField(this,2)!=null;};proto.Synth.prototype.getFilterEnvelope=function(){return(jspb.Message.getWrapperField(this,proto.Envelope,3));};proto.Synth.prototype.setFilterEnvelope=function(value){return jspb.Message.setWrapperField(this,3,value);};proto.Synth.prototype.clearFilterEnvelope=function(){return this.setFilterEnvelope(undefined);};proto.Synth.prototype.hasFilterEnvelope=function(){return jspb.Message.getField(this,3)!=null;};proto.Synth.prototype.getFilter=function(){return(jspb.Message.getFloatingPointFieldWithDefault(this,4,0.0));};proto.Synth.prototype.setFilter=function(value){return jspb.Message.setProto3FloatField(this,4,value);};proto.Synth.prototype.getResonance=function(){return(jspb.Message.getFloatingPointFieldWithDefault(this,5,0.0));};proto.Synth.prototype.setResonance=function(value){return jspb.Message.setProto3FloatField(this,5,value);};proto.Synth.prototype.getFilterType=function(){return(jspb.Message.getFieldWithDefault(this,6,0));};proto.Synth.prototype.setFilterType=function(value){return jspb.Message.setProto3IntField(this,6,value);};proto.Synth.prototype.getLfoEnabled=function(){return(jspb.Message.getBooleanFieldWithDefault(this,7,false));};proto.Synth.prototype.setLfoEnabled=function(value){return jspb.Message.setProto3BooleanField(this,7,value);};proto.Synth.prototype.getLfoType=function(){return(jspb.Message.getFieldWithDefault(this,8,0));};proto.Synth.prototype.setLfoType=function(value){return jspb.Message.setProto3EnumField(this,8,value);};proto.Synth.prototype.getLfoFreq=function(){return(jspb.Message.getFloatingPointFieldWithDefault(this,9,0.0));};proto.Synth.prototype.setLfoFreq=function(value){return jspb.Message.setProto3FloatField(this,9,value);};proto.Synth.prototype.getLfoLevel=function(){return(jspb.Message.getFloatingPointFieldWithDefault(this,10,0.0));};proto.Synth.prototype.setLfoLevel=function(value){return jspb.Message.setProto3FloatField(this,10,value);};proto.Synth.prototype.getLfoTarget=function(){return(jspb.Message.getFieldWithDefault(this,11,0));};proto.Synth.prototype.setLfoTarget=function(value){return jspb.Message.setProto3EnumField(this,11,value);};proto.Synth.prototype.getLfoMode=function(){return(jspb.Message.getFieldWithDefault(this,12,0));};proto.Synth.prototype.setLfoMode=function(value){return jspb.Message.setProto3EnumField(this,12,value);};goog.provide('proto.SynthType');proto.SynthType={SINE:0,SQUARE:1,SAWTOOTH:2,TRIANGLE:3};